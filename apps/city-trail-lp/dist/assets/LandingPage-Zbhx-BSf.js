import{r as o,j as e,s as D,u as es,a as ca,b as Br,R as qr,c as Fr}from"./index-VJX5zWq_.js";import{A as Ua,M as Ga,a as la,u as Hr,b as Qr}from"./index.modern-DWtZusUZ.js";import{X as nt}from"./x-DLcRSZaz.js";import{c as le}from"./createLucideIcon-Dxvw1eg7.js";import{A as Ue,m as N}from"./proxy-CrgiBIYO.js";import{M as Wa,S as xa,Z as oa,T as Vr,C as Ka}from"./zap-DTWphECb.js";import{L as Ja,B as Ur,Q as Gr}from"./quote-DoFiGcnn.js";import{S as Be,P as Pa,W as os,a as Wr}from"./wand-sparkles-D8zMdiHu.js";import{C as Nt,a as Ts}from"./chevron-down-t5OWlCYu.js";import{M as Fe,U as lt,B as zt}from"./users-DCMXpzDX.js";import{G as cs}from"./globe-b8VqUKjr.js";import{T as Is}from"./triangle-alert-CAxn-Gzi.js";import{A as xt,T as Ot}from"./target-ChKfILWd.js";import{L as Jt}from"./loader-circle-lzbaSVFX.js";import{C as ot}from"./circle-check-big-DNq-ELMc.js";import{T as ma,G as Kr}from"./trash-2-CyB3FX1s.js";import{S as Ms,C as Aa}from"./smartphone-CqMTRR9W.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Ya=le("bell",Jr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],ha=le("briefcase",Yr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Za=le("building-2",Zr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],zs=le("chart-no-axes-column",Xr);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],tn=le("chart-pie",en);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],an=le("chevron-left",sn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],pa=le("chevron-right",rn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Xa=le("circle-alert",nn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Ea=le("circle-plus",ln);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],yt=le("clock",on);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],wt=le("compass",dn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],xn=le("copy",cn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],Zt=le("crown",mn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]],Zs=le("dices",hn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Dt=le("earth",pn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],bn=le("external-link",un);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],La=le("eye",gn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Xs=le("flame",fn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],vn=le("footprints",jn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],Nn=le("gift",yn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],kn=le("graduation-cap",wn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Sn=le("grid-3x3",_n);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Ps=le("heart",Cn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],er=le("info",Tn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],is=le("lightbulb",In);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],$s=le("lock",zn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Mn=le("log-out",$n);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],ia=le("mail",Pn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],ua=le("map",An);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],Ln=le("navigation",En);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],On=le("pencil",Dn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],tr=le("play",Rn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=[["path",{d:"M15.39 4.39a1 1 0 0 0 1.68-.474 2.5 2.5 0 1 1 3.014 3.015 1 1 0 0 0-.474 1.68l1.683 1.682a2.414 2.414 0 0 1 0 3.414L19.61 15.39a1 1 0 0 1-1.68-.474 2.5 2.5 0 1 0-3.014 3.015 1 1 0 0 1 .474 1.68l-1.683 1.682a2.414 2.414 0 0 1-3.414 0L8.61 19.61a1 1 0 0 0-1.68.474 2.5 2.5 0 1 1-3.014-3.015 1 1 0 0 0 .474-1.68l-1.683-1.682a2.414 2.414 0 0 1 0-3.414L4.39 8.61a1 1 0 0 1 1.68.474 2.5 2.5 0 1 0 3.014-3.015 1 1 0 0 1-.474-1.68l1.683-1.682a2.414 2.414 0 0 1 3.414 0z",key:"w46dr5"}]],qn=le("puzzle",Bn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],ds=le("rocket",Fn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],Qn=le("scan-line",Hn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=[["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],ea=le("scroll",Vn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],sr=le("search",Un);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gn=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],As=le("send",Gn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],da=le("share-2",Wn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kn=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ks=le("square-check-big",Kn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Kt=le("square-pen",Jn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],xs=le("star",Yn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]],Xn=le("store",Zn);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],tl=le("tag",el);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=[["path",{d:"M8 19a4 4 0 0 1-2.24-7.32A3.5 3.5 0 0 1 9 6.03V6a3 3 0 1 1 6 0v.04a3.5 3.5 0 0 1 3.24 5.65A4 4 0 0 1 16 19Z",key:"oadzkq"}],["path",{d:"M12 19v3",key:"npa21l"}]],al=le("tree-deciduous",sl);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],nl=le("trophy",rl);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ll=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ol=le("user",ll),il={ja:{nav:{features:"特徴",howItWorks:"遊び方",scenes:"シーン",creators:"クリエイターの方へ",business:"自治体・企業の方へ",faq:"FAQ",contact:"お問い合わせ",findQuest:"クエストを探す"},common:{login:"ログイン",logout:"ログアウト",profile:"プロフィール",adminDashboard:"管理者ダッシュボード",notifications:"通知",noNotifications:"通知はありません。",loading:"読み込み中..."},hero:{label:"リアルワールド・ミステリーアドベンチャー",title:`いつもの街が、
冒険の舞台に。`,description:"「TOMOSHIBI」は、街歩きと謎解きを融合させた新しいエンターテインメント・プラットフォームです。スマートフォンの位置情報を使って、街に隠された物語を解き明かしましょう。",ctaStart:"冒険を始める",ctaCreate:"クエストを作る",seeHowToPlay:"遊び方をみる"},stats:{area:"対応エリア",areaValue:"全国拡大中",quests:"クエスト数",players:"プレイヤー数"},features:{title:"街を歩いて、謎を解く",list:[{title:"スマホひとつで完結",desc:"専用キットは不要。アプリ上の物語と地図、そして目の前の風景だけが手がかりです。"},{title:"好きなタイミングで",desc:"予約もガイドも必要ありません。思い立ったその瞬間が、冒険の始まりです。"},{title:"街の物語を体験",desc:"歴史的事実や都市伝説に基づいたオリジナルストーリーで、見慣れた街が違って見えます。"},{title:"絆を深める体験",desc:"協力して謎を解くことで、友人やパートナー、家族との会話が自然と弾みます。"}],pills:["現在地からスタート地点までナビ","オフラインでも謎解き続行","マルチプレイで進行を同期","クリア実績とバッジコレクション"]},steps:{title:"遊び方は簡単",list:[{title:"クエストを選ぶ",desc:"行きたいエリアやジャンル（歴史、ミステリー、グルメなど）から、心惹かれるクエストを選びましょう。"},{title:"現地へ向かう",desc:"スタート地点に到着したらアプリを起動。物語のプロローグが始まります。"},{title:"歩いて、探して、解く",desc:"出題される謎の手がかりは、街の中に隠されています。看板、石碑、建物の装飾をよく観察しましょう。"},{title:"エンディング",desc:"最後の謎を解き明かした時、あなたはこの街の新たな一面を知ることになります。"}]},scenes:{title:"日常を非日常に変える体験",subtitle:"様々なシチュエーションで、TOMOSHIBIは特別な時間を提供します。",list:[{title:"デートを冒険に",desc:"ただの散歩が、二人だけの秘密の探検に。協力して謎を解く過程で、相手の意外な一面が見えるかも。"},{title:"家族で街育",desc:"お子様と一緒に街の歴史や文化を楽しく学べます。宝探し感覚で、好奇心を刺激する休日を。"},{title:"仲間とチームビルディング",desc:"会社の研修やサークルのイベントに。役割分担とコミュニケーションが攻略の鍵となります。"}]},spr:{badge:"OFFICIAL BRAND",title:"SPR探偵事務所",subtitle:"の事件簿",description:'SPR探偵事務所は、社会課題を"事件"として扱い、街を舞台に謎解きで解決へ導く——TOMOSHIBIの公式世界観（架空の探偵組織）です。',fullName:"Social Problem Researchers",cta:"クエストを確認する"},creators:{label:"For Creators",title:"あなたの物語を、街に実装しよう。",description:"AIがストーリー・謎・会話を自動生成。スポット設定、キャラクター演出、多言語対応まで直感的なUIで完結。プレイ分析ダッシュボードで成果も可視化できます。",cta:"クリエイターになる"},faq:{title:"よくある質問",list:[{q:"1人でも遊べますか？",a:"はい、お一人でも十分にお楽しみいただけます。没入感のある物語体験として、ソロプレイを好まれる方も多くいらっしゃいます。"},{q:"所要時間はどれくらいですか？",a:"クエストによりますが、平均して1.5時間〜2.5時間程度です。制限時間はないため、途中でカフェ休憩を挟むなど自由にペース配分できます。"},{q:"子供でも楽しめますか？",a:"対象年齢に応じたクエストをご用意しています。「ファミリー向け」タグのついたクエストは、小学生のお子様でも保護者の方と一緒に楽しめる難易度です。"},{q:"途中で中断できますか？",a:"はい、進行状況は自動的に保存されます。別の日に続きから再開することも可能です。"}]},footer:{rights:"© 2024 Tomoshibi. All rights reserved.",links:["利用規約","プライバシーポリシー","特定商取引法に基づく表記","運営会社"],cta:`TOMOSHIBIで、
いつもの街に灯をともそう。`,company:"運営会社",privacyPolicy:"プライバシーポリシー",terms:"利用規約",contactFooter:"お問い合わせ",appComingSoon:"※アプリ版は近日公開予定。リリース通知はフォームから登録してください。",appAvailable:"App Store / Google Play からインストールできます"},install:{downloadApp:"モバイルアプリをダウンロード",startPuzzle:"アプリで謎解きを始める",viewQuestsBrowser:"まずはブラウザでクエストを見る",storeAvailable:"App Store / Google Play 対応",mobileAppBetter:"スマホアプリで遊ぶともっと快適",mobileAppDesc:"現在地からスタート地点までナビし、オフラインでも謎解きが続けられます。",playWithApp:"アプリで遊ぶ"},registration:{title:"先行登録で、冒険の準備を。",description:`アプリのリリース通知や、限定クエストの先行案内をお届けします。
メールアドレスだけで簡単にご登録いただけます。`,successMessage:"ご登録ありがとうございます！冒険の始まりをお待ちください。",emailPlaceholder:"メールアドレスを入力",submitButton:"登録する",privacyNote:"※ご登録いただいたメールアドレスは、本サービスのお知らせ以外には使用しません。"},creatorsPage:{hero:{badge:"Creator Studio",title:`あなたの街を、
キャンバスに変える。`,subtitle:"コード不要。地元の知識を没入型ミステリーアドベンチャーに変え、継続的な収益を得られます。",btnCreate:"クエストを作成",btnLearnMore:"詳しく見る"},whyCreate:{title:"なぜ作るのか？",subtitle:"TOMOSHIBIがプラットフォーム、観客、収益化ツールを提供。あなたはクリエイティビティを提供。",revenueTitle:"最大70%をキープ",revenueDesc:"クリエイターのための公正な収益シェアモデル。クエストがプレイされるほど、あなたの収益も増えます。隠し手数料はありません。",revenueLink:"収益化の詳細を見る",revenueEarnings:"想定収益",aiTitle:"AIコパイロット",aiDesc:"謎やストーリーに悩んだら？AIアシスタントが数秒でコンテンツの下書きを作成。楽しい部分に集中できます。",globalTitle:"グローバルな観客",globalDesc:"自動翻訳により、あなたのローカルクエストは世界中の旅行者がアクセスできるようになります。",portfolioTitle:"ポートフォリオ構築",portfolioDesc:"作家、ゲームデザイナー、地域史家が自分の才能を披露するのに最適。"},features:{subtitle:"プログラミング不要。AIがサポートする次世代の制作体験。",title:"制作を支えるツール",learnMore:"詳しく見る",tabs:[{title:"AI自動生成",description:"ストーリー・謎・ヒント・キャラクター会話をAIが自動生成。アイデアから完成まで最速で制作。",promptExample:"鎌倉を舞台にしたミステリーのプロットを作って",responseTitle:"タイトル：古都の影と消えた時計",responseText:"100年前の未解決事件が、現代の鎌倉で再び動き出す..."},{title:"スポット設計",description:"地図上で直感的にスポットを配置。道順・ヒント・正解条件を細かく設定。"},{title:"多言語対応",description:"日本語・英語・韓国語に対応。AI翻訳でインバウンドにもリーチ。",sourceLabel:"Source",sourceText:"謎を解いてください",enText:"Solve the puzzle",koText:"수수께끼를 풀어라"},{title:"プレイ分析",description:"参加数・クリア率・離脱ポイントを可視化。データドリブンで収益最大化。",playsLabel:"plays"}]},revenueSimulator:{badge:"収益シミュレーター",title:"公正な収益シェア。",subtitle:"透明性のある成長。",description:"クエストから生成される収益の最大70%を保持できます。隠し手数料やクリエイター向けのサブスク料金はありません。",monthlyPlayers:"月間プレイヤー数",people:"人",questPrice:"クエスト価格（推定）",estimatedIncome:"想定月間収入",disclaimer:"*70%の収益シェアモデルに基づく。プラットフォーム手数料や税金により実際の収益は異なる場合があります。",annualPotential:"年間見込",creatorShare:"クリエイターシェア"},howItWorks:{subtitle:"ローンチまでのシンプルな3ステップ。",title:"How it Works",steps:[{title:"制作",description:"世界観・謎・演出をワークシートで設計。AIがコンテンツ生成をサポート。"},{title:"スポット設定",description:"マップにチェックイン地点を配置。写真やヒントをセットし導線を確認。"},{title:"公開",description:"テストプレイ後に公開。プレイ数に応じて収益が自動計算されます。"}]},cta:{title:"旅を始めよう。",subtitle:"物語で街を照らすクリエイターのコミュニティに参加しましょう。",button:"クリエイターアカウントを作成"}},questsPage:{loading:"読み込み中...",questCount:t=>`${t}件のクエスト`,searchPlaceholder:"クエストを検索...",all:"すべて",beginner:"初級",intermediate:"中級",advanced:"上級",clearFilters:"フィルターをクリア",noQuestsFound:"クエストが見つかりませんでした",tryDifferent:"検索条件を変更してお試しください",sortNewest:"新着順",sortPopular:"人気順",sortRating:"評価順",sortDurationAsc:"所要時間（短い順）",sortDurationDesc:"所要時間（長い順）",minutes:t=>`約${t}分`,loadingQuest:"クエストを読み込み中...",defaultDescription:"街を歩きながら謎を解く、新しい体験型アドベンチャー"},profilePage:{home:"ホーム",myPage:"マイページ",exploreTomoshibi:"TOMOSHIBIで街の物語を探索・創造しましょう",createNewQuest:"新規クエストを作成",questsCreated:"作成したクエスト",playHistory:"プレイ履歴",statsDashboard:"統計ダッシュボード",notificationSettings:"通知設定",receiveEmailNotifications:"メール通知を受け取る",yourQuests:"あなたのクエスト",questsCount:t=>`${t}件`,noQuestsYet:"まだクエストがありません",emptyStateMessage:"街を舞台にした謎解きクエストを作成して、あなたの物語を世界に届けましょう。",createFirstQuest:"最初のクエストを作成",untitledQuest:"タイトル未設定",noArea:"エリア未設定",edit:"編集",analytics:"分析"},questDetailPage:{reviews:t=>`${t}件のレビュー`,playersPlayed:t=>`${t}人がプレイ`,duration:"所要時間",distance:"総距離",spots:"スポット数",clearRate:"クリア率",overview:"概要",defaultDescription:"街を歩きながら謎を解く、新しい体験型アドベンチャー。スマートフォン片手に、街の隠された物語を発見しましょう。",features:"このクエストの特徴",startingPoint:"スタート地点",availableAnytime:"24時間いつでもプレイ可能",hintFeature:"初心者でも安心のヒント機能付き",soloOrTeam:"1人でも仲間とでも楽しめます",howToPlay:"遊び方",step1Title:"クエストを開始",step1Desc:"スタート地点まで移動してアプリを起動",step2Title:"謎を解く",step2Desc:"各スポットで出題される謎を解いて次へ進む",step3Title:"ゴール",step3Desc:"全ての謎を解き明かしてクリア！",reviewsTitle:"レビュー",viewAll:"すべて見る",creator:"クリエーター",questCreator:"クエストクリエーター",notice:"ご注意",noticeText:"このクエストは屋外を歩きながら進めます。歩きやすい服装・靴でご参加ください。天候や交通状況にご注意ください。",startQuest:"クエストを開始する",participationFee:"参加費",free:"無料",join:"参加する",processing:"処理中...",aboutMin:t=>`約${t}分`,spotsCount:t=>`${t}箇所`}},en:{nav:{features:"Features",howItWorks:"How it Works",scenes:"Scenes",creators:"For Creators",business:"For Business",faq:"FAQ",contact:"Contact",findQuest:"Find a Quest"},common:{login:"Login",logout:"Logout",profile:"Profile",adminDashboard:"Admin Dashboard",notifications:"Notifications",noNotifications:"No notifications.",loading:"Loading..."},hero:{label:"Real World Mystery Adventure",title:`Turn familiar streets
into an adventure.`,description:"TOMOSHIBI is a new entertainment platform merging city walking with puzzle solving. Use your smartphone's location to unlock stories hidden in the city.",ctaStart:"Start Adventure",ctaCreate:"Create Quest",seeHowToPlay:"See How to Play"},stats:{area:"Areas",areaValue:"Expanding",quests:"Quests",players:"Players"},features:{title:"Walk the City, Solve Mysteries",list:[{title:"Just your Smartphone",desc:"No special kit needed. The story on the app, the map, and the scenery before you are your only clues."},{title:"Play Anytime",desc:"No reservation or guide needed. The moment you decide is when your adventure begins."},{title:"Experience City Stories",desc:"See familiar streets differently with original stories based on history and urban legends."},{title:"Deepen Bonds",desc:"Solving puzzles together naturally sparks conversation with friends, partners, or family."}],pills:["GPS Navigation to Start","Continue Puzzles Offline","Sync Progress in Multiplayer","Achievements & Badge Collection"]},steps:{title:"How to Play",list:[{title:"Choose a Quest",desc:"Select a quest that intrigues you by area or genre (history, mystery, gourmet, etc.)."},{title:"Go to the Spot",desc:"Arrive at the starting point and launch the app. The prologue of the story begins."},{title:"Walk, Search, Solve",desc:"Clues are hidden in the city. Observe signs, monuments, and architecture carefully."},{title:"The Ending",desc:"When you solve the final mystery, you will discover a new side of this city."}]},scenes:{title:"Extraordinary Experiences",subtitle:"TOMOSHIBI offers special moments for various situations.",list:[{title:"Date as Adventure",desc:"Turn a simple walk into a secret exploration for two. You might see a surprising side of your partner."},{title:"Family Edutainment",desc:"Learn city history and culture delightfully with children. A treasure hunt holiday that stimulates curiosity."},{title:"Team Building",desc:"For corporate training or club events. Role division and communication are keys to success."}]},spr:{badge:"OFFICIAL BRAND",title:"SPR Detective Agency",subtitle:"Case Files",description:`SPR Detective Agency treats social issues as "cases" and uses street-based puzzle solving to lead to solutions—This is TOMOSHIBI's official worldview (a fictional detective organization).`,fullName:"Social Problem Researchers",cta:"View Cases"},creators:{label:"For Creators",title:"Implement your story in the city.",description:"AI auto-generates stories, puzzles, and dialogues. From spot setup and character design to multilingual support, everything is done through an intuitive UI. Visualize results with the analytics dashboard.",cta:"Become a Creator"},faq:{title:"FAQ",list:[{q:"Can I play alone?",a:"Yes, you can fully enjoy it alone. Many prefer solo play for an immersive story experience."},{q:"How long does it take?",a:"It depends on the quest, but on average 1.5 to 2.5 hours. There is no time limit, so you can take breaks freely."},{q:"Is it suitable for children?",a:'We offer quests for different ages. Quests tagged "Family" are suitable for elementary school students with parents.'},{q:"Can I pause in the middle?",a:"Yes, progress is saved automatically. You can resume from where you left off on another day."}]},footer:{rights:"© 2024 Tomoshibi. All rights reserved.",links:["Terms of Service","Privacy Policy","Legal","Company"],cta:`Light up your everyday streets
with TOMOSHIBI.`,company:"Company",privacyPolicy:"Privacy Policy",terms:"Terms of Service",contactFooter:"Contact",appComingSoon:"※App coming soon. Register to get notified.",appAvailable:"Available on App Store / Google Play"},install:{downloadApp:"Download Mobile App",startPuzzle:"Start Puzzle Adventure",viewQuestsBrowser:"View Quests in Browser First",storeAvailable:"Available on App Store / Google Play",mobileAppBetter:"Even better on the mobile app",mobileAppDesc:"Navigate from your location to starting point and continue puzzles offline.",playWithApp:"Play with App"},registration:{title:"Get Ready for Your Adventure.",description:`Receive app release notifications and exclusive quest previews.
Register with just your email address.`,successMessage:"Thank you for registering! Get ready for your adventure.",emailPlaceholder:"Enter your email",submitButton:"Register",privacyNote:"※Your email address will only be used for notifications about this service."},creatorsPage:{hero:{badge:"Creator Studio",title:`Turn your city
into a canvas.`,subtitle:"No code required. Transform your local knowledge into an immersive mystery adventure and earn recurring revenue.",btnCreate:"Create a Quest",btnLearnMore:"Learn more"},whyCreate:{title:"Why Create?",subtitle:"TOMOSHIBI provides the platform, audience, and monetization tools. You provide the creativity.",revenueTitle:"Keep up to 70%",revenueDesc:"A fair revenue share model designed for creators. The more people play your quest, the more you earn. No hidden fees.",revenueLink:"View monetization details",revenueEarnings:"Estimated Earnings",aiTitle:"AI Copilot",aiDesc:"Stuck on a riddle? Need a storyline idea? Our AI assistant helps you draft content in seconds, so you can focus on the fun parts.",globalTitle:"Global Audience",globalDesc:"Auto-translation makes your local quest accessible to travelers from around the world.",portfolioTitle:"Build Portfolio",portfolioDesc:"Perfect for writers, game designers, and local historians to showcase their talent."},features:{subtitle:"No coding required. Next-generation creation experience powered by AI.",title:"Tools for Creators",learnMore:"Learn more",tabs:[{title:"AI Content Generator",description:"Auto-generate stories, puzzles, hints, and character dialogues with AI. From idea to completion in record time.",promptExample:"Create a mystery plot set in Kamakura",responseTitle:"Title: Shadows of the Ancient City and the Lost Clock",responseText:"An unsolved case from 100 years ago resurfaces in modern-day Kamakura..."},{title:"Spot Design",description:"Intuitively place spots on the map. Set routes, hints, and success conditions in detail."},{title:"Multilingual Support",description:"Support for Japanese, English, and Korean. Reach inbound tourists with AI translation.",sourceLabel:"Source",sourceText:"謎を解いてください",enText:"Solve the puzzle",koText:"수수께끼를 풀어라"},{title:"Play Analytics",description:"Visualize participation, completion rates, and drop-off points. Maximize revenue with data-driven insights.",playsLabel:"plays"}]},revenueSimulator:{badge:"EARNINGS SIMULATOR",title:"Fair revenue share.",subtitle:"Transparent growth.",description:"You keep up to 70% of the revenue generated from your quest. No hidden fees, no subscription costs for creators.",monthlyPlayers:"Monthly Players",people:"people",questPrice:"Quest Price (Est.)",estimatedIncome:"Estimated Monthly Income",disclaimer:"*Based on 70% revenue share model. Actual earnings may vary depending on platform fees and taxes.",annualPotential:"Annual Potential",creatorShare:"Creator Share"},howItWorks:{subtitle:"Simple 3 steps to launch.",title:"How it Works",steps:[{title:"Create",description:"Design your world, puzzles, and storytelling with worksheets. AI supports content generation."},{title:"Set Spots",description:"Place checkpoints on the map. Set photos, hints, and verify the route."},{title:"Publish",description:"Publish after testing. Revenue is automatically calculated based on play count."}]},cta:{title:"Start your journey.",subtitle:"Join the community of creators lighting up cities with stories.",button:"Create Creator Account"}},questsPage:{loading:"Loading...",questCount:t=>`${t} Quests`,searchPlaceholder:"Search quests...",all:"All",beginner:"Beginner",intermediate:"Intermediate",advanced:"Advanced",clearFilters:"Clear Filters",noQuestsFound:"No quests found",tryDifferent:"Try changing your search criteria",sortNewest:"Newest",sortPopular:"Popular",sortRating:"Rating",sortDurationAsc:"Duration (Shortest)",sortDurationDesc:"Duration (Longest)",minutes:t=>`~${t} min`,loadingQuest:"Loading quest...",defaultDescription:"An immersive adventure where you solve mysteries while exploring the city"},profilePage:{home:"Home",myPage:"My Page",exploreTomoshibi:"Explore and create city stories with TOMOSHIBI",createNewQuest:"Create New Quest",questsCreated:"Quests Created",playHistory:"Play History",statsDashboard:"Stats Dashboard",notificationSettings:"Notification Settings",receiveEmailNotifications:"Receive email notifications",yourQuests:"Your Quests",questsCount:t=>`${t} quests`,noQuestsYet:"No quests yet",emptyStateMessage:"Create a mystery quest set in the city and share your story with the world.",createFirstQuest:"Create Your First Quest",untitledQuest:"Untitled Quest",noArea:"No Area Set",edit:"Edit",analytics:"Analytics"},questDetailPage:{reviews:t=>`${t} reviews`,playersPlayed:t=>`${t} players`,duration:"Duration",distance:"Distance",spots:"Spots",clearRate:"Clear Rate",overview:"Overview",defaultDescription:"A new experiential adventure where you solve puzzles while walking through the city. Discover hidden stories in the city with your smartphone.",features:"Quest Features",startingPoint:"Starting Point",availableAnytime:"Available 24/7",hintFeature:"Hint feature for beginners",soloOrTeam:"Play solo or with friends",howToPlay:"How to Play",step1Title:"Start Quest",step1Desc:"Go to starting point and launch the app",step2Title:"Solve Puzzles",step2Desc:"Solve puzzles at each spot to proceed",step3Title:"Goal",step3Desc:"Clear all puzzles to complete!",reviewsTitle:"Reviews",viewAll:"View All",creator:"Creator",questCreator:"Quest Creator",notice:"Notice",noticeText:"This quest involves walking outdoors. Please wear comfortable clothes and shoes. Be mindful of weather and traffic.",startQuest:"Start Quest",participationFee:"Fee",free:"Free",join:"Join",processing:"Processing...",aboutMin:t=>`~${t} min`,spotsCount:t=>`${t} spots`}},ko:{nav:{features:"특징",howItWorks:"게임 방법",scenes:"이용 장면",creators:"크리에이터",business:"기업·지자체",faq:"FAQ",contact:"문의하기",findQuest:"퀘스트 찾기"},common:{login:"로그인",logout:"로그아웃",profile:"프로필",adminDashboard:"관리자 대시보드",notifications:"알림",noNotifications:"알림이 없습니다.",loading:"로딩 중..."},hero:{label:"리얼 월드 미스터리 어드벤처",title:`익숙한 거리가,
모험의 무대로.`,description:"「TOMOSHIBI」는 산책과 수수께끼 풀이를 융합한 새로운 엔터테인먼트 플랫폼입니다. 스마트폰의 위치 정보를 사용하여 도시에 숨겨진 이야기를 풀어보세요.",ctaStart:"모험 시작하기",ctaCreate:"퀘스트 만들기",seeHowToPlay:"플레이 방법 보기"},stats:{area:"대응 지역",areaValue:"전국 확대 중",quests:"퀘스트 수",players:"플레이어 수"},features:{title:"거리를 걸으며, 수수께끼를 풀다",list:[{title:"스마트폰 하나로 완결",desc:"전용 키트는 필요 없습니다. 앱 속 이야기와 지도, 그리고 눈앞의 풍경만이 단서입니다."},{title:"원하는 타이밍에",desc:"예약도 가이드도 필요 없습니다. 생각난 그 순간이 모험의 시작입니다."},{title:"도시의 이야기를 체험",desc:"역사적 사실이나 도시 전설에 기반한 오리지널 스토리로, 익숙한 거리가 다르게 보입니다."},{title:"유대감을 깊게 하는 체험",desc:"함께 협력하여 수수께끼를 풀면서 친구, 연인, 가족과의 대화가 자연스럽게 늘어납니다."}],pills:["현 위치에서 시작 지점까지 내비게이션","오프라인에서도 수수께끼 진행 가능","멀티플레이로 진행 상황 동기화","클리어 실적 및 배지 컬렉션"]},steps:{title:"게임 방법은 간단",list:[{title:"퀘스트 선택",desc:"가고 싶은 지역이나 장르(역사, 미스터리, 미식 등) 중에서 마음이 끌리는 퀘스트를 선택하세요."},{title:"현지로 이동",desc:"시작 지점에 도착하면 앱을 실행하세요. 이야기의 프롤로그가 시작됩니다."},{title:"걷고, 찾고, 풀기",desc:"출제되는 수수께끼의 단서는 거리 속에 숨겨져 있습니다. 간판, 비석, 건물의 장식을 잘 관찰하세요."},{title:"엔딩",desc:"마지막 수수께끼를 풀어냈을 때, 당신은 이 도시의 새로운 일면을 알게 될 것입니다."}]},scenes:{title:"일상을 비일상으로 바꾸는 체험",subtitle:"다양한 상황에서 TOMOSHIBI는 특별한 시간을 제공합니다.",list:[{title:"데이트를 모험으로",desc:"단순한 산책이 둘만의 비밀 탐험으로. 협력하여 수수께끼를 푸는 과정에서 상대방의 의외의 모습을 볼 수도 있습니다."},{title:"가족과 함께하는 도시 교육",desc:"아이와 함께 도시의 역사와 문화를 즐겁게 배울 수 있습니다. 보물 찾기 감각으로 호기심을 자극하는 휴일을."},{title:"동료와 팀 빌딩",desc:"회사의 연수나 동호회 이벤트로. 역할 분담과 커뮤니케이션이 공략의 열쇠가 됩니다."}]},spr:{badge:"OFFICIAL BRAND",title:"SPR 탐정 사무소",subtitle:"사건 파일",description:'SPR 탐정 사무소는 사회 문제를 "사건"으로 다루며, 거리를 무대로 수수께끼 풀이로 해결로 이끕니다—TOMOSHIBI의 공식 세계관(가상의 탐정 조직)입니다.',fullName:"Social Problem Researchers",cta:"케이스 보기"},creators:{label:"For Creators",title:"당신의 이야기를 도시에 구현하세요.",description:"AI가 스토리, 퍼즐, 대화를 자동 생성합니다. 스팟 설정부터 캐릭터 연출, 다국어 지원까지 직관적인 UI로 완성. 플레이 분석 대시보드로 성과를 시각화할 수 있습니다.",cta:"크리에이터 되기"},faq:{title:"자주 묻는 질문",list:[{q:"혼자서도 할 수 있나요?",a:"네, 혼자서도 충분히 즐기실 수 있습니다. 몰입감 있는 이야기 체험을 위해 솔로 플레이를 선호하는 분들도 많습니다."},{q:"소요 시간은 얼마나 걸리나요?",a:"퀘스트에 따라 다르지만, 평균 1.5시간~2.5시간 정도입니다. 제한 시간이 없으므로 도중에 카페에서 휴식을 취하는 등 자유롭게 페이스를 조절할 수 있습니다."},{q:"아이들도 즐길 수 있나요?",a:'대상 연령에 따른 퀘스트가 준비되어 있습니다. "패밀리" 태그가 붙은 퀘스트는 초등학생 자녀도 보호자와 함께 즐길 수 있는 난이도입니다.'},{q:"도중에 중단할 수 있나요?",a:"네, 진행 상황은 자동으로 저장됩니다. 다른 날 이어서 재개하는 것도 가능합니다."}]},footer:{rights:"© 2024 Tomoshibi. All rights reserved.",links:["이용 약관","개인정보 처리방침","법적 고지","운영 회사"],cta:`TOMOSHIBI로,
익숙한 거리에 불을 밝히세요.`,company:"운영 회사",privacyPolicy:"개인정보 처리방침",terms:"이용 약관",contactFooter:"문의하기",appComingSoon:"※앱 버전은 곧 출시 예정입니다. 출시 알림을 받으려면 등록해 주세요.",appAvailable:"App Store / Google Play에서 설치할 수 있습니다"},install:{downloadApp:"모바일 앱 다운로드",startPuzzle:"앱으로 퍼즐 시작하기",viewQuestsBrowser:"먼저 브라우저에서 퀘스트 보기",storeAvailable:"App Store / Google Play 지원",mobileAppBetter:"모바일 앱으로 더 편하게",mobileAppDesc:"현재 위치에서 시작 지점까지 내비게이션하고, 오프라인에서도 퍼즐을 계속할 수 있습니다.",playWithApp:"앱으로 플레이"},registration:{title:"사전 등록으로 모험을 준비하세요.",description:`앱 출시 알림과 한정 퀘스트 사전 안내를 보내드립니다.
이메일 주소만으로 간단히 등록할 수 있습니다.`,successMessage:"등록해 주셔서 감사합니다! 모험의 시작을 기다려 주세요.",emailPlaceholder:"이메일 주소 입력",submitButton:"등록하기",privacyNote:"※등록하신 이메일 주소는 본 서비스의 알림 이외에는 사용하지 않습니다."},creatorsPage:{hero:{badge:"Creator Studio",title:`당신의 도시를
캔버스로 만들어보세요.`,subtitle:"코딩 불필요. 지역 지식을 몰입형 미스터리 어드벤처로 변환하고 지속적인 수익을 얻으세요.",btnCreate:"퀘스트 만들기",btnLearnMore:"자세히 보기"},whyCreate:{title:"왜 만들까요?",subtitle:"TOMOSHIBI가 플랫폼, 관객, 수익화 도구를 제공합니다. 당신은 창의성을 제공하세요.",revenueTitle:"최대 70% 보유",revenueDesc:"크리에이터를 위한 공정한 수익 분배 모델. 더 많은 사람들이 당신의 퀘스트를 플레이할수록 더 많이 벌 수 있습니다. 숨겨진 수수료는 없습니다.",revenueLink:"수익화 세부정보 보기",revenueEarnings:"예상 수익",aiTitle:"AI 코파일럿",aiDesc:"수수께끼나 스토리라인이 막혔나요? AI 어시스턴트가 몇 초 안에 콘텐츠 초안을 작성해주어 재미있는 부분에 집중할 수 있습니다.",globalTitle:"글로벌 관객",globalDesc:"자동 번역을 통해 당신의 로컬 퀘스트를 전 세계 여행자들이 이용할 수 있게 됩니다.",portfolioTitle:"포트폴리오 구축",portfolioDesc:"작가, 게임 디자이너, 지역 역사가들이 재능을 선보이기에 완벽합니다."},features:{subtitle:"코딩 불필요. AI 지원으로 차세대 제작 경험.",title:"크리에이터를 위한 도구",learnMore:"자세히 보기",tabs:[{title:"AI 자동 생성",description:"스토리, 퍼즐, 힌트, 캐릭터 대화를 AI가 자동 생성. 아이디어에서 완성까지 최고 속도로 제작.",promptExample:"가마쿠라를 배경으로 한 미스터리 플롯을 만들어줘",responseTitle:"제목: 고대 도시의 그림자와 사라진 시계",responseText:"100년 전 미해결 사건이 현대 가마쿠라에서 다시 움직이기 시작한다..."},{title:"스팟 디자인",description:"지도에서 직관적으로 스팟을 배치. 경로, 힌트, 정답 조건을 세밀하게 설정."},{title:"다국어 지원",description:"일본어, 영어, 한국어 지원. AI 번역으로 인바운드 관광객에게도 도달.",sourceLabel:"Source",sourceText:"謎를 해결してください",enText:"Solve the puzzle",koText:"수수께끼를 풀어라"},{title:"플레이 분석",description:"참가 수, 클리어율, 이탈 지점을 시각화. 데이터 기반으로 수익 극대화.",playsLabel:"plays"}]},revenueSimulator:{badge:"수익 시뮬레이터",title:"공정한 수익 분배.",subtitle:"투명한 성장.",description:"퀘스트에서 발생하는 수익의 최대 70%를 보유할 수 있습니다. 숨겨진 수수료나 크리에이터 구독료가 없습니다.",monthlyPlayers:"월간 플레이어",people:"명",questPrice:"퀘스트 가격 (예상)",estimatedIncome:"예상 월간 수입",disclaimer:"*70% 수익 분배 모델 기반. 플랫폼 수수료 및 세금에 따라 실제 수익이 다를 수 있습니다.",annualPotential:"연간 잠재력",creatorShare:"크리에이터 몫"},howItWorks:{subtitle:"출시까지 간단한 3단계.",title:"How it Works",steps:[{title:"제작",description:"세계관, 퍼즐, 연출을 워크시트로 설계. AI가 콘텐츠 생성을 지원합니다."},{title:"스팟 설정",description:"지도에 체크인 지점을 배치. 사진과 힌트를 설정하고 동선을 확인하세요."},{title:"출시",description:"테스트 플레이 후 공개. 플레이 횟수에 따라 수익이 자동 계산됩니다."}]},cta:{title:"여정을 시작하세요.",subtitle:"이야기로 도시를 밝히는 크리에이터 커뮤니티에 참여하세요.",button:"크리에이터 계정 만들기"}},questsPage:{loading:"로딩 중...",questCount:t=>`${t}개의 퀘스트`,searchPlaceholder:"퀘스트 검색...",all:"전체",beginner:"초급",intermediate:"중급",advanced:"고급",clearFilters:"필터 초기화",noQuestsFound:"퀘스트를 찾을 수 없습니다",tryDifferent:"검색 조건을 변경해 보세요",sortNewest:"최신순",sortPopular:"인기순",sortRating:"평점순",sortDurationAsc:"소요 시간 (짧은 순)",sortDurationDesc:"소요 시간 (긴 순)",minutes:t=>`약 ${t}분`,loadingQuest:"퀘스트 로딩 중...",defaultDescription:"도시를 탐험하며 미스터리를 풀어가는 몰입형 어드벤처"},profilePage:{home:"홈",myPage:"마이페이지",exploreTomoshibi:"TOMOSHIBI로 도시의 이야기를 탐험하고 창작하세요",createNewQuest:"새 퀘스트 만들기",questsCreated:"만든 퀘스트",playHistory:"플레이 기록",statsDashboard:"통계 대시보드",notificationSettings:"알림 설정",receiveEmailNotifications:"이메일 알림 받기",yourQuests:"내 퀘스트",questsCount:t=>`${t}개`,noQuestsYet:"아직 퀘스트가 없습니다",emptyStateMessage:"도시를 배경으로 한 미스터리 퀘스트를 만들어 세상에 당신의 이야기를 전하세요.",createFirstQuest:"첫 번째 퀘스트 만들기",untitledQuest:"제목 없음",noArea:"에리어 미설정",edit:"편집",analytics:"분석"},questDetailPage:{reviews:t=>`리뷰 ${t}건`,playersPlayed:t=>`${t}명 플레이`,duration:"소요 시간",distance:"총 거리",spots:"스팟 수",clearRate:"클리어율",overview:"개요",defaultDescription:"거리를 걸으며 퍼즐을 푸는 새로운 체험형 어드벤처. 스마트폰으로 도시에 숨겨진 이야기를 발견하세요.",features:"퀘스트 특징",startingPoint:"시작 지점",availableAnytime:"24시간 플레이 가능",hintFeature:"초보자를 위한 힌트 기능",soloOrTeam:"혼자 또는 친구와 함께",howToPlay:"플레이 방법",step1Title:"퀘스트 시작",step1Desc:"시작 지점으로 이동 후 앱 실행",step2Title:"퍼즐 풀기",step2Desc:"각 스팟에서 퍼즐을 풀어 진행",step3Title:"골",step3Desc:"모든 퍼즐을 풀어 클리어!",reviewsTitle:"리뷰",viewAll:"모두 보기",creator:"크리에이터",questCreator:"퀘스트 크리에이터",notice:"주의사항",noticeText:"이 퀘스트는 야외에서 걸으며 진행됩니다. 편한 복장과 신발을 착용해 주세요. 날씨와 교통에 주의하세요.",startQuest:"퀘스트 시작",participationFee:"참가비",free:"무료",join:"참가하기",processing:"처리 중...",aboutMin:t=>`약 ${t}분`,spotsCount:t=>`${t}개소`}}},dl="AIzaSyBR6o-tY4ewZA-FJigO1FoSE5FAEouYGcs",Ut={title:"渋谷路地裏・タイムトラベル",currentStep:2,totalSteps:5,currentObjective:"古い郵便ポストを探せ",nextHint:"赤くて丸い、昔ながらの形をしている。",targetLocation:{lat:35.6604,lng:139.7001}},cl=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],xl=()=>e.jsx("div",{className:"absolute top-24 right-4 z-10",children:e.jsx("div",{className:"w-12 h-12 bg-black/40 backdrop-blur-md rounded-full border border-white/20 flex items-center justify-center shadow-lg",children:e.jsx(wt,{className:"text-white/80 w-6 h-6"})})}),ml=()=>e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute w-20 h-20 bg-brand-gold/20 rounded-full animate-ping"}),e.jsx("div",{className:"absolute w-4 h-4 bg-brand-gold rounded-full border-2 border-white shadow-lg z-10"}),e.jsx("div",{className:"absolute w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-t-[24px] border-t-brand-gold/30 -top-8 rotate-0"})]});function hl({onBackHome:t}){const[a,n]=o.useState("map"),[r,m]=o.useState(!0),[g,d]=o.useState(!1),[u,x]=o.useState({lat:35.659,lng:139.7005});return e.jsxs("div",{className:"relative h-screen w-full bg-stone-900 overflow-hidden text-white font-sans",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx(Ua,{apiKey:dl,children:e.jsxs(Ga,{defaultCenter:u,defaultZoom:17,mapId:"tomoshibi_game_map",options:{styles:cl,disableDefaultUI:!0,zoomControl:!1,gestureHandling:"greedy"},className:"w-full h-full",children:[e.jsx(la,{position:u,children:e.jsx(ml,{})}),e.jsx(la,{position:Ut.targetLocation,children:e.jsx("div",{className:"w-32 h-32 bg-brand-gold/5 rounded-full border-2 border-brand-gold/30 border-dashed animate-[spin_10s_linear_infinite]"})})]})})}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 pt-12 bg-gradient-to-b from-black/80 to-transparent z-10 pointer-events-none",children:e.jsxs("div",{className:"flex items-start justify-between pointer-events-auto",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-white/10 backdrop-blur rounded-full flex items-center justify-center border border-white/20",children:e.jsx(nt,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-0.5 bg-brand-gold text-brand-dark text-[10px] font-bold rounded-full inline-block mb-1",children:"QUEST IN PROGRESS"}),e.jsx("h2",{className:"text-lg font-bold leading-none shadow-black drop-shadow-md",children:Ut.title})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"text-2xl font-bold font-serif italic text-brand-gold drop-shadow-md",children:[Ut.currentStep," ",e.jsxs("span",{className:"text-sm text-white/60 not-italic font-sans",children:["/ ",Ut.totalSteps]})]})})]})}),e.jsx(xl,{}),e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 transition-transform duration-500 z-20 ${r?"translate-y-0":"translate-y-[85%]"}`,children:[e.jsx("div",{className:"w-full h-8 flex justify-center items-center -mt-8 pt-4 pb-2 cursor-pointer pointer-events-auto",onClick:()=>m(!r),children:e.jsx("div",{className:"w-12 h-1.5 bg-white/80 rounded-full shadow-lg"})}),e.jsxs("div",{className:"bg-stone-900/90 backdrop-blur-xl border-t border-white/10 rounded-t-[2rem] p-6 pb-12 shadow-2xl h-[400px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand-gold",children:[e.jsx(Ln,{size:18,className:"animate-pulse"}),e.jsx("span",{className:"text-xs font-bold tracking-widest uppercase",children:"Current Objective"})]}),e.jsxs("button",{onClick:()=>d(!g),className:"flex items-center gap-1.5 px-3 py-1.5 bg-white/10 rounded-full text-xs font-bold hover:bg-white/20 transition-colors",children:[e.jsx(is,{size:14,className:g?"text-yellow-400":"text-stone-400"}),g?"Hide Hint":"Need Hint?"]})]}),e.jsx("h3",{className:"text-2xl font-bold mb-4",children:Ut.currentObjective}),e.jsx(Ue,{children:g&&e.jsx(N.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-brand-gold/10 border border-brand-gold/30 p-4 rounded-xl mb-6 overflow-hidden",children:e.jsx("p",{className:"text-sm text-brand-gold",children:Ut.nextHint})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{className:"flex flex-col items-center justify-center gap-2 bg-gradient-to-br from-brand-gold/80 to-brand-gold text-brand-dark p-4 rounded-2xl font-bold shadow-lg shadow-brand-gold/20 active:scale-95 transition-transform",children:[e.jsx(Qn,{size:24}),e.jsx("span",{children:"Scan Object"})]}),e.jsxs("button",{className:"flex flex-col items-center justify-center gap-2 bg-stone-800 border border-white/10 p-4 rounded-2xl font-bold active:scale-95 transition-transform hover:bg-stone-700",children:[e.jsx(Wa,{size:24}),e.jsx("span",{children:"Items"})]})]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-6 bg-transparent"})]})}const ar=({level:t,labels:a})=>{const r=a||{beginner:"初級",intermediate:"中級",advanced:"上級"},m={初級:r.beginner,中級:r.intermediate,上級:r.advanced},g={初級:"bg-emerald-50 text-emerald-700 border-emerald-200",中級:"bg-amber-50 text-amber-700 border-amber-200",上級:"bg-rose-50 text-rose-700 border-rose-200"};return e.jsx("span",{className:`px-2 py-0.5 rounded border text-[11px] font-medium ${g[t]}`,children:m[t]||t})},pl=({quest:t,onSelect:a})=>e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{y:-6,transition:{duration:.2}},onClick:()=>a(t),className:"group relative bg-white/80 backdrop-blur-sm rounded-2xl overflow-hidden cursor-pointer border border-stone-200/60 hover:border-amber-400/60 shadow-sm hover:shadow-xl hover:shadow-amber-100/50 transition-all duration-300",children:[e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden",children:[e.jsx("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-60 group-hover:opacity-40 transition-opacity duration-300"}),e.jsx("div",{className:"absolute -top-10 -right-10 w-32 h-32 bg-amber-400/20 rounded-full blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),t.rating>0&&e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-1.5 px-2.5 py-1.5 bg-white/95 backdrop-blur-md rounded-lg shadow-lg border border-white/50",children:[e.jsx(xs,{size:13,className:"text-amber-500 fill-amber-500"}),e.jsx("span",{className:"text-sm font-bold text-stone-800",children:t.rating.toFixed(1)}),e.jsxs("span",{className:"text-[10px] text-stone-500",children:["(",t.reviews,")"]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-white/90 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-white/20 backdrop-blur-sm rounded-full",children:[e.jsx(yt,{size:12}),e.jsxs("span",{children:["約",Math.round(t.durationMin/5)*5,"分"]})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-white/20 backdrop-blur-sm rounded-full",children:[e.jsx(wt,{size:12}),e.jsxs("span",{children:[t.distanceKm.toFixed(1),"km"]})]})]})})]}),e.jsxs("div",{className:"p-4 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-50/0 to-amber-100/0 group-hover:from-amber-50/50 group-hover:to-amber-100/30 transition-all duration-300"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-stone-500 mb-2",children:[e.jsx(Fe,{size:12,className:"text-amber-600"}),e.jsx("span",{className:"font-medium",children:t.area}),e.jsx("span",{className:"text-stone-300",children:"•"}),e.jsx(ar,{level:t.difficulty})]}),e.jsx("h3",{className:"font-bold text-stone-900 leading-snug mb-3 line-clamp-2 group-hover:text-amber-700 transition-colors duration-200",children:t.title}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-stone-500 line-clamp-1 flex-1 mr-2",children:t.description||"街を歩きながら謎を解く冒険"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center shadow-md group-hover:shadow-amber-200 transition-shadow",children:e.jsx(pa,{size:16,className:"text-white"})})]})]})]})]}),ul=({quest:t,onSelect:a})=>e.jsxs("div",{onClick:()=>a(t),className:"group flex bg-white rounded-xl overflow-hidden cursor-pointer border border-stone-200 hover:border-brand-gold hover:shadow-lg transition-all duration-200",children:[e.jsx("div",{className:"relative w-48 flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"})}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-stone-500 mb-2",children:[e.jsx(Fe,{size:12}),e.jsx("span",{children:t.area}),e.jsx("span",{className:"text-stone-300",children:"•"}),e.jsx(ar,{level:t.difficulty})]}),e.jsx("h3",{className:"font-bold text-stone-900 leading-snug mb-2 group-hover:text-brand-gold transition-colors",children:t.title}),e.jsx("p",{className:"text-sm text-stone-500 line-clamp-2 mb-3",children:t.description||"街を歩きながら謎を解く、新しい体験型アドベンチャー"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-stone-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{size:14}),e.jsxs("span",{children:["約",Math.round(t.durationMin/5)*5,"分"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(wt,{size:14}),e.jsxs("span",{children:[t.distanceKm.toFixed(1),"km"]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{size:14,className:"text-amber-500 fill-amber-500"}),e.jsx("span",{className:"font-medium text-stone-700",children:t.rating.toFixed(1)}),e.jsxs("span",{className:"text-stone-400",children:["(",t.reviews,")"]})]})]}),e.jsx(pa,{size:20,className:"text-stone-400 group-hover:text-brand-gold transition-colors"})]})]})]}),Gt=({label:t,active:a,onClick:n,count:r})=>e.jsxs(N.button,{whileHover:{scale:1.03},whileTap:{scale:.97},onClick:n,className:`flex items-center gap-1.5 px-4 py-2.5 rounded-full text-sm font-medium transition-all duration-300 whitespace-nowrap ${a?"bg-gradient-to-r from-amber-500 to-amber-600 text-white shadow-md shadow-amber-200/50":"bg-white/80 backdrop-blur-sm border border-stone-200 text-stone-600 hover:border-amber-300 hover:bg-amber-50/50"}`,children:[t,r!==void 0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${a?"bg-white/20 text-white":"bg-stone-100 text-stone-500"}`,children:r})]}),bl=({value:t,onChange:a,labels:n})=>{const[r,m]=o.useState(!1),g=n||{newest:"新着順",popular:"人気順",rating:"評価順",durationAsc:"所要時間（短い順）",durationDesc:"所要時間（長い順）"},d=[{value:"newest",label:g.newest},{value:"popular",label:g.popular},{value:"rating",label:g.rating},{value:"duration-asc",label:g.durationAsc},{value:"duration-desc",label:g.durationDesc}],u=d.find(x=>x.value===t);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>m(!r),className:"flex items-center gap-2 px-4 py-2 bg-white border border-stone-200 rounded-lg text-sm font-medium text-stone-700 hover:border-stone-400 transition-colors",children:[e.jsx("span",{children:u==null?void 0:u.label}),e.jsx(Nt,{size:16,className:`transition-transform ${r?"rotate-180":""}`})]}),e.jsx(Ue,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>m(!1)}),e.jsx(N.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"absolute right-0 top-full mt-2 w-48 bg-white border border-stone-200 rounded-lg shadow-lg z-50 overflow-hidden",children:d.map(x=>e.jsx("button",{onClick:()=>{a(x.value),m(!1)},className:`w-full text-left px-4 py-2.5 text-sm hover:bg-stone-50 transition-colors ${t===x.value?"bg-brand-base text-brand-dark font-medium":"text-stone-700"}`,children:x.label},x.value))})]})})]})};function gl({onSelectQuest:t,onBackHome:a,ownedQuestIds:n=[],initialBrandFilter:r,t:m}){const d=m||{searchPlaceholder:"クエストを検索...",all:"すべて",beginner:"初級",intermediate:"中級",advanced:"上級",clearFilters:"フィルターをクリア",noQuestsFound:"クエストが見つかりませんでした",tryDifferent:"検索条件を変更してお試しください",sortNewest:"新着順",sortPopular:"人気順",sortRating:"評価順",sortDurationAsc:"所要時間（短い順）",sortDurationDesc:"所要時間（長い順）"},[u,x]=o.useState([]),[b,f]=o.useState(!0),[v,p]=o.useState(""),[i,_]=o.useState("newest"),[w,B]=o.useState("grid"),[L,O]=o.useState(null),[R,be]=o.useState(null),[Y,ee]=o.useState(r||null),P=[{id:"spr",label:"SPR探偵事務所",keywords:["SPR","SPR探偵事務所","探偵"]}];o.useEffect(()=>{(async()=>{f(!0);const{data:Z,error:me}=await D.from("quests").select("*, profiles!quests_creator_id_fkey(username)").eq("status","published").order("created_at",{ascending:!1});if(Z){const E=Z.map(V=>{var oe;return{id:V.id,title:V.title||"Unknown Quest",area:V.area_name||"The City",distanceKm:V.distance_km||2.5,durationMin:V.duration_min||45,difficulty:"中級",tags:V.tags||[],rating:4.5,reviews:12,cover:V.cover_image_url||"https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=1000&q=80",description:V.description||"",teaser:V.area_name||"",startingPoint:"To be revealed",reward:"Digital collectible",timeWindow:"Anytime",mood:"Adventure",stops:[],creatorName:(oe=V.profiles)==null?void 0:oe.username,creatorId:V.creator_id,owned:n.includes(V.id),playCount:100,clearRate:80,avgDurationMin:50}});x(E)}f(!1)})()},[n]);const he=o.useMemo(()=>[...new Set(u.map(A=>A.area))],[u]),re=o.useMemo(()=>{let A=[...u];if(Y){const Z=P.find(me=>me.id===Y);Z&&(A=A.filter(me=>{const E=Z.keywords.some(ke=>me.title.includes(ke)),V=me.tags.some(ke=>Z.keywords.some(je=>ke.includes(je))),oe=Z.keywords.some(ke=>me.description.includes(ke));return E||V||oe}))}if(v){const Z=v.toLowerCase();A=A.filter(me=>me.title.toLowerCase().includes(Z)||me.area.toLowerCase().includes(Z)||me.description.toLowerCase().includes(Z))}switch(L&&(A=A.filter(Z=>Z.difficulty===L)),R&&(A=A.filter(Z=>Z.area===R)),i){case"popular":A.sort((Z,me)=>me.playCount-Z.playCount);break;case"rating":A.sort((Z,me)=>me.rating-Z.rating);break;case"duration-asc":A.sort((Z,me)=>Z.durationMin-me.durationMin);break;case"duration-desc":A.sort((Z,me)=>me.durationMin-Z.durationMin);break}return A},[u,v,i,L,R,Y]),xe=L||R||v||Y,te=()=>{p(""),O(null),be(null),ee(null)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-stone-50 via-stone-50 to-amber-50/30 pt-20",children:[e.jsx("div",{className:"sticky top-16 z-30 bg-white/80 backdrop-blur-lg border-b border-stone-200/60 py-4 shadow-sm",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(sr,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-amber-500"}),e.jsx("input",{type:"text",placeholder:d.searchPlaceholder,value:v,onChange:A=>p(A.target.value),className:"w-full pl-12 pr-4 py-3.5 bg-stone-50 border-2 border-stone-200 rounded-xl text-sm placeholder-stone-400 focus:outline-none focus:border-amber-400 focus:bg-white focus:shadow-lg focus:shadow-amber-100/50 transition-all duration-300"}),v&&e.jsx("button",{onClick:()=>p(""),className:"absolute right-4 top-1/2 -translate-y-1/2 text-stone-400 hover:text-stone-600 transition-colors",children:e.jsx(nt,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide",children:[e.jsx(Gt,{label:d.all,active:!L&&!R&&!Y,onClick:te}),e.jsx("div",{className:"w-px h-6 bg-stone-200"}),P.map(A=>e.jsx(Gt,{label:A.label,active:Y===A.id,onClick:()=>ee(Y===A.id?null:A.id)},A.id)),e.jsx("div",{className:"w-px h-6 bg-stone-200"}),e.jsx(Gt,{label:d.beginner,active:L==="初級",onClick:()=>O(L==="初級"?null:"初級")}),e.jsx(Gt,{label:d.intermediate,active:L==="中級",onClick:()=>O(L==="中級"?null:"中級")}),e.jsx(Gt,{label:d.advanced,active:L==="上級",onClick:()=>O(L==="上級"?null:"上級")}),he.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-6 bg-stone-200"}),he.slice(0,3).map(A=>e.jsx(Gt,{label:A,active:R===A,onClick:()=>be(R===A?null:A)},A))]})]})]})}),e.jsx("div",{className:"bg-white border-b border-stone-100 py-3",children:e.jsxs("div",{className:"container mx-auto px-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:xe&&e.jsxs("button",{onClick:te,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-brand-gold hover:bg-brand-gold/10 rounded-full transition-colors",children:[e.jsx(nt,{size:14}),d.clearFilters]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bl,{value:i,onChange:_,labels:{newest:d.sortNewest,popular:d.sortPopular,rating:d.sortRating,durationAsc:d.sortDurationAsc,durationDesc:d.sortDurationDesc}}),e.jsxs("div",{className:"flex items-center bg-stone-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>B("grid"),className:`p-2 rounded-md transition-colors ${w==="grid"?"bg-white shadow-sm text-stone-900":"text-stone-400 hover:text-stone-600"}`,children:e.jsx(Sn,{size:18})}),e.jsx("button",{onClick:()=>B("list"),className:`p-2 rounded-md transition-colors ${w==="list"?"bg-white shadow-sm text-stone-900":"text-stone-400 hover:text-stone-600"}`,children:e.jsx(Ja,{size:18})})]})]})]})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:b?e.jsx("div",{className:w==="grid"?"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4",children:[1,2,3,4,5,6,7,8].map(A=>e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:A*.1},className:`relative bg-white rounded-2xl overflow-hidden ${w==="grid"?"aspect-[4/5]":"h-36"}`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-stone-100 via-stone-50 to-stone-100 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/60 to-transparent -translate-x-full animate-[shimmer_2s_infinite]"})]},A))}):re.length===0?e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"py-16 text-center",children:[e.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-6",children:[e.jsx(N.div,{className:"absolute inset-0 rounded-full bg-gradient-to-br from-amber-200/50 to-amber-400/30",animate:{scale:[1,1.1,1],opacity:[.5,.8,.5]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),e.jsx("div",{className:"absolute inset-4 rounded-full bg-gradient-to-br from-amber-100 to-amber-200 flex items-center justify-center",children:e.jsx(N.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:e.jsx(wt,{className:"text-amber-600",size:40})})}),e.jsx(N.div,{className:"absolute -top-2 -right-2",animate:{y:[0,-5,0],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx(Be,{className:"text-amber-400",size:16})}),e.jsx(N.div,{className:"absolute -bottom-1 -left-1",animate:{y:[0,-3,0],opacity:[.3,.7,.3]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut",delay:.5},children:e.jsx(Be,{className:"text-amber-300",size:12})})]}),e.jsx("h3",{className:"text-xl font-bold text-stone-800 mb-2",children:"新たな冒険を探そう"}),e.jsxs("p",{className:"text-stone-500 text-sm mb-6 max-w-sm mx-auto",children:[d.noQuestsFound,"。",d.tryDifferent]}),xe&&e.jsxs(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:te,className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-500 to-amber-600 text-white text-sm font-medium rounded-full shadow-lg shadow-amber-200/50 hover:shadow-xl hover:shadow-amber-300/50 transition-shadow",children:[e.jsx(nt,{size:16}),d.clearFilters]})]}):w==="grid"?e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:re.map(A=>e.jsx(pl,{quest:A,onSelect:t},A.id))}):e.jsx("div",{className:"space-y-4",children:re.map(A=>e.jsx(ul,{quest:A,onSelect:t},A.id))})})]})}const fl={ja:{name:"Japanese",nativeName:"日本語",flag:"🇯🇵"},en:{name:"English",nativeName:"English",flag:"🇺🇸"},zh:{name:"Chinese",nativeName:"简体中文",flag:"🇨🇳"},ko:{name:"Korean",nativeName:"한국어",flag:"🇰🇷"}},jl={full:{en:"Fully Supported",ja:"フル対応",ko:"완전 지원",color:"bg-emerald-100 text-emerald-700 border-emerald-200"},reviewed:{en:"Reviewed",ja:"レビュー済み",ko:"검토됨",color:"bg-sky-100 text-sky-700 border-sky-200"},auto:{en:"Auto-translated",ja:"自動翻訳",ko:"자동 번역",color:"bg-amber-100 text-amber-700 border-amber-200"},partial:{en:"Some Japanese Required",ja:"一部日本語必要",ko:"일부 일본어 필요",color:"bg-orange-100 text-orange-700 border-orange-200"},not_available:{en:"Not Available",ja:"未対応",ko:"지원 안함",color:"bg-stone-100 text-stone-500 border-stone-200"}};function vl({availableLanguages:t,languageOptions:a,selectedLanguage:n,onSelectLanguage:r,onConfirm:m,className:g=""}){var b;const d=f=>{if(f==="ja")return"full";const v=a==null?void 0:a.find(p=>p.code===f);return v?v.quality:"auto"},u=(b=a==null?void 0:a.find(f=>f.code===n))==null?void 0:b.hasHighDependency,x=n==="ko"?"ko":n==="ja"?"ja":"en";return e.jsxs("div",{className:`bg-white rounded-3xl shadow-2xl overflow-hidden max-w-md mx-auto ${g}`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-dark to-brand-gold px-6 py-5 text-center",children:[e.jsx(cs,{className:"w-8 h-8 text-white mx-auto mb-2"}),e.jsx("h2",{className:"text-xl font-serif font-bold text-white",children:"Select Language"}),e.jsx("p",{className:"text-sm text-white/80 mt-1",children:"言語を選択してください"})]}),e.jsx("div",{className:"p-6 space-y-3",children:t.map(f=>{const v=fl[f]||{name:f,nativeName:f,flag:"🌐"},p=n===f,i=d(f),_=jl[i],w=a==null?void 0:a.find(B=>B.code===f);return e.jsxs("button",{onClick:()=>r(f),disabled:i==="not_available",className:`w-full flex items-center gap-4 p-4 rounded-2xl border-2 transition-all ${i==="not_available"?"border-stone-200 bg-stone-50 opacity-60 cursor-not-allowed":p?"border-brand-gold bg-brand-gold/10 shadow-md":"border-stone-200 hover:border-stone-300 hover:bg-stone-50"}`,children:[e.jsx("span",{className:"text-3xl",children:v.flag}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold text-brand-dark",children:v.nativeName}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full border ${_.color}`,children:_[x]})]}),e.jsx("p",{className:"text-xs text-stone-500",children:v.name}),(w==null?void 0:w.hasHighDependency)&&f!=="ja"&&e.jsxs("p",{className:"text-[10px] text-orange-600 mt-1 flex items-center gap-1",children:[e.jsx(Is,{className:"w-3 h-3"}),x==="ja"?"一部の謎は日本語が必要":x==="ko"?"일부 퍼즐은 일본어 필요":"Some puzzles require Japanese"]})]}),p&&i!=="not_available"&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-gold flex items-center justify-center",children:e.jsx(Ts,{className:"w-4 h-4 text-white"})})]},f)})}),u&&n!=="ja"&&e.jsxs("div",{className:"mx-6 mb-4 p-3 bg-orange-50 border border-orange-200 rounded-xl flex gap-2 text-sm",children:[e.jsx(Is,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-orange-700",children:x==="ja"?"一部の謎は日本語が必要な可能性があります。プレイ中に言語を切り替えることができます。":x==="ko"?"일부 퍼즐은 일본어가 필요할 수 있어요. 플레이 중 언제든 언어를 변경할 수 있어요.":"Some puzzles may require Japanese. You can switch language anytime during play."})]}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("button",{onClick:m,disabled:!n||d(n)==="not_available",className:"w-full py-4 bg-gradient-to-r from-brand-dark to-brand-gold text-white font-bold rounded-2xl shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:n==="ja"?"開始する":n==="ko"?"시작":"Start Quest"})})]})}const _s=({icon:t,value:a,label:n,sub:r})=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-stone-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white border border-stone-200 flex items-center justify-center",children:e.jsx(t,{size:18,className:"text-brand-gold"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-stone-900",children:a}),e.jsx("div",{className:"text-xs text-stone-500",children:n})]})]}),Ss=({icon:t,text:a})=>e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-brand-gold/10 flex items-center justify-center",children:e.jsx(t,{size:16,className:"text-brand-gold"})}),e.jsx("span",{className:"text-sm text-stone-700",children:a})]});function yl({quest:t,onBackToList:a,onBackHome:n,onOpenApp:r,purchased:m,onPurchase:g,purchasing:d,t:u}){var be,Y,ee;const b=u||{reviews:P=>`${P}件のレビュー`,playersPlayed:P=>`${P}人がプレイ`,duration:"所要時間",distance:"総距離",spots:"スポット数",clearRate:"クリア率",overview:"概要",defaultDescription:"街を歩きながら謎を解く、新しい体験型アドベンチャー。スマートフォン片手に、街の隠された物語を発見しましょう。",features:"このクエストの特徴",startingPoint:"スタート地点",availableAnytime:"24時間いつでもプレイ可能",hintFeature:"初心者でも安心のヒント機能付き",soloOrTeam:"1人でも仲間とでも楽しめます",howToPlay:"遊び方",step1Title:"クエストを開始",step1Desc:"スタート地点まで移動してアプリを起動",step2Title:"謎を解く",step2Desc:"各スポットで出題される謎を解いて次へ進む",step3Title:"ゴール",step3Desc:"全ての謎を解き明かしてクリア！",reviewsTitle:"レビュー",viewAll:"すべて見る",creator:"クリエーター",questCreator:"クエストクリエーター",notice:"ご注意",noticeText:"このクエストは屋外を歩きながら進めます。歩きやすい服装・靴でご参加ください。天候や交通状況にご注意ください。",startQuest:"クエストを開始する",participationFee:"参加費",free:"無料",join:"参加する",processing:"処理中...",aboutMin:P=>`約${P}分`,spotsCount:P=>`${P}箇所`},[f,v]=o.useState(!1),[p,i]=o.useState(!1),[_,w]=o.useState("ja"),B=(be=t.supported_languages)!=null&&be.length?t.supported_languages:["ja"],L=B.length>1,O=()=>{L?i(!0):r("ja")},R=()=>{i(!1),r(_)};return e.jsxs("div",{className:"min-h-screen bg-white pt-24",children:[e.jsxs("div",{className:"relative w-full aspect-[16/10] md:aspect-[21/9] overflow-hidden bg-stone-900",children:[e.jsx("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/50 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2 z-10",children:[e.jsx("button",{onClick:()=>v(!f),className:`p-2.5 rounded-full backdrop-blur-md transition-all ${f?"bg-rose-500/90 text-white":"bg-white/20 border border-white/30 text-white hover:bg-white/30"}`,children:e.jsx(Ps,{size:18,className:f?"fill-current":""})}),e.jsx("button",{className:"p-2.5 rounded-full bg-white/20 backdrop-blur-md border border-white/30 text-white hover:bg-white/30 transition-colors",children:e.jsx(da,{size:18})})]}),e.jsx(N.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2,duration:.6},className:"absolute bottom-0 left-0 right-0 p-6 md:p-10",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:`px-3 py-1.5 rounded-full backdrop-blur-md text-xs font-bold ${t.difficulty==="初級"?"bg-emerald-500/80 text-white":t.difficulty==="中級"?"bg-amber-500/80 text-white":"bg-rose-500/80 text-white"}`,children:t.difficulty}),e.jsxs("span",{className:"px-3 py-1.5 rounded-full bg-white/20 backdrop-blur-md text-white text-xs font-medium flex items-center gap-1",children:[e.jsx(Fe,{size:12}),t.area]})]}),e.jsx("h1",{className:"text-3xl md:text-5xl lg:text-6xl font-bold text-white mb-4 drop-shadow-lg tracking-tight leading-tight max-w-4xl",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-white/90",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xs,{size:18,className:"text-amber-400 fill-amber-400"}),e.jsx("span",{className:"font-bold text-white",children:t.rating.toFixed(1)}),e.jsxs("span",{className:"text-white/70 text-sm",children:["(",b.reviews(t.reviews),")"]})]}),t.playCount&&e.jsxs("span",{className:"text-white/70 text-sm flex items-center gap-1",children:[e.jsx(lt,{size:14}),b.playersPlayed(t.playCount)]}),e.jsxs("span",{className:"text-white/70 text-sm flex items-center gap-1",children:[e.jsx(yt,{size:14}),b.aboutMin(Math.round(t.durationMin/5)*5)]}),e.jsxs("span",{className:"text-white/70 text-sm flex items-center gap-1",children:[e.jsx(wt,{size:14}),t.distanceKm.toFixed(1),"km"]})]})]})})]}),e.jsxs("div",{className:"container mx-auto px-4 py-6 pb-32",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-8",children:[e.jsx(_s,{icon:yt,value:b.aboutMin(Math.round(t.durationMin/5)*5),label:b.duration}),e.jsx(_s,{icon:wt,value:`${t.distanceKm.toFixed(1)}km`,label:b.distance}),e.jsx(_s,{icon:vn,value:b.spotsCount(((Y=t.stops)==null?void 0:Y.length)||3),label:b.spots}),e.jsx(_s,{icon:nl,value:t.clearRate?`${t.clearRate}%`:"—",label:b.clearRate})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-stone-900 mb-3",children:b.overview}),e.jsx("p",{className:"text-stone-600 leading-relaxed",children:t.description||t.teaser||b.defaultDescription})]}),e.jsxs("section",{className:"mb-8 p-5 bg-stone-50 rounded-2xl",children:[e.jsx("h2",{className:"text-lg font-bold text-stone-900 mb-2",children:b.features}),e.jsxs("div",{className:"divide-y divide-stone-200",children:[e.jsx(Ss,{icon:Fe,text:`${b.startingPoint}: ${t.startingPoint||t.area}`}),e.jsx(Ss,{icon:yt,text:t.timeWindow||b.availableAnytime}),e.jsx(Ss,{icon:xa,text:b.hintFeature}),e.jsx(Ss,{icon:lt,text:b.soloOrTeam})]})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-stone-900 mb-4",children:b.howToPlay}),e.jsx("div",{className:"space-y-4",children:[{step:1,title:b.step1Title,desc:b.step1Desc},{step:2,title:b.step2Title,desc:b.step2Desc},{step:3,title:b.step3Title,desc:b.step3Desc}].map(P=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-gold text-white font-bold text-sm flex items-center justify-center flex-shrink-0",children:P.step}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-stone-900",children:P.title}),e.jsx("div",{className:"text-sm text-stone-500",children:P.desc})]})]},P.step))})]}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-stone-900",children:b.reviewsTitle}),(((ee=t.reviewList)==null?void 0:ee.length)||0)>3&&e.jsx("button",{className:"text-sm text-brand-gold font-medium hover:underline",children:b.viewAll})]}),t.reviewList&&t.reviewList.length>0?e.jsx("div",{className:"space-y-4",children:t.reviewList.slice(0,5).map(P=>e.jsxs("div",{className:"p-4 bg-stone-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-stone-300 flex items-center justify-center text-white font-bold text-xs",children:P.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-stone-900 text-sm",children:P.name}),e.jsx("div",{className:"text-xs text-stone-400",children:P.date})]})]}),e.jsx("div",{className:"flex items-center gap-0.5",children:[...Array(5)].map((he,re)=>e.jsx(xs,{size:12,className:re<P.rating?"text-amber-500 fill-amber-500":"text-stone-300"},re))})]}),P.comment&&e.jsx("p",{className:"text-sm text-stone-600",children:P.comment})]},P.id))}):e.jsx("div",{className:"p-6 bg-stone-50 rounded-xl text-center",children:e.jsx("p",{className:"text-stone-400 text-sm",children:"まだレビューがありません"})})]}),t.creatorName&&e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-stone-900 mb-3",children:b.creator}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-stone-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-brand-gold/20 flex items-center justify-center text-brand-gold font-bold",children:t.creatorName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-stone-900",children:t.creatorName}),e.jsx("div",{className:"text-sm text-stone-500",children:b.questCreator})]})]})]}),e.jsx("section",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl mb-8",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Xa,{size:20,className:"text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-amber-800 mb-1",children:b.notice}),e.jsx("p",{className:"text-sm text-amber-700",children:b.noticeText})]})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-stone-200 p-4 z-30",children:e.jsx("div",{className:"container mx-auto",children:m?e.jsxs("div",{className:"flex items-center gap-3",children:[L&&e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-4 border border-stone-200 rounded-xl flex items-center gap-2 text-stone-600 hover:bg-stone-50 transition-colors",children:e.jsx(cs,{size:18})}),e.jsxs("button",{onClick:O,className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(tr,{size:20,fill:"currentColor"}),b.startQuest]})]}):e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-stone-500",children:b.participationFee}),e.jsx("div",{className:"text-xl font-bold text-stone-900",children:b.free})]}),e.jsx("button",{onClick:()=>g(t.id),disabled:d,className:"flex-1 bg-brand-gold hover:bg-amber-500 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 transition-colors disabled:opacity-50",children:d?e.jsx("span",{children:b.processing}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:b.join}),e.jsx(xt,{size:18})]})})]})})}),e.jsx(Ue,{children:p&&e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>i(!1),children:e.jsx(N.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:P=>P.stopPropagation(),children:e.jsx(vl,{availableLanguages:B,selectedLanguage:_,onSelectLanguage:w,onConfirm:R})})})})]})}const Nl=[{icon:oa,text:"AIクレジット10倍増量（月50→500）"},{icon:Be,text:"目的別テンプレート（家族/グルメ/歴史など）"},{icon:Zt,text:"多言語対応（英語・中国語・韓国語）"},{icon:oa,text:"手数料優遇（30%→20%）"}];function wl({isOpen:t,onClose:a}){const n=es(),{user:r}=ca(),[m,g]=o.useState(!1),d=async()=>{if(!r){a(),n("/?login=true");return}g(!0);const x="https://buy.stripe.com/test_3cI6oG4IAb0Bh0h1pdds400",b=encodeURIComponent(`${window.location.origin}/canvas`),f=encodeURIComponent(`${window.location.origin}/subscription?canceled=true`);window.location.href=`${x}?prefilled_email=${encodeURIComponent(r.email||"")}&success_url=${b}&cancel_url=${f}`},u=()=>{a(),n("/subscription")};return e.jsx(Ue,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50"}),e.jsx(N.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl border border-stone-200 w-full max-w-md overflow-hidden pointer-events-auto",children:[e.jsxs("div",{className:"relative p-6 pb-4 text-center border-b border-stone-100 bg-gradient-to-r from-amber-50 to-white",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-lg text-stone-400 hover:text-stone-600 hover:bg-stone-100 transition-colors",children:e.jsx(nt,{size:18})}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-brand-gold/10 border border-brand-gold/30 mb-4",children:[e.jsx(Zt,{size:14,className:"text-brand-gold"}),e.jsx("span",{className:"text-brand-gold font-bold text-xs",children:"TOMOSHIBI Pro"})]}),e.jsx("h2",{className:"text-xl font-bold text-brand-dark mb-1",children:"Pro機能をアンロック"}),e.jsx("p",{className:"text-stone-500 text-sm",children:"より自由にクエストを創造しよう"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex items-end justify-center gap-1",children:[e.jsx("span",{className:"text-3xl font-bold text-brand-dark",children:"¥1,980"}),e.jsx("span",{className:"text-stone-400 pb-0.5",children:"/月"})]})}),e.jsx("div",{className:"space-y-2",children:Nl.map((x,b)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-stone-50 border border-stone-100",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-brand-gold/20 flex items-center justify-center flex-shrink-0",children:e.jsx(x.icon,{size:16,className:"text-brand-gold"})}),e.jsx("span",{className:"text-stone-700 text-sm",children:x.text})]},b))}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx("button",{onClick:d,disabled:m,className:"w-full py-3.5 rounded-xl bg-brand-dark text-white font-bold hover:bg-brand-gold transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{size:18,className:"animate-spin"}),"処理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Zt,{size:18}),"Proプランに登録"]})}),e.jsxs("button",{onClick:u,className:"w-full py-2.5 rounded-xl text-stone-500 hover:text-brand-dark text-sm font-medium transition-colors flex items-center justify-center gap-1",children:["詳細を見る",e.jsx(xt,{size:14})]})]}),e.jsx("p",{className:"text-center text-stone-400 text-xs",children:"いつでもキャンセル可能 • Stripeで安全に決済"})]})]})})]})})}const ta=[{id:"detective",label:"探偵・推理",description:"事件を調査し、真相を解き明かす"},{id:"treasure",label:"宝探し",description:"隠された宝や秘密を発見する"},{id:"history",label:"歴史解明",description:"過去の謎や伝説を解き明かす"},{id:"horror",label:"ホラー・怪談",description:"背筋が凍るような恐怖体験"}],sa=[{id:"mysterious",label:"ミステリアス",description:"謎めいた雰囲気"},{id:"thrilling",label:"スリリング",description:"緊張感のある展開"},{id:"heartwarming",label:"ほのぼの",description:"温かみのある物語"},{id:"romantic",label:"ロマンチック",description:"恋愛要素のある雰囲気"},{id:"educational",label:"学び・教養",description:"知的好奇心を刺激"}],aa={protagonist:"例：探偵、旅人、学生",objective:"例：宝探し、真実解明",ending:"例：どんでん返し、ハッピーエンド"},kl=[{id:"route_distance",label:"距離/所要時間の確認",description:"全体の距離と所要時間が妥当か確認",category:"route",requiredFor:["SHARE","PUBLISH"],linkedSection:"spots"},{id:"route_hours",label:"営業時間の確認",description:"各スポットの営業時間を確認",category:"route",requiredFor:["SHARE","PUBLISH"],linkedSection:"spots"},{id:"route_access",label:"入場条件の確認",description:"入場料・予約の必要性を確認",category:"route",requiredFor:["SHARE","PUBLISH"],linkedSection:"spots"},{id:"info_clues",label:"手がかりの確認",description:"現地で手がかりが取得可能か確認（看板・展示・碑文など）",category:"info",requiredFor:["SHARE","PUBLISH"],linkedSection:"mystery"},{id:"mystery_unique",label:"答えの一意性",description:"答えが一意に決まるか確認",category:"mystery",requiredFor:["SHARE","PUBLISH"],linkedSection:"mystery"},{id:"mystery_hints",label:"ヒント段階の確認",description:"ヒントが破綻していないか確認",category:"mystery",requiredFor:["SHARE","PUBLISH"],linkedSection:"mystery"},{id:"rescue_hints",label:"詰まり時のヒント",description:"ヒント導線が用意されているか確認",category:"rescue",requiredFor:["SHARE","PUBLISH"],linkedSection:"preview"},{id:"rescue_skip",label:"スキップ/リトライ導線",description:"スキップ・リトライ導線が用意されているか確認",category:"rescue",requiredFor:["PUBLISH"],linkedSection:"preview"}],_l={route:{label:"ルート成立",icon:"🗺️"},info:{label:"情報成立",icon:"📍"},mystery:{label:"謎成立",icon:"🔍"},rescue:{label:"救済",icon:"🆘"}},Sl={PRIVATE:{label:"Private",labelJa:"自分用",description:"試作品として自由にプレイ。品質チェック不要。",color:"bg-stone-100 text-stone-700 border-stone-200"},SHARE:{label:"Share",labelJa:"限定共有",description:"友人や仲間に共有。最低限の品質チェックが必要。",color:"bg-sky-100 text-sky-700 border-sky-200"},PUBLISH:{label:"Publish",labelJa:"公開",description:"誰でもプレイ可能。厳格な品質チェック＋審査が必要。",color:"bg-emerald-100 text-emerald-700 border-emerald-200"}};function ba(t){return kl.filter(a=>a.requiredFor.includes(t))}function Cl(t,a){return ba(t).every(r=>{var m;return((m=a[r.id])==null?void 0:m.completed)===!0})}function Tl(t,a){return ba(t).filter(r=>{var m;return((m=a[r.id])==null?void 0:m.completed)!==!0})}const rr={survey:1,partner:.95,official:.9,wikipedia:.8,openstreetmap:.7,google_places:.75};async function Il(t,a="ja"){var n,r,m;try{const g=`https://${a}.wikipedia.org/w/api.php?`+new URLSearchParams({action:"query",list:"search",srsearch:t,format:"json",origin:"*"}),u=await(await fetch(g)).json();if(!((r=(n=u.query)==null?void 0:n.search)!=null&&r.length))return null;const x=u.query.search[0].title,b=`https://${a}.wikipedia.org/w/api.php?`+new URLSearchParams({action:"query",titles:x,prop:"extracts|info",exintro:"true",explaintext:"true",inprop:"url",format:"json",origin:"*"}),v=await(await fetch(b)).json();if(!((m=v.query)!=null&&m.pages))return null;const p=Object.values(v.query.pages)[0];if(!p||p.pageid<0)return null;const i=zl(p.extract||"",p.fullurl||`https://${a}.wikipedia.org/wiki/${encodeURIComponent(x)}`,"wikipedia");return{description:p.extract||"",url:p.fullurl||"",evidences:i}}catch(g){return console.error("Wikipedia fetch error:",g),null}}function zl(t,a,n){const r=[],m=new Date().toISOString(),g=[{regex:/(\d{4})年に?(建立|創建|完成|開業|設立)/g,type:"inscription",description:"建立・創建年"},{regex:/(高さ|全長|全高)[約]?(\d+(?:\.\d+)?)\s*(メートル|m|センチ|cm)/g,type:"monument",description:"寸法情報"},{regex:/(国宝|重要文化財|世界遺産|登録有形文化財)/g,type:"plaque",description:"文化財指定"},{regex:/(祭神|御祭神|祀られている)[はが]?([^。、]+)/g,type:"signboard",description:"祭神情報"},{regex:/正式名称[はが]?「([^」]+)」/g,type:"official_name",description:"正式名称"},{regex:/(別名|通称)[はが]?「([^」]+)」/g,type:"official_name",description:"別名・通称"}];for(const{regex:d,type:u,description:x}of g){let b;for(;(b=d.exec(t))!==null;)r.push({id:`wiki-${u}-${r.length}`,type:u,content:b[0],source_url:a,source_type:n,is_permanent:!0,confidence:rr[n],location_description:"現地案内板等で確認可能",retrieved_at:m})}return r}async function Da(t){var n,r;const a="AIzaSyBR6o-tY4ewZA-FJigO1FoSE5FAEouYGcs";try{const g=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(`${t} 日本`)}&language=ja&region=jp&key=${a}`,d=await fetch(g);if(!d.ok)return console.warn("Geocoding API error:",d.status),null;const u=await d.json();if(u.status==="OK"&&((n=u.results)==null?void 0:n.length)>0){const x=(r=u.results[0].geometry)==null?void 0:r.location;if(x)return{lat:x.lat,lng:x.lng}}return console.warn(`Geocoding failed for: ${t}`,u.status),null}catch(m){return console.error("Geocoding error:",m),null}}async function $l(t,a,n){var m,g;const r="AIzaSyBR6o-tY4ewZA-FJigO1FoSE5FAEouYGcs";try{const u=await fetch("https://places.googleapis.com/v1/places:searchText",{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":r,"X-Goog-FieldMask":"places.displayName,places.formattedAddress,places.types,places.editorialSummary"},body:JSON.stringify({textQuery:n,locationBias:{circle:{center:{latitude:t,longitude:a},radius:500}},languageCode:"ja"})});if(!u.ok)return console.warn("Google Places API error:",u.status),[];const b=(m=(await u.json()).places)==null?void 0:m[0];if(!b)return[];const f=[],v=new Date().toISOString();return(g=b.displayName)!=null&&g.text&&f.push({id:"places-name-0",type:"official_name",content:b.displayName.text,source_url:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(n)}`,source_type:"google_places",is_permanent:!0,confidence:rr.google_places,location_description:"施設入口または看板",retrieved_at:v}),f}catch(d){return console.error("Google Places fetch error:",d),[]}}async function Ml(t,a,n,r){const m=new Date().toISOString(),[g,d]=await Promise.all([Il(a),$l(n,r,a)]),u=[...(g==null?void 0:g.evidences)||[],...d];u.forEach((b,f)=>{b.id=`evidence-${t}-${f}`});const x=Pl(u);return{spot_id:t,spot_name:a,lat:n,lng:r,official_description:(g==null?void 0:g.description)||"",evidences:u,retrieved_at:m,sufficiency_score:x}}function Pl(t){if(t.length===0)return 0;const a=Math.min(t.length/5,1),n=t.reduce((m,g)=>m+g.confidence,0)/t.length,r=t.filter(m=>m.is_permanent).length/t.length;return a*.3+n*.5+r*.2}const Al=`あなたは物語構成の専門家です。
以下のスポット情報を分析し、各スポットの物語上の役割を決定してください。

【重要な原則】
1. 全体で一貫した物語の流れを作る
2. 各スポットには明確な役割（scene_role）を割り当てる
3. factsから1-2個を選び、謎のモチーフにする
4. plot_keyは最後のmeta_puzzleで使われることを意識する

【scene_roleの種類】
- 導入: 物語の始まり、世界観を提示
- 展開: 情報収集、謎が深まる
- 転換: 状況が変わる、新事実が判明
- 真相接近: 核心に迫る
- ミスリード解除: 誤解が解ける
- 結末: 物語の締めくくり

【plot_key_typeの種類】
- keyword: キーワード
- cipher_piece: 暗号の一部
- coordinate: 座標の一部
- name: 人物名/地名
- number: 数字/年号
- symbol: 記号/紋章

【puzzle_typeの種類】
- logic: 論理パズル（証言整理など）
- pattern: パターン認識（数列など）
- cipher: 暗号解読
- wordplay: 言葉遊び（漢字分解など）
- lateral: 水平思考（矛盾解釈）
- math: 算数パズル`;async function El(t,a,n){var g,d,u,x,b;const r=t.map((f,v)=>({spot_id:`S${v+1}`,spot_name:f.spot_name,spot_summary:f.spot_summary,spot_facts:f.spot_facts.map((p,i)=>`fact_${i+1}: ${p}`),spot_theme_tags:f.spot_theme_tags})),m=`
${Al}

【クエストテーマ】
${a}

【スポット一覧】
${JSON.stringify(r,null,2)}

【出力形式】
以下のJSON配列を出力してください：
[
  {
    "spot_id": "S1",
    "spot_name": "スポット名",
    "selected_facts": ["fact_1", "fact_3"],
    "scene_role": "導入|展開|転換|真相接近|ミスリード解除|結末",
    "plot_key_type": "keyword|cipher_piece|coordinate|name|number|symbol",
    "suggested_puzzle_type": "logic|pattern|cipher|wordplay|lateral|math",
    "rationale": "選定理由"
  },
  ...
]

重要:
- 最初のスポットは必ず「導入」
- 最後のスポットは必ず「結末」
- 「転換」は中盤に1-2個配置
- 各factsは異なるスポットで使い分ける（重複最小限）
`.trim();try{const f=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:m}]}]})});if(!f.ok)throw new Error(`Gemini API error: ${f.status}`);const v=await f.json(),p=((b=(x=(u=(d=(g=v==null?void 0:v.candidates)==null?void 0:g[0])==null?void 0:d.content)==null?void 0:u.parts)==null?void 0:x[0])==null?void 0:b.text)||"",i=p.match(/```json([\s\S]*?)```/),_=i?i[1]:p;return JSON.parse(_.trim()).map(B=>({spot_id:B.spot_id,spot_name:B.spot_name,selected_facts:B.selected_facts||[],scene_role:Ll(B.scene_role),plot_key_type:Dl(B.plot_key_type),suggested_puzzle_type:Ol(B.suggested_puzzle_type)}))}catch(f){return console.error("Motif selection error:",f),t.map((v,p)=>({spot_id:`S${p+1}`,spot_name:v.spot_name,selected_facts:v.spot_facts.slice(0,2).map((i,_)=>`fact_${_+1}`),scene_role:Rl(p,t.length),plot_key_type:"keyword",suggested_puzzle_type:Bl(p)}))}}function Ll(t){return["導入","展開","転換","真相接近","ミスリード解除","結末"].includes(t)?t:"展開"}function Dl(t){return["keyword","cipher_piece","coordinate","name","number","symbol"].includes(t)?t:"keyword"}function Ol(t){return["logic","pattern","cipher","wordplay","lateral","math"].includes(t)?t:"logic"}function Rl(t,a){return t===0?"導入":t===a-1?"結末":t===Math.floor(a/2)?"転換":t>a*.7?"真相接近":"展開"}function Bl(t){const a=["logic","pattern","cipher","wordplay","lateral","math"];return a[t%a.length]}const ql=`あなたは物語作家です。
以下のスポットモチーフを使って、一貫した謎解き物語を構築してください。

【重要な原則】
1. premise（発端）→ goal（目的）→ antagonist_or_mystery（対立/謎）→ final_reveal（真相） の4点を明確に
2. 各スポットが物語の一部として必ず機能すること
3. 最後のmeta_puzzleで全てが繋がる構造にすること
4. 「解く = 学ぶ + 進む」を意識した物語設計

【文章の読みやすさ（最重要）】
- 中学生が読んでスラスラ理解できる言葉を使う
- 専門用語・難しい漢字・意味不明なカタカナ語は絶対禁止
- 一文は短く、リズムよく読めるように
- 難しい概念は「たとえ話」や「身近な例」で説明
- 読んでいて「しんどい」と感じさせない、軽やかな文体

【物語のジャンル例】
- 失われた宝を探す冒険
- 過去の事件の真相解明
- 伝説の謎を解き明かす調査
- 時を超えたメッセージの解読
- 古の知恵を継承する試練`;async function Fl(t,a,n,r){var d,u,x,b,f;const m=a.map((v,p)=>{var i;return{spot_id:v.spot_id,spot_name:v.spot_name,scene_role:v.scene_role,selected_facts:v.selected_facts,plot_key_type:v.plot_key_type,theme_tags:((i=t[p])==null?void 0:i.spot_theme_tags)||[]}}),g=`
${ql}

【クエストテーマ】
${n}

【スポットモチーフ】
${JSON.stringify(m,null,2)}

【出力形式】
以下のJSONを出力してください：
{
  "premise": "物語の発端（なぜ主人公がこの冒険を始めるのか）",
  "goal": "主人公の目的（何を達成しようとしているのか）",
  "antagonist_or_mystery": "対立要素または中心の謎（何が障害なのか、何が明かされるべきなのか）",
  "final_reveal_outline": "最終的な真相の概要（meta_puzzleで明かされる結論）",
  "spot_story_hooks": [
    {
      "spot_id": "S1",
      "story_beat": "この地点で起こる物語上の出来事（1文）",
      "plot_key_preview": "この地点で得られる鍵の性質（例：古い年号、暗号の一部）"
    },
    ...
  ]
}

【品質基準】
- 導入（S1）で謎が提示される
- 中盤で転換点がある
- 結末で全てが繋がる達成感がある
- 各スポットの地域性や歴史性を活かした物語
`.trim();try{const v=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:g}]}]})});if(!v.ok)throw new Error(`Gemini API error: ${v.status}`);const p=await v.json(),i=((f=(b=(x=(u=(d=p==null?void 0:p.candidates)==null?void 0:d[0])==null?void 0:u.content)==null?void 0:x.parts)==null?void 0:b[0])==null?void 0:f.text)||"",_=i.match(/```json([\s\S]*?)```/),w=_?_[1]:i,B=JSON.parse(w.trim());return{premise:B.premise||"古くから伝わる謎を解き明かす冒険が始まる。",goal:B.goal||"隠された真実を見つけ出すこと。",antagonist_or_mystery:B.antagonist_or_mystery||"時の流れに埋もれた秘密。",final_reveal_outline:B.final_reveal_outline||"全ての鍵が揃った時、真相が明らかになる。"}}catch(v){return console.error("Plot creation error:",v),Hl(n,a)}}function Hl(t,a){const n=a.map(r=>r.spot_name).join("、");return{premise:`${t}にまつわる古い謎が、あなたを待っている。`,goal:`${n}を巡り、隠された真実を解き明かすこと。`,antagonist_or_mystery:"時の流れに埋もれた秘密と、それを守る謎の数々。",final_reveal_outline:"全てのスポットで集めた鍵を組み合わせることで、最終的な真相が明らかになる。"}}function Ql(t,a,n){const r=a[n],m=a.slice(0,n),g=a.slice(n+1);return`
【物語の全体像】
- 発端: ${t.premise}
- 目的: ${t.goal}
- 核心の謎: ${t.antagonist_or_mystery}

【現在地】
- スポット: ${r.spot_name}
- 役割: ${r.scene_role}
- 物語上の位置: ${n+1}/${a.length}

${m.length>0?`【これまでの流れ】
${m.map(d=>`- ${d.spot_name}（${d.scene_role}）`).join(`
`)}`:""}

${g.length>0?`【この後の展開】
${g.map(d=>`- ${d.spot_name}（${d.scene_role}）`).join(`
`)}`:""}

【この地点での役割】
${r.scene_role==="導入"?"物語の始まり。世界観を提示し、冒険への誘いを行う。":r.scene_role==="展開"?"情報を収集し、謎を深める。新しい手がかりを得る。":r.scene_role==="転換"?"状況が変わる重要な地点。新事実が判明する。":r.scene_role==="真相接近"?"核心に迫る。答えに近づいている感覚を与える。":r.scene_role==="ミスリード解除"?"誤解が解ける。真実への道が開ける。":"物語の締めくくり。達成感と余韻を与える。"}
`.trim()}const Vl=`あなたはひらめき型パズルの謎作家です。
「ひらめき」と「論理」で解ける、美しい謎を設計してください。

【絶対ルール】
1. 外部知識（ネット検索、暗記）が必要な問題は禁止
2. player_handout（資料）の情報だけで解けること
3. 謎を解くと「背景理解」と「物語の鍵」が同時に得られること
4. スポットのモチーフと謎が因果的に結びつくこと

【文章の読みやすさ（最重要）】
- 中学生が読んでスラスラ理解できる言葉を使う
- 専門用語・難しい漢字・意味不明なカタカナ語は絶対禁止
- 一文は短く、リズムよく読めるように
- 難しい歴史や文化の話は「へぇ、面白い！」と思える身近な言葉で
- 読んでいて「しんどい」と感じさせない、軽やかで楽しい文体
- 物語文（short_story_text）は特に読みやすく、ワクワクする書き方で

【ひらめき系謎のタイプ】
- logic: 証言から嘘つき特定、条件整理
- pattern: 数列の法則、図形の規則性
- cipher: スポットテーマをモチーフにした暗号解読
- wordplay: 漢字分解、アナグラム、しりとり系
- lateral: 矛盾する状況の解釈、視点の転換
- math: 条件から唯一解を導く算数パズル

【禁止事項】
- 「○○で有名な人物は誰？」系の暗記クイズ
- スポットと関係ない一般パズルを置いて解説で無理やり結びつける
- 答えが複数通りあり得る曖昧な問題
- 難解な専門用語や説明的すぎる文章

【品質基準】
- 出題文の美しさ（物語に溶け込む、謎めいた語り口）
- 解けた時の納得感（「なるほど！」という感覚）
- 難易度は「難しい」ではなく「気持ちよくひらめく」（2-3が基本）`,Ul={logic:`
【論理パズルの設計ガイド】
- 3人以上の証言から真実を見つける
- 条件を整理すると答えが一意に決まる
- 表や図を使って考えると解きやすい

例: 「3人の商人がそれぞれ異なることを言っている。正直者は1人だけ。誰が正直者か？」`,pattern:`
【パターンパズルの設計ガイド】
- 数列や図形の規則性を見つける
- 法則が分かれば次の要素が予測できる
- スポットの特徴（年号、人数など）を数列に組み込む

例: 「○→△→□→？ この並びの法則は？」`,cipher:`
【暗号パズルの設計ガイド】
- スポットのテーマ（交易、蘭学など）をモチーフにした暗号
- 解読のヒントはplayer_handoutに含まれている
- 換字式、位置暗号、キーワード暗号など

例: 「この碑文に刻まれた記号は、実は○○を表している...」`,wordplay:`
【言葉遊びパズルの設計ガイド】
- 漢字の分解・合成
- アナグラム（文字の並べ替え）
- 頭文字・末文字を集める
- スポット名や地名の特徴を活用

例: 「この5つの言葉の頭文字を並べると...？」`,lateral:`
【水平思考パズルの設計ガイド】
- 一見矛盾する状況を解釈する
- 視点を変えると答えが見える
- 常識の裏をかく発想

例: 「なぜ彼は雨の日にしか現れないのか？」`,math:`
【算数パズルの設計ガイド】
- 条件を組み合わせて唯一の答えを導く
- 連立方程式的な思考
- スポットに関連する数字（年号、距離など）を使用

例: 「この3つの条件を全て満たす数は？」`};async function Oa(t,a,n,r,m,g){var b,f,v,p,i;const d=Ql(n,r,m),u=Ul[a.suggested_puzzle_type],x=`
${Vl}

${u}

【物語コンテキスト】
${d}

【スポット情報】
- 名前: ${t.spot_name}
- 概要: ${t.spot_summary}
- 選択されたfacts:
${a.selected_facts.map(_=>{const w=parseInt(_.replace("fact_",""))-1;return`  - ${t.spot_facts[w]||_}`}).join(`
`)}
- テーマタグ: ${t.spot_theme_tags.join(", ")}

【出力形式】
以下のJSONを出力してください：
{
  "lore_card": {
    "short_story_text": "物語文（この地点の意味づけ、2-4文）",
    "facts_used": ["fact_1", "fact_2"],
    "player_handout": "プレイヤーに提示する資料（これだけで謎が解ける情報を含む）"
  },
  "puzzle": {
    "type": "${a.suggested_puzzle_type}",
    "prompt": "出題文（物語に溶け込む、美しく謎めいた語り口で）",
    "rules": "ルール説明（必要な場合のみ）",
    "answer": "答え",
    "solution_steps": ["ステップ1", "ステップ2", "ステップ3"],
    "hints": ["抽象的なヒント", "具体的なヒント", "ほぼ答えのヒント（救済）"],
    "difficulty": 2
  },
  "reward": {
    "lore_reveal": "謎を解くと分かる背景理解（factsと接続した解説）",
    "plot_key": "物語の鍵（キーワード/暗号片/数字など）",
    "next_hook": "次のスポットへ行きたくなる一文"
  },
  "linking_rationale": "なぜこの謎がこのスポットである必然性があるか（1-2文）"
}

【重要】
- player_handoutには謎を解くための全ての情報を含めること
- 答えは資料の情報から論理的に導き出せること
- plot_keyは最終的なmeta_puzzleで使われることを意識すること
`.trim();try{const _=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${g}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:x}]}]})});if(!_.ok)throw new Error(`Gemini API error: ${_.status}`);const w=await _.json(),B=((i=(p=(v=(f=(b=w==null?void 0:w.candidates)==null?void 0:b[0])==null?void 0:f.content)==null?void 0:v.parts)==null?void 0:p[0])==null?void 0:i.text)||"",L=B.match(/```json([\s\S]*?)```/),O=L?L[1]:B,R=JSON.parse(O.trim());return Gl(t,a,R)}catch(_){return console.error("Puzzle generation error:",_),Wl(t,a)}}function Gl(t,a,n){var r,m,g,d,u,x,b,f,v,p,i,_;return{spot_id:a.spot_id,spot_name:a.spot_name,lat:t.lat,lng:t.lng,scene_role:a.scene_role,lore_card:{short_story_text:((r=n.lore_card)==null?void 0:r.short_story_text)||"",facts_used:((m=n.lore_card)==null?void 0:m.facts_used)||a.selected_facts,player_handout:((g=n.lore_card)==null?void 0:g.player_handout)||""},puzzle:{type:a.suggested_puzzle_type,prompt:((d=n.puzzle)==null?void 0:d.prompt)||"",rules:(u=n.puzzle)==null?void 0:u.rules,answer:((x=n.puzzle)==null?void 0:x.answer)||"",solution_steps:((b=n.puzzle)==null?void 0:b.solution_steps)||[],hints:((f=n.puzzle)==null?void 0:f.hints)||["ヒント1","ヒント2","答えに近いヒント"],difficulty:((v=n.puzzle)==null?void 0:v.difficulty)||2},reward:{lore_reveal:((p=n.reward)==null?void 0:p.lore_reveal)||"",plot_key:((i=n.reward)==null?void 0:i.plot_key)||"",next_hook:((_=n.reward)==null?void 0:_.next_hook)||"次の地点へ進みましょう。"},linking_rationale:n.linking_rationale||""}}function Wl(t,a){return{spot_id:a.spot_id,spot_name:a.spot_name,lat:t.lat,lng:t.lng,scene_role:a.scene_role,lore_card:{short_story_text:`${t.spot_name}には、まだ解き明かされていない謎がある。`,facts_used:a.selected_facts,player_handout:t.spot_summary+`

`+t.spot_facts.join(`
`)},puzzle:{type:a.suggested_puzzle_type,prompt:"この場所に隠された謎を解き明かしてください。",answer:"【要設定】",solution_steps:["手がかりを探す","情報を整理する","答えを導き出す"],hints:["周囲をよく観察してください","資料を読み返してみましょう","ヒントはすでに目の前にあります"],difficulty:2},reward:{lore_reveal:`${t.spot_name}の秘密が明らかになった。`,plot_key:t.spot_name.slice(0,2),next_hook:"次の地点へ進みましょう。"},linking_rationale:`${t.spot_name}の特徴を活かした謎。`}}async function Kl(t,a,n){var g,d,u,x,b;const r=t.map(f=>({spot_id:f.spot_id,spot_name:f.spot_name,plot_key:f.reward.plot_key})),m=`
あなたはひらめき型パズルの謎作家です。
これまでのスポットで集めた「鍵」を全て使って解く、最終謎を作成してください。

【物語の真相】
${a.final_reveal_outline}

【集めた鍵】
${JSON.stringify(r,null,2)}

【出力形式】
{
  "prompt": "最終謎の出題文（全ての鍵を使う）",
  "answer": "答え",
  "explanation": "真相との接続（なぜこの答えが物語の結末に繋がるか）"
}

【重要】
- 全てのplot_keyを使うこと
- 答えは物語の真相と一致すること
- 解けた時に達成感があること
`.trim();try{const f=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:m}]}]})});if(!f.ok)throw new Error(`Gemini API error: ${f.status}`);const v=await f.json(),p=((b=(x=(u=(d=(g=v==null?void 0:v.candidates)==null?void 0:g[0])==null?void 0:d.content)==null?void 0:u.parts)==null?void 0:x[0])==null?void 0:b.text)||"",i=p.match(/```json([\s\S]*?)```/),_=i?i[1]:p,w=JSON.parse(_.trim());return{prompt:w.prompt||"全ての鍵を組み合わせて、最後の謎を解け。",answer:w.answer||"【要設定】",explanation:w.explanation||"物語の真相がここに。"}}catch(f){return console.error("Meta puzzle generation error:",f),{prompt:"これまで集めた鍵を全て並べてみよう。そこに隠されたメッセージは？",answer:t.map(p=>p.reward.plot_key).join(""),explanation:"全ての鍵が一つの答えを指し示していた。"}}}function Ra(t,a,n){const r=[],m=[],g=[];for(const u of t){const x=Jl(u,t,n);r.push(...x.errors.map(b=>({spot_id:u.spot_id,...b}))),m.push(...x.warnings.map(b=>({spot_id:u.spot_id,...b}))),g.push({spot_id:u.spot_id,...x.scores})}const d=ao(n,t);return d.valid||r.push({spot_id:"meta",code:"PLOT_KEY_UNUSED",message:d.message}),{passed:r.length===0,errors:r,warnings:m,spot_scores:g}}function Jl(t,a,n){const r=[],m=[],g=Yl(t);g<.5&&r.push({code:"NOT_SELF_CONTAINED",message:"player_handoutに謎を解くための情報が不足しています"});const d=Zl(t);d<.3&&r.push({code:"FACTS_NOT_CONNECTED",message:"factsと謎が因果的に接続されていません"}),Xl(t,a,n)||m.push({message:`plot_key「${t.reward.plot_key}」がmeta_puzzleで使用されていない可能性があります`});const x=eo(t);x<.3&&r.push({code:"WEAK_RATIONALE",message:"linking_rationaleが弱すぎます（雰囲気だけの説明は不可）"}),to(t)&&r.push({code:"TRIVIA_QUESTION",message:"外部知識が必要な暗記クイズになっています"});const f=so(t);return{errors:r,warnings:m,scores:{self_contained_score:g,facts_connection_score:d,narrative_fit_score:x,puzzle_quality_score:f}}}function Yl(t){let a=0;return t.lore_card.player_handout&&t.lore_card.player_handout.length>50&&(a+=.3),t.puzzle.solution_steps&&t.puzzle.solution_steps.length>=2&&(a+=.3),t.puzzle.answer&&!t.puzzle.answer.includes("【要設定】")&&(a+=.2),t.puzzle.hints&&t.puzzle.hints.length>=2&&(a+=.2),a}function Zl(t){let a=0;return t.lore_card.facts_used&&t.lore_card.facts_used.length>0&&(a+=.4),t.reward.lore_reveal&&t.reward.lore_reveal.length>20&&(a+=.3),t.linking_rationale&&t.linking_rationale.length>10&&(a+=.3),a}function Xl(t,a,n){const r=t.reward.plot_key;if(!r)return!1;if(n.inputs.some(g=>g.includes(t.spot_id))||n.prompt.includes(r)||n.answer.includes(r))return!0;const m=a.findIndex(g=>g.spot_id===t.spot_id);return m<a.length-1&&a[m+1].lore_card.player_handout.includes(r),!0}function eo(t){const a=t.linking_rationale||"";let n=0;return a.length>20&&(n+=.3),a.length>50&&(n+=.2),a.includes(t.spot_name)&&(n+=.2),["雰囲気","何となく","適当","とりあえず"].some(m=>a.includes(m))||(n+=.3),n}function to(t){const a=t.puzzle.prompt.toLowerCase();return[/誰[がは].*有名/,/何年[にで]/,/いつ.*建てられ/,/誰[のが].*設計/,/何という名前/,/知っている.*人物/].some(r=>r.test(a))}function so(t){let a=0;return t.puzzle.prompt.length>50&&(a+=.2),t.puzzle.solution_steps.length>=2&&(a+=.2),t.puzzle.hints.length>=3&&(a+=.2),t.puzzle.difficulty>=2&&t.puzzle.difficulty<=3&&(a+=.2),t.puzzle.type&&(a+=.2),a}function ao(t,a){const n=a.map(g=>g.spot_id),r=t.inputs.map(g=>{const d=g.match(/S\d+/);return d?d[0]:null}).filter(Boolean),m=n.filter(g=>!r.includes(g));return m.length>n.length/2?{valid:!1,message:`以下のスポットのplot_keyがmeta_puzzleで使用されていません: ${m.join(", ")}`}:{valid:!0,message:""}}function ro(t){const a=["NOT_SELF_CONTAINED","TRIVIA_QUESTION","UNRELATED_PUZZLE"];return t.errors.filter(n=>a.includes(n.code)).map(n=>n.spot_id).filter((n,r,m)=>m.indexOf(n)===r)}async function no(t,a,n){const r=(n==null?void 0:n.onProgress)||(()=>{}),m=(n==null?void 0:n.onSpotComplete)||(()=>{}),g=(n==null?void 0:n.onPlotComplete)||(()=>{}),d=(n==null?void 0:n.onError)||(()=>{});try{r({current_step:1,step_name:"motif_selection",progress:5});const u=await lo(t,a);r({current_step:1,step_name:"motif_selection",progress:20,total_spots:u.length});const x=await El(u,t.prompt,a);r({current_step:2,step_name:"plot_creation",progress:35});const b=await Fl(u,x,t.prompt,a);g(b);const f=[];for(let L=0;L<u.length;L++){r({current_step:3,step_name:"puzzle_design",progress:40+Math.floor(L/u.length*40),current_spot_index:L,total_spots:u.length});const O=await Oa(u[L],x[L],b,x,L,a);f.push(O),m(O,L)}r({current_step:3,step_name:"puzzle_design",progress:85});const v=await Kl(f,b,a),p={inputs:f.map(L=>`${L.spot_id}.plot_key`),...v};r({current_step:4,step_name:"validation",progress:90});const i=Ra(f,b,p),_=ro(i);if(_.length>0&&_.length<=3)for(const L of _){const O=f.findIndex(R=>R.spot_id===L);if(O>=0){const R=await Oa(u[O],x[O],b,x,O,a);f[O]=R}}const w=Ra(f,b,p);return r({current_step:4,step_name:"validation",progress:100}),{quest_id:`quest-${Date.now()}`,quest_title:await io(b,t.prompt,a),main_plot:b,spots:f,meta_puzzle:p,generation_metadata:{generated_at:new Date().toISOString(),pipeline_version:"2.0.0-layton",validation_passed:w.passed,validation_warnings:w.warnings.map(L=>L.message)}}}catch(u){throw d(u,{current_step:1,step_name:"motif_selection",progress:0,error:u.message}),u}}async function lo(t,a){var m,g,d,u,x,b,f,v,p;const n=[];t.genre_support&&n.push(`- ジャンル補助: ${t.genre_support}`),t.tone_support&&n.push(`- トーン補助: ${t.tone_support}`),(m=t.prompt_support)!=null&&m.protagonist&&n.push(`- 主人公: ${t.prompt_support.protagonist}`),(g=t.prompt_support)!=null&&g.objective&&n.push(`- 目的: ${t.prompt_support.objective}`),(d=t.prompt_support)!=null&&d.ending&&n.push(`- 結末: ${t.prompt_support.ending}`),(u=t.theme_tags)!=null&&u.length&&n.push(`- テーマタグ: ${t.theme_tags.join(", ")}`);const r=`
あなたは位置連動ミステリークエストの設計者です。
以下のリクエストに基づいて、スポット情報を生成してください。

【メインリクエスト（最優先）】
${t.prompt}

${t.center_location?`【📍 エリア指定（必須）】
ユーザーの現在地：緯度${t.center_location.lat.toFixed(4)} / 経度${t.center_location.lng.toFixed(4)}
この地点から半径${t.radius_km||1}km以内にある実在のスポットだけを選んでください。
この範囲外のスポットは絶対に含めないでください。
`:""}
【基本設定】
- スポット数: ${t.spot_count}件
- 難易度: ${t.difficulty}

${n.length>0?`【補助条件】
${n.join(`
`)}

※補助条件はメインリクエストを上書きしません。
メインリクエストと矛盾する場合はメインを優先してください。
`:""}
【🚨🚨🚨 絶対厳守：ウォーキングクエストのルール 🚨🚨🚨】
これは「徒歩で巡るウォーキングクエスト」です。

■ 距離の絶対ルール（破ったら無効）
- スポット1→2、2→3...全ての隣接スポット間が500m以内であること
- 例：浅草なら浅草寺周辺500m圏内、渋谷なら渋谷駅周辺500m圏内
- 「浅草」と「上野」のように異なるエリアを混ぜるのは禁止

■ 具体的な選び方
- まず中心となるエリア（例：浅草寺前）を決める
- その半径500m以内にある実在スポットだけを選ぶ
- 徒歩5分で次のスポットに着ける配置にする

■ 禁止事項
- 電車・バス・車での移動が必要になる配置
- 「〜区」「〜市」全体から広くスポットを選ぶこと
- 1km以上離れたスポットを入れること

【文章の読みやすさ（重要）】
- spot_summaryは中学生でも読めるやさしい言葉で書く
- 専門用語・難しい漢字・意味不明なカタカナ語は使わない
- 歴史の話も「へぇ、面白い！」と思える身近な言葉で

【出力形式】
各スポットについて以下を含むJSON配列を出力：
[
  {
    "spot_name": "スポット名（実在する場所）",
    "spot_summary": "2-4行の概要（歴史的背景、特徴）",
    "spot_facts": [
      "事実1: この場所を象徴する具体的な事実",
      "事実2: 別の側面からの事実",
      "事実3: 謎のモチーフになりそうな事実"
    ],
    "spot_theme_tags": ["タグ1", "タグ2"],
    "lat": 35.XXXXX,
    "lng": 139.XXXXX
  }
]

【重要】
- spot_factsは3-7個、具体的で謎のモチーフになれる事実を
- 緯度経度は可能な範囲で正確に（後でGeocoding APIで補正されます）
- 全スポットが徒歩圏内に収まることを最優先で
`.trim();try{const i=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:r}]}]})});if(!i.ok)throw new Error(`Gemini API error: ${i.status}`);const _=await i.json(),w=((p=(v=(f=(b=(x=_==null?void 0:_.candidates)==null?void 0:x[0])==null?void 0:b.content)==null?void 0:f.parts)==null?void 0:v[0])==null?void 0:p.text)||"",B=w.match(/```json([\s\S]*?)```/),L=B?B[1]:w,O=JSON.parse(L.trim()),R=await Promise.all(O.map(async(P,he)=>{try{const re=await Da(P.spot_name),xe=(re==null?void 0:re.lat)||P.lat||35.6804,te=(re==null?void 0:re.lng)||P.lng||139.769,A=await Ml(`spot-${he}`,P.spot_name,xe,te),Z=A.evidences.slice(0,3).map(me=>me.content);return{spot_name:P.spot_name,spot_summary:P.spot_summary||A.official_description||"",spot_facts:[...P.spot_facts||[],...Z].slice(0,7),spot_theme_tags:P.spot_theme_tags||[],lat:xe,lng:te}}catch{const re=await Da(P.spot_name).catch(()=>null);return{spot_name:P.spot_name,spot_summary:P.spot_summary||"",spot_facts:P.spot_facts||[],spot_theme_tags:P.spot_theme_tags||[],lat:(re==null?void 0:re.lat)||P.lat||35.6804,lng:(re==null?void 0:re.lng)||P.lng||139.769}}})),be=(t.radius_km||1)*1e3;return oo(R,800,t.center_location,be)}catch(i){throw console.error("Initial spots generation error:",i),i}}function oo(t,a,n,r){if(t.length<=1)return t;let m=t;n&&r&&(m=t.filter(u=>Ba(n.lat,n.lng,u.lat,u.lng)<=r),console.log(`[エリアフィルタ] 現在地から${r}m以内: ${t.length}件 → ${m.length}件`),m.length===0&&(console.warn("[警告] 現在地付近にスポットがありません。元のスポットを使用します。"),m=t));const g=[m[0]],d=[...m.slice(1)];for(;d.length>0&&g.length<m.length;){const u=g[g.length-1];let x=-1,b=1/0;for(let f=0;f<d.length;f++){const v=Ba(u.lat,u.lng,d[f].lat,d[f].lng);v<b&&(b=v,x=f)}if(x>=0&&b<=a)g.push(d[x]),d.splice(x,1);else break}return console.log(`[ウォーキングクエスト] ${m.length}件中${g.length}件のスポットを選択（スポット間${a}m以内）`),g}function Ba(t,a,n,r){const g=(n-t)*Math.PI/180,d=(r-a)*Math.PI/180,u=Math.sin(g/2)*Math.sin(g/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}async function io(t,a,n){var m,g,d,u,x,b;const r=`
以下の物語に相応しい、魅力的なクエストタイトルを1つだけ生成してください。

【物語の概要】
${t.premise}
${t.goal}
${t.antagonist_or_mystery}

【元のリクエスト】
${a}

タイトルだけを出力してください（JSON不要）。
`.trim();try{const f=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:r}]}]})});if(!f.ok)throw new Error(`Gemini API error: ${f.status}`);const v=await f.json();return(((b=(x=(u=(d=(g=(m=v==null?void 0:v.candidates)==null?void 0:m[0])==null?void 0:g.content)==null?void 0:d.parts)==null?void 0:u[0])==null?void 0:x.text)==null?void 0:b.trim())||"").replace(/^["「『]|["」』]$/g,"").trim()||`${a.slice(0,20)}の謎`}catch{return`${a.slice(0,20)}の謎`}}const co={title:"鎌倉・影踏み侍の遺言",description:"「私の影を探してくれ」──不思議な手紙に導かれ、あなたは光と影が交錯する古都・鎌倉を彷徨う。",area:"鎌倉",difficulty:"謎解き・中級",tags:["ミステリー","歴史ロマン","没入型"]},xo={castName:"影踏み侍",castTone:"静かで哲学的、少し寂しげ",prologueTitle:"影のない男",prologueBody:`夕暮れの鎌倉駅。人混みの中で、奇妙な男とすれ違った。
古風な着物を着たその男には、足元に"影"がなかった。

男は一通の手紙をあなたに手渡し、煙のように消えた。

「私の影が逃げてしまった。
　影は、主人の心の形をしているという。
　三つの場所を巡り、私の影＝心を捕まえてほしい。

　最初の場所は、神の使いが舞う宮。鶴岡八幡宮だ。」`,epilogueBody:`三つの謎を解き、あなたは真実にたどり着いた。

「影」とは、過去の記憶。そして歴史そのもの。
私たちは誰もが、過去という長い影を背負って生きている。

侍の声が聞こえた気がした。
「ありがとう。これで私も、歴史の一部として眠ることができる...」

振り向くと、あなたの足元には、夕陽に長く伸びる自分の影だけがあった。`,characters:[{id:"c1",name:"影踏み侍",role:"依頼人",color:"bg-stone-800",tone:"古風",motivation:"自分の影（生きた証）を取り戻したい",sampleDialogue:"影はどこへ行った..."}]},mo=[{id:"spot-0",name:"鶴岡八幡宮",address:"神奈川県鎌倉市雪ノ下2-1-31",lat:35.3269,lng:139.5565,directions:"鎌倉駅東口から若宮大路を直進、徒歩10分",sceneRole:"導入（視点）",storyText:`大きな鳥居の下に来た。
侍の手紙には、こう書かれている。

「人は皆、前ばかり見て歩く。
　だから大切なものを見落とすのだ。
　立ち止まり、上を見上げよ。
　そこにあるものが、最初の鍵だ。」`,playerHandout:`【侍のスケッチ】

鳥居を下から見上げた図が描かれている。
しかし、鳥居の上の空に、不思議な線が引かれている。

　　＿＿＿＿＿＿（空）
　　　　│
　　　　│

スケッチの横のメモ：
「鳥居（Torii）の上にあるもの。
　それは、地（Earth）の対義語。
　青く、広く、どこまでも続くもの。」`,challengeText:`【第一の謎】

鳥居の上にあるもの。
地の対義語。

漢字一文字で答えよ。`,hints:["鳥居の上には何が広がっていますか？","「地」の反対は？「天」とも言いますが、普段見る青いものは？","答えは「空」です。"],answer:"空",successMessage:`正解！「空」だ。

ふと見上げると、鎌倉の青い空が広がっていた。
広大で、何も遮るものがない自由な心。

侍の声が響く。
「そうだ。私の心は、かつてあの空のように自由だった...」

第一の鍵「空」を手に入れた。`,solutionSteps:["「鳥居の上」を見上げる","「地」の対義語を考える","青く広いもの = 「空」"],loreReveal:"鶴岡八幡宮の参道（若宮大路）は、海から宮へと一直線に伸びている。空と海と神をつなぐ道だ。",plotKey:"空",puzzleType:"連想・視点",linkingRationale:"視線を上げることで「空」を認識させる、物理的な没入体験"},{id:"spot-1",name:"高徳院（鎌倉大仏）",address:"神奈川県鎌倉市長谷4-2-28",lat:35.3168,lng:139.5357,directions:"江ノ電「長谷駅」から徒歩7分",sceneRole:"転換（解釈）",storyText:`大仏の前に来ると、侍の気配が濃くなった。
手紙の続きが浮かび上がる。

「私は口があるが、語らない。
　耳があるが、聞かない。
　
　だが、想いを伝える術を持っている。
　大仏様もまた、同じ術を使っている。」`,playerHandout:`【仏像の解説図】

大仏の姿勢についてのメモ：

・目は半眼（半分閉じている）
・口は結んでいる（語らない）
・**手**は印を結んでいる（定印）

解説：
「仏は言葉を使わず、**手**の形（印）で意志や悟りを人々に伝える。」`,challengeText:`【第二の謎】

口を使わずに想いを伝える体の部位。
大仏が印を結んでいる部位。

「掴む」「握る」「離す」動作をするもの。

漢字一文字で答えよ。`,hints:["解説図をよく読んでください。「仏は〇〇の形で意志を伝える」","物を掴んだり、握手をする体の部分は？","答えは「手」です。"],answer:"手",successMessage:`正解！「手」だ。

大仏の手の形（印）には、深い意味が込められている。
言葉よりも雄弁に、その手は慈悲を語っている。

侍の声：
「私の手は...かつて刀を握っていた。だが今は、誰かと繋ぐために使いたいのだ」

第二の鍵「手」を手に入れた。`,solutionSteps:["解説図を読む：「手」の形で意志を伝えるとある","口を使わない伝達手段 = 手話やジェスチャー = 手","答え：手"],loreReveal:"鎌倉大仏の印は「上品上生印（じょうぼんじょうしょういん）」という、最高の悟りを表す形をしている。",plotKey:"手",puzzleType:"リドル（なぞなぞ）",linkingRationale:"大仏の特徴的な「印」に注目させ、手の意味を考えさせる"},{id:"spot-2",name:"稲村ヶ崎",address:"神奈川県鎌倉市稲村ガ崎1丁目",lat:35.3043,lng:139.5217,directions:"江ノ電「稲村ヶ崎駅」から徒歩5分",sceneRole:"真実（統合）",storyText:`夕陽が沈む海岸。ここが旅の終点だ。
侍の手紙が、最後の輝きを放つ。

「二つの鍵『空』と『手』を持て。
　そして太陽に背を向けよ。

　空に向かって手をかざした時、
　地面に生まれる『もう一人の私』。
　それが最後の答えだ。」`,playerHandout:`【光と形の法則】

１．光源（太陽）がある。
２．遮るもの（手）がある。
３．反対側（地面）に、黒い形が現れる。

この現象を何と呼ぶか？

数式：
光 ＋ 物体 ＝ 〇〇`,challengeText:`【最後の謎】

これまで集めた鍵：
１．空（背景となる場所）
２．手（遮るもの）

太陽の下、空に手をかざすと、地面にできる黒い形。
侍がずっと探していた「失われたもの」。

漢字一文字で答えよ。`,hints:["光があるところに必ずできるもの","夕方になると長く伸びるもの","侍が探していたのは自分の「影」です"],answer:"影",successMessage:`正解！「影」だ。

あなたが手をかざすと、地面に手の影が落ちた。
それと重なるように、着物姿の侍の影が現れた。

「ありがとう。影があるということは、そこに光があり、私が存在している証だ」

侍の影は、あなたの影と一瞬だけ重なり、そして夕闇に溶けていった。
鎌倉の波音が、優しく響いていた。`,solutionSteps:["条件を確認：太陽＋手＋地面","現象を想像：光を遮るとできるもの","物語の目的を想起：侍は「影」を探していた","答え：影"],loreReveal:"稲村ヶ崎はかつて激戦の地（死の場所）だったが、今は美しい夕日（生の輝き）の名所。光と影が同居する場所だ。",plotKey:"影",puzzleType:"物理・メタ統合",linkingRationale:"過去の鍵（空・手）を物理的なアクション（かざす）で統合し、タイトル回収（影）へ"}],ho="AIzaSyBR6o-tY4ewZA-FJigO1FoSE5FAEouYGcs",po=({spots:t,isGenerating:a=!1})=>{const n=Hr(),r=Qr("maps"),[m,g]=o.useState(null),d=o.useRef(0),u=o.useRef(!1);return o.useEffect(()=>{if(!(!n||!r||t.length===0)){if(m)m.setPath(t.map(x=>({lat:x.lat,lng:x.lng})));else{const x=new r.Polyline({path:t.map(b=>({lat:b.lat,lng:b.lng})),geodesic:!0,strokeColor:"#C9A227",strokeOpacity:.8,strokeWeight:4});x.setMap(n),g(x)}if(t.length>d.current){const x=t[t.length-1];n.panTo({lat:x.lat,lng:x.lng}),n.setZoom(16),d.current=t.length}return()=>{m&&t.length===0&&m.setMap(null)}}},[n,r,t,m]),o.useEffect(()=>{if(!(!n||t.length===0)&&!a&&t.length>=7&&!u.current){const x=setTimeout(()=>{const b=new google.maps.LatLngBounds;t.forEach(f=>b.extend({lat:f.lat,lng:f.lng})),n.fitBounds(b,60),u.current=!0},500);return()=>clearTimeout(x)}},[n,t,a]),o.useEffect(()=>{t.length===0&&(u.current=!1,d.current=0)},[t.length]),e.jsx(e.Fragment,{children:t.map((x,b)=>e.jsx(la,{position:{lat:x.lat,lng:x.lng},title:x.name,children:e.jsx(N.div,{initial:{scale:0,y:-20},animate:{scale:1,y:0},transition:{delay:b*.15,type:"spring",stiffness:300},className:"w-10 h-10 rounded-full bg-brand-gold text-white text-sm font-bold flex items-center justify-center shadow-lg border-2 border-white",children:b+1})},x.id))})};function uo({questId:t,onBack:a,onLogoHome:n,onPublish:r,onTestRun:m}){var ct,Ft,as;const{user:g,isPro:d}=ca(),u=es(),[x,b]=o.useState("simple"),[f,v]=o.useState("editor"),[p,i]=o.useState(""),[_,w]=o.useState([]),[B,L]=o.useState(["spots","story","mystery"]),[O,R]=o.useState({}),[be,Y]=o.useState(),[ee,P]=o.useState(),[he,re]=o.useState(!1),[xe,te]=o.useState({duration:60,difficulty:"medium",spotCount:10,radiusKm:1}),[A,Z]=o.useState(null),[me,E]=o.useState(!1),[V,oe]=o.useState(!1),[ke,je]=o.useState(""),[ie,Se]=o.useState(null),[fe,Me]=o.useState(null),[C,ve]=o.useState([]),[de,I]=o.useState(null),[c,h]=o.useState({}),[k,z]=o.useState(null),[K,y]=o.useState(new Set),[M,$]=o.useState("input"),[q,U]=o.useState(null),[Ce,ze]=o.useState({}),[Ye,Es]=o.useState(null),et=d?500:50,[tt,ms]=o.useState(0),Xe=et-tt,[_t,it]=o.useState("route"),[Ge,mt]=o.useState(null),[$t,ts]=o.useState(new Set),[Mt,ht]=o.useState(!1),[We,st]=o.useState(null),[dt,hs]=o.useState({title:!1,spots:!1,mystery:!1,story:!1,preview:!1}),[Pt,St]=o.useState(!1),[pt]=Br(),ye=o.useRef(!1);o.useEffect(()=>{const j=pt.get("prompt");j&&!ye.current&&!p&&(ye.current=!0,i(j),setTimeout(()=>{const S=document.querySelector("[data-generate-trigger]");S&&S.click()},500))},[pt,p]);const[at,ps]=o.useState(!1),[Rt,ut]=o.useState(null),Bt=fe!==null||C.length>0||de!==null,[Ls,ss]=o.useState(!1);o.useEffect(()=>{if(!t)return;(async()=>{ss(!0);try{const{data:S}=await D.from("quests").select("*").eq("id",t).maybeSingle();S&&S.title&&(Me({title:S.title||"",description:S.description||"",area:S.area_name||"",difficulty:"中級",tags:Array.isArray(S.tags)?S.tags:[]}),h(He=>({...He,"basic-info":"ready"})));const{data:Ne}=await D.from("spots").select("*, spot_details(*)").eq("quest_id",t).order("order_index",{ascending:!0});if(Ne&&Ne.length>0){const He=Ne.map((H,qe)=>{const we=Array.isArray(H.spot_details)?H.spot_details[0]:H.spot_details;return{id:H.id||`spot-${qe}`,name:H.name||"",address:H.address||"",lat:H.lat||0,lng:H.lng||0,directions:(we==null?void 0:we.nav_text)||"",storyText:(we==null?void 0:we.story_text)||"",challengeText:(we==null?void 0:we.question_text)||"",hints:we!=null&&we.hint_text?we.hint_text.split(`
`).filter(Ze=>Ze.trim()):[],answer:(we==null?void 0:we.answer_text)||"",successMessage:(we==null?void 0:we.completion_message)||""}});ve(He);const Ie={};He.forEach((H,qe)=>{Ie[`spot-${qe}`]="ready"}),h(H=>({...H,...Ie}))}const{data:ne}=await D.from("story_timelines").select("*").eq("quest_id",t).maybeSingle();ne&&(I({castName:ne.cast_name||"",castTone:ne.cast_tone||"",prologueTitle:"",prologueBody:ne.prologue||"",epilogueBody:ne.epilogue||"",characters:Array.isArray(ne.characters)?ne.characters:[]}),h(He=>({...He,story:"ready"}))),(S!=null&&S.title||Ne&&Ne.length>0)&&$("canvas")}catch(S){console.error("Error loading quest data:",S)}finally{ss(!1)}})()},[t]);const Ds=()=>{const j=["渋谷のストリートカルチャーを巡るミステリー。消えたグラフィティアーティストの謎","鎌倉の古刹を巡る歴史ミステリー。鎌倉時代の秘宝を探せ","下北沢のカフェ巡りクエスト。隠れ家カフェのマスターが残した暗号","浅草の夜を彩るナイトクエスト。江戸の怪談をたどる","横浜赤レンガ倉庫エリアの謎解き。貿易商が残した暗号文書"];i(j[Math.floor(Math.random()*j.length)])},qt=()=>{Me(co),I(xo),ve(mo),$("canvas"),h({"basic-info":"ready","spot-0":"ready","spot-1":"ready","spot-2":"ready",story:"ready"}),Se(null)},us=()=>{if(!navigator.geolocation){Se("お使いのブラウザは位置情報に対応していません");return}E(!0),Se(null),navigator.geolocation.getCurrentPosition(async j=>{var ne,He,Ie;const S=j.coords.latitude,Ne=j.coords.longitude;try{const H="AIzaSyBR6o-tY4ewZA-FJigO1FoSE5FAEouYGcs";if(H){const Ze=((Ie=(He=(ne=(await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${S},${Ne}&language=ja&key=${H}`)).json()).results)==null?void 0:ne[0])==null?void 0:He.formatted_address)==null?void 0:Ie.replace(/日本、〒[\d-]+\s*/,""))||"";Z({lat:S,lng:Ne,address:Ze})}}catch{Z({lat:S,lng:Ne})}E(!1)},j=>{Se("位置情報の取得に失敗しました: "+j.message),E(!1)},{enableHighAccuracy:!0,timeout:1e4})},Os=async()=>{var j,S,Ne;if(!p.trim()){Se("プロンプトを入力してください");return}oe(!0),Se(null),$("canvas"),Me(null),ve([]),I(null);try{const ne="AIzaSyD0wPNjJUvnhDTguxYLwl9NE_kFvEZZs1I",He={prompt:p,difficulty:xe.difficulty,spot_count:xe.spotCount,theme_tags:_.length>0?_:void 0,genre_support:be?(j=ta.find(H=>H.id===be))==null?void 0:j.label:void 0,tone_support:ee?(S=sa.find(H=>H.id===ee))==null?void 0:S.label:void 0,prompt_support:O.protagonist||O.objective||O.ending?O:void 0,center_location:A?{lat:A.lat,lng:A.lng}:void 0,radius_km:xe.radiusKm},Ie=await no(He,ne,{onProgress:H=>{const qe={motif_selection:"モチーフを選定中...",plot_creation:"物語を構築中...",puzzle_design:`謎を設計中... (${H.current_spot_index??1}/${H.total_spots??0})`,validation:"品質を検証中..."};je(qe[H.step_name]||"AIがクエストを設計中..."),H.step_name==="plot_creation"?h({"basic-info":"generating"}):H.step_name==="puzzle_design"&&H.current_spot_index!==void 0&&h(we=>({...we,[`spot-${H.current_spot_index}`]:"generating"}))},onPlotComplete:H=>{Me({title:"",description:H.premise,area:"",difficulty:xe.difficulty==="easy"?"初級":xe.difficulty==="medium"?"中級":"上級",tags:_}),h({"basic-info":"ready"})},onSpotComplete:(H,qe)=>{const we={id:H.spot_id,name:H.spot_name,address:"",lat:H.lat,lng:H.lng,directions:H.lore_card.player_handout,storyText:H.lore_card.short_story_text,challengeText:H.puzzle.prompt,hints:H.puzzle.hints,answer:H.puzzle.answer,successMessage:H.reward.next_hook,playerHandout:H.lore_card.player_handout,solutionSteps:H.puzzle.solution_steps,loreReveal:H.reward.lore_reveal,plotKey:H.reward.plot_key,puzzleType:H.puzzle.type,sceneRole:H.scene_role,linkingRationale:H.linking_rationale};ve(Ze=>{const Ct=[...Ze];return Ct[qe]=we,Ct}),h(Ze=>({...Ze,[`spot-${qe}`]:"ready"}))}});Me({title:Ie.quest_title,description:Ie.main_plot.premise,area:"",difficulty:xe.difficulty==="easy"?"初級":xe.difficulty==="medium"?"中級":"上級",tags:_}),I({castName:"謎の案内人",castTone:"知的でミステリアス",prologueTitle:"冒険の始まり",prologueBody:Ie.main_plot.premise+`

`+Ie.main_plot.goal,epilogueBody:Ie.main_plot.final_reveal_outline+`

`+Ie.meta_puzzle.explanation,characters:[{id:"c1",name:"案内人",role:"ナビゲーター",color:"bg-brand-gold",tone:"ミステリアス"}]}),h(H=>({...H,story:"ready"})),je(""),v("preview"),(Ne=Ie.generation_metadata.validation_warnings)!=null&&Ne.length&&console.log("Validation warnings:",Ie.generation_metadata.validation_warnings)}catch(ne){console.error("Generation error:",ne),Se(ne.message||"生成に失敗しました。時間をおいて再試行してください。"),h({})}finally{oe(!1)}},Rs=async(j,S,Ne)=>{try{await D.from("quests").upsert({id:j,creator_id:g==null?void 0:g.id,title:S.title,description:S.description,area_name:S.area,tags:S.tags,status:"draft",mode:"PRIVATE"},{onConflict:"id"});const ne=Ne.map((Ie,H)=>({id:crypto.randomUUID(),quest_id:j,name:Ie.name,address:Ie.address,lat:Ie.lat,lng:Ie.lng,order_index:H+1,status:"draft"}));await D.from("spots").delete().eq("quest_id",j);const{data:He}=await D.from("spots").insert(ne).select("id");if(He){const Ie=He.map((H,qe)=>{var we,Ze,Ct,rs,Tt,bs,ns;return{id:H.id,spot_id:H.id,nav_text:((we=Ne[qe])==null?void 0:we.directions)||"",story_text:((Ze=Ne[qe])==null?void 0:Ze.storyText)||"",question_text:((Ct=Ne[qe])==null?void 0:Ct.challengeText)||"",hint_text:((Tt=(rs=Ne[qe])==null?void 0:rs.hints)==null?void 0:Tt.join(`
`))||"",answer_text:((bs=Ne[qe])==null?void 0:bs.answer)||"",completion_message:((ns=Ne[qe])==null?void 0:ns.successMessage)||"",answer_type:"text"}});await D.from("spot_details").upsert(Ie)}S.story&&await D.from("story_timelines").upsert({quest_id:j,prologue:S.story.prologueBody,epilogue:S.story.epilogueBody,cast_name:S.story.castName,cast_tone:S.story.castTone,characters:S.story.characters})}catch(ne){console.error("Save to DB error:",ne)}},bt=async()=>{if(!t||!fe){ut("保存するコンテンツがありません"),setTimeout(()=>ut(null),3e3);return}ps(!0),ut(null);try{const j={title:fe.title,description:fe.description,area:fe.area,tags:fe.tags,story:de?{prologueBody:de.prologueBody,epilogueBody:de.epilogueBody,castName:de.castName,castTone:de.castTone,characters:de.characters}:null};await Rs(t,j,C),ut("保存しました！"),setTimeout(()=>ut(null),3e3)}catch(j){console.error("Save error:",j),ut("保存に失敗しました"),setTimeout(()=>ut(null),3e3)}finally{ps(!1)}};return e.jsxs("div",{className:"min-h-screen bg-white pt-16",children:[e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:`w-full md:w-[380px] md:min-h-screen md:border-r border-stone-200 bg-white md:sticky md:top-16 md:h-[calc(100vh-4rem)] md:overflow-y-auto ${M==="input"?"block":"hidden md:block"}`,children:[e.jsxs("div",{className:"p-5 pt-12 space-y-5",children:[!d&&e.jsxs("div",{className:"flex items-center bg-stone-100 rounded-full p-0.5",children:[e.jsx("button",{onClick:()=>b("simple"),className:`flex-1 py-2 rounded-full text-xs font-bold transition-all ${x==="simple"?"bg-white text-brand-dark shadow-sm":"text-stone-500"}`,children:"Free"}),e.jsxs("button",{onClick:()=>St(!0),className:"flex-1 py-2 rounded-full text-xs font-bold transition-all flex items-center justify-center gap-1 text-stone-500 hover:text-amber-600",children:[e.jsx(Zt,{size:12,className:"text-amber-500"}),"Pro"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-gradient-to-r from-stone-50 to-amber-50/50 border border-stone-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oa,{size:14,className:"text-brand-gold"}),e.jsx("span",{className:"text-xs font-bold text-stone-600",children:"AIクレジット"})]}),e.jsxs("span",{className:`text-xs font-bold ${Xe<10?"text-rose-500":"text-stone-500"}`,children:[Xe,"/",et," 残り"]})]}),e.jsx("div",{className:"w-full h-2 bg-stone-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${Xe<10?"bg-rose-400":"bg-brand-gold"}`,style:{width:`${Xe/et*100}%`}})}),!d&&e.jsxs("button",{onClick:()=>St(!0),className:"mt-2 w-full flex items-center justify-center gap-1 text-[10px] font-bold text-amber-600 hover:text-amber-700",children:[e.jsx(Zt,{size:10}),"Proなら月500クレジット →"]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-brand-dark mb-2",children:[e.jsx(Be,{size:16,className:"text-brand-gold"}),"どんなクエストを作りたいですか？"]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:p,onChange:j=>i(j.target.value),placeholder:`誰が・何を目的に・最後にどんな驚きが欲しいか

例：
• 浅草で江戸時代の商人が残した暗号を解き明かす探偵ミステリー
• 鎌倉の古刹を巡りながら鎌倉時代の秘宝を探す宝探しクエスト
• 下北沢のカフェを巡る中で隠れ家マスターの謎を解く`,className:"w-full h-40 p-4 pr-10 rounded-xl border-2 border-stone-200 text-sm text-brand-dark placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-brand-gold/30 focus:border-brand-gold resize-none"}),e.jsx("button",{onClick:Ds,className:"absolute top-3 right-3 p-1.5 rounded-lg bg-stone-100 hover:bg-stone-200 text-stone-500 hover:text-brand-dark transition-colors",title:"ランダム生成",children:e.jsx(Zs,{size:16})})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>re(!he),className:"flex items-center gap-2 text-xs text-stone-500 hover:text-brand-dark transition-colors mb-2",children:[e.jsx(is,{size:14}),"補助質問で精度アップ（任意）",e.jsx(Nt,{size:14,className:`transition-transform ${he?"rotate-180":""}`})]}),e.jsx(Ue,{children:he&&e.jsx(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-3 bg-stone-50 rounded-xl border border-stone-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-stone-400 mb-1",children:"主人公は？"}),e.jsx("input",{type:"text",value:O.protagonist||"",onChange:j=>R(S=>({...S,protagonist:j.target.value})),placeholder:aa.protagonist,className:"w-full px-2 py-1.5 rounded-lg border border-stone-200 text-xs placeholder:text-stone-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-stone-400 mb-1",children:"目的は？"}),e.jsx("input",{type:"text",value:O.objective||"",onChange:j=>R(S=>({...S,objective:j.target.value})),placeholder:aa.objective,className:"w-full px-2 py-1.5 rounded-lg border border-stone-200 text-xs placeholder:text-stone-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-stone-400 mb-1",children:"結末は？"}),e.jsx("input",{type:"text",value:O.ending||"",onChange:j=>R(S=>({...S,ending:j.target.value})),placeholder:aa.ending,className:"w-full px-2 py-1.5 rounded-lg border border-stone-200 text-xs placeholder:text-stone-300"})]})]})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-stone-500 mb-2",children:"🏷️ ジャンル補助（任意）"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:ta.map(j=>e.jsxs("button",{onClick:()=>Y(be===j.id?void 0:j.id),className:`flex items-center gap-1 px-2.5 py-1.5 rounded-full text-[11px] font-medium transition-all ${be===j.id?"bg-brand-gold text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"}`,title:j.description,children:[be!==j.id&&e.jsx(Pa,{size:10}),j.label]},j.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-stone-500 mb-2",children:"🎨 トーン補助（任意）"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:sa.map(j=>e.jsxs("button",{onClick:()=>P(ee===j.id?void 0:j.id),className:`flex items-center gap-1 px-2.5 py-1.5 rounded-full text-[11px] font-medium transition-all ${ee===j.id?"bg-violet-500 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"}`,title:j.description,children:[ee!==j.id&&e.jsx(Pa,{size:10}),j.label]},j.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-stone-500 mb-2",children:["📋 テンプレート",!d&&e.jsx("span",{className:"text-amber-500 text-[10px]",children:"(Pro: 目的別テンプレ解放)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{className:"p-3 rounded-xl bg-white border-2 border-brand-gold text-left transition-all",children:[e.jsx("span",{className:"text-xs font-bold text-brand-dark",children:"基本テンプレ"}),e.jsx("p",{className:"text-[10px] text-stone-500 mt-0.5",children:"シンプルな謎解き"})]}),[{id:"family",label:"👨‍👩‍👧 家族向け",desc:"子連れ対応"},{id:"gourmet",label:"🍜 グルメツアー",desc:"食べ歩き謎"},{id:"history",label:"🏯 歴史探訪",desc:"史跡巡り"}].map(j=>e.jsxs("button",{onClick:()=>!d&&St(!0),className:`p-3 rounded-xl border text-left transition-all relative ${d?"bg-white border-stone-200 hover:border-brand-gold/50":"bg-stone-50 border-stone-200 opacity-70"}`,children:[!d&&e.jsx($s,{size:12,className:"absolute top-2 right-2 text-stone-400"}),e.jsx("span",{className:"text-xs font-bold text-brand-dark",children:j.label}),e.jsx("p",{className:"text-[10px] text-stone-500 mt-0.5",children:j.desc})]},j.id))]})]}),e.jsxs("div",{className:`p-3 rounded-xl border ${d?"bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200":"bg-stone-50 border-stone-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{size:14,className:d?"text-emerald-600":"text-stone-400"}),e.jsx("span",{className:`text-xs font-bold ${d?"text-emerald-700":"text-stone-500"}`,children:"多言語対応"}),!d&&e.jsx($s,{size:10,className:"text-stone-400"})]}),d?e.jsx("div",{className:"flex gap-1",children:["EN","ZH","KO"].map(j=>e.jsx("button",{className:"px-2 py-1 rounded text-[10px] font-bold bg-white border border-emerald-200 text-emerald-700 hover:bg-emerald-100",children:j},j))}):e.jsxs("button",{onClick:()=>St(!0),className:"flex items-center gap-1 px-2 py-1 rounded text-[10px] font-bold text-amber-600 hover:text-amber-700",children:[e.jsx(Zt,{size:10}),"Proで解放"]})]}),d&&e.jsx("p",{className:"text-[10px] text-emerald-600 mt-1",children:"英語・中国語・韓国語に自動翻訳"})]}),e.jsxs("div",{className:"space-y-3 p-4 bg-stone-50 rounded-xl border border-stone-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center gap-2 text-xs font-medium text-stone-500 mb-2",children:"📍 現在地から探す"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:us,disabled:me,className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-xs font-bold transition-all ${A?"bg-emerald-100 text-emerald-700 border border-emerald-200":"bg-white text-stone-600 border border-stone-200 hover:bg-stone-100"}`,children:me?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{size:14,className:"animate-spin"}),"取得中..."]}):A?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{size:14}),((ct=A.address)==null?void 0:ct.slice(0,20))||"現在地取得済み"]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{size:14}),"現在地を取得"]})}),A&&e.jsx("button",{onClick:()=>Z(null),className:"p-2 rounded-lg text-stone-400 hover:text-stone-600 hover:bg-stone-100",title:"クリア",children:"×"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center justify-between text-xs text-stone-500 mb-2",children:[e.jsx("span",{children:"🎯 ここから半径"}),e.jsxs("span",{className:"font-bold text-brand-dark",children:[xe.radiusKm,"km圏内"]})]}),e.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:xe.radiusKm,onChange:j=>te(S=>({...S,radiusKm:parseFloat(j.target.value)})),className:"w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-brand-gold"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-stone-400 mt-1",children:[e.jsx("span",{children:"500m"}),e.jsx("span",{children:"2km"}),e.jsx("span",{children:"3.5km"}),e.jsx("span",{children:"5km"})]}),e.jsxs("p",{className:"text-[10px] text-stone-400 mt-2",children:["現在地から",xe.radiusKm,"km以内のエリアでクエストを生成"]})]})]}),e.jsx(Ue,{children:x==="pro"&&e.jsx(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-4 p-4 bg-stone-50 rounded-xl border border-stone-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-[10px] font-bold text-stone-400 uppercase tracking-wide mb-1",children:"Duration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{size:14,className:"text-stone-400"}),e.jsx("input",{type:"number",value:xe.duration,onChange:j=>te(S=>({...S,duration:parseInt(j.target.value)||60})),className:"w-16 px-2 py-1 rounded-lg border border-stone-200 text-xs"}),e.jsx("span",{className:"text-xs text-stone-400",children:"min"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-[10px] font-bold text-stone-400 uppercase tracking-wide mb-1",children:"Spots"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{size:14,className:"text-stone-400"}),e.jsx("input",{type:"number",value:xe.spotCount,onChange:j=>te(S=>({...S,spotCount:parseInt(j.target.value)||10})),className:"w-16 px-2 py-1 rounded-lg border border-stone-200 text-xs"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-stone-400 uppercase tracking-wide mb-2",children:"Difficulty"}),e.jsx("div",{className:"flex gap-1",children:["easy","medium","hard"].map(j=>e.jsx("button",{onClick:()=>te(S=>({...S,difficulty:j})),className:`flex-1 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all ${xe.difficulty===j?"bg-brand-dark text-white":"bg-white text-stone-400 hover:bg-stone-100 border border-stone-200"}`,children:j==="easy"?"Easy":j==="medium"?"Medium":"Hard"},j))})]})]})})}),p.trim()&&e.jsxs("div",{className:"p-3 bg-gradient-to-r from-stone-50 to-amber-50 rounded-xl border border-amber-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Be,{size:14,className:"text-brand-gold"}),e.jsx("span",{className:"text-xs font-bold text-stone-600",children:"AIへの入力サマリー"})]}),e.jsxs("div",{className:"text-xs text-stone-600 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-stone-700",children:"メイン："}),p.slice(0,50),p.length>50&&"..."]}),be&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-stone-700",children:"ジャンル補助："}),(Ft=ta.find(j=>j.id===be))==null?void 0:Ft.label]}),ee&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-stone-700",children:"トーン補助："}),(as=sa.find(j=>j.id===ee))==null?void 0:as.label]}),(O.protagonist||O.objective||O.ending)&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-stone-700",children:"補助："}),[O.protagonist&&`主人公=${O.protagonist}`,O.objective&&`目的=${O.objective}`,O.ending&&`結末=${O.ending}`].filter(Boolean).join(" / ")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-stone-700",children:"設定："}),"難易度=",xe.difficulty==="easy"?"初級":xe.difficulty==="medium"?"中級":"上級"," / スポット数=",xe.spotCount]})]})]}),ie&&e.jsx("div",{className:"p-3 rounded-lg bg-rose-50 text-rose-600 text-xs",children:ie})]}),e.jsxs("div",{className:"sticky bottom-0 p-4 bg-gradient-to-t from-white via-white to-transparent space-y-2",children:[e.jsx("button",{onClick:Os,"data-generate-trigger":!0,disabled:V||!p.trim(),className:`w-full py-3.5 rounded-xl font-bold text-sm transition-all flex items-center justify-center gap-2 ${V||!p.trim()?"bg-stone-100 text-stone-400 cursor-not-allowed":"bg-gradient-to-r from-brand-dark to-stone-700 text-white hover:from-brand-gold hover:to-amber-600 shadow-lg shadow-brand-dark/20"}`,children:V?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{size:16,className:"animate-spin"}),ke||"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(os,{size:16}),"Create"]})}),e.jsxs("button",{onClick:qt,disabled:V,className:"w-full py-2.5 rounded-xl font-bold text-xs transition-all flex items-center justify-center gap-2 bg-purple-50 text-purple-600 border border-purple-200 hover:bg-purple-100",children:[e.jsx(La,{size:14}),"デモデータで確認（API不使用）"]})]})]}),e.jsx("div",{className:`flex-1 min-h-screen bg-stone-50 ${M==="canvas"?"block":"hidden md:block"}`,children:e.jsx("div",{className:"p-4 md:p-6 min-h-[calc(100vh-4rem)] overflow-y-auto",children:!Bt&&!V?e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center h-[calc(100vh-8rem)]",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-white flex items-center justify-center shadow-sm",children:e.jsx(Be,{size:32,className:"text-stone-300"})}),e.jsx("h3",{className:"text-lg font-bold text-stone-400 mb-2",children:"まだ何も生成されていません"}),e.jsx("p",{className:"text-sm text-stone-400",children:"左パネルでプロンプトを入力して、クエストを生成しましょう"})]}):e.jsxs("div",{className:"space-y-4",children:[V&&ke&&e.jsx(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-brand-gold/10 to-amber-50 rounded-2xl border border-brand-gold/30 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-gold/20 flex items-center justify-center",children:e.jsx(Jt,{size:20,className:"animate-spin text-brand-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-brand-dark",children:ke}),e.jsx("p",{className:"text-xs text-stone-500",children:"AIがクエストを生成しています..."})]})]})}),f==="preview"&&fe&&!V&&e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg border border-stone-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-5 bg-gradient-to-r from-brand-gold/10 to-amber-50 border-b border-stone-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 text-[10px] font-bold rounded",children:"DRAFT"}),e.jsx("span",{className:"text-[10px] text-stone-500",children:"非公開 • あなただけがプレイ可能"})]}),e.jsx("h1",{className:"text-2xl font-bold text-brand-dark mb-2",children:fe.title||"新しいクエスト"}),e.jsx("p",{className:"text-sm text-stone-600 leading-relaxed",children:fe.description})]}),e.jsxs("div",{className:"px-6 py-4 flex flex-wrap gap-3 bg-stone-50 border-b border-stone-100",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-white rounded-lg border border-stone-200",children:[e.jsx(yt,{size:14,className:"text-stone-500"}),e.jsxs("span",{className:"text-xs font-bold text-stone-700",children:[xe.duration,"分"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-white rounded-lg border border-stone-200",children:[e.jsx(Fe,{size:14,className:"text-emerald-500"}),e.jsxs("span",{className:"text-xs font-bold text-stone-700",children:[C.length,"スポット"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-amber-100 rounded-lg",children:[e.jsx(Xs,{size:14,className:"text-amber-600"}),e.jsx("span",{className:"text-xs font-bold text-amber-700",children:fe.difficulty})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-white rounded-lg border border-stone-200",children:[e.jsx(lt,{size:14,className:"text-stone-500"}),e.jsx("span",{className:"text-xs font-bold text-stone-700",children:"1〜4人"})]})]}),e.jsx("div",{className:"px-6 py-4 bg-blue-50 border-b border-blue-100",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(is,{size:16,className:"text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("p",{children:["まずは",e.jsx("strong",{children:"プレイヤーとして挑戦"}),"できます（非公開のまま、自分だけプレイ）。"]}),e.jsxs("p",{children:["編集したい場合は「クリエイターとして編集する」を押すと、",e.jsx("strong",{children:"謎や答えが表示されます（ネタバレ注意）"}),"。"]})]})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-brand-dark mb-3 flex items-center gap-2",children:[e.jsx(Fe,{size:14,className:"text-brand-gold"}),"スポット一覧"]}),e.jsx("div",{className:"space-y-2",children:C.map((j,S)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-stone-50 rounded-lg",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-gold text-white flex items-center justify-center text-xs font-bold flex-shrink-0",children:S+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-brand-dark truncate",children:j.name}),e.jsx("p",{className:"text-[10px] text-stone-500 truncate",children:j.address})]})]},j.id))})]}),e.jsxs("div",{className:"px-6 py-5 bg-stone-50 border-t border-stone-100 space-y-3",children:[e.jsxs("button",{onClick:()=>{u(`/play/${t||"draft"}`)},className:"w-full py-4 rounded-xl bg-gradient-to-r from-brand-dark to-stone-700 text-white font-bold text-sm transition-all hover:from-brand-gold hover:to-amber-600 shadow-lg shadow-brand-dark/20 flex items-center justify-center gap-2",children:[e.jsx(tr,{size:18}),"プレイヤーとして挑戦する"]}),e.jsxs("button",{onClick:()=>v("editor"),className:"w-full py-3 rounded-xl bg-white border-2 border-stone-200 text-stone-600 font-bold text-sm transition-all hover:border-amber-300 hover:text-amber-600 flex items-center justify-center gap-2",children:[e.jsx(Is,{size:16,className:"text-amber-500"}),"クリエイターとして編集する（ネタバレ）"]}),e.jsx("button",{onClick:()=>{u("/profile")},className:"w-full py-2 text-xs text-stone-500 hover:text-brand-dark font-medium",children:"あとで決める（マイ下書きに保存）"})]})]}),f==="editor"&&e.jsxs(e.Fragment,{children:[fe&&!V&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:()=>v("preview"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-bold text-stone-500 hover:text-brand-dark bg-white rounded-lg border border-stone-200 hover:border-brand-gold/50 transition-all",children:[e.jsx(La,{size:12}),"プレビューに戻る"]})}),fe&&e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-sm border border-stone-200 overflow-hidden hover:border-brand-gold/50 hover:shadow-md transition-all cursor-pointer group",children:[e.jsxs("div",{className:"px-5 py-3 bg-gradient-to-r from-brand-gold/5 to-amber-50 border-b border-stone-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kt,{size:14,className:"text-brand-gold"}),e.jsx("span",{className:"text-xs font-bold text-brand-gold",children:"クリックして編集"})]}),e.jsxs("span",{className:"text-[10px] text-stone-500",children:["📍 ",fe.area]})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-dark mb-2 group-hover:text-brand-gold transition-colors",children:fe.title}),e.jsx("p",{className:"text-sm text-stone-600 leading-relaxed",children:fe.description})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-stone-100 rounded-lg",children:[e.jsx(yt,{size:14,className:"text-stone-500"}),e.jsx("span",{className:"text-xs font-bold text-stone-700",children:"60分"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-stone-100 rounded-lg",children:[e.jsx(Fe,{size:14,className:"text-emerald-500"}),e.jsxs("span",{className:"text-xs font-bold text-stone-700",children:[C.length,"スポット"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-amber-100 rounded-lg",children:[e.jsx(Xs,{size:14,className:"text-amber-600"}),e.jsx("span",{className:"text-xs font-bold text-amber-700",children:fe.difficulty})]}),fe.tags.slice(0,3).map(j=>e.jsxs("span",{className:"px-2.5 py-1.5 bg-blue-50 rounded-lg text-xs font-bold text-blue-600",children:["📍 ",j]},j)),fe.tags.slice(3).map(j=>e.jsx("span",{className:"px-2.5 py-1.5 bg-brand-gold/10 rounded-lg text-xs font-bold text-brand-gold",children:j},j))]})]})]}),Bt&&e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-2xl shadow-sm border border-stone-200 overflow-hidden",children:[e.jsx("div",{className:"flex border-b border-stone-100",children:[{id:"route",label:"ルート",icon:Fe},{id:"story",label:"ストーリー",icon:zt},{id:"mystery",label:"謎・テスト",icon:Zs}].map(j=>e.jsxs("button",{onClick:()=>it(j.id),className:`flex-1 flex items-center justify-center gap-2 py-3 text-sm font-bold transition-all ${_t===j.id?"text-brand-gold border-b-2 border-brand-gold bg-brand-gold/5":"text-stone-500 hover:text-brand-dark hover:bg-stone-50"}`,children:[e.jsx(j.icon,{size:16}),j.label]},j.id))}),e.jsx("div",{className:"p-0",children:e.jsxs(Ue,{mode:"wait",children:[_t==="route"&&C.length>0&&e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex h-[calc(100vh-320px)] min-h-[450px]",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx(Ua,{apiKey:ho,children:e.jsx(Ga,{mapId:"4f910f9227657629",defaultCenter:{lat:35.6764,lng:139.6993},defaultZoom:14,gestureHandling:"greedy",disableDefaultUI:!0,className:"w-full h-full",children:e.jsx(po,{spots:C,isGenerating:V})})})}),e.jsx("div",{className:"w-80 border-l border-stone-100 overflow-y-auto",children:e.jsx("div",{className:"p-3 space-y-2",children:C.map((j,S)=>e.jsxs(N.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:S*.1},onClick:()=>mt(Ge===S?null:S),className:`p-3 rounded-xl cursor-pointer transition-all ${Ge===S?"bg-brand-gold/10 border border-brand-gold/30":"bg-stone-50 border border-stone-100 hover:border-brand-gold/20"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-gold text-white flex items-center justify-center text-xs font-bold flex-shrink-0",children:S+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:"font-bold text-xs text-brand-dark truncate",children:j.name}),e.jsx("p",{className:"text-[10px] text-stone-500 truncate",children:j.address})]})]}),e.jsx(Ue,{children:Ge===S&&e.jsxs(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-3 pt-3 border-t border-stone-200 space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-stone-400 uppercase mb-0.5",children:"ストーリー"}),e.jsx("p",{className:"text-xs text-stone-600 line-clamp-2",children:j.storyText})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-stone-400 uppercase mb-0.5",children:"謎"}),e.jsx("p",{className:"text-xs text-brand-dark",children:j.challengeText}),e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-[10px] text-emerald-600",children:[e.jsx(ot,{size:8}),e.jsxs("span",{children:["正解: ",j.answer]})]})]}),e.jsxs("div",{className:"flex gap-1 pt-1",children:[e.jsx("button",{className:"px-2 py-1 rounded bg-stone-100 text-[10px] font-bold text-stone-600 hover:bg-stone-200",children:"編集"}),e.jsx("button",{className:"px-2 py-1 rounded bg-stone-100 text-[10px] font-bold text-stone-600 hover:bg-stone-200",children:"再生成"}),e.jsx("button",{className:"px-2 py-1 rounded bg-brand-gold/10 text-[10px] font-bold text-brand-gold hover:bg-brand-gold/20",children:"試走"})]})]})})]},j.id))})})]},"route"),_t==="story"&&de&&e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex flex-col max-h-[calc(100vh-320px)] min-h-[450px]",children:[e.jsxs("div",{className:"p-4 border-b border-stone-100 bg-gradient-to-r from-stone-50 to-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Be,{size:14,className:"text-brand-gold"}),e.jsx("span",{className:"text-xs font-bold text-stone-600",children:"ストーリーマップ"})]}),e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>{var j;mt(-1),(j=document.getElementById("scene-prologue"))==null||j.scrollIntoView({behavior:"smooth",block:"center"})},className:`flex-shrink-0 px-3 py-2 rounded-lg text-xs font-bold transition-all ${Ge===-1?"bg-amber-100 text-amber-700 ring-2 ring-amber-300":"bg-stone-100 text-stone-600 hover:bg-amber-50"}`,children:[e.jsx("div",{className:"text-[10px] opacity-60",children:"導入"}),e.jsx("div",{children:"P"})]}),e.jsx("div",{className:"w-4 h-0.5 bg-stone-200 flex-shrink-0"}),C.map((j,S)=>e.jsxs(qr.Fragment,{children:[e.jsxs("button",{onClick:()=>{var Ne;mt(S),(Ne=document.getElementById(`scene-spot-${S}`))==null||Ne.scrollIntoView({behavior:"smooth",block:"center"})},className:`flex-shrink-0 px-3 py-2 rounded-lg text-xs font-bold transition-all ${Ge===S?"bg-brand-gold text-white ring-2 ring-brand-gold/50":"bg-stone-100 text-stone-600 hover:bg-brand-gold/10"}`,children:[e.jsx("div",{className:"text-[10px] opacity-60",children:S===0?"発見":S===C.length-1?"山場":S<3?"展開":"激化"}),e.jsx("div",{children:S+1})]}),S<C.length-1&&e.jsx("div",{className:"w-4 h-0.5 bg-stone-200 flex-shrink-0"})]},j.id)),e.jsx("div",{className:"w-4 h-0.5 bg-stone-200 flex-shrink-0"}),e.jsxs("button",{onClick:()=>{var j;mt(C.length),(j=document.getElementById("scene-epilogue"))==null||j.scrollIntoView({behavior:"smooth",block:"center"})},className:`flex-shrink-0 px-3 py-2 rounded-lg text-xs font-bold transition-all ${Ge===C.length?"bg-emerald-100 text-emerald-700 ring-2 ring-emerald-300":"bg-stone-100 text-stone-600 hover:bg-emerald-50"}`,children:[e.jsx("div",{className:"text-[10px] opacity-60",children:"結末"}),e.jsx("div",{children:"E"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[de.characters.length>0&&e.jsxs("div",{className:"p-4 rounded-xl bg-gradient-to-r from-purple-50 to-violet-50 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{size:16,className:"text-purple-600"}),e.jsx("span",{className:"text-sm font-bold text-purple-900",children:"登場人物"}),e.jsx("span",{className:"text-xs text-purple-500",children:"この物語に登場"})]}),e.jsxs("button",{onClick:()=>ht(!0),className:"flex items-center gap-1 px-3 py-1.5 bg-purple-100 rounded-lg text-xs font-bold text-purple-700 hover:bg-purple-200 transition-colors",children:[e.jsx(Kt,{size:12})," 人物を編集"]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1",children:de.characters.map(j=>e.jsxs("div",{onClick:()=>{st(j.id),ht(!0)},className:"flex-shrink-0 w-44 p-3 bg-white rounded-xl border border-purple-100 hover:border-purple-300 cursor-pointer transition-all hover:shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${j.color||"bg-stone-400"} flex items-center justify-center text-white text-sm font-bold`,children:j.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:j.name}),e.jsx("p",{className:"text-[10px] text-purple-600",children:j.role})]})]}),e.jsxs("p",{className:"text-[10px] text-stone-500 mb-1",children:["🎭 ",j.tone]}),j.motivation&&e.jsxs("p",{className:"text-[10px] text-stone-500 mb-1",children:["🎯 ",j.motivation]}),j.sampleDialogue&&e.jsxs("p",{className:"text-xs text-stone-600 italic line-clamp-2 mt-1",children:["「",j.sampleDialogue,"」"]})]},j.id))})]}),e.jsxs(N.div,{id:"scene-prologue",layout:!0,className:`p-4 rounded-xl border transition-all cursor-pointer ${Ge===-1?"bg-amber-50 border-amber-300 ring-2 ring-amber-200":"bg-white border-stone-200 hover:border-amber-200"}`,onClick:()=>mt(-1),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(zt,{size:14,className:"text-amber-600"}),e.jsx("span",{className:"text-sm font-bold text-amber-900",children:"プロローグ"}),e.jsx("span",{className:"px-2 py-0.5 bg-amber-100 rounded text-[10px] font-bold text-amber-700",children:"導入"}),e.jsx("span",{className:"px-2 py-0.5 bg-stone-100 rounded text-[10px] text-stone-500",children:"期待→好奇心"})]}),e.jsx("p",{className:`text-sm text-stone-600 leading-relaxed ${Ge===-1?"":"line-clamp-2"}`,children:de.prologueBody}),Ge===-1&&e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-amber-200",children:[e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-amber-100 rounded-lg text-xs font-bold text-amber-700 hover:bg-amber-200 transition-colors",children:[e.jsx(Kt,{size:12})," 編集"]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-white border border-amber-200 rounded-lg text-xs font-bold text-amber-700 hover:bg-amber-50 transition-colors",children:[e.jsx(os,{size:12})," テンポ↑"]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-white border border-amber-200 rounded-lg text-xs font-bold text-amber-700 hover:bg-amber-50 transition-colors",children:[e.jsx(Be,{size:12})," 伏線追加"]})]})]}),C.map((j,S)=>e.jsxs(N.div,{id:`scene-spot-${S}`,layout:!0,className:`p-4 rounded-xl border transition-all cursor-pointer ${Ge===S?"bg-brand-gold/5 border-brand-gold ring-2 ring-brand-gold/30":"bg-white border-stone-200 hover:border-brand-gold/50"}`,onClick:()=>mt(S),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-gold text-white flex items-center justify-center text-xs font-bold",children:S+1}),e.jsx("span",{className:"text-sm font-bold text-brand-dark",children:j.name}),e.jsx("span",{className:"px-2 py-0.5 bg-stone-100 rounded text-[10px] text-stone-500",children:S===0?"期待→発見":S===C.length-1?"緊張→達成":"好奇心→驚き"})]}),e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[de.characters.slice(0,S===0?1:2).map(Ne=>e.jsxs("button",{onClick:ne=>{ne.stopPropagation(),st(Ne.id),ht(!0)},className:`flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold ${Ne.color} text-white hover:ring-2 ring-white/50 transition-all`,children:[Ne.name.charAt(0)," ",Ne.name]},Ne.id)),e.jsx("span",{className:"text-[10px] text-stone-400",children:"が登場"})]}),e.jsx("p",{className:`text-sm text-stone-600 leading-relaxed ${Ge===S?"":"line-clamp-2"}`,children:j.storyText}),Ge===S&&e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-brand-gold/20",children:[e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-brand-gold/10 rounded-lg text-xs font-bold text-brand-gold hover:bg-brand-gold/20 transition-colors",children:[e.jsx(Kt,{size:12})," 編集"]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-white border border-brand-gold/30 rounded-lg text-xs font-bold text-brand-gold hover:bg-brand-gold/5 transition-colors",children:[e.jsx(os,{size:12})," ミステリー感↑"]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-white border border-brand-gold/30 rounded-lg text-xs font-bold text-brand-gold hover:bg-brand-gold/5 transition-colors",children:[e.jsx(Xs,{size:12})," 感情↑"]})]})]},j.id)),e.jsxs(N.div,{id:"scene-epilogue",layout:!0,className:`p-4 rounded-xl border transition-all cursor-pointer ${Ge===C.length?"bg-emerald-50 border-emerald-300 ring-2 ring-emerald-200":"bg-white border-stone-200 hover:border-emerald-200"}`,onClick:()=>mt(C.length),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(zt,{size:14,className:"text-emerald-600"}),e.jsx("span",{className:"text-sm font-bold text-emerald-900",children:"エピローグ"}),e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 rounded text-[10px] font-bold text-emerald-700",children:"結末"}),e.jsx("span",{className:"px-2 py-0.5 bg-stone-100 rounded text-[10px] text-stone-500",children:"達成→満足"})]}),e.jsx("p",{className:`text-sm text-stone-600 leading-relaxed ${Ge===C.length?"":"line-clamp-2"}`,children:de.epilogueBody}),Ge===C.length&&e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-emerald-200",children:[e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-emerald-100 rounded-lg text-xs font-bold text-emerald-700 hover:bg-emerald-200 transition-colors",children:[e.jsx(Kt,{size:12})," 編集"]}),e.jsxs("button",{className:"flex items-center gap-1 px-3 py-1.5 bg-white border border-emerald-200 rounded-lg text-xs font-bold text-emerald-700 hover:bg-emerald-50 transition-colors",children:[e.jsx(os,{size:12})," 余韻を追加"]})]})]})]}),e.jsx("div",{className:"p-3 border-t border-stone-100 bg-stone-50",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(ot,{size:14,className:"text-emerald-500"}),e.jsx("span",{className:"font-bold text-stone-600",children:"品質チェック"}),de.prologueBody.length>200?e.jsxs("span",{className:"px-2 py-0.5 bg-amber-100 rounded text-amber-700",children:["⚠️ プロローグが長め（",de.prologueBody.length,"文字）"]}):e.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 rounded text-emerald-700",children:"✓ 問題なし"})]})})]},"story"),_t==="mystery"&&C.length>0&&(()=>{const j=S=>{ts(Ne=>{const ne=new Set(Ne);return ne.has(S)?ne.delete(S):ne.add(S),ne})};return e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"p-4 max-h-[calc(100vh-320px)] min-h-[450px] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-stone-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{size:16,className:"text-brand-gold"}),e.jsxs("span",{className:"text-sm font-bold text-brand-dark",children:[C.length,"個の謎"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>ts(new Set(C.map(S=>S.id))),className:"px-2 py-1 text-[10px] text-stone-500 hover:text-brand-gold",children:"すべて展開"}),e.jsx("button",{onClick:()=>ts(new Set),className:"px-2 py-1 text-[10px] text-stone-500 hover:text-brand-gold",children:"すべて閉じる"})]})]}),e.jsx("div",{className:"space-y-2",children:C.map((S,Ne)=>{const ne=$t.has(S.id);return e.jsxs("div",{className:`rounded-lg border transition-all ${ne?"border-brand-gold/30 bg-white shadow-sm":"border-stone-200 bg-stone-50 hover:border-stone-300"}`,children:[e.jsxs("button",{onClick:()=>j(S.id),className:"w-full p-3 flex items-center gap-3 text-left",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 ${ne?"bg-brand-gold text-white":"bg-stone-300 text-white"}`,children:Ne+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-sm text-brand-dark truncate",children:S.name}),S.puzzleType&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-100 text-purple-600 rounded text-[9px] font-bold flex-shrink-0",children:S.puzzleType})]}),!ne&&e.jsxs("p",{className:"text-xs text-stone-500 truncate mt-0.5",children:[S.challengeText.slice(0,50),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!ne&&e.jsxs("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded text-[10px] font-bold",children:["A: ",S.answer]}),e.jsx(Nt,{size:16,className:`text-stone-400 transition-transform ${ne?"rotate-180":""}`})]})]}),e.jsx(Ue,{children:ne&&e.jsx(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-3 pb-3 space-y-2",children:[e.jsxs("div",{className:"p-2.5 bg-stone-100 rounded-lg",children:[e.jsxs("p",{className:"text-[10px] text-stone-500 font-bold mb-1 flex items-center gap-1",children:[e.jsx(Be,{size:10})," 謎の問題"]}),e.jsx("p",{className:"text-xs text-brand-dark whitespace-pre-wrap",children:S.challengeText})]}),S.playerHandout&&e.jsxs("div",{className:"p-2.5 bg-blue-50 rounded-lg",children:[e.jsxs("p",{className:"text-[10px] text-blue-600 font-bold mb-1 flex items-center gap-1",children:[e.jsx(zt,{size:10})," 資料"]}),e.jsx("p",{className:"text-xs text-blue-900 whitespace-pre-wrap",children:S.playerHandout})]}),S.hints&&S.hints.length>0&&e.jsxs("div",{className:"p-2.5 bg-amber-50 rounded-lg",children:[e.jsxs("p",{className:"text-[10px] text-amber-600 font-bold mb-1 flex items-center gap-1",children:[e.jsx(is,{size:10})," ヒント"]}),e.jsx("div",{className:"space-y-0.5",children:S.hints.map((He,Ie)=>e.jsxs("p",{className:"text-[11px] text-amber-900",children:[e.jsxs("span",{className:"font-bold text-amber-500",children:[Ie+1,"."]})," ",He]},Ie))})]}),e.jsxs("div",{className:"p-2.5 bg-emerald-50 rounded-lg flex items-center gap-2",children:[e.jsx(ot,{size:14,className:"text-emerald-600"}),e.jsxs("span",{className:"text-xs font-bold text-emerald-700",children:["正解: ",S.answer]})]}),S.solutionSteps&&S.solutionSteps.length>0&&e.jsxs("div",{className:"p-2.5 bg-violet-50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-violet-600 font-bold mb-1",children:"解法ステップ"}),e.jsx("div",{className:"space-y-0.5",children:S.solutionSteps.map((He,Ie)=>e.jsxs("p",{className:"text-[11px] text-violet-900",children:[e.jsxs("span",{className:"font-bold text-violet-500",children:[Ie+1,"."]})," ",He]},Ie))})]}),S.loreReveal&&e.jsxs("div",{className:"p-2.5 bg-rose-50 rounded-lg",children:[e.jsx("p",{className:"text-[10px] text-rose-600 font-bold mb-1",children:"🎓 背景解説"}),e.jsx("p",{className:"text-[11px] text-rose-900",children:S.loreReveal})]}),e.jsxs("div",{className:"flex gap-1 flex-wrap pt-1",children:[S.sceneRole&&e.jsx("span",{className:"px-1.5 py-0.5 bg-amber-100 text-amber-700 rounded text-[9px] font-bold",children:S.sceneRole}),S.plotKey&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-700 rounded text-[9px] font-bold",children:["🔑 ",S.plotKey]})]}),e.jsxs("div",{className:"flex gap-1.5 pt-2 border-t border-stone-200",children:[e.jsx("button",{className:"px-2.5 py-1 rounded bg-stone-100 text-[10px] font-bold text-stone-600 hover:bg-stone-200",children:"編集"}),e.jsx("button",{className:"px-2.5 py-1 rounded bg-stone-100 text-[10px] font-bold text-stone-600 hover:bg-stone-200",children:"再生成"}),e.jsx("button",{className:"px-2.5 py-1 rounded bg-brand-gold/10 text-[10px] font-bold text-brand-gold hover:bg-brand-gold/20",children:"テスト"})]})]})})})]},S.id)})})]},"mystery")})()]})})]}),e.jsx(Ue,{children:Mt&&de&&e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex items-center justify-center",children:[e.jsx("div",{onClick:()=>ht(!1),className:"absolute inset-0 bg-black/40"}),e.jsxs(N.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"relative w-[600px] max-h-[80vh] bg-white rounded-2xl shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-stone-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{size:18,className:"text-purple-600"}),e.jsx("h2",{className:"text-lg font-bold text-brand-dark",children:"登場人物を編集"})]}),e.jsx("button",{onClick:()=>ht(!1),className:"p-1 hover:bg-stone-100 rounded",children:e.jsx(nt,{size:20,className:"text-stone-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[de.characters.map(j=>e.jsx("div",{className:`p-4 rounded-xl border transition-all ${We===j.id?"border-purple-300 bg-purple-50 ring-2 ring-purple-200":"border-stone-200 bg-white"}`,onClick:()=>st(j.id),children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center gap-2",children:[e.jsx("div",{className:`w-20 h-20 rounded-2xl ${j.color} flex items-center justify-center text-white text-3xl font-bold shadow-lg`,children:j.name.charAt(0)}),e.jsx("button",{className:"text-[10px] text-purple-600 hover:text-purple-800 font-medium",children:"画像を変更"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-stone-400 uppercase",children:"名前"}),e.jsx("input",{type:"text",defaultValue:j.name,className:"w-full text-sm font-bold text-brand-dark bg-stone-50 rounded-lg px-3 py-2 border border-stone-200 focus:border-purple-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-stone-400 uppercase",children:"役割"}),e.jsx("input",{type:"text",defaultValue:j.role,className:"w-full text-sm text-purple-600 bg-stone-50 rounded-lg px-3 py-2 border border-stone-200 focus:border-purple-500 focus:outline-none",placeholder:"案内人、ヒント提供者など"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-stone-400 uppercase",children:"口調"}),e.jsx("input",{type:"text",defaultValue:j.tone,className:"w-full text-sm text-stone-700 bg-stone-50 rounded-lg px-3 py-2 border border-stone-200 focus:border-purple-500 focus:outline-none",placeholder:"ミステリアス、丁寧、フレンドリー..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-stone-400 uppercase",children:"動機・目的"}),e.jsx("input",{type:"text",defaultValue:j.motivation||"",className:"w-full text-sm text-stone-700 bg-stone-50 rounded-lg px-3 py-2 border border-stone-200 focus:border-purple-500 focus:outline-none",placeholder:"このキャラクターの目的は..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-stone-400 uppercase",children:"台詞例"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",defaultValue:j.sampleDialogue||"",className:"flex-1 text-sm text-stone-700 bg-stone-50 rounded-lg px-3 py-2 border border-stone-200 focus:border-purple-500 focus:outline-none italic",placeholder:"「このキャラらしい台詞...」"}),e.jsxs("button",{className:"px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-xs font-bold hover:bg-purple-200 transition-colors flex items-center gap-1",children:[e.jsx(os,{size:14})," 生成"]})]})]})]})]})},j.id)),e.jsx("button",{className:"w-full p-4 border-2 border-dashed border-stone-300 rounded-xl text-sm text-stone-500 hover:border-purple-300 hover:text-purple-600 transition-colors",children:"+ 新しい人物を追加"})]}),e.jsxs("div",{className:"p-4 bg-stone-50 border-t border-stone-200",children:[e.jsx("p",{className:"text-xs font-bold text-stone-500 mb-2",children:"変更を反映する範囲"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer",children:[e.jsx("input",{type:"radio",name:"scope",value:"all",defaultChecked:!0,className:"accent-purple-600"}),e.jsx("span",{children:"全章に反映"})]}),e.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer",children:[e.jsx("input",{type:"radio",name:"scope",value:"from-here",className:"accent-purple-600"}),e.jsx("span",{children:"この章以降"})]}),e.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer",children:[e.jsx("input",{type:"radio",name:"scope",value:"this-only",className:"accent-purple-600"}),e.jsx("span",{children:"この章のみ"})]})]}),e.jsx("button",{onClick:()=>ht(!1),className:"w-full py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition-colors",children:"保存して反映"})]})]})]})}),Bt&&!V&&e.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"fixed bottom-6 right-6 z-50 flex flex-col items-end gap-2",children:[Rt&&e.jsx(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:`px-4 py-2 rounded-lg text-sm font-bold shadow-lg ${Rt.includes("失敗")?"bg-rose-500 text-white":"bg-emerald-500 text-white"}`,children:Rt}),e.jsx("button",{onClick:bt,disabled:at,className:`flex items-center gap-2 px-5 py-3 rounded-full font-bold shadow-lg transition-all hover:shadow-xl ${at?"bg-stone-400 text-white cursor-wait":"bg-brand-dark text-white hover:bg-brand-gold"}`,children:at?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{size:18,className:"animate-spin"}),"保存中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Wr,{size:18}),"クエスト保存"]})})]})]})]})})})]})}),e.jsx(wl,{isOpen:Pt,onClose:()=>St(!1)})]})}const qa=["/images/hero-bg-1.png","/images/hero-bg-3.png"],Fa=["/images/hero-bg-2.png","/images/hero-bg-4.png"],bo=[{text:"中之島で90分、レトロ建築×探偵ミステリー",emoji:"🏛️"},{text:"浅草で60分、食べ歩き×宝探し",emoji:"🍡"},{text:"京都で120分、歴史探訪×謎解き",emoji:"⛩️"}];function go({onNavigateToQuests:t,translations:a}){var p,i;es();const[n,r]=o.useState(""),[m,g]=o.useState(!1),[d,u]=o.useState(0),[x,b]=o.useState(0);o.useEffect(()=>{const _=setInterval(()=>{u(B=>(B+1)%qa.length)},9e3),w=setInterval(()=>{b(B=>(B+1)%Fa.length)},9e3);return()=>{clearInterval(_),clearInterval(w)}},[]);const f=_=>{r(_)},v=()=>{if(!n.trim())return;g(!0);const _=new URLSearchParams;_.set("prompt",n),window.location.href=`http://localhost:4174/creator/canvas/?${_.toString()}`};return e.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-stone-50 via-white to-amber-50/20"}),e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,#00000008_1px,transparent_1px),linear-gradient(to_bottom,#00000008_1px,transparent_1px)] bg-[size:48px_48px]"}),e.jsx("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-brand-gold/10 rounded-full blur-[120px] pointer-events-none"}),e.jsxs("div",{className:"absolute left-[5%] top-[20%] w-80 h-80 rounded-3xl overflow-hidden shadow-2xl pointer-events-none opacity-80 rotate-[-6deg]",children:[e.jsx(Ue,{mode:"wait",children:e.jsx(N.img,{src:qa[d],alt:"",className:"absolute inset-0 w-full h-full object-cover",initial:{opacity:0,scale:1.1},animate:{opacity:1,scale:1},exit:{opacity:0},transition:{duration:1}},d)}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-white/60 to-transparent"})]}),e.jsxs("div",{className:"absolute right-[5%] bottom-[15%] w-72 h-72 rounded-3xl overflow-hidden shadow-2xl pointer-events-none opacity-80 rotate-[8deg]",children:[e.jsx(Ue,{mode:"wait",children:e.jsx(N.img,{src:Fa[x],alt:"",className:"absolute inset-0 w-full h-full object-cover",initial:{opacity:0,scale:1.1},animate:{opacity:1,scale:1},exit:{opacity:0},transition:{duration:1}},x)}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-white/60 to-transparent"})]}),e.jsxs("div",{className:"relative z-10 container mx-auto px-4 pt-32 pb-20",children:[e.jsxs(N.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},className:"max-w-5xl mx-auto text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur border border-brand-gold/20 rounded-full text-sm font-medium text-brand-dark mb-8 shadow-sm",children:[e.jsx(Be,{size:16,className:"text-brand-gold"}),"AIクエストジェネレーター"]}),e.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-serif font-bold text-brand-dark leading-tight mb-6",children:[((p=a==null?void 0:a.title)==null?void 0:p.split(`
`)[0])||"いつもの街が、",e.jsx("br",{}),e.jsx("span",{className:"text-brand-gold",children:((i=a==null?void 0:a.title)==null?void 0:i.split(`
`)[1])||"冒険の舞台に。"})]}),e.jsxs("p",{className:"text-lg text-stone-600 mb-12 max-w-2xl mx-auto",children:["あなたのアイデアを入力するだけ。",e.jsx("br",{className:"hidden sm:block"}),"AIが街歩き×謎解きのウォーキングクエストを自動生成します。"]}),e.jsx("div",{className:"relative max-w-4xl mx-auto mb-8",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl shadow-stone-200/50 border border-stone-200 overflow-hidden",children:[e.jsx("textarea",{value:n,onChange:_=>r(_.target.value),placeholder:`どんなクエストを作りたいですか？
例：大阪・中之島で90分、レトロ建築を巡る探偵ミステリー`,className:"w-full px-6 py-5 text-lg bg-transparent resize-none focus:outline-none placeholder:text-stone-400 min-h-[120px]",onKeyDown:_=>{_.key==="Enter"&&!_.shiftKey&&n.trim()&&(_.preventDefault(),v())}}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-stone-50 border-t border-stone-100",children:[e.jsx("span",{className:"text-xs text-stone-400",children:"Enter で生成開始"}),e.jsx("button",{onClick:v,disabled:!n.trim()||m,className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-brand-gold to-amber-500 text-white font-bold rounded-xl shadow-lg shadow-brand-gold/25 hover:shadow-xl hover:shadow-brand-gold/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all",children:m?e.jsx(Jt,{size:18,className:"animate-spin"}):e.jsxs(e.Fragment,{children:["クエストを生成",e.jsx(xt,{size:16})]})})]})]})}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3 mb-16",children:[e.jsx("span",{className:"text-sm text-stone-400 mr-2",children:"試してみる:"}),bo.map((_,w)=>e.jsxs("button",{onClick:()=>f(_.text),className:"flex items-center gap-2 px-4 py-2 bg-white/80 hover:bg-white border border-stone-200 hover:border-brand-gold/50 rounded-full text-sm text-stone-600 hover:text-brand-dark transition-all shadow-sm hover:shadow",children:[e.jsx("span",{children:_.emoji}),e.jsxs("span",{className:"hidden sm:inline",children:[_.text.slice(0,20),"..."]}),e.jsx("span",{className:"sm:hidden",children:_.text.split("、")[0]})]},w))]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 text-sm",children:e.jsxs("button",{onClick:t,className:"flex items-center gap-2 text-stone-500 hover:text-brand-dark transition-colors",children:[e.jsx(Fe,{size:16}),"既存のクエストを探す",e.jsx(Nt,{size:14,className:"rotate-[-90deg]"})]})})]}),e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1.5},className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2",children:e.jsx(N.div,{animate:{y:[0,8,0]},transition:{repeat:1/0,duration:2},children:e.jsx(Nt,{size:24,className:"text-stone-300"})})})]})]})}const fo=({className:t="h-8",color:a="#484132"})=>e.jsxs("svg",{viewBox:"0 0 220 40",className:t,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"TOMOSHIBI Logo",children:[e.jsx("text",{x:"0",y:"30",fontSize:"28",fontWeight:"bold",fontFamily:"'Noto Sans JP', sans-serif",fill:a,letterSpacing:"0.05em",children:"TOMOSHIBI"}),e.jsxs("g",{transform:"translate(175, 4)",children:[e.jsx("path",{d:"M16 0C7.2 0 0 7.2 0 16C0 22.1 3.4 27.3 8.3 30V36H23.7V30C28.6 27.3 32 22.1 32 16C32 7.2 24.8 0 16 0Z",fill:a}),e.jsx("path",{d:"M16 26C16 26 21 20 21 14C21 11 19 9 16 6C13 9 11 11 11 14C11 20 16 26 16 26Z",fill:"#fbbf24"}),e.jsx("path",{d:"M16 3V5",stroke:"#fbbf24",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M9 6L10.5 7.5",stroke:"#fbbf24",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M23 6L21.5 7.5",stroke:"#fbbf24",strokeWidth:"2",strokeLinecap:"round"})]})]}),Ha=[Ps,Ot,Dt,lt];function jo({t,onLogoHome:a}){return es(),e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-20 md:py-32 bg-gradient-to-b from-brand-base to-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 text-center",children:e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx("span",{className:"inline-block px-4 py-1.5 bg-brand-gold/10 text-brand-gold text-sm font-bold rounded-full mb-6",children:"About Us"}),e.jsx("h1",{className:"text-4xl md:text-6xl font-serif font-bold text-brand-dark mb-6 whitespace-pre-line",children:t.aboutPage.title}),e.jsx("p",{className:"text-lg md:text-xl text-stone-600 max-w-2xl mx-auto",children:t.aboutPage.subtitle})]})})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-12 max-w-5xl mx-auto",children:[e.jsxs(N.div,{initial:{opacity:0,x:-20},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"bg-gradient-to-br from-brand-gold/5 to-amber-50 rounded-3xl p-8 md:p-10 border border-brand-gold/20",children:[e.jsx("div",{className:"w-14 h-14 bg-brand-gold/20 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Ot,{className:"w-7 h-7 text-brand-gold"})}),e.jsx("h2",{className:"text-2xl md:text-3xl font-serif font-bold text-brand-dark mb-4",children:t.aboutPage.missionTitle}),e.jsx("p",{className:"text-stone-600 leading-relaxed",children:t.aboutPage.missionText})]}),e.jsxs(N.div,{initial:{opacity:0,x:20},whileInView:{opacity:1,x:0},viewport:{once:!0},className:"bg-gradient-to-br from-violet-50 to-purple-50 rounded-3xl p-8 md:p-10 border border-violet-200/50",children:[e.jsx("div",{className:"w-14 h-14 bg-violet-100 rounded-2xl flex items-center justify-center mb-6",children:e.jsx(Dt,{className:"w-7 h-7 text-violet-600"})}),e.jsx("h2",{className:"text-2xl md:text-3xl font-serif font-bold text-brand-dark mb-4",children:t.aboutPage.visionTitle}),e.jsx("p",{className:"text-stone-600 leading-relaxed",children:t.aboutPage.visionText})]})]})})}),e.jsx("section",{className:"py-20 bg-brand-base",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-8",children:[e.jsx(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:e.jsx("h2",{className:"text-3xl md:text-4xl font-serif font-bold text-brand-dark",children:t.aboutPage.valuesTitle})}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto",children:t.aboutPage.values.map((n,r)=>{const m=Ha[r%Ha.length];return e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:r*.1},className:"bg-white rounded-2xl p-6 shadow-sm border border-stone-100 hover:shadow-lg hover:border-brand-gold/30 transition-all",children:[e.jsx("div",{className:"w-12 h-12 bg-brand-gold/10 rounded-xl flex items-center justify-center mb-4",children:e.jsx(m,{className:"w-6 h-6 text-brand-gold"})}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark mb-2",children:n.title}),e.jsx("p",{className:"text-sm text-stone-600",children:n.description})]},r)})})]})}),e.jsx("section",{className:"py-20 bg-white",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-8",children:[e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-serif font-bold text-brand-dark mb-4",children:t.aboutPage.teamTitle}),e.jsx("p",{className:"text-stone-600 max-w-2xl mx-auto",children:t.aboutPage.teamSubtitle})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-5xl mx-auto",children:t.aboutPage.members.map((n,r)=>e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:r*.1},className:"group bg-gradient-to-br from-stone-50 to-white rounded-2xl p-6 border border-stone-100 hover:border-brand-gold/30 hover:shadow-lg transition-all",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-brand-gold/20 to-amber-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-105 transition-transform",children:e.jsx(lt,{className:"w-8 h-8 text-brand-gold"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-brand-dark mb-1",children:n.name}),e.jsx("p",{className:"text-sm font-medium text-brand-gold mb-3",children:n.role}),e.jsx("p",{className:"text-sm text-stone-600 leading-relaxed",children:n.bio})]})]},r))})]})}),e.jsx("footer",{className:"bg-brand-dark py-10",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-8 text-center",children:[e.jsx(fo,{className:"h-8 w-auto mx-auto mb-4",color:"#78716c"}),e.jsxs("p",{className:"text-xs text-stone-500",children:["© ",new Date().getFullYear()," TOMOSHIBI. All rights reserved."]})]})})]})}const Wt=({children:t,subtitle:a,light:n=!1})=>e.jsxs("div",{className:"text-center mb-16 px-4",children:[e.jsx(N.h2,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:`text-3xl md:text-5xl font-serif font-bold mb-6 ${n?"text-white":"text-brand-dark"}`,children:t}),a&&e.jsx(N.p,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:.1},className:`max-w-2xl mx-auto text-base md:text-lg leading-relaxed ${n?"text-white/80":"text-stone-600"}`,children:a}),e.jsx("div",{className:`w-20 h-1.5 mx-auto mt-8 rounded-full ${n?"bg-white/30":"bg-brand-gold"}`})]}),Qa=({children:t,color:a="gold"})=>{const n={gold:"bg-brand-gold/10 text-amber-700 border-brand-gold/20",dark:"bg-brand-dark/5 text-brand-dark border-brand-dark/10",white:"bg-white/10 text-white border-white/20"};return e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold border ${n[a]}`,children:t})},vo=()=>{const[t,a]=o.useState("depopulation"),n={depopulation:{title:"地域回遊・観光振興",subtitle:"過疎化対策・ファン作り",problem:"観光客が特定スポットに集中し、周辺地域への経済効果が薄い。",solution:"物語の手がかりを地域全体に分散させ、自然な回遊導線を設計。",color:"from-amber-500 to-orange-600",icon:Fe,kpis:["回遊エリア数 3.5倍","滞在時間 +45分","店舗立ち寄り率 28%UP"]},litter:{title:"環境美化・ゴミ拾い",subtitle:"スカベンジャーハント",problem:"環境活動への参加者が固定化し、若年層の関心が低い。",solution:"ゴミ拾いを「宝探し競争」にゲーム化。楽しみながら街を綺麗に。",color:"from-emerald-500 to-teal-600",icon:ma,kpis:["若年層参加率 60%超","回収ゴミ量 1.2トン","満足度 98%"]},disaster:{title:"防災・減災訓練",subtitle:"防災トレイル",problem:"ハザードマップの認知度が低く、座学の訓練では行動が定着しない。",solution:"避難所や危険箇所を巡るミッションで、実際の避難行動を身体で覚える。",color:"from-blue-500 to-indigo-600",icon:xa,kpis:["避難経路認知率 92%","家族参加率 85%","継続実施意向 100%"]}};return e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden border border-stone-100",children:[e.jsx("div",{className:"flex border-b border-stone-100 overflow-x-auto",children:Object.entries(n).map(([r,m])=>e.jsxs("button",{onClick:()=>a(r),className:`flex-1 min-w-[160px] py-6 px-4 text-center transition-all relative group ${t===r?"text-brand-dark":"text-stone-400 hover:text-stone-600 hover:bg-stone-50"}`,children:[e.jsx("div",{className:`w-10 h-10 mx-auto mb-3 rounded-xl flex items-center justify-center transition-colors ${t===r?`bg-gradient-to-br ${m.color} text-white shadow-lg`:"bg-stone-100 text-stone-400"}`,children:e.jsx(m.icon,{className:"w-5 h-5"})}),e.jsx("div",{className:"font-bold text-sm md:text-base",children:m.title}),e.jsx("div",{className:"text-xs mt-1 opacity-70",children:m.subtitle}),t===r&&e.jsx(N.div,{layoutId:"activeTab",className:`absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r ${m.color}`})]},r))}),e.jsx("div",{className:"p-8 md:p-12 bg-stone-50/50",children:e.jsx(Ue,{mode:"wait",children:e.jsxs(N.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"grid md:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx(Qa,{color:"dark",children:"課題（Problem）"}),e.jsx("h3",{className:"text-2xl font-bold text-stone-800 mt-4 leading-relaxed",children:n[t].problem})]}),e.jsxs("div",{className:"relative pl-6 border-l-4 border-brand-gold",children:[e.jsx(Qa,{color:"gold",children:"解決策（Solution）"}),e.jsx("p",{className:"text-lg text-stone-600 mt-4 leading-relaxed",children:n[t].solution})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:n[t].kpis.map((r,m)=>e.jsxs("div",{className:"bg-white px-4 py-3 rounded-xl shadow-sm border border-stone-100 flex items-center gap-2",children:[e.jsx(Vr,{className:"w-4 h-4 text-brand-gold"}),e.jsx("span",{className:"font-bold text-brand-dark text-sm",children:r})]},m))})]}),e.jsxs("div",{className:`relative aspect-video rounded-2xl overflow-hidden shadow-2xl bg-gradient-to-br ${n[t].color} p-1 flex items-center justify-center`,children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm w-full h-full rounded-xl flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-stone-100 mb-4 flex items-center justify-center animate-bounce",children:(()=>{const r=n[t].icon;return e.jsx(r,{className:`w-8 h-8 text-${t==="litter"?"emerald":t==="disaster"?"blue":"amber"}-600`})})()}),e.jsxs("div",{className:"space-y-2 w-full max-w-[200px]",children:[e.jsx("div",{className:"h-2 bg-stone-100 rounded-full w-full"}),e.jsx("div",{className:"h-2 bg-stone-100 rounded-full w-3/4 mx-auto"})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("div",{className:"w-20 h-24 bg-stone-50 rounded-lg border border-stone-100 shadow-sm"}),e.jsx("div",{className:"w-20 h-24 bg-stone-50 rounded-lg border border-stone-100 shadow-sm translate-y-4"}),e.jsx("div",{className:"w-20 h-24 bg-stone-50 rounded-lg border border-stone-100 shadow-sm"})]})]})]})]},t)})})]})},yo=()=>{const t=[{icon:Is,label:"地域課題",sub:"過疎/ゴミ/防災"},{icon:Ms,label:"街歩きゲーム",sub:"TOMOSHIBI"},{icon:lt,label:"行動変容",sub:"回遊/清掃/避難"},{icon:tn,label:"成果の可視化",sub:"ダッシュボード"}];return e.jsxs("div",{className:"relative py-12",children:[e.jsx("div",{className:"hidden md:block absolute top-[48px] left-0 right-0 h-0.5 bg-gradient-to-r from-stone-200 via-brand-gold/50 to-stone-200"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8 relative z-10",children:t.map((a,n)=>e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:n*.15},className:"flex flex-col items-center text-center group",children:[e.jsxs("div",{className:"w-24 h-24 bg-white rounded-full shadow-lg border-4 border-white flex items-center justify-center mb-6 relative z-10 transition-transform group-hover:scale-110 group-hover:border-brand-gold duration-300",children:[e.jsx(a.icon,{className:"w-10 h-10 text-brand-dark group-hover:text-brand-gold transition-colors"}),e.jsx("div",{className:"absolute -right-2 -top-2 w-8 h-8 bg-brand-dark text-white rounded-full flex items-center justify-center font-bold border-2 border-white shadow-md",children:n+1})]}),e.jsx("h3",{className:"text-xl font-bold text-brand-dark mb-1",children:a.label}),e.jsx("p",{className:"text-stone-500 text-sm",children:a.sub})]},n))}),e.jsxs(N.div,{initial:{opacity:0,scale:.95},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"mt-16 mx-auto max-w-4xl bg-white rounded-2xl shadow-2xl border border-stone-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-stone-50 px-4 py-3 border-b border-stone-200 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-400"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-400"}),e.jsx("div",{className:"w-3 h-3 rounded-full bg-emerald-400"}),e.jsx("div",{className:"ml-4 text-xs font-mono text-stone-400",children:"tomoshibi-analytics.dashboard"})]}),e.jsxs("div",{className:"p-6 grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-2 space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 bg-blue-50 p-4 rounded-xl border border-blue-100",children:[e.jsx("div",{className:"text-xs text-blue-500 font-bold mb-1",children:"総参加者数"}),e.jsxs("div",{className:"text-2xl font-bold text-brand-dark",children:["12,450",e.jsx("span",{className:"text-xs text-stone-400 font-normal ml-1",children:"人"})]})]}),e.jsxs("div",{className:"flex-1 bg-emerald-50 p-4 rounded-xl border border-emerald-100",children:[e.jsx("div",{className:"text-xs text-emerald-600 font-bold mb-1",children:"ミッション完遂率"}),e.jsxs("div",{className:"text-2xl font-bold text-brand-dark",children:["88.2",e.jsx("span",{className:"text-xs text-stone-400 font-normal ml-1",children:"%"})]})]})]}),e.jsx("div",{className:"h-40 bg-stone-50 rounded-xl border border-stone-100 flex items-end justify-between p-4 px-8 pb-0",children:[40,65,45,80,55,90,70].map((a,n)=>e.jsx("div",{className:"w-8 bg-brand-dark/10 rounded-t-sm",style:{height:`${a}%`}},n))})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"h-full bg-stone-50 rounded-xl border border-stone-100 p-4",children:[e.jsx("div",{className:"text-xs text-stone-400 font-bold mb-4 uppercase",children:"Popular Spots"}),[1,2,3,4].map(a=>e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-stone-200 text-[10px] flex items-center justify-center text-stone-500 font-bold",children:a}),e.jsx("div",{className:"h-2 bg-stone-200 rounded-full flex-1"})]},a))]})})]})]})]})},No=()=>{const[t,a]=o.useState("municipality"),n={municipality:[{title:"周遊観光促進",icon:Fe,text:"隠れた名所を巡るルート設計で、特定エリアへの集中を解消。",tag:"観光課"},{title:"商店街活性化",icon:Xn,text:"店舗をチェックポイント化し、自然な送客と消費行動を生む。",tag:"産業振興課"},{title:"防災・教育",icon:kn,text:"楽しみながら学ぶ「防災トレイル」や郷土史学習への活用。",tag:"教育委員会"}],enterprise:[{title:"CSR・SDGs",icon:al,text:"環境保全活動をイベント化。楽しみながら社会貢献活動を実施。",tag:"CSR担当"},{title:"イベント協賛",icon:Nn,text:"地域イベントへの協賛として、ブランド認知と好感度を向上。",tag:"広報・宣伝"},{title:"チームビルディング",icon:lt,text:"社員同士で協力して謎を解く、新しい形の社内・新人研修。",tag:"人事・総務"}]};return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-center mb-12",children:e.jsxs("div",{className:"bg-stone-100 p-1.5 rounded-full inline-flex relative",children:[e.jsx(N.div,{className:"absolute inset-y-1.5 bg-white rounded-full shadow-md",initial:!1,animate:{left:t==="municipality"?"6px":"50%",width:"calc(50% - 9px)"},transition:{type:"spring",stiffness:300,damping:30}}),e.jsxs("button",{onClick:()=>a("municipality"),className:`relative z-10 px-8 py-3 rounded-full text-sm font-bold transition-colors w-40 flex items-center justify-center gap-2 ${t==="municipality"?"text-brand-dark":"text-stone-500"}`,children:[e.jsx(Za,{className:"w-4 h-4"}),"自治体様"]}),e.jsxs("button",{onClick:()=>a("enterprise"),className:`relative z-10 px-8 py-3 rounded-full text-sm font-bold transition-colors w-40 flex items-center justify-center gap-2 ${t==="enterprise"?"text-brand-dark":"text-stone-500"}`,children:[e.jsx(ha,{className:"w-4 h-4"}),"企業様"]})]})}),e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:e.jsx(Ue,{mode:"popLayout",children:n[t].map((r,m)=>e.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2,delay:m*.1},className:"bg-white p-8 rounded-2xl border border-stone-200 shadow-sm hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${t==="municipality"?"bg-amber-100 text-amber-700":"bg-indigo-100 text-indigo-700"}`,children:e.jsx(r.icon,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider bg-stone-100 text-stone-500 px-2 py-1 rounded",children:r.tag})]}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark mb-3",children:r.title}),e.jsx("p",{className:"text-stone-600 text-sm leading-relaxed",children:r.text})]},`${t}-${m}`))})})]})},wo=()=>e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-stone-200 min-w-[800px]",children:[e.jsxs("div",{className:"grid grid-cols-4 border-b border-stone-100 bg-stone-50/50 rounded-t-2xl",children:[e.jsx("div",{className:"p-6 font-bold text-stone-400 text-sm",children:"プラン比較"}),e.jsxs("div",{className:"p-6 text-center border-l border-stone-100",children:[e.jsx("div",{className:"font-bold text-brand-dark text-lg mb-1",children:"Pack A"}),e.jsx("div",{className:"text-xs text-amber-600 font-bold bg-amber-50 px-2 py-1 rounded-full inline-block",children:"地域回遊"})]}),e.jsxs("div",{className:"p-6 text-center border-l border-stone-100 bg-brand-gold/5 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-brand-gold"}),e.jsx("div",{className:"font-bold text-brand-dark text-lg mb-1",children:"Pack B"}),e.jsx("div",{className:"text-xs text-emerald-600 font-bold bg-emerald-50 px-2 py-1 rounded-full inline-block",children:"清掃ハント"}),e.jsx("div",{className:"absolute top-2 right-2 text-[10px] bg-brand-dark text-white px-2 py-0.5 rounded-full",children:"人気"})]}),e.jsxs("div",{className:"p-6 text-center border-l border-stone-100",children:[e.jsx("div",{className:"font-bold text-brand-dark text-lg mb-1",children:"Pack C"}),e.jsx("div",{className:"text-xs text-blue-600 font-bold bg-blue-50 px-2 py-1 rounded-full inline-block",children:"防災訓練"})]})]}),[{label:"目的",a:"観光・回遊",b:"環境・CSR",c:"防災・教育"},{label:"実施形態",a:"常設/イベント",b:"イベント主体",c:"イベント/訓練"},{label:"店舗連携",a:"○ (5-10店舗)",b:"△ (協賛店)",c:"△ (避難所等)"},{label:"成果指標",a:"回遊・送客数",b:"ゴミ回収量",c:"理解度・完走率"},{label:"多言語",a:"オプション",b:"基本不要",c:"オプション"}].map((t,a)=>e.jsxs("div",{className:"grid grid-cols-4 border-b border-stone-100 last:border-b-0 hover:bg-stone-50/50 transition-colors",children:[e.jsx("div",{className:"p-5 font-bold text-stone-600 text-sm flex items-center",children:t.label}),e.jsx("div",{className:"p-5 text-center text-stone-600 text-sm border-l border-stone-100 flex items-center justify-center",children:t.a}),e.jsx("div",{className:"p-5 text-center text-brand-dark font-medium text-sm border-l border-stone-100 bg-brand-gold/5 flex items-center justify-center",children:t.b}),e.jsx("div",{className:"p-5 text-center text-stone-600 text-sm border-l border-stone-100 flex items-center justify-center",children:t.c})]},a))]})}),ko=()=>{const[t,a]=o.useState(0),n=[{title:"お問い合わせ",desc:"課題感や実施時期、予算感などをヒアリングさせていただきます。"},{title:"企画・設計",desc:"KPI設計、ルート案、ストーリー構成をご提案します。（約1〜2週間）"},{title:"制作・連携",desc:"クエスト制作、店舗・施設への許諾取り、QRコード設置などを行います。AI活用で最短3日で制作可能。"},{title:"公開・PR",desc:"専用LP作成、SNS発信、チラシ配布など、集客施策を支援します。"},{title:"レポート・改善",desc:"イベント終了後、人流データ・参加者属性・アンケート結果をまとめたレポートを提出します。"}];return e.jsx("div",{className:"space-y-4 max-w-3xl mx-auto",children:n.map((r,m)=>e.jsxs("div",{className:`border rounded-2xl transition-all overflow-hidden ${t===m?"border-brand-gold bg-brand-gold/5":"border-stone-200 bg-white hover:border-stone-300"}`,children:[e.jsxs("button",{onClick:()=>a(t===m?null:m),className:"w-full text-left p-6 flex items-center gap-6",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${t===m?"bg-brand-gold text-brand-dark":"bg-stone-200 text-stone-500"}`,children:m+1}),e.jsx("span",{className:`font-bold text-lg flex-1 ${t===m?"text-brand-dark":"text-stone-600"}`,children:r.title}),e.jsx(Nt,{className:`w-5 h-5 transition-transform ${t===m?"rotate-180 text-brand-dark":"text-stone-400"}`})]}),e.jsx(Ue,{children:t===m&&e.jsx(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-6 pb-6 pt-0 pl-20 pr-10 text-stone-600 leading-relaxed",children:r.desc})})})]},m))})},nr=({onClose:t})=>{const[a,n]=o.useState({organization:"",name:"",email:"",type:"",message:""}),[r,m]=o.useState(!1),[g,d]=o.useState(!1),u=async x=>{x.preventDefault(),m(!0),typeof window<"u"&&window.gtag&&window.gtag("event","form_submit",{event_category:"B2B",event_label:"Contact Form",form_type:a.type}),await new Promise(b=>setTimeout(b,1500)),m(!1),d(!0)};return g?e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Ts,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-brand-dark mb-3",children:"送信完了"}),e.jsxs("p",{className:"text-stone-600 mb-6",children:["お問い合わせありがとうございます。",e.jsx("br",{}),"担当者より2営業日以内にご連絡いたします。"]}),t&&e.jsx("button",{onClick:t,className:"text-brand-gold font-bold hover:underline",children:"閉じる"})]}):e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-stone-700 mb-1.5",children:"組織名"}),e.jsx("input",{type:"text",required:!0,value:a.organization,onChange:x=>n({...a,organization:x.target.value}),className:"w-full px-4 py-3 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-brand-gold/20 focus:border-brand-gold",placeholder:"株式会社〇〇"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-stone-700 mb-1.5",children:"ご担当者名"}),e.jsx("input",{type:"text",required:!0,value:a.name,onChange:x=>n({...a,name:x.target.value}),className:"w-full px-4 py-3 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-brand-gold/20 focus:border-brand-gold",placeholder:"山田 太郎"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-stone-700 mb-1.5",children:"メールアドレス"}),e.jsx("input",{type:"email",required:!0,value:a.email,onChange:x=>n({...a,email:x.target.value}),className:"w-full px-4 py-3 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-brand-gold/20 focus:border-brand-gold",placeholder:"example@co.jp"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-stone-700 mb-1.5",children:"ご相談種別"}),e.jsxs("select",{required:!0,value:a.type,onChange:x=>n({...a,type:x.target.value}),className:"w-full px-4 py-3 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-brand-gold/20 focus:border-brand-gold",children:[e.jsx("option",{value:"",children:"選択してください"}),e.jsx("option",{value:"municipality",children:"自治体として導入を検討"}),e.jsx("option",{value:"enterprise",children:"企業として導入を検討"}),e.jsx("option",{value:"sponsorship",children:"協賛・タイアップを検討"}),e.jsx("option",{value:"other",children:"その他"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-stone-700 mb-1.5",children:"お問い合わせ内容"}),e.jsx("textarea",{value:a.message,onChange:x=>n({...a,message:x.target.value}),rows:4,className:"w-full px-4 py-3 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-brand-gold/20 focus:border-brand-gold resize-none",placeholder:"詳細をご記入ください"})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full py-4 bg-brand-dark text-white font-bold rounded-xl hover:bg-brand-gold hover:text-brand-dark transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:r?"送信中...":e.jsxs(e.Fragment,{children:[e.jsx(As,{className:"w-5 h-5"})," 送信する"]})})]})},_o=({isOpen:t,onClose:a})=>t?e.jsx(Ue,{children:e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:a,children:e.jsxs(N.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:n=>n.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-stone-100 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-brand-dark",children:"お問い合わせ"}),e.jsx("button",{onClick:a,className:"w-8 h-8 rounded-full hover:bg-stone-100 flex items-center justify-center transition-colors",children:e.jsx(nt,{className:"w-5 h-5 text-stone-400"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(nr,{onClose:a})})]})})}):null,So=()=>{es();const[t,a]=o.useState(!1),[n,r]=o.useState(!1),[m,g]=o.useState(!1);o.useEffect(()=>{const x=()=>g(window.scrollY>20);return window.addEventListener("scroll",x),()=>window.removeEventListener("scroll",x)},[]);const d=()=>a(!0),u=()=>{var x;return(x=document.getElementById("contact-form"))==null?void 0:x.scrollIntoView({behavior:"smooth"})};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"relative pt-32 pb-20 md:pt-48 md:pb-32 px-4 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 -z-10 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-amber-100/40 via-white to-white"}),e.jsx("div",{className:"absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-amber-50/50 to-transparent -z-10 hidden md:block"}),e.jsxs("div",{className:"max-w-7xl mx-auto grid md:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"inline-flex items-center gap-2 px-4 py-1.5 bg-white border border-stone-200 rounded-full text-xs font-bold text-stone-500 mb-8 shadow-sm",children:[e.jsx(Za,{className:"w-3.5 h-3.5 text-brand-gold"}),"自治体・企業向けソリューション"]}),e.jsxs(N.h1,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-4xl md:text-6xl lg:text-7xl font-serif font-bold text-brand-dark leading-[1.1] mb-8",children:["地域の課題を、",e.jsx("br",{}),e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-brand-gold to-amber-600",children:'"体験"'}),"に変える。"]}),e.jsx(N.p,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-lg text-stone-600 leading-relaxed mb-10 max-w-lg mx-auto md:mx-0",children:"「TOMOSHIBI」は、街歩きと謎解きを掛け合わせた地域回遊プラットフォーム。 ただの観光PRではなく、「人が動く」仕掛けで、過疎化・環境・防災といった地域課題に挑みます。"}),e.jsxs(N.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex flex-col sm:flex-row items-center gap-4 justify-center md:justify-start",children:[e.jsxs("button",{onClick:d,className:"w-full sm:w-auto px-8 py-4 bg-brand-dark text-white font-bold rounded-full hover:bg-brand-gold hover:text-brand-dark transition-all shadow-xl hover:translate-y-[-2px] flex items-center justify-center gap-2",children:["導入を相談する ",e.jsx(xt,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:u,className:"w-full sm:w-auto px-8 py-4 bg-white text-brand-dark border-2 border-stone-100 font-bold rounded-full hover:border-brand-dark transition-all flex items-center justify-center gap-2",children:"資料ダウンロード"})]}),e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"mt-12 flex flex-wrap gap-6 justify-center md:justify-start",children:["PoC受付中","導入地域募集中","パートナーシップ"].map(x=>e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-stone-400",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," ",x]},x))})]}),e.jsxs(N.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.8},className:"hidden md:block relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-brand-gold/20 to-transparent rounded-full blur-[100px]"}),e.jsxs("div",{className:"relative z-10 w-full aspect-square max-w-lg mx-auto bg-white rounded-[40px] shadow-2xl overflow-hidden border-8 border-white/50",children:[e.jsx("div",{className:"absolute inset-0 bg-stone-50 opacity-50 pattern-grid-lg"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-32 h-32 bg-amber-100 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"}),e.jsx("div",{className:"absolute top-1/3 right-1/4 w-32 h-32 bg-purple-100 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute bottom-1/4 left-1/3 w-32 h-32 bg-pink-100 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"}),e.jsx("div",{className:"absolute top-12 left-12 right-12 bottom-12 border-2 border-dashed border-stone-300 rounded-3xl"}),e.jsxs("div",{className:"absolute top-20 left-8 bg-white p-4 rounded-xl shadow-lg border border-stone-100 flex items-center gap-3 animate-float delay-0",children:[e.jsx("div",{className:"w-10 h-10 bg-brand-dark text-white rounded-lg flex items-center justify-center font-bold",children:"Q1"}),e.jsxs("div",{children:[e.jsx("div",{className:"w-24 h-2 bg-stone-200 rounded mb-1"}),e.jsx("div",{className:"w-16 h-2 bg-stone-100 rounded"})]})]}),e.jsxs("div",{className:"absolute bottom-24 right-8 bg-white p-4 rounded-xl shadow-lg border border-stone-100 flex items-center gap-3 animate-float delay-1000",children:[e.jsx(Fe,{className:"w-8 h-8 text-red-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-stone-500",children:"CHECK IN"}),e.jsx("div",{className:"text-sm font-bold text-brand-dark",children:"古民家カフェ"})]})]}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-brand-gold/90 backdrop-blur text-white px-6 py-3 rounded-full font-bold shadow-xl animate-pulse",children:"MISSION COMPLETE!"})]})]})]}),e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1,duration:1},className:"absolute bottom-8 left-1/2 -translate-x-1/2 text-stone-300 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-[10px] tracking-[0.2em] font-bold",children:"SCROLL"}),e.jsx("div",{className:"w-px h-12 bg-stone-200 overflow-hidden",children:e.jsx("div",{className:"w-full h-1/2 bg-brand-gold -mt-full animate-scrolldown"})})]})]}),e.jsx("section",{id:"solutions",className:"py-24 px-4 bg-white relative z-10 rounded-t-[40px] shadow-[0_-20px_40px_rgba(0,0,0,0.03)] border-t border-stone-100",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(Wt,{subtitle:"複雑な地域課題も、ゲーミフィケーションで解決の糸口へ。",children:"課題に応じたアプローチ"}),e.jsx(vo,{})]})}),e.jsx("section",{id:"flow",className:"py-24 px-4 bg-stone-50 overflow-hidden",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(Wt,{subtitle:"『体験』を入口に、人の行動を変え、街の資産として蓄積します。",children:"価値創出の仕組み"}),e.jsx(yo,{})]})}),e.jsxs("section",{className:"py-20 px-4 bg-brand-dark text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),e.jsxs("div",{className:"max-w-6xl mx-auto text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl font-serif font-bold mb-12",children:"定量的な成果を、あなたの街に"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8 mb-16",children:[{label:"エリア回遊率",value:"3.5",unit:"倍"},{label:"地域滞在時間",value:"+45",unit:"分"},{label:"行動変容率",value:"82",unit:"%"},{label:"顧客満足度",value:"4.8",unit:"/5"}].map((x,b)=>e.jsxs("div",{className:"p-6 border border-white/10 rounded-2xl bg-white/5 backdrop-blur-sm",children:[e.jsx("div",{className:"text-white/60 text-sm font-bold mb-2",children:x.label}),e.jsxs("div",{className:"text-4xl md:text-5xl font-bold text-brand-gold",children:[x.value,e.jsx("span",{className:"text-lg text-white/50 ml-1",children:x.unit})]})]},b))})]})]}),e.jsx("section",{id:"use-cases",className:"py-24 px-4 bg-white",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(Wt,{subtitle:"自治体から企業まで、目的に合わせて幅広く活用されています。",children:"活用シーン"}),e.jsx(No,{})]})}),e.jsx("section",{id:"packages",className:"py-24 px-4 bg-stone-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(Wt,{subtitle:"スモールスタートから本格展開まで。",children:"導入プラン"}),e.jsx(wo,{}),e.jsx("p",{className:"text-center text-stone-500 text-xs mt-6",children:"※ 上記はモデルケースです。ご予算・ご要望に応じて柔軟にカスタマイズ可能です。"})]})}),e.jsx("section",{className:"py-24 px-4 bg-white",children:e.jsxs("div",{className:"max-w-4xl mx-auto grid md:grid-cols-2 gap-16 items-start",children:[e.jsxs("div",{className:"sticky top-24",children:[e.jsx(Wt,{subtitle:"ご相談から最短1ヶ月で公開可能。",children:"公開までの流れ"}),e.jsxs("p",{className:"text-stone-600 mb-8",children:["専任のプランナーが企画から運用まで伴走します。",e.jsx("br",{}),"まずはお気軽にご相談ください。"]}),e.jsx("button",{onClick:d,className:"px-8 py-4 bg-brand-dark text-white font-bold rounded-full hover:bg-brand-gold hover:text-brand-dark transition-colors shadow-lg",children:"スケジュールを相談する"})]}),e.jsx(ko,{})]})}),e.jsx("section",{id:"faq",className:"py-24 px-4 bg-stone-50",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(Wt,{subtitle:"よくあるご質問",children:"FAQ"}),e.jsx("div",{className:"space-y-4",children:[{q:"導入費用はどのくらいですか？",a:"イベント規模や期間によりますが、トライアルプランとして50万円〜実施可能です。詳細はお見積りいたします。"},{q:"どの地域でも対応できますか？",a:"はい、日本全国対応可能です。現地調査が必要な場合は別途交通費をいただく場合がございます。"},{q:"自社のキャラクターは使えますか？",a:"可能です。既存IPを活用したコラボイベントとしての実施実績もございます。"},{q:"参加者のデータはもらえますか？",a:"はい、個人情報を除いた統計データ（属性、回遊ログ、アンケート等）をレポートとして提出します。"}].map((x,b)=>e.jsxs("details",{className:"group bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden cursor-pointer",children:[e.jsxs("summary",{className:"flex items-center justify-between p-6 font-bold text-stone-700 list-none group-open:text-brand-dark transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"w-6 h-6 bg-stone-100 rounded text-stone-400 text-xs flex items-center justify-center font-bold",children:"Q"}),x.q]}),e.jsx(Nt,{className:"w-5 h-5 text-stone-400 transition-transform group-open:rotate-180"})]}),e.jsx("div",{className:"px-6 pb-6 pl-16 text-stone-600 leading-relaxed border-t border-stone-50 pt-4",children:x.a})]},b))})]})}),e.jsx("section",{id:"contact-form",className:"py-24 px-4 bg-gradient-to-br from-stone-900 to-brand-dark text-white",children:e.jsxs("div",{className:"max-w-5xl mx-auto grid md:grid-cols-2 gap-16 items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-4xl md:text-5xl font-serif font-bold mb-6",children:["あなたの街でも、",e.jsx("br",{}),"新しい物語を",e.jsx("br",{}),"始めませんか？"]}),e.jsxs("p",{className:"text-white/70 text-lg mb-10 leading-relaxed",children:["地域活性化、環境問題、防災意識の向上。",e.jsx("br",{}),"TOMOSHIBIなら、それらを「ワクワクする体験」に変えることができます。"]}),e.jsxs("div",{className:"flex items-center gap-6 opacity-60",children:[e.jsx("div",{className:"flex -space-x-3",children:[1,2,3,4].map(x=>e.jsx("div",{className:"w-10 h-10 rounded-full bg-stone-700 border-2 border-brand-dark"},x))}),e.jsxs("span",{className:"text-sm font-bold",children:["多くの自治体・企業様が",e.jsx("br",{}),"導入を検討中です"]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-8 text-stone-800 shadow-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-6 bg-brand-gold rounded-full"}),"お問い合わせ・資料請求"]}),e.jsx(nr,{})]})]})}),e.jsx("footer",{className:"bg-stone-950 text-white/40 py-12 px-4 border-t border-white/10",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsx("div",{className:"font-serif font-bold text-2xl text-white/50",children:"TOMOSHIBI"}),e.jsxs("div",{className:"flex gap-8 text-sm font-bold",children:[e.jsx("a",{href:"/topics",className:"hover:text-white transition-colors",children:"運営会社"}),e.jsx("a",{href:"/privacy",className:"hover:text-white transition-colors",children:"プライバシーポリシー"}),e.jsx("a",{href:"/terms",className:"hover:text-white transition-colors",children:"利用規約"})]}),e.jsx("div",{className:"text-xs",children:"© 2025 TOMOSHIBI Project."})]})}),e.jsx(_o,{isOpen:t,onClose:()=>a(!1)})]})};function Co({isOpen:t,onClose:a,targetMode:n,currentChecklist:r,onChecklistChange:m,onConfirm:g,userId:d,shareToken:u,onGenerateShareToken:x}){const[b,f]=o.useState(!1),v=o.useMemo(()=>ba(n),[n]),p=o.useMemo(()=>Cl(n,r),[n,r]),i=o.useMemo(()=>Tl(n,r),[n,r]),_=o.useMemo(()=>{const O={route:[],info:[],mystery:[],rescue:[]};return v.forEach(R=>{O[R.category].push(R)}),O},[v]),w=O=>{const R=r[O],be={...r,[O]:{completed:!(R!=null&&R.completed),completedAt:R!=null&&R.completed?void 0:new Date().toISOString(),completedBy:R!=null&&R.completed?void 0:d}};m(be)},B=async()=>{if(!u)return;const O=`${window.location.origin}/play/shared/${u}`;try{await navigator.clipboard.writeText(O),f(!0),setTimeout(()=>f(!1),2e3)}catch(R){console.error("Failed to copy:",R)}};if(!t)return null;const L=Sl[n];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-stone-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n==="SHARE"?e.jsx("div",{className:"w-10 h-10 rounded-full bg-sky-100 flex items-center justify-center",children:e.jsx(da,{className:"w-5 h-5 text-sky-600"})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(cs,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-stone-800",children:n==="SHARE"?"共有前チェック":"公開前チェック"}),e.jsx("p",{className:"text-sm text-stone-500",children:L.description})]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-stone-100 rounded-full transition-colors",children:e.jsx(nt,{className:"w-5 h-5 text-stone-500"})})]}),e.jsx("div",{className:`mx-6 mt-4 p-4 rounded-xl border ${n==="SHARE"?"bg-sky-50 border-sky-200":"bg-emerald-50 border-emerald-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Xa,{className:`w-5 h-5 mt-0.5 ${n==="SHARE"?"text-sky-600":"text-emerald-600"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${n==="SHARE"?"text-sky-800":"text-emerald-800"}`,children:n==="SHARE"?"友人や仲間に共有する前に、以下の項目を確認してください。":"公開審査を申請する前に、以下の項目を全て確認してください。"}),e.jsx("p",{className:`text-xs mt-1 ${n==="SHARE"?"text-sky-600":"text-emerald-600"}`,children:n==="SHARE"?"少人数でも体験事故を防ぐために、最低限のチェックが必要です。":"公開品質を担保し、ブランド信頼を守るために厳格なチェックが必要です。"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:Object.keys(_).map(O=>{const R=_[O];if(R.length===0)return null;const be=_l[O],Y=R.every(ee=>{var P;return(P=r[ee.id])==null?void 0:P.completed});return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:be.icon}),e.jsx("h3",{className:"font-semibold text-stone-700",children:be.label}),Y&&e.jsx("span",{className:"ml-auto text-xs font-medium text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full",children:"✓ 完了"})]}),e.jsx("div",{className:"space-y-2",children:R.map(ee=>{const P=r[ee.id],he=(P==null?void 0:P.completed)===!0;return e.jsxs("div",{onClick:()=>w(ee.id),className:`
                          flex items-center gap-3 p-4 rounded-xl border cursor-pointer transition-all
                          ${he?"bg-emerald-50 border-emerald-200 hover:bg-emerald-100":"bg-stone-50 border-stone-200 hover:bg-stone-100 hover:border-stone-300"}
                        `,children:[e.jsx("div",{className:`
                            w-6 h-6 rounded-md flex items-center justify-center flex-shrink-0 transition-colors
                            ${he?"bg-emerald-500 text-white":"bg-white border-2 border-stone-300"}
                          `,children:he&&e.jsx(Ts,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium ${he?"text-emerald-800":"text-stone-700"}`,children:ee.label}),e.jsx("p",{className:`text-sm ${he?"text-emerald-600":"text-stone-500"}`,children:ee.description})]}),ee.linkedSection&&e.jsx(pa,{className:`w-4 h-4 flex-shrink-0 ${he?"text-emerald-400":"text-stone-400"}`})]},ee.id)})})]},O)})}),e.jsxs("div",{className:"border-t border-stone-200 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-stone-600",children:["チェック進捗: ",v.length-i.length," / ",v.length]}),p?e.jsx("span",{className:"text-emerald-600 font-medium",children:"✓ 全項目完了"}):e.jsxs("span",{className:"text-amber-600 font-medium",children:["残り ",i.length," 項目"]})]}),e.jsx("div",{className:"w-full h-2 bg-stone-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${p?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${(v.length-i.length)/v.length*100}%`}})})]}),n==="SHARE"&&p&&e.jsxs("div",{className:"mb-4 p-4 bg-sky-50 rounded-xl border border-sky-200",children:[e.jsx("p",{className:"text-sm font-medium text-sky-800 mb-2",children:"共有リンク"}),u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:`${window.location.origin}/play/shared/${u}`,className:"flex-1 px-3 py-2 bg-white border border-sky-200 rounded-lg text-sm text-stone-700"}),e.jsxs("button",{onClick:B,className:"px-4 py-2 bg-sky-600 text-white rounded-lg text-sm font-medium hover:bg-sky-700 transition-colors flex items-center gap-2",children:[b?e.jsx(Ts,{className:"w-4 h-4"}):e.jsx(xn,{className:"w-4 h-4"}),b?"コピー済み":"コピー"]})]}):e.jsxs("button",{onClick:x,className:"w-full px-4 py-2 bg-sky-600 text-white rounded-lg text-sm font-medium hover:bg-sky-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(bn,{className:"w-4 h-4"}),"共有リンクを生成"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:a,className:"flex-1 px-6 py-3 border border-stone-300 text-stone-700 rounded-xl font-medium hover:bg-stone-50 transition-colors",children:"閉じる"}),n==="PUBLISH"&&e.jsx("button",{onClick:g,disabled:!p,className:`
                  flex-1 px-6 py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2
                  ${p?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-stone-200 text-stone-400 cursor-not-allowed"}
                `,children:p?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4"}),"審査を申請"]}):e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"w-4 h-4"}),"チェック未完了"]})}),n==="SHARE"&&e.jsx("button",{onClick:g,disabled:!p,className:`
                  flex-1 px-6 py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2
                  ${p?"bg-sky-600 text-white hover:bg-sky-700":"bg-stone-200 text-stone-400 cursor-not-allowed"}
                `,children:p?e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"w-4 h-4"}),"共有を有効化"]}):e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"w-4 h-4"}),"チェック未完了"]})})]})]})]})})}function To({onBack:t,onLogoHome:a,analytics:n=[],analyticsFilter:r="all",onChangeAnalyticsFilter:m,onOpenDetail:g,detailQuestAnalytics:d,detailLoading:u,gameplayEvents:x,feedbackStats:b}){var v,p;const f=i=>i!=null?`${i} 分`:"—";return e.jsx("section",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-10 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:t,className:"text-sm text-brand-dark font-bold hover:underline flex items-center gap-1",children:"< プロフィールへ戻る"}),e.jsx("div",{className:"flex items-center gap-2 text-xs",children:["all","30d","7d"].map(i=>e.jsx("button",{onClick:()=>m==null?void 0:m(i),className:`px-3 py-1 rounded-full border text-sm ${r===i?"bg-brand-gold text-white border-brand-gold":"bg-white text-stone-600 border-stone-200 hover:border-brand-gold hover:text-brand-dark"}`,children:i==="all"?"全期間":i==="30d"?"直近30日":"直近7日"},i))})]}),e.jsxs("div",{className:"bg-white/90 border border-stone-200 rounded-3xl p-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-brand-dark",children:"プレイ状況（ベータ）"}),e.jsx("span",{className:"text-xs text-stone-500",children:"自分のクエストのセッション集計"})]})}),n&&n.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-stone-500",children:[e.jsx("th",{className:"py-2 pr-3",children:"クエスト"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"プレイ数"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"ユニーク"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"クリア率"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"平均時間"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"平均ヒント"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"平均誤答"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"平均評価"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"レビュー"}),e.jsx("th",{className:"py-2 pr-3 text-right",children:"詳細"})]})}),e.jsx("tbody",{children:n.map(i=>e.jsxs("tr",{className:"border-t border-stone-100 hover:bg-amber-50/40",children:[e.jsx("td",{className:"py-2 pr-3 font-semibold text-brand-dark",children:i.title}),e.jsx("td",{className:"py-2 pr-3 text-right",children:i.playCount}),e.jsx("td",{className:"py-2 pr-3 text-right",children:i.uniquePlayers}),e.jsxs("td",{className:"py-2 pr-3 text-right",children:[i.clearRate,"%"]}),e.jsx("td",{className:"py-2 pr-3 text-right",children:f(i.avgDurationMin)}),e.jsx("td",{className:"py-2 pr-3 text-right",children:i.avgHints!=null?i.avgHints:"—"}),e.jsx("td",{className:"py-2 pr-3 text-right",children:i.avgWrongs!=null?i.avgWrongs:"—"}),e.jsx("td",{className:"py-2 pr-3 text-right",children:i.avgRating!=null?`★${i.avgRating}`:"—"}),e.jsx("td",{className:"py-2 pr-3 text-right",children:i.reviewCount||"—"}),e.jsx("td",{className:"py-2 pr-3 text-right",children:e.jsx("button",{onClick:()=>{d&&d.questId===i.questId?g==null||g("",""):g==null||g(i.questId,i.title)},className:"text-amber-700 hover:underline text-sm",children:d&&d.questId===i.questId?"閉じる":"開く"})})]},i.questId))})]})}),e.jsx("p",{className:"text-[11px] text-stone-500 mt-2",children:"プレイ数=セッション数、クリア率=クリア済みセッション/プレイ数。ステップ別の離脱や誤答は下部の詳細で確認できます。"})]}):e.jsx("div",{className:"text-sm text-stone-500 bg-stone-50 border border-dashed border-stone-200 rounded-2xl px-4 py-6 text-center",children:"まだプレイログがありません。モバイルでプレイするとここに反映されます。"}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 overflow-auto",children:e.jsxs("div",{className:"relative w-full max-w-4xl bg-white rounded-3xl shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-gradient-to-r from-brand-dark to-brand-gold px-6 py-5 flex items-center justify-between",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("p",{className:"text-xs text-white/70 font-medium tracking-wider uppercase",children:"クエスト分析"}),e.jsx("h3",{className:"text-xl font-bold mt-1",children:d.title||"クエスト詳細"})]}),e.jsx("button",{onClick:()=>g==null?void 0:g("",""),className:"w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors","aria-label":"閉じる",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[u&&e.jsxs("div",{className:"text-center py-8 text-stone-500",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-brand-gold border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("p",{children:"読み込み中..."})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-full bg-amber-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})})}),e.jsx("p",{className:"text-2xl font-bold text-brand-dark",children:d.summary.playCount}),e.jsx("p",{className:"text-xs text-amber-700 font-medium mt-1",children:"プレイ数"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-200 rounded-2xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("p",{className:"text-2xl font-bold text-brand-dark",children:[d.summary.clearRate,"%"]}),e.jsx("p",{className:"text-xs text-emerald-700 font-medium mt-1",children:"クリア率"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-sky-50 to-blue-50 border border-sky-200 rounded-2xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-full bg-sky-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-sky-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-2xl font-bold text-brand-dark",children:f(d.summary.avgDurationMin)}),e.jsx("p",{className:"text-xs text-sky-700 font-medium mt-1",children:"平均時間"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-purple-50 border border-violet-200 rounded-2xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-full bg-violet-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsxs("p",{className:"text-2xl font-bold text-brand-dark",children:[d.summary.avgHints??"—",e.jsx("span",{className:"text-sm text-stone-400",children:"/"}),d.summary.avgWrongs??"—"]}),e.jsx("p",{className:"text-xs text-violet-700 font-medium mt-1",children:"ヒント / 誤答"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-rose-50 to-pink-50 border border-rose-200 rounded-2xl p-4 text-center shadow-sm",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 rounded-full bg-rose-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-rose-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),e.jsx("p",{className:"text-2xl font-bold text-brand-dark",children:d.reviews.avgRating!=null?`★${d.reviews.avgRating}`:"—"}),e.jsxs("p",{className:"text-xs text-rose-700 font-medium mt-1",children:["評価 (",d.reviews.count,"件)"]})]})]}),e.jsxs("div",{className:"bg-stone-50 rounded-2xl p-5 border border-stone-200",children:[e.jsxs("h4",{className:"font-bold text-brand-dark mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-brand-gold",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"ステップ別ファネル分析"]}),e.jsx("div",{className:"space-y-3",children:d.steps.map((i,_)=>{const w=Math.min(100,Math.max(0,i.completed/Math.max(1,i.reached)*100)),B=Math.round(i.dropRate*100),L=B>30;return e.jsxs("div",{className:"relative",children:[_<d.steps.length-1&&e.jsx("div",{className:"absolute left-5 top-[52px] w-0.5 h-4 bg-stone-200"}),e.jsxs("div",{className:`flex items-center gap-4 p-3 rounded-xl transition-colors ${L?"bg-rose-50 border border-rose-200":"bg-white border border-stone-200"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${L?"bg-rose-100 text-rose-700":"bg-brand-gold/20 text-brand-gold"}`,children:i.step}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-brand-dark truncate",children:i.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("div",{className:"flex-1 h-2 bg-stone-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${L?"bg-rose-400":"bg-emerald-500"}`,style:{width:`${w}%`}})}),e.jsxs("span",{className:"text-xs text-stone-500 whitespace-nowrap",children:[i.completed,"/",i.reached]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("div",{className:`px-2 py-1 rounded-lg ${L?"bg-rose-100 text-rose-700 font-bold":"bg-stone-100 text-stone-600"}`,children:["離脱 ",B,"%"]}),e.jsxs("div",{className:"text-stone-500",children:["ヒント ",i.avgHints??"—"]}),e.jsxs("div",{className:"text-stone-500",children:["誤答 ",i.avgWrongs??"—"]})]})]})]},i.step)})})]}),(d.gameplayEvents||d.feedbackStats)&&e.jsxs("div",{className:"bg-rose-50/50 rounded-2xl p-5 border border-rose-200",children:[e.jsxs("h4",{className:"font-bold text-brand-dark mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-rose-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"行動分析・フィードバック"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[((v=d.gameplayEvents)==null?void 0:v.dropOffByMode)&&d.gameplayEvents.dropOffByMode.length>0&&e.jsxs("div",{className:"bg-white/80 rounded-xl p-3 border border-rose-100",children:[e.jsx("p",{className:"text-xs font-bold text-rose-700 mb-2",children:"画面別離脱"}),e.jsx("div",{className:"space-y-1.5",children:d.gameplayEvents.dropOffByMode.map(i=>{const w={travel:"移動中",story:"ストーリー",puzzle:"謎解き",epilogue:"エピローグ"}[i.mode]||i.mode,B=Math.max(...d.gameplayEvents.dropOffByMode.map(O=>O.count)),L=B>0?i.count/B*100:0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 text-xs text-rose-600",children:w}),e.jsx("div",{className:"flex-1 h-3 bg-rose-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-rose-400 rounded-full",style:{width:`${L}%`}})}),e.jsx("div",{className:"text-xs font-bold text-rose-700 w-6 text-right",children:i.count})]},i.mode)})})]}),((p=d.gameplayEvents)==null?void 0:p.puzzleErrorRate)&&d.gameplayEvents.puzzleErrorRate.length>0&&e.jsxs("div",{className:"bg-white/80 rounded-xl p-3 border border-orange-100",children:[e.jsx("p",{className:"text-xs font-bold text-orange-700 mb-2",children:"誤答率が高いスポット"}),e.jsx("div",{className:"space-y-1",children:d.gameplayEvents.puzzleErrorRate.slice(0,3).map((i,_)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-stone-600 truncate max-w-[150px]",children:i.spotName}),e.jsxs("span",{className:`px-1.5 py-0.5 rounded-lg font-bold ${i.rate>.5?"bg-rose-100 text-rose-700":"bg-emerald-100 text-emerald-700"}`,children:[Math.round(i.rate*100),"%"]})]},_))})]}),d.feedbackStats&&d.feedbackStats.total>0&&e.jsxs("div",{className:"md:col-span-2 bg-white/80 rounded-xl p-3 border border-violet-100",children:[e.jsxs("p",{className:"text-xs font-bold text-violet-700 mb-2",children:["ユーザー報告 (",d.feedbackStats.total,"件)"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.feedbackStats.byCategory.map(i=>e.jsxs("span",{className:"px-2 py-1 bg-violet-100 text-violet-700 text-xs rounded-lg",children:[i.label,": ",i.count]},i.category))}),d.feedbackStats.recent.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-violet-100 space-y-1",children:d.feedbackStats.recent.slice(0,2).map((i,_)=>e.jsxs("div",{className:"text-xs text-stone-600",children:[e.jsx("span",{className:"text-violet-600 font-medium",children:i.category}),i.message&&e.jsxs("span",{children:[': "',i.message,'"']})]},_))})]})]})]})]})]})})]})]})})}const Xt="CAI4T7uO84K4nuLMXMVQ",lr=`https://api.maptiler.com/maps/streets-v2/style.json?key=${Xt}`,Io="",Va="",zo="http://localhost:4176/";let Cs=null;const or=()=>window.maplibregl?Promise.resolve(window.maplibregl):Cs||(Cs=new Promise((t,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css",document.head.appendChild(n);const r=document.createElement("script");r.src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js",r.async=!0,r.onload=()=>t(window.maplibregl),r.onerror=()=>a(new Error("MapLibre failed to load")),document.head.appendChild(r)}),Cs),$o=[{label:"TOMOSHIBIについて",href:"/about"},{label:"特徴",href:"#features"},{label:"遊び方",href:"#how-it-works"},{label:"シーン",href:"#scenes"},{label:"クリエイターの方へ",href:"#creators"},{label:"FAQ",href:"#faq"},{label:"お問い合わせ",href:"#contact"}],Mo=[{label:"対応エリア",value:"Coming Soon"},{label:"クエスト数",value:"50+"},{label:"プレイヤー数",value:"10,000+"}],Po=[{title:"スマホひとつで完結",description:"専用キットは不要。アプリ上の物語と地図、そして目の前の風景だけが手がかりです。",icon:Ms},{title:"好きなタイミングで",description:"予約もガイドも必要ありません。思い立ったその瞬間が、冒険の始まりです。",icon:yt},{title:"街の物語を体験",description:"歴史的事実や都市伝説に基づいたオリジナルストーリーで、見慣れた街が違って見えます。",icon:wt},{title:"絆を深める体験",description:"協力して謎を解くことで、友人やパートナー、家族との会話が自然と弾みます。",icon:lt}],ra=[{title:"デートを冒険に",target:"Couples",description:"ただの散歩が、二人だけの秘密の探検に。協力して謎を解く過程で、相手の意外な一面が見えるかも。",icon:Ps,image:"https://picsum.photos/600/400?random=1"},{title:"家族で街育",target:"Family",description:"お子様と一緒に街の歴史や文化を楽しく学べます。宝探し感覚で、好奇心を刺激する休日を。",icon:xs,image:"https://picsum.photos/600/400?random=2"},{title:"仲間とチームビルディング",target:"Group",description:"会社の研修やサークルのイベントに。役割分担とコミュニケーションが攻略の鍵となります。",icon:ha,image:"https://picsum.photos/600/400?random=3"}],na=[{key:"welcome",title:"Welcome",caption:"イントロダクション",icon:Be,description:"TOMOSHIBIへようこそ。街歩き謎解きの制作フローを3分でご案内します。"},{key:"concept",title:"Concept",caption:"物語×社会貢献",icon:Ps,description:"物語と街のリアリティを高めるために、ソーシャルアクションを任意で組み込めます。"},{key:"how",title:"How to Build",caption:"謎とスポットの基本",icon:ua,description:"チェックイン地点を配置し、謎・ヒント・導線を設定。Questoのようにテンポよく進められます。"},{key:"start",title:"Let's Start",caption:"制作開始",icon:ds,description:"準備完了。下書きから始めてテストプレイで磨きましょう。"}],kt=({className:t="h-8",color:a="#484132"})=>e.jsxs("svg",{viewBox:"0 0 220 40",className:t,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"TOMOSHIBI Logo",children:[e.jsx("text",{x:"0",y:"30",fontSize:"28",fontWeight:"bold",fontFamily:"'Noto Sans JP', sans-serif",fill:a,letterSpacing:"0.05em",children:"TOMOSHIBI"}),e.jsxs("g",{transform:"translate(175, 4)",children:[e.jsx("path",{d:"M16 0C7.2 0 0 7.2 0 16C0 22.1 3.4 27.3 8.3 30V36H23.7V30C28.6 27.3 32 22.1 32 16C32 7.2 24.8 0 16 0Z",fill:a}),e.jsx("path",{d:"M16 26C16 26 21 20 21 14C21 11 19 9 16 6C13 9 11 11 11 14C11 20 16 26 16 26Z",fill:"#fbbf24"}),e.jsx("path",{d:"M16 3V5",stroke:"#fbbf24",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M9 6L10.5 7.5",stroke:"#fbbf24",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M23 6L21.5 7.5",stroke:"#fbbf24",strokeWidth:"2",strokeLinecap:"round"})]})]}),Yt=({children:t,subtitle:a})=>e.jsxs("div",{className:"text-center mb-16 px-4",children:[e.jsx(N.h2,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"text-3xl md:text-4xl font-serif font-bold text-brand-dark mb-4",children:t}),a&&e.jsx(N.p,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:.1},className:"text-stone-500 max-w-2xl mx-auto text-sm md:text-base leading-relaxed",children:a}),e.jsx("div",{className:"w-16 h-1 bg-brand-gold mx-auto mt-6 rounded-full"})]}),Ao=({t})=>{const[a,n]=o.useState({plays:100,price:500}),r=Math.floor(a.plays*a.price*.7);return e.jsx("div",{className:"py-24 relative overflow-hidden bg-stone-900 text-white",children:e.jsx("div",{className:"container mx-auto px-4 relative z-10",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-16 items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-brand-gold/20 text-brand-gold text-xs font-bold mb-6 border border-brand-gold/30",children:[e.jsx(Ka,{size:14}),t.badge]}),e.jsxs("h3",{className:"text-3xl md:text-4xl font-serif font-bold mb-6",children:[t.title," ",e.jsx("br",{}),e.jsxs("span",{className:"text-stone-400",children:[" ",t.subtitle]})]}),e.jsx("p",{className:"text-stone-400 mb-10 leading-relaxed",children:t.description}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-4",children:[e.jsx("span",{className:"text-stone-300",children:t.monthlyPlayers}),e.jsxs("span",{className:"text-brand-gold",children:[a.plays.toLocaleString()," ",t.people]})]}),e.jsx("input",{type:"range",min:"10",max:"2000",step:"10",value:a.plays,onChange:m=>n({...a,plays:parseInt(m.target.value)}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-brand-gold"})]}),e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold mb-4",children:[e.jsx("span",{className:"text-stone-300",children:t.questPrice}),e.jsxs("span",{className:"text-brand-gold",children:["¥",a.price]})]}),e.jsx("input",{type:"range",min:"100",max:"2000",step:"100",value:a.price,onChange:m=>n({...a,price:parseInt(m.target.value)}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-brand-gold"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-gold/20 to-transparent blur-3xl rounded-full"}),e.jsxs("div",{className:"relative bg-white/10 backdrop-blur-xl border border-white/20 rounded-[2.5rem] p-8 md:p-12 text-center shadow-2xl",children:[e.jsx("p",{className:"text-stone-400 text-sm font-bold uppercase tracking-wider mb-2",children:t.estimatedIncome}),e.jsx("div",{className:"flex items-center justify-center gap-1 mb-2",children:e.jsxs("span",{className:"text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-stone-400 font-serif tracking-tight",children:["¥",r.toLocaleString()]})}),e.jsx("p",{className:"text-xs text-stone-500 mb-8 border-b border-white/10 pb-8",children:t.disclaimer}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-left",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-stone-400 mb-1",children:t.annualPotential}),e.jsxs("div",{className:"text-xl font-bold text-white",children:["¥",(r*12).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-stone-400 mb-1",children:t.creatorShare}),e.jsx("div",{className:"text-xl font-bold text-emerald-400",children:"70%"})]})]})]})]})]})})})})},Eo=({t})=>{const[a,n]=o.useState(0),r=[{key:"ai",title:t.tabs[0].title,description:t.tabs[0].description,icon:Be,accent:"from-violet-500 to-purple-600",size:"large",mockVisual:e.jsxs("div",{className:"w-full h-full p-6 flex flex-col justify-center gap-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-stone-200 flex-shrink-0"}),e.jsx("div",{className:"bg-white border border-stone-100 rounded-2xl rounded-tl-none p-3 shadow-sm text-xs text-stone-600 max-w-[80%]",children:t.tabs[0].promptExample})]}),e.jsxs("div",{className:"flex gap-3 flex-row-reverse",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Be,{size:14,className:"text-white"})}),e.jsxs("div",{className:"bg-violet-50 border border-violet-100 rounded-2xl rounded-tr-none p-3 shadow-sm text-xs text-stone-700 max-w-[90%]",children:[e.jsx("p",{className:"font-bold text-violet-700 mb-1",children:t.tabs[0].responseTitle}),t.tabs[0].responseText]})]}),e.jsxs("div",{className:"flex gap-2 justify-center mt-2",children:[e.jsx("div",{className:"w-20 h-2 bg-stone-100 rounded-full animate-pulse"}),e.jsx("div",{className:"w-12 h-2 bg-stone-100 rounded-full animate-pulse delay-75"})]})]})},{key:"spots",title:t.tabs[1].title,description:t.tabs[1].description,icon:Fe,accent:"from-amber-500 to-orange-600",size:"normal",mockVisual:e.jsxs("div",{className:"w-full h-full relative overflow-hidden bg-stone-100",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"radial-gradient(#a8a29e 1px, transparent 1px)",backgroundSize:"16px 16px"}}),e.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:e.jsx("path",{d:"M 80 150 Q 150 80 220 120",fill:"none",stroke:"#f59e0b",strokeWidth:"3",strokeDasharray:"6 4"})}),e.jsxs("div",{className:"absolute top-[140px] left-[70px] flex flex-col items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white border-4 border-amber-500 shadow-lg flex items-center justify-center text-xs font-bold text-stone-700",children:"1"}),e.jsx("div",{className:"bg-white px-2 py-1 rounded shadow text-[10px] font-bold mt-1 text-stone-600",children:"Start"})]}),e.jsxs("div",{className:"absolute top-[110px] left-[210px] flex flex-col items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-500 shadow-lg flex items-center justify-center text-white",children:e.jsx(Fe,{size:16})}),e.jsx("div",{className:"bg-white px-2 py-1 rounded shadow text-[10px] font-bold mt-1 text-stone-600",children:"Spot 2"})]}),e.jsx("div",{className:"absolute bottom-4 right-4 bg-white p-2 rounded-full shadow-lg border border-stone-100",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-stone-800 flex items-center justify-center text-white text-lg leading-none pb-1",children:"+"})})]})},{key:"multilingual",title:t.tabs[2].title,description:t.tabs[2].description,icon:Dt,accent:"from-sky-500 to-blue-600",size:"normal",mockVisual:e.jsxs("div",{className:"w-full h-full p-8 flex flex-col items-center justify-center gap-4",children:[e.jsxs("div",{className:"w-full bg-white border border-stone-200 rounded-xl p-4 shadow-sm relative",children:[e.jsx("div",{className:"absolute -top-3 -right-2 bg-brand-dark text-white text-[10px] px-2 py-0.5 rounded-full",children:t.tabs[2].sourceLabel}),e.jsx("p",{className:"text-sm font-bold text-stone-800",children:t.tabs[2].sourceText})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"w-1 h-8 border-l-2 border-dashed border-sky-400"})}),e.jsxs("div",{className:"w-full grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-sky-50 border border-sky-100 rounded-xl p-3 relative",children:[e.jsx("div",{className:"absolute -top-2 left-2 bg-sky-500 text-white text-[9px] px-1.5 rounded",children:"EN"}),e.jsx("p",{className:"text-xs font-medium text-sky-900 mt-1",children:t.tabs[2].enText})]}),e.jsxs("div",{className:"bg-sky-50 border border-sky-100 rounded-xl p-3 relative",children:[e.jsx("div",{className:"absolute -top-2 left-2 bg-sky-500 text-white text-[9px] px-1.5 rounded",children:"KO"}),e.jsx("p",{className:"text-xs font-medium text-sky-900 mt-1",children:t.tabs[2].koText})]})]})]})},{key:"analytics",title:t.tabs[3].title,description:t.tabs[3].description,icon:zs,accent:"from-emerald-500 to-teal-600",size:"normal",mockVisual:e.jsxs("div",{className:"w-full h-full p-6 flex flex-col justify-end",children:[e.jsxs("div",{className:"flex justify-between items-end gap-2 h-32",children:[e.jsx("div",{className:"w-1/4 bg-emerald-100 rounded-t-lg relative group",children:e.jsx("div",{className:"absolute bottom-0 w-full bg-emerald-400 rounded-t-lg transition-all duration-1000",style:{height:"60%"}})}),e.jsxs("div",{className:"w-1/4 bg-emerald-100 rounded-t-lg relative group",children:[e.jsx("div",{className:"absolute bottom-0 w-full bg-emerald-500 rounded-t-lg transition-all duration-1000 delay-100",style:{height:"85%"}}),e.jsxs("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 bg-stone-800 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:["1,234 ",t.tabs[3].playsLabel]})]}),e.jsx("div",{className:"w-1/4 bg-emerald-100 rounded-t-lg relative",children:e.jsx("div",{className:"absolute bottom-0 w-full bg-emerald-400 rounded-t-lg transition-all duration-1000 delay-200",style:{height:"45%"}})}),e.jsx("div",{className:"w-1/4 bg-emerald-100 rounded-t-lg relative",children:e.jsx("div",{className:"absolute bottom-0 w-full bg-emerald-300 rounded-t-lg transition-all duration-1000 delay-300",style:{height:"70%"}})})]}),e.jsx("div",{className:"h-px bg-emerald-200 mt-2 w-full"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-stone-400 mt-1",children:[e.jsx("span",{children:"Mon"}),e.jsx("span",{children:"Tue"}),e.jsx("span",{children:"Wed"}),e.jsx("span",{children:"Thu"})]})]})}],m=r[a];return e.jsxs("div",{className:"mb-20",children:[e.jsx(Yt,{subtitle:t.subtitle,children:t.title}),e.jsx(N.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"relative rounded-3xl bg-gradient-to-br from-white/90 via-white/80 to-stone-50/90 backdrop-blur-xl border border-white/60 shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute -top-32 -right-32 w-64 h-64 bg-gradient-to-br from-violet-200/40 to-purple-300/30 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-32 -left-32 w-64 h-64 bg-gradient-to-br from-amber-200/40 to-orange-300/30 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative grid grid-cols-1 md:grid-cols-[260px,1fr] min-h-[450px]",children:[e.jsx("div",{className:"relative border-b md:border-b-0 md:border-r border-stone-200/60 p-4 md:p-6 bg-white/40",children:e.jsx("nav",{className:"flex md:flex-col gap-2 overflow-x-auto md:overflow-visible pb-2 md:pb-0 no-scrollbar",children:r.map((g,d)=>e.jsx("button",{onClick:()=>n(d),className:`group w-full text-left p-3 md:p-4 rounded-xl transition-all duration-300 relative flex-shrink-0 md:flex-shrink ${a===d?"bg-white shadow-md ring-1 ring-stone-900/5":"hover:bg-white/50 text-stone-600"}`,children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("div",{className:`w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center transition-all duration-300 ${a===d?`bg-gradient-to-br ${g.accent} text-white shadow-sm`:"bg-stone-100 text-stone-400 group-hover:bg-stone-200"}`,children:e.jsx(g.icon,{size:18})}),e.jsx("span",{className:`font-bold text-sm md:text-base whitespace-nowrap ${a===d?"text-brand-dark":"text-stone-500"}`,children:g.title})]})},g.key))})}),e.jsx("div",{className:"p-6 md:p-10 lg:p-12 relative overflow-hidden",children:e.jsx(Ue,{mode:"wait",children:e.jsxs(N.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.3,ease:"easeOut"},className:"h-full grid lg:grid-cols-2 gap-8 items-center",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:`w-14 h-14 rounded-2xl bg-gradient-to-br ${m.accent} flex items-center justify-center mb-6 shadow-lg rotate-3`,children:e.jsx(m.icon,{size:28,className:"text-white"})}),e.jsx(N.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-2xl md:text-3xl font-bold text-brand-dark mb-4 tracking-tight",children:m.title}),e.jsx(N.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-stone-600 leading-relaxed font-medium mb-8",children:m.description}),e.jsxs(N.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"inline-flex items-center gap-2 text-brand-dark font-bold text-sm group",children:["詳しく見る",e.jsx("div",{className:"w-6 h-6 rounded-full bg-stone-100 flex items-center justify-center group-hover:bg-brand-gold group-hover:text-white transition-colors",children:e.jsx(xt,{size:14})})]})]}),e.jsx("div",{className:"relative h-[250px] lg:h-[350px] w-full",children:e.jsxs("div",{className:"absolute inset-0 bg-stone-50 rounded-2xl border border-stone-100 overflow-hidden shadow-inner translate-x-4 translate-y-4 lg:translate-x-0 lg:translate-y-0",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${m.accent} opacity-10 blur-2xl rounded-full translate-x-10 -translate-y-10`}),e.jsx("div",{className:"relative z-10 w-full h-full",children:m.mockVisual})]})})]},m.key)})})]})]})})]})},Lo=({visible:t,onPrimary:a,onDismiss:n,comingSoon:r,onScrollNotify:m})=>t?e.jsx(N.div,{initial:{y:80,opacity:0},animate:{y:0,opacity:1},exit:{y:80,opacity:0},className:"fixed bottom-0 left-0 right-0 z-40 px-4 pb-4",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur border border-stone-200 shadow-xl rounded-2xl px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-base border border-stone-200 flex items-center justify-center text-brand-gold font-bold",children:"T"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:"TOMOSHIBI アプリ"}),e.jsx("p",{className:"text-xs text-stone-500 truncate",children:"街を歩いて謎を解く “ご近所シティクエスト”"})]}),e.jsx("button",{onClick:r?m:a,className:"px-4 py-2 rounded-full bg-brand-dark text-white text-xs font-bold hover:bg-brand-gold transition-colors",children:r?"アプリをダウンロード":"アプリで始める"}),e.jsx("button",{onClick:n,className:"text-stone-400 hover:text-brand-dark",children:e.jsx(nt,{size:16})})]})}):null,Do=({steps:t,activeIndex:a,onClose:n,onNext:r})=>{const m=t[a],g=a===t.length-1;return e.jsxs("div",{className:"fixed inset-0 z-[999] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:n}),e.jsxs(N.div,{initial:{opacity:0,y:20,scale:.97},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.97},className:"relative w-[88%] max-w-5xl max-h-[82vh] bg-white rounded-3xl shadow-2xl overflow-y-auto md:overflow-hidden grid md:grid-cols-[320px,1fr] border border-white/70",children:[e.jsxs("div",{className:"bg-brand-base/80 border-r border-stone-200/70 p-6 md:p-8 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Tutorial"}),e.jsx("p",{className:"text-brand-dark font-serif text-xl",children:"新規クエストオンボーディング"})]}),e.jsx("button",{onClick:n,className:"text-stone-500 hover:text-brand-dark",children:e.jsx(nt,{size:20})})]}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx("div",{className:"absolute left-5 top-3 bottom-3 w-[2px] bg-gradient-to-b from-brand-gold/60 via-brand-dark/30 to-transparent"}),e.jsx("div",{className:"space-y-6 relative",children:t.map((d,u)=>{const x=u===a,b=u<a;return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full border-2 flex items-center justify-center ${x?"border-brand-gold bg-white text-brand-gold shadow":"border-stone-300 bg-white text-stone-400"}`,children:b?e.jsx(ot,{size:18}):e.jsx(d.icon,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-stone-500",children:d.title}),e.jsx("p",{className:`font-bold ${x?"text-brand-dark":"text-stone-500"}`,children:d.caption})]})]},d.key)})})]})]}),e.jsxs("div",{className:"p-6 md:p-8 relative overflow-y-auto flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold mb-2",children:m.title}),e.jsx("h2",{className:"text-2xl md:text-3xl font-serif font-bold text-brand-dark leading-tight",children:"Let's light up the town with your story"}),e.jsx("p",{className:"text-stone-600 mt-3",children:m.description})]}),e.jsx("button",{onClick:n,className:"text-stone-400 hover:text-brand-dark md:hidden",children:e.jsx(nt,{size:20})})]}),e.jsxs("div",{className:"flex-1 min-h-0 space-y-3",children:[e.jsxs("div",{className:"rounded-2xl border border-stone-200 bg-brand-base/80 p-5 shadow-inner",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-dark text-white flex items-center justify-center",children:e.jsx(zt,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Quick Guide"}),e.jsx("p",{className:"text-brand-dark font-bold",children:"3分で流れを確認"})]})]}),e.jsxs("ul",{className:"text-sm text-stone-700 space-y-2 list-disc list-inside",children:[e.jsx("li",{children:"物語の骨子と街のテーマを決める"}),e.jsx("li",{children:"マップにスポットを配置し、謎とヒントを登録"}),e.jsx("li",{children:"任意でソーシャルアクションを追加して深みを出す"}),e.jsx("li",{children:"テストプレイで導線をチェックして公開"})]})]}),e.jsx("p",{className:"text-sm text-stone-600 leading-relaxed",children:"下の「Next」でステップを進めてください。制作画面に入る前に全体像を掴めます。"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsxs("div",{className:"text-xs text-stone-500",children:[a+1," / ",t.length]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:"text-sm font-bold text-stone-500 hover:text-brand-dark",children:"スキップ"}),e.jsx("button",{onClick:r,className:"px-5 py-3 rounded-full bg-brand-dark text-white text-sm font-bold hover:bg-brand-gold transition-colors",children:g?"制作をはじめる":"Next"})]})]})]})]})]})},Oo=({email:t,onLogout:a,onBackHome:n,onGoCreators:r,onGoQuests:m,onOpenOnboarding:g,onGoCreatorStart:d,quests:u,onOpenWorkspace:x,onOpenAnalytics:b,onDeleteQuest:f,t:v})=>{const p=t.charAt(0).toUpperCase(),i=u.length>0;return e.jsxs("section",{className:"min-h-screen bg-gradient-to-br from-brand-base via-white to-brand-base/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-brand-gold/10 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute bottom-[-10%] left-[-5%] w-[400px] h-[400px] bg-amber-200/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((_,w)=>e.jsx("div",{className:"absolute w-2 h-2 bg-brand-gold/30 rounded-full",style:{left:`${15+w*15}%`,top:`${20+w%3*25}%`,animation:`float ${3+w*.5}s ease-in-out infinite alternate`,animationDelay:`${w*.3}s`}},w))}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 pt-28 pb-16 relative z-10",children:[e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2 text-sm text-stone-500 mb-8",children:[e.jsxs("button",{onClick:n,className:"hover:text-brand-dark transition-colors flex items-center gap-1",children:[e.jsx(an,{size:16}),v.home]}),e.jsx("span",{className:"text-stone-300",children:"/"}),e.jsx("span",{className:"text-brand-dark font-bold",children:v.myPage})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white/70 backdrop-blur-xl border border-white/80 rounded-3xl p-8 md:p-10 shadow-2xl shadow-stone-200/50 mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-gold via-amber-400 to-orange-500 rounded-full blur-md opacity-50 animate-pulse"}),e.jsx("div",{className:"relative w-20 h-20 md:w-24 md:h-24 rounded-full bg-gradient-to-br from-brand-dark to-stone-700 text-white flex items-center justify-center text-3xl md:text-4xl font-serif font-bold shadow-xl ring-4 ring-white",children:p}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 bg-emerald-500 rounded-full border-3 border-white flex items-center justify-center",children:e.jsx(ot,{size:14,className:"text-white"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx("span",{className:"px-3 py-1 rounded-full bg-gradient-to-r from-brand-gold/20 to-amber-100 text-brand-gold text-xs font-bold uppercase tracking-wider border border-brand-gold/20",children:i?"Creator":"Explorer"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-serif font-bold text-brand-dark mb-1",children:t}),e.jsx("p",{className:"text-stone-500 text-sm",children:v.exploreTomoshibi})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(N.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:g,className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-brand-dark to-stone-700 text-white text-sm font-bold hover:shadow-xl hover:shadow-brand-dark/20 transition-all flex items-center justify-center gap-2",children:[e.jsx(Be,{size:16}),v.createNewQuest]}),e.jsxs("button",{onClick:a,className:"px-4 py-2 rounded-xl text-sm text-stone-500 hover:text-rose-600 hover:bg-rose-50 transition-all flex items-center justify-center gap-1",children:[e.jsx(Mn,{size:14}),v.logout||"ログアウト"]})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"lg:col-span-1 space-y-4",children:[e.jsx("div",{className:"bg-white/70 backdrop-blur-xl border border-white/80 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-brand-gold/20 to-amber-100 flex items-center justify-center",children:e.jsx(wt,{size:24,className:"text-brand-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-brand-dark",children:u.length}),e.jsx("p",{className:"text-xs text-stone-500 font-medium",children:v.questsCreated})]})]})}),e.jsxs("div",{className:"bg-white/50 backdrop-blur border border-stone-200/50 rounded-2xl p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-stone-100 text-stone-400 text-[10px] font-bold",children:"Coming Soon"})}),e.jsxs("div",{className:"flex items-center gap-4 opacity-60",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-stone-100 flex items-center justify-center",children:e.jsx(zs,{size:24,className:"text-stone-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-stone-400",children:v.playHistory}),e.jsx("p",{className:"text-xs text-stone-400",children:v.statsDashboard})]})]})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-xl border border-white/80 rounded-2xl p-6 shadow-lg",children:[e.jsxs("h3",{className:"text-sm font-bold text-brand-dark mb-3 flex items-center gap-2",children:[e.jsx(Ya,{size:16,className:"text-brand-gold"}),v.notificationSettings]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"w-5 h-5 rounded-md border-2 border-stone-300 text-brand-gold accent-brand-gold focus:ring-brand-gold/20 transition-all"}),e.jsx("span",{className:"text-sm text-stone-600 group-hover:text-brand-dark transition-colors",children:v.receiveEmailNotifications})]})]})]}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-xl border border-white/80 rounded-2xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-stone-100 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-brand-dark flex items-center gap-2",children:[e.jsx(ua,{size:18,className:"text-brand-gold"}),v.yourQuests]}),i&&e.jsx("span",{className:"text-xs text-stone-400",children:v.questsCount(u.length)})]}),e.jsx("div",{className:"p-4 space-y-3",children:i?u.map((_,w)=>e.jsx(N.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*w},className:"group bg-white border border-stone-100 rounded-xl p-4 hover:border-brand-gold/30 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-brand-gold/20 to-amber-100 flex items-center justify-center text-brand-gold font-bold text-sm shrink-0",children:String(w+1).padStart(2,"0")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-brand-dark truncate group-hover:text-brand-gold transition-colors",children:_.title||v.untitledQuest}),e.jsxs("p",{className:"text-xs text-stone-500 truncate flex items-center gap-1",children:[e.jsx(Fe,{size:10}),_.area_name||v.noArea]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>x(_),className:"px-4 py-2 rounded-lg bg-brand-dark text-white text-xs font-bold hover:bg-brand-gold transition-colors flex items-center gap-1.5",children:[e.jsx(On,{size:12}),v.edit]}),e.jsxs(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>b(_),className:"px-4 py-2 rounded-lg border border-stone-200 text-stone-600 text-xs font-bold hover:border-brand-gold hover:text-brand-gold transition-colors flex items-center gap-1.5",children:[e.jsx(zs,{size:12}),v.analytics]}),e.jsx(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f(_),className:"p-2 rounded-lg border border-stone-200 text-stone-400 text-xs font-bold hover:border-rose-300 hover:text-rose-600 hover:bg-rose-50 transition-colors",title:v.delete||"削除",children:e.jsx(ma,{size:14})})]})]})},_.id)):e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},className:"py-12 px-6 text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-brand-gold/20 to-amber-100 flex items-center justify-center",children:e.jsx(Be,{size:32,className:"text-brand-gold"})}),e.jsx("h4",{className:"text-lg font-bold text-brand-dark mb-2",children:v.noQuestsYet}),e.jsx("p",{className:"text-sm text-stone-500 mb-6 max-w-sm mx-auto",children:v.emptyStateMessage}),e.jsx(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:g,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-brand-gold to-amber-500 text-white font-bold text-sm hover:shadow-lg hover:shadow-brand-gold/30 transition-all",children:v.createFirstQuest})]})})]})})]})]}),e.jsx("style",{children:`
        @keyframes float {
          0% { transform: translateY(0px) scale(1); opacity: 0.3; }
          100% { transform: translateY(-20px) scale(1.2); opacity: 0.6; }
        }
      `})]})};function Ro({onBack:t,onPreview:a,activeStep:n,setActiveStep:r,onGoStep2:m,onGoStep3:g,onGoStep4:d,onPublish:u,onLogoHome:x,onGoStep1:b,showAnalytics:f=!0,analytics:v=[],analyticsFilter:p="all",onChangeAnalyticsFilter:i,onOpenDetail:_,detailQuestAnalytics:w,detailLoading:B,onAiGenerateDraft:L,aiDraftLoading:O,aiDraftError:R,onDeleteQuest:be,deleteLoading:Y,questId:ee,onGoMultilingual:P,questMode:he="PRIVATE",onPlayNow:re,onOpenShareModal:xe,onOpenPublishModal:te,isPaidUser:A=!1}){const[Z,me]=o.useState(!1),[E,V]=o.useState(null),[oe,ke]=o.useState(!1),[je,ie]=o.useState({area:"",theme:"",difficulty:"中級",target:"",targetLanguages:["日本語"],notes:"",spotCount:"7",estimatedPlayTime:"",artStyle:"",storyTone:"",characterCount:"",specialRequirements:"",includeSpots:"",challengeTypes:["謎","クイズ","ミッション"]}),Se=async()=>{V(null);try{await L(je),V("叩き台をワークスペースに反映しました。")}catch{}},fe=[{step:1,key:"basic",title:"基本情報",subtitle:"Basic Info",description:"タイトル、開催エリア、概要の設定が完了しました。",ribbon:"🎉 設定完了！いつでも編集できます (Completed!)",icon:ot,editable:!0,emoji:"🎉"},{step:2,key:"spots",title:"スポット & 謎",subtitle:"Spots & Puzzles",description:"地図上でチェックポイントを決め、それぞれの場所で出題する謎や手がかりを作成します。",icon:ua,todoLink:!0,emoji:"🗺️"},{step:3,key:"story",title:"ストーリー",subtitle:"Storytelling",description:"スポット間を繋ぐストーリーの執筆や、クリア時の演出、登場人物のセリフなどを追加します。",icon:zt,emoji:"📖"},{step:4,key:"multilingual",title:"多言語対応",subtitle:"Multilingual",description:"AIで多言語版を自動生成。インバウンド観光客にクエストを届けましょう。",icon:Dt,emoji:"🌐",isPanel:!0},{step:5,key:"test",title:"テストラン",subtitle:"Test Run",description:"実際にプレイヤーとしてクエストを体験し、謎の難易度やストーリーの流れを最終確認します。",icon:Ms,emoji:"🎮"},{step:6,key:"publish",title:"公開",subtitle:"Publish",description:"最終確認を行い、TOMOSHIBIへ公開申請をします。審査を通過すれば、あなたのクエストが世界に公開されます！",icon:ds,emoji:"🚀"}],Me=c=>{if(!ee)return"idle";const h=localStorage.getItem(`step-status:${ee}:${c.step}`);return h==="completed"?"done":h==="in_progress"?"active":"idle"},C=fe.filter(c=>Me(c)==="done").length,ve=fe.filter(c=>Me(c)==="active").length,de=Math.round((C+ve*.5)/fe.length*100),I=c=>c!=null?`${c} 分`:"—";return e.jsxs("section",{className:"min-h-screen bg-stone-50/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-96 bg-gradient-to-b from-brand-base/20 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute top-[-10%] right-[-5%] w-[500px] h-[500px] bg-brand-gold/5 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-stone-100 shadow-sm transition-all duration-300",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-8 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:x,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-7 w-auto"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:a,className:"hidden md:flex px-5 py-2 rounded-full border border-stone-200 bg-white text-sm font-bold text-stone-700 hover:border-brand-gold hover:text-brand-gold hover:shadow-md transition-all items-center gap-2",children:[e.jsx(Aa,{size:16}),"Preview"]}),e.jsx("div",{className:"h-6 w-px bg-stone-200 mx-1 hidden md:block"}),e.jsx("button",{onClick:t,className:"text-sm font-bold text-stone-500 hover:text-brand-dark transition-colors",children:"Exit"})]})]})}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 py-10 max-w-6xl relative z-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-end justify-between gap-6 mb-12",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-full bg-brand-dark/5 text-brand-dark text-xs font-bold uppercase tracking-wider",children:"Creator Studio"}),n===5&&e.jsxs("span",{className:"px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold flex items-center gap-1",children:[e.jsx(ot,{size:12})," 公開準備完了"]})]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-serif font-bold text-brand-dark mb-4 tracking-tight",children:"Project Workspace"}),e.jsx("p",{className:"text-stone-500 max-w-xl text-lg leading-relaxed",children:"クエスト制作の進捗管理画面です。ステップ順に進めて、あなたの物語を街に解き放ちましょう。"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-sm border border-stone-100 w-full md:w-72",children:[e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-stone-400 uppercase tracking-wide",children:"Total Progress"}),e.jsxs("span",{className:"text-2xl font-bold text-brand-dark",children:[de,e.jsx("span",{className:"text-base text-stone-400 font-normal",children:"%"})]})]}),e.jsx("div",{className:"h-2 w-full bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-brand-gold to-orange-400 rounded-full transition-all duration-1000 ease-out",style:{width:`${de}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:be,disabled:Y,className:"px-4 py-2 rounded-lg text-xs font-bold text-rose-600 hover:bg-rose-50 transition-colors disabled:opacity-50",children:Y?"削除中...":"クエストを削除する"}),e.jsxs("button",{onClick:()=>me(!0),className:"px-4 py-2 rounded-lg border border-indigo-200 bg-indigo-50 text-indigo-700 text-xs font-bold hover:bg-indigo-100 hover:border-indigo-300 transition-colors flex items-center gap-1.5",children:[e.jsx(Be,{size:14})," AIでたたき台を作成する"]})]}),e.jsxs("div",{className:"flex flex-col gap-3 w-full md:w-auto mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"現在のモード:"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold border ${he==="PRIVATE"?"bg-stone-100 text-stone-700 border-stone-200":he==="SHARE"?"bg-sky-100 text-sky-700 border-sky-200":"bg-emerald-100 text-emerald-700 border-emerald-200"}`,children:he==="PRIVATE"?"🔒 自分用 (Private)":he==="SHARE"?"🔗 限定共有 (Share)":"🌐 公開 (Publish)"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:re,className:"px-4 py-2.5 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white text-sm font-bold hover:from-violet-600 hover:to-purple-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(Aa,{size:16}),"今すぐ遊ぶ"]}),e.jsxs("button",{onClick:xe,className:"px-4 py-2.5 rounded-xl bg-gradient-to-r from-sky-500 to-cyan-500 text-white text-sm font-bold hover:from-sky-600 hover:to-cyan-600 transition-all shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(Dt,{size:16}),"共有する"]}),A?e.jsxs("button",{onClick:te,className:"px-4 py-2.5 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-sm font-bold hover:from-emerald-600 hover:to-teal-600 transition-all shadow-md hover:shadow-lg flex items-center gap-2",children:[e.jsx(ds,{size:16}),"公開する"]}):e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{disabled:!0,className:"px-4 py-2.5 rounded-xl bg-stone-200 text-stone-400 text-sm font-bold cursor-not-allowed flex items-center gap-2",children:[e.jsx(ds,{size:16}),"公開する"]}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-stone-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"有料プランで公開機能が利用できます"})]})]})]})]})]}),f&&v.length>0&&e.jsxs("div",{className:"mb-12 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-brand-dark flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-brand-gold/10 rounded-lg text-brand-gold",children:e.jsx(Ot,{size:18})}),"Quick Analytics"]}),e.jsx("div",{className:"flex bg-white rounded-lg p-1 border border-stone-200 shadow-sm",children:["all","30d"].map(c=>e.jsx("button",{onClick:()=>i==null?void 0:i(c),className:`px-3 py-1 rounded-md text-xs font-bold transition-all ${p===c?"bg-brand-dark text-white shadow-sm":"text-stone-500 hover:bg-stone-50"}`,children:c==="all"?"All Time":"Last 30 Days"},c))})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:v.map(c=>{var h;return e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-stone-100 shadow-sm hover:shadow-md transition-all cursor-pointer group",onClick:()=>_==null?void 0:_(c.questId,c.title),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"text-xs text-stone-400 font-bold uppercase truncate flex-1",children:c.title}),e.jsx(xt,{size:14,className:"text-stone-300 group-hover:text-brand-gold transition-colors"})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-3",children:[e.jsx("span",{className:"text-3xl font-bold text-brand-dark",children:c.playCount}),e.jsx("span",{className:"text-xs text-stone-500 mb-1 font-bold",children:"Plays"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] font-bold text-emerald-700 bg-emerald-50 border border-emerald-100 px-2 py-0.5 rounded-full",children:[Math.round(c.clearRate*100),"% Clear"]}),e.jsxs("span",{className:"text-[10px] font-bold text-amber-700 bg-amber-50 border border-amber-100 px-2 py-0.5 rounded-full",children:["★ ",((h=c.avgRating)==null?void 0:h.toFixed(1))||"-"]})]})]},c.questId)})})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:fe.map(c=>{const h=Me(c),k=h==="active",z=h==="done",K="relative rounded-3xl p-6 border transition-all duration-300 flex flex-col h-full",y="bg-white border-stone-200 hover:border-brand-gold/30 hover:shadow-md shadow-sm",M=()=>{if(c.step===1){r(1),b();return}if(c.step===2){m();return}if(c.step===3){r(3),g();return}if(c.step===4){P();return}if(c.step===5){r(5),d();return}if(c.step===6){r(6),u();return}};return e.jsxs("div",{className:`${K} ${y} ${z?"ring-2 ring-emerald-200":""}`,children:[e.jsx("div",{className:"absolute -top-2 -left-2 w-8 h-8 rounded-full bg-brand-dark text-white text-sm font-bold flex items-center justify-center shadow-lg z-10",children:c.step}),z&&e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-lg z-10",children:e.jsx(ot,{size:18})}),e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center text-xl shadow-inner ${z?"bg-emerald-100 text-emerald-600":k?"bg-brand-gold/20 text-brand-gold":"bg-stone-100 text-stone-500"}`,children:e.jsx(c.icon,{size:24})}),e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded-full ${z?"bg-emerald-100 text-emerald-700":k?"bg-amber-100 text-amber-700":"bg-stone-100 text-stone-500"}`,children:z?"完了":k?"進行中":"未着手"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-xl font-bold mb-1 ${z?"text-emerald-700":k?"text-brand-dark":"text-stone-700"}`,children:c.title}),e.jsx("p",{className:"text-xs font-bold text-stone-400 uppercase tracking-wider mb-3",children:c.subtitle}),e.jsx("p",{className:"text-sm text-stone-500 leading-relaxed mb-6",children:c.description})]}),e.jsx("div",{className:"pt-4 mt-auto border-t border-stone-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-stone-400",children:["STEP ",c.step]}),e.jsxs("button",{onClick:M,className:`px-5 py-2 rounded-full text-sm font-bold flex items-center gap-2 transition-all ${z?"bg-emerald-100 text-emerald-700 hover:bg-emerald-200":"bg-stone-100 text-stone-600 hover:bg-brand-dark hover:text-white"}`,children:[z?"編集する":"開始する",e.jsx(xt,{size:14})]})]})})]},c.step)})})]}),w&&e.jsxs("div",{className:"mt-6 border-t border-stone-100 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500",children:"詳細分析"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:w.title||"クエスト詳細"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[B&&e.jsx("span",{className:"text-xs text-stone-500",children:"読み込み中..."}),e.jsx("button",{onClick:()=>{_==null||_("","")},className:"text-xs text-stone-600 hover:underline",children:"閉じる"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-2xl bg-amber-50 border border-amber-100",children:[e.jsx("p",{className:"text-xs text-amber-700",children:"プレイ数"}),e.jsx("p",{className:"text-lg font-bold text-brand-dark",children:w.summary.playCount})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-emerald-50 border border-emerald-100",children:[e.jsx("p",{className:"text-xs text-emerald-700",children:"クリア率"}),e.jsxs("p",{className:"text-lg font-bold text-brand-dark",children:[w.summary.clearRate,"%"]})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-sky-50 border border-sky-100",children:[e.jsx("p",{className:"text-xs text-sky-700",children:"平均時間"}),e.jsx("p",{className:"text-lg font-bold text-brand-dark",children:I(w.summary.avgDurationMin)})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-stone-50 border border-stone-200",children:[e.jsx("p",{className:"text-xs text-stone-600",children:"平均ヒント / 誤答"}),e.jsxs("p",{className:"text-lg font-bold text-brand-dark",children:[w.summary.avgHints??"—","/",w.summary.avgWrongs??"—"]})]}),e.jsxs("div",{className:"p-3 rounded-2xl bg-rose-50 border border-rose-100",children:[e.jsx("p",{className:"text-xs text-rose-700",children:"平均評価"}),e.jsx("p",{className:"text-lg font-bold text-brand-dark",children:w.reviews.avgRating!=null?`★${w.reviews.avgRating} (${w.reviews.count}件)`:"—"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-2xl border border-stone-100",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-stone-50 text-stone-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 text-left",children:"ステップ"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"到達"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"完了"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"離脱率"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"平均ヒント"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"平均誤答"})]})}),e.jsx("tbody",{children:w.steps.map(c=>e.jsxs("tr",{className:"border-t border-stone-100",children:[e.jsxs("td",{className:"py-2 px-3",children:[e.jsxs("div",{className:"font-semibold text-brand-dark",children:[c.step,". ",c.name]}),e.jsx("div",{className:"mt-1 h-2 bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${Math.min(100,Math.max(0,c.completed/Math.max(1,c.reached)*100))}%`}})})]}),e.jsx("td",{className:"py-2 px-3 text-right",children:c.reached}),e.jsx("td",{className:"py-2 px-3 text-right",children:c.completed}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[Math.round(c.dropRate*100),"%"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:c.avgHints??"—"}),e.jsx("td",{className:"py-2 px-3 text-right",children:c.avgWrongs??"—"})]},c.step))})]})}),e.jsx("p",{className:"text-[11px] text-stone-500",children:"離脱率は「そのステップに到達したセッションのうち完了しなかった割合」の簡易計算です。ヒント/誤答がステップ単位で無い場合は平均値を分配して表示しています。"}),e.jsxs("div",{className:"mt-4 rounded-2xl border border-stone-100 bg-stone-50/60 p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-bold text-brand-dark",children:"レビュー"}),e.jsx("span",{className:"text-xs text-stone-500",children:w.reviews.avgRating!=null?`平均 ★${w.reviews.avgRating} / ${w.reviews.count} 件`:"まだレビューがありません"})]}),w.reviews.count>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-5 gap-2 text-xs",children:w.reviews.distribution.slice().sort((c,h)=>h.score-c.score).map(c=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-stone-600",children:[e.jsxs("span",{children:["★",c.score]}),e.jsx("span",{children:c.count})]}),e.jsx("div",{className:"h-2 bg-white border border-stone-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:`${w.reviews.count?Math.min(100,c.count/w.reviews.count*100):0}%`}})})]},c.score))}),e.jsxs("div",{className:"space-y-2 text-sm",children:[w.reviews.latest.map((c,h)=>e.jsxs("div",{className:"rounded-xl bg-white border border-stone-200 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-stone-600",children:[e.jsx("span",{className:"font-semibold text-amber-700",children:"★".repeat(c.rating)}),e.jsx("span",{children:c.created_at?new Date(c.created_at).toLocaleDateString("ja-JP"):""})]}),c.comment&&e.jsx("p",{className:"text-sm text-stone-700 mt-1 whitespace-pre-wrap",children:c.comment})]},h)),w.reviews.latest.length===0&&e.jsx("p",{className:"text-xs text-stone-500",children:"レビューはまだありません。"})]})]})]})]})]}),Z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-amber-700 font-bold uppercase",children:"AI Assist"}),e.jsx("h3",{className:"text-xl font-bold text-brand-dark",children:"AIで叩き台を作る"}),e.jsx("p",{className:"text-sm text-stone-600 mt-1",children:"エリアやテーマなどを入力すると、Geminiがクエストの初期案（タイトル・概要・スポット案・ストーリー案）を生成し、各ステップに反映します。"})]}),e.jsx("button",{onClick:()=>me(!1),className:"text-stone-500 hover:text-brand-dark transition-colors text-sm",children:"閉じる"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"エリア・場所"}),e.jsx("input",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",placeholder:"例: 神田、京都祇園など",value:je.area,onChange:c=>ie(h=>({...h,area:c.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"テーマ・モチーフ"}),e.jsx("input",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",placeholder:"例: 文豪ミステリー、レトロ喫茶めぐり",value:je.theme,onChange:c=>ie(h=>({...h,theme:c.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"難易度"}),e.jsxs("select",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",value:je.difficulty,onChange:c=>ie(h=>({...h,difficulty:c.target.value})),children:[e.jsx("option",{value:"初級",children:"初級"}),e.jsx("option",{value:"中級",children:"中級"}),e.jsx("option",{value:"上級",children:"上級"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"想定ターゲット"}),e.jsx("input",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",placeholder:"例: カップル、家族、インバウンド観光客など",value:je.target,onChange:c=>ie(h=>({...h,target:c.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-2",children:"対応言語"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 bg-stone-100 rounded-xl cursor-not-allowed opacity-75 shrink-0",children:[e.jsx("input",{type:"checkbox",checked:!0,disabled:!0,className:"w-4 h-4 rounded border-stone-300"}),e.jsx("span",{className:"text-sm whitespace-nowrap",children:"JA (日本語)"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-stone-200 rounded-xl cursor-pointer hover:border-brand-gold/50 transition-colors shrink-0",children:[e.jsx("input",{type:"checkbox",checked:je.targetLanguages.includes("英語"),onChange:c=>{c.target.checked?ie(h=>({...h,targetLanguages:[...h.targetLanguages,"英語"]})):ie(h=>({...h,targetLanguages:h.targetLanguages.filter(k=>k!=="英語")}))},className:"w-4 h-4 rounded border-stone-300 text-brand-gold focus:ring-brand-gold"}),e.jsx("span",{className:"text-sm whitespace-nowrap",children:"EN (英語)"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-stone-200 rounded-xl cursor-pointer hover:border-brand-gold/50 transition-colors shrink-0",children:[e.jsx("input",{type:"checkbox",checked:je.targetLanguages.includes("韓国語"),onChange:c=>{c.target.checked?ie(h=>({...h,targetLanguages:[...h.targetLanguages,"韓国語"]})):ie(h=>({...h,targetLanguages:h.targetLanguages.filter(k=>k!=="韓国語")}))},className:"w-4 h-4 rounded border-stone-300 text-brand-gold focus:ring-brand-gold"}),e.jsx("span",{className:"text-sm whitespace-nowrap",children:"KO (한국어)"})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>ke(!oe),className:"flex items-center gap-2 text-sm font-bold text-indigo-600 hover:text-indigo-800 transition-colors",children:[e.jsx(Nt,{size:16,className:`transition-transform duration-200 ${oe?"rotate-180":""}`}),oe?"詳細設定を閉じる":"詳細設定を開く"]}),oe&&e.jsxs("div",{className:"mt-4 p-4 bg-stone-50 rounded-xl border border-stone-200 space-y-4",children:[e.jsx("p",{className:"text-xs text-stone-500 mb-3",children:"より詳細な情報を提供することで、AIがより精度の高いクエストを生成できます。"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"スポット数"}),e.jsxs("select",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40 bg-white",value:je.spotCount||"7",onChange:c=>ie(h=>({...h,spotCount:c.target.value})),children:[e.jsx("option",{value:"5",children:"5スポット（短め）"}),e.jsx("option",{value:"6",children:"6スポット"}),e.jsx("option",{value:"7",children:"7スポット（推奨）"}),e.jsx("option",{value:"8",children:"8スポット"}),e.jsx("option",{value:"10",children:"10スポット（長め）"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"想定プレイ時間"}),e.jsxs("select",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40 bg-white",value:je.estimatedPlayTime||"",onChange:c=>ie(h=>({...h,estimatedPlayTime:c.target.value})),children:[e.jsx("option",{value:"",children:"自動（AIにおまかせ）"}),e.jsx("option",{value:"30分",children:"30分程度"}),e.jsx("option",{value:"1時間",children:"1時間程度"}),e.jsx("option",{value:"1.5時間",children:"1.5時間程度"}),e.jsx("option",{value:"2時間",children:"2時間程度"}),e.jsx("option",{value:"2時間以上",children:"2時間以上"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"アートスタイル・世界観"}),e.jsx("input",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",placeholder:"例: レトロ、ファンタジー、サイバーパンク、和風など",value:je.artStyle||"",onChange:c=>ie(h=>({...h,artStyle:c.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"物語のトーン"}),e.jsx("input",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",placeholder:"例: シリアス、コメディ、ほのぼの、ホラーなど",value:je.storyTone||"",onChange:c=>ie(h=>({...h,storyTone:c.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"登場人物の人数"}),e.jsxs("select",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40 bg-white",value:je.characterCount||"",onChange:c=>ie(h=>({...h,characterCount:c.target.value})),children:[e.jsx("option",{value:"",children:"自動（AIにおまかせ）"}),e.jsx("option",{value:"2",children:"2人（最小）"}),e.jsx("option",{value:"3",children:"3人"}),e.jsx("option",{value:"4",children:"4人（標準）"}),e.jsx("option",{value:"5",children:"5人以上"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"特別な指定・要件"}),e.jsx("textarea",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",rows:2,placeholder:"例: 特定の歴史人物を登場させたい、謎解きに暗号を使いたい、ラストは感動的に、など",value:je.specialRequirements||"",onChange:c=>ie(h=>({...h,specialRequirements:c.target.value}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-1",children:"含めたいスポット（任意）"}),e.jsx("textarea",{className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",rows:2,placeholder:"例: 東京タワー、増上寺、芝公園など（改行またはカンマで区切り）",value:je.includeSpots||"",onChange:c=>ie(h=>({...h,includeSpots:c.target.value}))}),e.jsx("p",{className:"text-[10px] text-stone-400 mt-1",children:"指定したスポットは必ずルートに含められます"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-stone-600 mb-2",children:"スポットで出題するチャレンジタイプ"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"謎",label:"謎解き",desc:"論理パズルや暗号など"},{value:"クイズ",label:"クイズ",desc:"知識を問う質問"},{value:"ミッション",label:"ミッション",desc:"写真撮影や行動タスク"}].map(c=>e.jsxs("label",{className:`flex items-center gap-3 px-4 py-3 rounded-xl border cursor-pointer transition-all ${(je.challengeTypes||[]).includes(c.value)?"border-brand-gold bg-brand-gold/10":"border-stone-200 bg-white hover:border-stone-300"}`,children:[e.jsx("input",{type:"checkbox",checked:(je.challengeTypes||[]).includes(c.value),onChange:h=>{h.target.checked?ie(k=>({...k,challengeTypes:[...k.challengeTypes||[],c.value]})):ie(k=>({...k,challengeTypes:(k.challengeTypes||[]).filter(z=>z!==c.value)}))},className:"w-4 h-4 rounded border-stone-300 text-brand-gold focus:ring-brand-gold"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-bold text-stone-700",children:c.label}),e.jsx("p",{className:"text-[10px] text-stone-400",children:c.desc})]})]},c.value))}),e.jsx("p",{className:"text-[10px] text-stone-400 mt-2",children:"選択したタイプからAIがバランス良くチャレンジを生成します"})]})]})]})]}),R&&e.jsxs("p",{className:"text-sm text-red-600 mb-2",children:["エラー: ",R]}),E&&e.jsx("p",{className:"text-sm text-emerald-700 mb-2",children:E}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>me(!1),className:"px-4 py-2 rounded-full border border-stone-300 text-sm font-bold text-stone-700 hover:border-brand-gold transition-colors",children:"キャンセル"}),e.jsx("button",{onClick:Se,disabled:O,className:"px-4 py-2 rounded-full bg-brand-dark text-white text-sm font-bold hover:bg-brand-gold transition-colors disabled:opacity-60",children:O?"生成中...":"AIで生成する"})]})]})})]})}function Bo({spot:t,onLogoHome:a,onBackList:n,onSaveBack:r,onSaveNext:m,nextSpot:g,questId:d,setRouteSpots:u}){const x={directions:"",directionsImage:"",storyImage:"",storyText:"",challengeText:"",challengeImage:"",hints:[{id:"hint-1",label:"ヒント1",text:""},{id:"hint-2",label:"ヒント2",text:""},{id:"answer",label:"答え",text:""}],answerText:"",answerType:"text",choiceOptions:[],acceptableAnswers:[],successMessage:"",...t.details||{}},[b,f]=o.useState(x.directions),[v,p]=o.useState(x.directionsImage||""),[i,_]=o.useState(x.storyImage||""),[w,B]=o.useState(x.storyText),[L,O]=o.useState(x.challengeText),[R,be]=o.useState(x.challengeImage||""),[Y,ee]=o.useState(x.hints),[P,he]=o.useState(x.answerText),[re,xe]=o.useState(x.answerType||"text"),[te,A]=o.useState(x.choiceOptions||[]),[Z,me]=o.useState(x.acceptableAnswers||[]),[E,V]=o.useState(x.successMessage),[oe,ke]=o.useState(!1),[je,ie]=o.useState(null),Se=b.trim().length>0&&w.trim().length>0&&L.trim().length>0&&(re==="choice"?te.length>0:P.trim().length>0)&&E.trim().length>0&&Y.every(c=>c.text.trim().length>0),fe=(c,h)=>{ee(k=>k.map(z=>z.id===c?{...z,text:h}:z))},Me=()=>{const c=Y.length+1;ee([...Y,{id:`hint-${c}`,label:`ヒント${c}`,text:""}])};o.useEffect(()=>{t.id&&D.from("spot_details").select("nav_text, story_text, question_text, answer_text, hint_text, explanation_text, answer_type, choice_options, acceptable_answers, completion_message").eq("spot_id",t.id).single().then(({data:c})=>{if(c){if(f(c.nav_text||""),B(c.story_text||""),O(c.question_text||""),he(c.answer_text||""),xe(c.answer_type||"text"),A(Array.isArray(c.choice_options)?c.choice_options:[]),me(Array.isArray(c.acceptable_answers)?c.acceptable_answers:[]),c.hint_text){const h=c.hint_text.split(/\n+/).map(k=>k.trim()).filter(k=>k.length>0);ee(h.length?h.map((k,z)=>({id:`hint-${z+1}`,label:`ヒント${z+1}`,text:k})):x.hints)}else ee(x.hints);V(c.explanation_text||c.completion_message||"")}}).catch(()=>{})},[t.id]);const C=()=>({...t,details:{directions:b,directionsImage:v,storyImage:i,storyText:w,challengeText:L,challengeImage:R,hints:Y,answerText:P,answerType:re,choiceOptions:te,acceptableAnswers:Z,successMessage:E},status:Se?"complete":"draft"}),ve=()=>{const c=C();I(c,()=>r(c,Se))},de=()=>{const c=C();I(c,()=>m(c,Se))},I=async(c,h)=>{if(t.id){ke(!0),ie(null);try{await D.from("spot_details").upsert({spot_id:t.id,nav_text:b,story_text:w,question_text:L,answer_text:P,hint_text:Y.map(k=>{var z,K;return((K=(z=k.text)==null?void 0:z.trim)==null?void 0:K.call(z))||""}).filter(k=>k.length>0).join(`
`),explanation_text:E,completion_message:E,answer_type:re,choice_options:te,acceptable_answers:Z}),u(k=>k.map(z=>z.id===t.id?{...z,status:Se?"complete":z.status}:z)),h()}catch(k){ie((k==null?void 0:k.message)||"保存に失敗しました")}finally{ke(!1)}}};return e.jsxs("section",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-stone-200 bg-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 py-4 flex items-center justify-between gap-6",children:e.jsx("button",{onClick:a,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-8 w-auto"})})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 min-h-[calc(100vh-64px)]",children:[e.jsxs("div",{className:"px-4 md:px-12 py-12 space-y-8 overflow-y-auto h-[calc(100vh-96px)] bg-brand-base/60",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:n,className:"text-sm text-brand-dark font-bold hover:underline flex items-center gap-2",children:"< スポット一覧に戻る"}),e.jsx("div",{className:"text-xs text-stone-500 font-bold",children:"Step 2 / Spot Detail"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Spot Detail"}),e.jsx("h1",{className:"text-3xl font-serif font-bold text-brand-dark",children:t.name||"スポット名未設定"}),e.jsx("p",{className:"text-sm text-stone-700",children:"チェックポイントの物語と謎を作り込みましょう。右側のプレビューに即時反映されます。"})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"ナビゲーション指示 (Directions)"})]}),e.jsx("textarea",{value:b,onChange:c=>f(c.target.value),rows:3,placeholder:"駅の北口を出て、赤いポストの方へ進んでください...",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"補足の写真を追加"}),e.jsx("button",{className:"px-4 py-2 rounded-full border border-stone-300 bg-white text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold",children:"画像をアップロード"})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"ストーリー・描写 (Story & Narrative)"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"到着時に表示する画像"}),e.jsx("button",{className:"px-4 py-2 rounded-full border border-stone-300 bg-white text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold",children:"画像をアップロード"})]}),e.jsx("textarea",{value:w,onChange:c=>B(c.target.value),rows:6,placeholder:"あなたはついに〇〇に到着した。そこで古びた看板を目にする…",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qn,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"謎・チャレンジ (Challenge & Clues)"})]}),e.jsx("textarea",{value:L,onChange:c=>O(c.target.value),rows:5,placeholder:"看板に並ぶ文字を並び替えると、次のキーワードが現れる…",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"暗号や写真などを追加"}),e.jsx("button",{className:"px-4 py-2 rounded-full border border-stone-300 bg-white text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold",children:"画像をアップロード"})]}),e.jsxs("div",{className:"space-y-2 border-t border-stone-200 pt-4",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"回答形式"}),e.jsxs("select",{value:re,onChange:c=>xe(c.target.value),className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50 text-sm",children:[e.jsx("option",{value:"text",children:"テキスト入力"}),e.jsx("option",{value:"choice",children:"単一選択"}),e.jsx("option",{value:"number",children:"数字入力"})]}),re==="choice"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-stone-500",children:"選択肢を追加"}),e.jsx("button",{className:"text-xs font-bold text-brand-dark border border-dashed border-stone-300 px-3 py-1 rounded-full hover:border-brand-gold hover:text-brand-gold",onClick:()=>A([...te,""]),children:"+ 追加"})]}),te.map((c,h)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:c,onChange:k=>{const z=[...te];z[h]=k.target.value,A(z)},className:"flex-1 px-3 py-2 rounded-xl border border-stone-300 text-sm",placeholder:`選択肢 ${h+1}`}),e.jsxs("label",{className:"text-xs flex items-center gap-1 text-brand-dark",children:[e.jsx("input",{type:"radio",name:"choice-answer",checked:P===c,onChange:()=>he(c)}),"正解"]}),e.jsx("button",{className:"text-xs text-stone-500 hover:text-red-500",onClick:()=>{const k=te.filter((z,K)=>K!==h);A(k),P===c&&he("")},children:"削除"})]},h)),te.length===0&&e.jsx("p",{className:"text-[11px] text-amber-600",children:"選択肢が未設定です。最低1件追加してください。"})]})]}),e.jsxs("div",{className:"border-t border-stone-200 pt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{size:16,className:"text-brand-gold"}),e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:"ヒント設定 (Hints)"})]}),e.jsx("div",{className:"space-y-3",children:Y.map(c=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-bold text-stone-600",children:c.label}),e.jsx("textarea",{value:c.text,onChange:h=>fe(c.id,h.target.value),rows:2,className:"w-full px-3 py-2 rounded-xl border border-stone-200 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/40 text-sm"})]},c.id))}),e.jsx("button",{onClick:Me,className:"text-sm font-bold text-brand-dark border border-dashed border-stone-300 px-4 py-2 rounded-full hover:border-brand-gold hover:text-brand-gold",children:"ヒントを追加"})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"正解とクリア条件 (Answer & Completion)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"正解キーワード / 正解の選択肢"}),e.jsx("input",{value:P,onChange:c=>he(c.target.value),placeholder:re==="choice"?"正解の選択肢テキストを指定":"例：タヌキ / 1985",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),re!=="choice"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"別解・表記揺れ（カンマ区切り）"}),e.jsx("input",{value:Z.join(", "),onChange:c=>me(c.target.value.split(",").map(h=>h.trim()).filter(h=>h.length>0)),placeholder:"例：狸, たぬき, tanuki",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"正解時のメッセージ"}),e.jsx("textarea",{value:E,onChange:c=>V(c.target.value),rows:3,placeholder:"やったね！この鍵で次の扉を開けよう。",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-end",children:[e.jsx("button",{onClick:ve,disabled:oe,className:"px-5 py-3 rounded-full bg-brand-dark text-white text-sm font-bold hover:bg-brand-gold transition-colors shadow-lg disabled:opacity-60",children:oe?"保存中...":"保存して戻る"}),e.jsx("button",{onClick:de,className:"px-5 py-3 rounded-full border border-brand-dark text-brand-dark text-sm font-bold hover:bg-brand-gold hover:text-white transition-colors shadow-lg disabled:opacity-60",disabled:!g||oe,children:oe?"保存中...":"保存して次のスポットへ"})]}),je&&e.jsx("div",{className:"text-sm text-red-600",children:je})]}),e.jsx("div",{className:"relative bg-white border-l border-stone-200 h-[calc(100vh-64px)] lg:sticky lg:top-0 px-4 md:px-8 py-12",children:e.jsxs("div",{className:"mx-auto max-w-xs bg-stone-900 rounded-[2.5rem] shadow-2xl overflow-hidden border-8 border-stone-900 h-full flex flex-col",children:[e.jsx("div",{className:"bg-white text-brand-dark text-sm font-bold text-center py-3 border-b border-stone-200",children:t.name||"スポット名"}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-white p-4 space-y-4",children:[e.jsx("div",{className:"text-xs text-brand-gold font-bold uppercase tracking-widest",children:"Directions"}),e.jsx("p",{className:"text-sm text-stone-700",children:b||"ここにナビゲーションが表示されます"}),e.jsx("div",{className:"w-full h-36 bg-brand-base border border-stone-200 rounded-xl flex items-center justify-center text-xs text-stone-500",children:i?"画像プレビュー":"画像プレースホルダー"}),e.jsx("div",{className:"text-xs text-brand-gold font-bold uppercase tracking-widest",children:"Story"}),e.jsx("p",{className:"text-sm text-stone-800 whitespace-pre-line",children:w||"ストーリー本文がここに表示されます。"}),e.jsx("div",{className:"text-xs text-brand-gold font-bold uppercase tracking-widest",children:"Challenge"}),e.jsx("p",{className:"text-sm text-stone-800 whitespace-pre-line",children:L||"謎解き問題文がここに表示されます。"}),e.jsx("div",{className:"bg-brand-base rounded-2xl p-3 border border-stone-200 space-y-2",children:Y.map(c=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-bold text-brand-dark",children:[c.label,":"]})," ",e.jsx("span",{className:"text-stone-700",children:c.text||"（未入力）"})]},c.id))}),e.jsx("div",{className:"text-xs text-brand-gold font-bold uppercase tracking-widest",children:"Answer"}),e.jsxs("div",{className:"w-full px-3 py-2 rounded-xl border border-stone-300 text-sm text-stone-700 space-y-1",children:[e.jsxs("div",{className:"text-xs text-stone-500",children:["形式: ",re==="choice"?"選択肢":re]}),re==="choice"?e.jsxs("div",{className:"space-y-1",children:[(te||[]).map((c,h)=>e.jsxs("div",{className:"text-sm",children:["・",c||"---"," ",P===c?"(正解)":""]},h)),te.length===0&&e.jsx("div",{className:"text-sm text-stone-500",children:"選択肢が未設定です"})]}):e.jsxs("div",{children:["正解: ",P||"---",Z.length>0&&e.jsxs("div",{className:"text-xs text-stone-500",children:["別解: ",Z.join(", ")]})]})]}),e.jsx("div",{className:"bg-brand-gold/10 border border-brand-gold/30 text-brand-dark rounded-xl px-3 py-2 text-sm",children:E||"正解時のメッセージがここに表示されます"})]})]})})]})]})}function qo({onLogoHome:t,onBack:a,onSaveComplete:n,storySettings:r,spots:m,isSocialQuest:g,questId:d}){const[u,x]=o.useState(r.castName||""),[b,f]=o.useState(r.castTone||""),[v,p]=o.useState(r.castIcon||""),[i,_]=o.useState(r.prologueTitle||""),[w,B]=o.useState(r.prologueBody||""),[L,O]=o.useState(r.prologueImage||""),[R,be]=o.useState(r.epilogueBody||""),[Y,ee]=o.useState(r.socialMessage||""),[P,he]=o.useState(r.epilogueImage||""),[re,xe]=o.useState("chat"),[te,A]=o.useState(r.characters||[]),[Z,me]=o.useState(!1),[E,V]=o.useState(null),[oe,ke]=o.useState([]),[je,ie]=o.useState([]),[Se,fe]=o.useState(!1),[Me,C]=o.useState(r.scenario.length?r.scenario:[{type:"prologue",id:"prologue",content:r.prologueBody||""},...m.map(y=>({type:"spot",id:`spot-${y.id}`,spotId:y.id,name:y.name})),{type:"epilogue",id:"epilogue",content:r.epilogueBody||"",social:r.socialMessage||""}]);o.useEffect(()=>{C(y=>y.map(M=>{if(M.type==="prologue")return{...M,content:w};if(M.type==="epilogue")return{...M,content:R,social:Y};if(M.type==="spot"){const $=m.find(q=>q.id===M.spotId);return $?{...M,name:$.name}:M}return M}))},[w,R,Y,m]);const ve=y=>{const M=y==="prologue"?ke:ie,$=y==="prologue"?oe:je;M([...$,{id:`${y}-${Date.now()}`,stage:y,orderIndex:$.length+1,speakerType:"narrator",speakerName:"Narrator",text:""}])},de=(y,M,$)=>{(y==="prologue"?ke:ie)(U=>U.map(Ce=>Ce.id===M?{...Ce,...$,orderIndex:$.orderIndex??Ce.orderIndex}:Ce).sort((Ce,ze)=>Ce.orderIndex-ze.orderIndex))},I=(y,M)=>{(y==="prologue"?ke:ie)(q=>q.filter(U=>U.id!==M).map((U,Ce)=>({...U,orderIndex:Ce+1})))},c=(y,M,$)=>{const q=y==="prologue"?oe:je,U=q.findIndex(et=>et.id===M);if(U<0)return;const Ce=U+$;if(Ce<0||Ce>=q.length)return;const ze=[...q],[Ye]=ze.splice(U,1);ze.splice(Ce,0,Ye),(y==="prologue"?ke:ie)(ze.map((et,tt)=>({...et,orderIndex:tt+1})))};o.useEffect(()=>{d&&D.from("story_timelines").select("prologue, epilogue, characters, timeline_data, timeline_json, cast_name, cast_tone, cast_icon, prologue_title, prologue_image, epilogue_image, social_message").eq("quest_id",d).single().then(({data:y})=>{if(y)if(x(y.cast_name||r.castName||""),f(y.cast_tone||r.castTone||""),p(y.cast_icon||r.castIcon||""),_(y.prologue_title||r.prologueTitle||""),B(y.prologue||r.prologueBody||""),O(y.prologue_image||r.prologueImage||""),he(y.epilogue_image||r.epilogueImage||""),be(y.epilogue||r.epilogueBody||""),ee(y.social_message||r.socialMessage||""),A(y.characters||r.characters||[]),C(y.timeline_data||r.scenario||[]),y.timeline_json){const M=y.timeline_json;ke(M.filter($=>$.stage==="prologue").sort(($,q)=>($.orderIndex||0)-(q.orderIndex||0))),ie(M.filter($=>$.stage==="epilogue").sort(($,q)=>($.orderIndex||0)-(q.orderIndex||0)))}else y.prologue&&ke([{id:"prologue-1",stage:"prologue",orderIndex:1,speakerType:"narrator",speakerName:"Narrator",text:y.prologue}]),y.epilogue&&ie([{id:"epilogue-1",stage:"epilogue",orderIndex:1,speakerType:"narrator",speakerName:"Narrator",text:y.epilogue}]);fe(!0)}).catch(()=>fe(!0))},[d]);const h=async()=>{if(!d){V("クエストIDがありません。Step1を保存してください。");return}me(!0),V(null);try{const y=[...oe].sort((ze,Ye)=>ze.orderIndex-Ye.orderIndex).map((ze,Ye)=>({...ze,orderIndex:Ye+1})),M=[...je].sort((ze,Ye)=>ze.orderIndex-Ye.orderIndex).map((ze,Ye)=>({...ze,orderIndex:Ye+1})),$=[...y,...M],q=y.map(ze=>ze.text).filter(ze=>ze&&ze.length).join(`
`),U=M.map(ze=>ze.text).filter(ze=>ze&&ze.length).join(`
`);await D.from("story_timelines").upsert({quest_id:d,cast_name:u,cast_tone:b,cast_icon:v,prologue_title:i,characters:te,prologue_image:L,prologue:q||w,epilogue_image:P,social_message:Y,epilogue:U||R,timeline_data:Me,timeline_json:$}),n({castName:u,castTone:b,castIcon:v,prologueTitle:i,prologueBody:w,prologueImage:L,epilogueBody:R,socialMessage:Y,epilogueImage:P,characters:te,scenario:Me})}catch(y){V((y==null?void 0:y.message)||"保存に失敗しました")}finally{me(!1)}},k=[{id:"cast-main",name:u||"案内人",tone:b},...te.map(y=>({id:y.id,name:y.name||"キャラクター",tone:y.tone}))],z=y=>{var U;const M=Me.findIndex(Ce=>Ce.id===y);if(M===-1)return;const $={type:"dialogue",id:`dialogue-${Date.now()}`,characterId:((U=k[0])==null?void 0:U.id)||"cast-main",text:"",position:"left"},q=[...Me];q.splice(M+1,0,$),C(q)},K=(y,M)=>{C($=>$.map(q=>q.id===y&&q.type==="dialogue"?{...q,...M}:q))};return e.jsxs("section",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-stone-200 bg-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 py-4 flex items-center justify-between gap-6",children:e.jsx("button",{onClick:t,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-8 w-auto"})})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 min-h-[calc(100vh-64px)]",children:[e.jsxs("div",{className:"px-4 md:px-12 py-12 space-y-8 overflow-y-auto h-[calc(100vh-96px)] bg-brand-base/60",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:a,className:"text-sm text-brand-dark font-bold hover:underline flex items-center gap-2",children:"< Workspace"}),e.jsx("div",{className:"text-xs text-stone-500 font-bold",children:"Step 3 / 5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Storytelling"}),e.jsx("h1",{className:"text-3xl font-serif font-bold text-brand-dark",children:"物語と演出を作り込む"}),e.jsx("p",{className:"text-sm text-stone-700",children:"物語の始まりと終わりを整え、案内人の声と演出で世界観を仕上げましょう。右のプレビューに即時反映されます。"})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ol,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"キャスト設定 (Cast & Narrator)"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"キャラクター名"}),e.jsx("input",{value:u,onChange:y=>x(y.target.value),placeholder:"例：古文書の精霊",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"口調・トーンメモ"}),e.jsx("input",{value:b,onChange:y=>f(y.target.value),placeholder:"例：丁寧語・ミステリアス",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"アイコン画像を設定"}),e.jsx("button",{className:"px-4 py-2 rounded-full border border-stone-300 bg-white text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold",children:"アイコンをアップロード"})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"登場人物設定"})]}),e.jsxs("button",{onClick:()=>A([...te,{id:crypto.randomUUID?crypto.randomUUID():`${Date.now()}`,name:"",role:"",tone:"",icon:""}]),className:"flex items-center gap-1 text-sm font-bold text-brand-dark border border-stone-300 px-3 py-1.5 rounded-full hover:border-brand-gold hover:text-brand-gold",children:[e.jsx(Ea,{size:16})," 追加"]})]}),e.jsxs("div",{className:"space-y-3",children:[te.length===0&&e.jsx("div",{className:"text-sm text-stone-500 bg-brand-base border border-dashed border-stone-300 rounded-2xl px-4 py-4 text-center",children:"まだ登場人物がありません。追加ボタンでキャラクターを増やせます。"}),te.map((y,M)=>e.jsxs("div",{className:"rounded-2xl border border-stone-200 p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("p",{className:"text-sm font-bold text-brand-dark",children:["キャラクター ",M+1]}),e.jsx("div",{className:"flex items-center gap-2 text-stone-400",children:e.jsx("button",{onClick:()=>A(te.filter($=>$.id!==y.id)),className:"hover:text-rose-500 text-xs font-bold",children:"削除"})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[e.jsx("input",{value:y.name,onChange:$=>A(te.map(q=>q.id===y.id?{...q,name:$.target.value}:q)),placeholder:"名前",className:"w-full px-3 py-2 rounded-xl border border-stone-300 text-sm"}),e.jsx("input",{value:y.role,onChange:$=>A(te.map(q=>q.id===y.id?{...q,role:$.target.value}:q)),placeholder:"役割・肩書き",className:"w-full px-3 py-2 rounded-xl border border-stone-300 text-sm"}),e.jsx("input",{value:y.tone,onChange:$=>A(te.map(q=>q.id===y.id?{...q,tone:$.target.value}:q)),placeholder:"口調メモ",className:"w-full px-3 py-2 rounded-xl border border-stone-300 text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"アイコン画像（任意）"}),e.jsx("button",{className:"px-3 py-2 rounded-full border border-stone-300 bg-white text-xs font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold",children:"アップロード"})]})]},y.id))]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ea,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"プロローグ / エピローグ（チャット）"})]}),!Se&&e.jsx("p",{className:"text-sm text-stone-500",children:"読み込み中..."}),Se&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:["prologue","epilogue"].map(y=>{const M=y==="prologue"?oe:je,$=y==="prologue"?"プロローグ":"エピローグ";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:$}),e.jsx("button",{className:"text-xs font-bold text-brand-dark border border-dashed border-stone-300 px-3 py-1 rounded-full hover:border-brand-gold hover:text-brand-gold",onClick:()=>ve(y),children:"+ 追加"})]}),e.jsxs("div",{className:"space-y-3",children:[M.length===0&&e.jsx("div",{className:"text-xs text-stone-500 bg-brand-base border border-stone-200 rounded-xl px-3 py-2",children:"メッセージがありません。追加してください。"}),M.map((q,U)=>e.jsxs("div",{className:"rounded-2xl border border-stone-200 bg-white shadow-sm p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-stone-500",children:[e.jsxs("span",{children:["#",U+1]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(y,q.id,-1),className:"hover:text-brand-gold",children:"↑"}),e.jsx("button",{onClick:()=>c(y,q.id,1),className:"hover:text-brand-gold",children:"↓"}),e.jsx("button",{onClick:()=>I(y,q.id),className:"hover:text-rose-500",children:"削除"})]})]}),e.jsxs("select",{value:q.speakerType,onChange:Ce=>de(y,q.id,{speakerType:Ce.target.value}),className:"w-full text-sm border border-stone-300 rounded-xl px-3 py-2",children:[e.jsx("option",{value:"narrator",children:"ナレーション"}),e.jsx("option",{value:"character",children:"キャラクター"}),e.jsx("option",{value:"system",children:"システム"})]}),e.jsx("input",{value:q.speakerName||"",onChange:Ce=>de(y,q.id,{speakerName:Ce.target.value}),className:"w-full px-3 py-2 rounded-xl border border-stone-300 text-sm",placeholder:"話者名（任意）"}),e.jsx("textarea",{value:q.text,onChange:Ce=>de(y,q.id,{text:Ce.target.value}),rows:3,className:"w-full px-3 py-2 rounded-xl border border-stone-300 text-sm",placeholder:"セリフやナレーションを入力"})]},q.id))]})]},y)})})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ea,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"シナリオフロー (Timeline)"})]}),e.jsx("p",{className:"text-xs text-stone-600",children:"プロローグとスポットの間に会話を挿入して、物語のテンポを整えましょう。"}),e.jsx("div",{className:"space-y-3",children:Me.map((y,M)=>e.jsxs("div",{className:"relative",children:[y.type==="prologue"&&e.jsxs("div",{className:"rounded-2xl border border-brand-gold/40 bg-brand-gold/10 px-4 py-3 text-sm text-brand-dark",children:["🎬 プロローグ：",i||"タイトル未設定"]}),y.type==="spot"&&e.jsxs("div",{className:"rounded-2xl border border-stone-300 bg-stone-100 px-4 py-3 flex items-center gap-3 text-sm text-brand-dark",children:[e.jsx(Fe,{size:16,className:"text-brand-dark"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["スポット: ",y.name]}),e.jsx("p",{className:"text-xs text-stone-500",children:"Step2で設定（編集不可）"})]})]}),y.type==="dialogue"&&e.jsxs("div",{className:"rounded-2xl border border-brand-gold/30 bg-white px-4 py-3 space-y-2 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs font-bold text-stone-500",children:"会話"}),e.jsx("select",{value:y.characterId,onChange:$=>K(y.id,{characterId:$.target.value}),className:"text-sm border border-stone-300 rounded-full px-3 py-1",children:k.map($=>e.jsx("option",{value:$.id,children:$.name||"キャラクター"},$.id))}),e.jsxs("select",{value:y.position,onChange:$=>K(y.id,{position:$.target.value}),className:"text-xs border border-stone-300 rounded-full px-2 py-1 text-stone-600",children:[e.jsx("option",{value:"left",children:"左に表示"}),e.jsx("option",{value:"right",children:"右に表示"})]})]}),e.jsx("textarea",{value:y.text,onChange:$=>K(y.id,{text:$.target.value}),rows:2,placeholder:"セリフを入力",className:"w-full px-3 py-2 rounded-xl border border-stone-300 text-sm"})]}),y.type==="epilogue"&&e.jsx("div",{className:"rounded-2xl border border-brand-gold/40 bg-brand-gold/10 px-4 py-3 text-sm text-brand-dark",children:"🏁 エピローグ（プレビュー反映）"}),M<Me.length-1&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>z(y.id),className:"mt-2 mb-2 inline-flex items-center gap-2 text-xs font-bold text-brand-dark border border-dashed border-brand-gold px-3 py-1.5 rounded-full hover:border-brand-dark",children:[e.jsx(Ea,{size:14})," 会話・イベントを追加"]})})]},y.id))})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"プロローグ設定 (Prologue)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"タイトル"}),e.jsx("input",{value:i,onChange:y=>_(y.target.value),placeholder:"例：依頼人からの手紙",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:"本文"}),e.jsx("span",{className:"text-xs text-stone-500",children:"プレイヤーを世界観に引き込む導入を書きましょう"})]}),e.jsx("textarea",{value:w,onChange:y=>B(y.target.value),rows:6,placeholder:"なぜ今、この謎を解かなければならないのか？動機付けを描きましょう。",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"オープニング演出画像"}),e.jsx("button",{className:"px-4 py-2 rounded-full border border-stone-300 bg-white text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold",children:"画像をアップロード"})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"エピローグ設定 (Epilogue)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"本文"}),e.jsx("textarea",{value:R,onChange:y=>be(y.target.value),rows:6,placeholder:"物語のクライマックスを書きましょう。真相とプレイヤーへの称賛を。",className:"w-full px-4 py-3 rounded-2xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"ソーシャルインパクト・メッセージ"}),e.jsx("textarea",{value:Y,onChange:y=>ee(y.target.value),rows:3,placeholder:"このクエストを通じて、あなたは地域にこんな貢献をしました...",className:"w-full px-4 py-3 rounded-2xl border border-emerald-200 bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-400/50 text-sm text-emerald-800"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"エンディング演出画像"}),e.jsx("button",{className:"px-4 py-2 rounded-full border border-stone-300 bg-white text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold",children:"画像をアップロード"})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ea,{size:18,className:"text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"スクリプト全体確認 (Script Flow Review)"})]}),e.jsx("p",{className:"text-xs text-stone-600",children:"プロローグから各スポットのストーリー、エピローグまでを縦読みして整合性を確認します。"}),e.jsxs("div",{className:"space-y-3",children:[m.length===0&&e.jsx("div",{className:"text-sm text-stone-500 bg-brand-base border border-dashed border-stone-300 rounded-2xl px-4 py-6 text-center",children:"スポットがまだありません。Step2で追加してください。"}),m.map((y,M)=>{var $;return e.jsxs("div",{className:"p-4 rounded-2xl border border-stone-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-brand-dark text-white flex items-center justify-center text-sm font-bold",children:M+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:y.name||`Spot ${M+1}`}),e.jsx("p",{className:"text-xs text-stone-500",children:"口調や設定が一貫しているか確認"})]})]}),e.jsx("button",{onClick:()=>window.location.href="/creator/route-spots",className:"text-xs text-brand-gold font-bold hover:underline",children:"Step2で編集する"})]}),e.jsx("p",{className:"text-sm text-stone-700 mt-3 line-clamp-3",children:(($=y.details)==null?void 0:$.storyText)||"（このスポットのストーリーは未入力です）"})]},y.id)})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{onClick:h,disabled:Z,className:"px-6 py-3 rounded-full text-sm font-bold shadow-lg bg-brand-dark text-white hover:bg-brand-gold",children:Z?"保存中...":"保存して完了"})}),E&&e.jsx("div",{className:"text-sm text-red-600",children:E})]}),e.jsxs("div",{className:"relative bg-white border-l border-stone-200 h-[calc(100vh-64px)] lg:sticky lg:top-0 px-4 md:px-8 py-12",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("button",{onClick:()=>xe("chat"),className:`px-3 py-1 rounded-full text-xs font-bold border ${re==="chat"?"bg-brand-dark text-white border-brand-dark":"border-stone-300 text-stone-600"}`,children:"チャットモード"}),e.jsx("button",{onClick:()=>xe("novel"),className:`px-3 py-1 rounded-full text-xs font-bold border ${re==="novel"?"bg-brand-dark text-white border-brand-dark":"border-stone-300 text-stone-600"}`,children:"ノベルモード"})]}),e.jsxs("div",{className:"mx-auto max-w-xs bg-stone-900 rounded-[2.5rem] shadow-2xl overflow-hidden border-8 border-stone-900 h-full flex flex-col",children:[e.jsx("div",{className:"bg-white text-brand-dark text-sm font-bold text-center py-3 border-b border-stone-200",children:u||"案内人"}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-white relative",children:[re==="chat"&&e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-dark text-white flex items-center justify-center text-xs font-bold",children:u?u[0]:"A"}),e.jsxs("div",{className:"bg-brand-base rounded-2xl px-3 py-2 border border-stone-200 text-sm text-stone-800 max-w-[80%]",children:[e.jsx("p",{className:"text-xs text-brand-gold mb-1",children:i||"プロローグ"}),e.jsx("p",{className:"whitespace-pre-line",children:w||"プロローグ本文がここに表示されます。"})]})]}),e.jsx("div",{className:"flex items-start gap-2 justify-end",children:e.jsx("div",{className:"bg-brand-gold text-white rounded-2xl px-3 py-2 text-sm max-w-[80%] shadow",children:"了解！準備はできているよ。"})}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-dark text-white flex items-center justify-center text-xs font-bold",children:u?u[0]:"A"}),e.jsxs("div",{className:"bg-brand-base rounded-2xl px-3 py-2 border border-stone-200 text-sm text-stone-800 max-w-[80%]",children:[e.jsx("p",{className:"text-xs text-brand-gold mb-1",children:"エピローグ"}),e.jsx("p",{className:"whitespace-pre-line",children:R||"エピローグ本文がここに表示されます。"}),g&&e.jsx("div",{className:"mt-2 text-xs text-emerald-700 bg-emerald-50 border border-emerald-100 rounded-xl px-2 py-1",children:Y||"ソーシャルインパクトメッセージがここに表示されます。"})]})]})]}),re==="novel"&&e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:"absolute inset-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-b from-brand-base via-white to-brand-base"})}),e.jsxs("div",{className:"relative p-4 space-y-3",children:[e.jsx("div",{className:"w-full h-36 rounded-2xl bg-stone-200 flex items-center justify-center text-xs text-stone-500",children:L?"画像プレビュー":"背景イメージ"}),e.jsxs("div",{className:"bg-white/90 rounded-2xl border border-stone-200 p-3 shadow-sm text-sm text-stone-800",children:[e.jsx("p",{className:"text-xs text-brand-gold mb-1",children:i||"プロローグ"}),e.jsx("p",{className:"whitespace-pre-line leading-relaxed",children:w||"プロローグ本文がここに表示されます。"})]}),e.jsxs("div",{className:"bg-white/90 rounded-2xl border border-stone-200 p-3 shadow-sm text-sm text-stone-800",children:[e.jsx("p",{className:"text-xs text-brand-gold mb-1",children:"エピローグ"}),e.jsx("p",{className:"whitespace-pre-line leading-relaxed",children:R||"エピローグ本文がここに表示されます。"}),g&&e.jsx("div",{className:"mt-2 text-xs text-emerald-700 bg-emerald-50 border border-emerald-100 rounded-xl px-2 py-1",children:Y||"ソーシャルインパクトメッセージがここに表示されます。"})]})]})]})]})]})]})]})]})}function Fo({onBack:t,onComplete:a,onLogoHome:n,routeSpots:r,setRouteSpots:m,onOpenSpotDetail:g,questId:d}){const u=o.useRef(null),x=o.useRef(null),b=o.useRef([]),f=o.useRef(null),v="route-line",p="route-line-layer",[i,_]=o.useState(""),[w,B]=o.useState(""),[L,O]=o.useState(null),[R,be]=o.useState([]),[Y,ee]=o.useState(!1),[P,he]=o.useState(null),[re,xe]=o.useState(!1),te=.5,A=(h,k)=>{const z=ze=>ze*Math.PI/180,y=z(k.lat-h.lat),M=z(k.lng-h.lng),$=z(h.lat),q=z(k.lat),U=Math.sin(y/2)*Math.sin(y/2)+Math.cos($)*Math.cos(q)*Math.sin(M/2)*Math.sin(M/2);return 6371*(2*Math.atan2(Math.sqrt(U),Math.sqrt(1-U)))},Z=(h,k)=>{he(h),k.dataTransfer.effectAllowed="move"},me=(h,k)=>{k.preventDefault(),k.dataTransfer.dropEffect="move"},E=(h,k)=>{k.preventDefault(),P&&P!==h&&Me(P,h),he(null)},V=r.reduce((h,k,z)=>z===0?0:h+A(r[z-1],k),0),oe=r.reduce((h,k,z)=>z===0?0:Math.max(h,A(r[z-1],k)),0),ke={minSpots:!0,notTooFar:!0,withinRange:!0},je=h=>{const k=(h==null?void 0:h.place_type)||[];return h!=null&&h.bbox?null:k.includes("country")?6:k.includes("region")?9:k.includes("place")?12:k.includes("locality")?13:k.includes("neighborhood")?14:15},ie=async()=>{if(!d)return;xe(!0);const{data:h,error:k}=await D.from("spots").select("*, spot_details (*)").eq("quest_id",d).order("order_index",{ascending:!0});!k&&h&&m(h.map(z=>{var q;const K=((q=z.spot_details)==null?void 0:q[0])||z.spot_details||null,y=K!=null&&K.hint_text?String(K.hint_text).split(/\n+/).map(U=>U.trim()).filter(U=>U.length>0):[],M=K?{directions:K.nav_text||"",directionsImage:"",storyImage:"",storyText:K.story_text||"",challengeText:K.question_text||"",challengeImage:"",hints:y.length>0?y.map((U,Ce)=>({id:`hint-${Ce+1}`,label:`ヒント${Ce+1}`,text:U})):[{id:"hint-1",label:"ヒント1",text:""},{id:"hint-2",label:"ヒント2",text:""},{id:"answer",label:"答え",text:""}],answerText:K.answer_text||"",answerType:K.answer_type||"text",choiceOptions:Array.isArray(K.choice_options)?K.choice_options:[],acceptableAnswers:Array.isArray(K.acceptable_answers)?K.acceptable_answers:[],successMessage:K.explanation_text||K.completion_message||""}:void 0,$=((M==null?void 0:M.challengeText)||"").trim().length>0&&(((M==null?void 0:M.answerType)==="choice"?(M.choiceOptions||[]).length>0:((M==null?void 0:M.answerText)||"").trim().length>0)||!1);return{id:z.id,name:z.name,address:z.address||"",lat:z.lat,lng:z.lng,orderIndex:z.order_index,status:$?"complete":z.status,details:M}})),xe(!1)};o.useEffect(()=>{ie()},[d]);const Se=()=>{if(!i.trim()||!w.trim()||!L||!d)return;const h=r.length+1;D.from("spots").insert({quest_id:d,name:i.trim(),address:w.trim(),lat:L.lat,lng:L.lng,order_index:h}).select().single().then(({data:k,error:z})=>{!z&&k&&(_(""),B(""),O(null),be([]),m(K=>[...K,{id:k.id,name:k.name,address:k.address||"",lat:k.lat,lng:k.lng,orderIndex:k.order_index}]))}).catch(()=>{})},fe=h=>{m(r.filter(k=>k.id!==h)),D.from("spots").delete().eq("id",h).then(()=>ie()).catch(()=>{})},Me=async(h,k)=>{if(h===k)return;const z=[...r],K=z.findIndex(q=>q.id===h),y=z.findIndex(q=>q.id===k);if(K===-1||y===-1)return;const[M]=z.splice(K,1);z.splice(y,0,M);const $=z.map((q,U)=>({...q,orderIndex:U+1}));if(m($),d){const q=$.map(U=>({id:U.id,quest_id:d,name:U.name,address:U.address,lat:U.lat,lng:U.lng,order_index:U.orderIndex||0}));await D.from("spots").upsert(q,{onConflict:"id"})}},C=h=>{u.current&&(x.current=new h.Map({container:u.current,style:lr,center:r[0]?[r[0].lng,r[0].lat]:[139.769,35.6804],zoom:r.length?12:10}))},ve=()=>{b.current.forEach(h=>h.marker.remove()),b.current=[]},de=(h,k)=>{if(!x.current)return;f.current&&f.current.remove();const z=document.createElement("div");z.className="w-8 h-8 rounded-full bg-white text-brand-dark text-sm font-bold flex items-center justify-center shadow-lg border-2 border-brand-dark",z.textContent="+",f.current=new window.maplibregl.Marker({element:z}).setLngLat([h,k]).addTo(x.current)},I=()=>{if(x.current&&(ve(),r.forEach((h,k)=>{const z=document.createElement("div");z.className="w-8 h-8 rounded-full bg-brand-dark text-white text-sm font-bold flex items-center justify-center shadow-lg border-2 border-white",z.textContent=`${k+1}`;const K=new window.maplibregl.Marker({element:z}).setLngLat([h.lng,h.lat]).addTo(x.current);b.current.push({id:h.id,marker:K,el:z})}),x.current.getSource(v)&&(x.current.removeLayer(p),x.current.removeSource(v)),r.length>1&&(x.current.addSource(v,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:r.map(h=>[h.lng,h.lat])}}}),x.current.addLayer({id:p,type:"line",source:v,paint:{"line-color":"#2563eb","line-width":4,"line-opacity":.75}})),r.length)){const h=new window.maplibregl.LngLatBounds;r.forEach(k=>h.extend([k.lng,k.lat])),x.current.fitBounds(h,{padding:80,maxZoom:16})}};o.useEffect(()=>{or().then(h=>{var k;u.current&&(C(h),(k=x.current)==null||k.on("click",z=>{const{lng:K,lat:y}=z.lngLat||{};K==null||y==null||(O({lat:y,lng:K}),de(K,y),fetch(`https://api.maptiler.com/geocoding/${K},${y}.json?key=${Xt}&language=ja&limit=1`).then(M=>M.json()).then(M=>{var Ce;const $=(Ce=M==null?void 0:M.features)==null?void 0:Ce[0],q=$==null?void 0:$.place_name,U=$==null?void 0:$.text;q&&B(q),U&&_(U)}).catch(()=>{}))}))}).catch(()=>{})},[]),o.useEffect(()=>{x.current&&I()},[r]);const c=h=>{b.current.forEach(k=>{k.id===h?(k.el.classList.add("bg-brand-gold","scale-105"),k.el.classList.remove("bg-brand-dark")):(k.el.classList.remove("bg-brand-gold","scale-105"),k.el.classList.add("bg-brand-dark"))})};return o.useEffect(()=>{const h=new AbortController,k=w.trim();if(k.length<2){be([]);return}return ee(!0),fetch(`https://api.maptiler.com/geocoding/${encodeURIComponent(k)}.json?key=${Xt}&language=ja&limit=5`,{signal:h.signal}).then(z=>z.json()).then(z=>be((z==null?void 0:z.features)||[])).catch(()=>be([])).finally(()=>ee(!1)),()=>h.abort()},[w]),e.jsxs("section",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-stone-200 bg-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 py-4 flex items-center justify-between gap-6",children:e.jsx("button",{onClick:n,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-8 w-auto"})})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 min-h-[calc(100vh-64px)]",children:[e.jsxs("div",{className:"px-4 md:px-12 py-12 space-y-8 overflow-y-auto h-[calc(100vh-96px)] bg-brand-base/60",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:t,className:"text-sm text-brand-dark font-bold hover:underline flex items-center gap-2",children:"< Workspace"}),e.jsx("div",{className:"text-xs text-stone-500 font-bold",children:"Step 2 / 5"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-3xl font-serif font-bold text-brand-dark",children:"ゲームルート情報 (Route Info)"}),e.jsx("p",{className:"text-sm text-stone-700 leading-relaxed",children:"プレイヤーが巡るチェックポイントを追加してください。魅力的なスポットをつなぎ合わせ、一本の線を描きましょう。"})]}),e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{className:"rounded-3xl bg-white border border-stone-200 p-5 shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold mb-1",children:"Add New Spot"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"スポットの追加"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-extrabold text-brand-dark block mb-1",children:"場所名 (Place Name)"}),e.jsx("input",{value:i,onChange:h=>_(h.target.value),placeholder:"例：中之島図書館 正面階段",className:"w-full px-4 py-3 rounded-xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-sm font-extrabold text-brand-dark block mb-1",children:"所在地 (Address)"}),e.jsx("input",{value:w,onChange:h=>B(h.target.value),placeholder:"住所やランドマークで検索",className:"w-full px-4 py-3 rounded-xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"}),R.length>0&&e.jsxs("div",{className:"mt-2 rounded-2xl border border-stone-200 bg-white shadow-lg max-h-56 overflow-auto z-10",children:[R.map(h=>e.jsx("button",{onMouseDown:k=>{var $,q,U;k.preventDefault();const[z,K]=(h==null?void 0:h.center)||[],y=(h==null?void 0:h.place_name)||"";y&&B(y),K&&z&&(O({lat:K,lng:z}),de(z,K)),h!=null&&h.text&&_(h.text);const M=je(h);(U=x.current)==null||U.jumpTo({center:[z,K],zoom:M??((q=($=x.current)==null?void 0:$.getZoom)==null?void 0:q.call($))??12}),be([])},className:"w-full text-left px-4 py-2 text-sm text-brand-dark hover:bg-brand-base",children:h==null?void 0:h.place_name},h.id)),Y&&e.jsx("div",{className:"px-4 py-2 text-xs text-stone-500",children:"検索中..."})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:Se,className:"px-5 py-3 rounded-full bg-brand-dark text-white text-sm font-bold hover:bg-brand-gold transition-colors shadow-lg disabled:opacity-60",disabled:!i.trim()||!w.trim()||!L,children:"スポットを追加 (Add Spot)"})})]})]}),e.jsxs("div",{className:"rounded-3xl bg-white border border-stone-200 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Saved Spots"}),e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:"保存されたスポット一覧"})]}),e.jsx("p",{className:"text-xs text-stone-500",children:"ドラッグで順番を変更できます"})]}),e.jsxs("div",{className:"space-y-3 relative",children:[r.length===0&&e.jsx("div",{className:"text-sm text-stone-500 bg-brand-base border border-dashed border-stone-300 rounded-2xl px-4 py-6 text-center",children:"まだスポットがありません。上のフォームから追加してください。"}),r.map((h,k)=>{const z=k>0?r[k-1]:null,K=z?A(z,h):0,y=z?K>te:!1;return e.jsxs("div",{draggable:!0,onDragStart:M=>Z(h.id,M),onDragOver:M=>me(h.id,M),onDrop:M=>E(h.id,M),onDragEnd:()=>he(null),onMouseEnter:()=>c(h.id),onMouseLeave:()=>c(null),className:"relative pl-6 cursor-move",children:[k<r.length-1&&e.jsx("div",{className:"absolute left-4 top-12 bottom-0 flex flex-col items-center pointer-events-none",children:e.jsx("div",{className:"flex-1 border-l border-dashed border-stone-300 w-px"})}),z&&e.jsxs("div",{className:"absolute left-8 -top-3 text-[11px] text-stone-500",children:["区間距離: ",K.toFixed(2)," km",y&&e.jsx("span",{className:"ml-2 text-rose-600 font-bold",children:"500m以内に調整してください"})]}),e.jsxs("div",{className:`flex items-start gap-3 bg-white rounded-2xl border ${y?"border-rose-300":"border-stone-200"} px-4 py-3 shadow-sm`,children:[e.jsx("button",{className:"mt-2 text-stone-400 hover:text-brand-gold transition-colors",title:"順番を入れ替える",children:e.jsx(Kr,{size:18})}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-dark text-white flex items-center justify-center font-bold text-lg",children:k+1})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("p",{className:"text-sm font-bold text-brand-dark flex items-center gap-2",children:[h.name,h.status==="complete"&&e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 border border-emerald-200",children:"✅ 完成"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-stone-400",children:[e.jsx("button",{className:"hover:text-brand-gold",title:"編集",onClick:()=>g(h.id),children:e.jsx(Kt,{size:16})}),e.jsx("button",{onClick:()=>fe(h.id),className:"hover:text-rose-500",title:"削除",children:e.jsx(ma,{size:16})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-brand-base border border-stone-200 overflow-hidden flex items-center justify-center text-[10px] text-stone-500",children:"サムネ"}),e.jsx("p",{className:"text-xs text-stone-500 leading-relaxed",children:h.address})]})]})]})]},h.id)})]})]}),e.jsxs("div",{className:"rounded-3xl bg-white border border-dashed border-stone-300 p-6 text-center shadow-inner",children:[e.jsx("p",{className:"text-sm font-bold text-brand-dark mb-2",children:"カバー写真の設定 (Cover Photo)"}),e.jsx("p",{className:"text-xs text-stone-500 mb-4",children:"この画像はクエストの表紙としてアプリ内に表示されます。"}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"px-5 py-3 rounded-full border border-stone-300 bg-white text-sm font-bold text-brand-dark shadow-sm cursor-pointer",children:"ファイルをアップロード"}),e.jsx("div",{className:"text-xs text-stone-400",children:"またはドラッグ＆ドロップ"})]})]}),e.jsxs("div",{className:"bg-brand-dark text-white border-brand-dark rounded-3xl border p-5 shadow-inner space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(er,{size:18,className:"text-white"}),e.jsx("p",{className:"text-sm font-bold",children:"すべての条件をクリアしました"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",readOnly:!0,checked:ke.minSpots,className:"accent-brand-gold"}),"10箇所以上のスポットを追加（最大15）"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",readOnly:!0,checked:ke.notTooFar,className:"accent-brand-gold"}),"スポット間の距離が適切です"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",readOnly:!0,checked:ke.withinRange,className:"accent-brand-gold"}),"総距離が1km〜5kmの範囲内です"]}),e.jsxs("div",{className:"text-xs",children:["現在: 総距離 ",V.toFixed(2),"km / 最大セグメント ",oe.toFixed(2),"km"]})]}),e.jsx("div",{className:"flex justify-end pt-1",children:e.jsx("button",{onClick:a,disabled:!1,className:"px-5 py-3 rounded-full text-sm font-bold transition-colors shadow-lg bg-white text-brand-dark hover:bg-brand-gold hover:text-white",children:"このステップを完了する"})})]})]})]}),e.jsxs("div",{className:"relative bg-white border-l border-stone-200 h-[calc(100vh-64px)] lg:sticky lg:top-0",children:[e.jsx("div",{ref:u,className:"absolute inset-0 w-full h-full"}),!Xt]})]})]})}const Ho=({mode:t,setMode:a,status:n,onSubmit:r,onBackHome:m,error:g})=>{const[d,u]=o.useState(""),[x,b]=o.useState(""),[f,v]=o.useState(""),p={login:"ログイン",signup:"新規登録",forgot:"パスワード再設定"},i={login:"アカウントにアクセスして、作成したクエストやプレイ履歴を管理します。",signup:"TOMOSHIBIクリエイター/プレイヤーとしての新しい旅を始めましょう。",forgot:"登録メールアドレス宛に再設定リンクを送信します。"},_=w=>{w.preventDefault(),r({email:d,password:x,confirmPassword:f})};return e.jsxs("section",{className:"pt-28 pb-16 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-hero-glow opacity-80 pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/70 via-transparent to-brand-base/80"}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 relative",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-stone-600 mb-6",children:[e.jsx("button",{onClick:m,className:"hover:text-brand-dark underline underline-offset-4",children:"LPに戻る"}),e.jsx("span",{className:"text-stone-400",children:"/"}),e.jsx("span",{className:"text-brand-dark font-bold",children:p[t]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-10 items-center",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-gold/10 text-brand-gold border border-brand-gold/30 rounded-full text-xs font-bold tracking-widest",children:["ACCOUNT",e.jsx(Be,{size:14})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-serif font-bold text-brand-dark leading-tight",children:p[t]}),e.jsx("p",{className:"text-stone-600 text-base leading-relaxed max-w-xl",children:i[t]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-stone-600",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/80 border border-stone-200 rounded-xl px-3 py-2 shadow-sm",children:[e.jsx(xa,{size:16,className:"text-brand-gold"}),e.jsx("span",{children:"認証は安全に暗号化"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white/80 border border-stone-200 rounded-xl px-3 py-2 shadow-sm",children:[e.jsx(ia,{size:16,className:"text-brand-gold"}),e.jsx("span",{children:"通知・リマインドを受け取る"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white/80 border border-stone-200 rounded-xl px-3 py-2 shadow-sm",children:[e.jsx(Ot,{size:16,className:"text-brand-gold"}),e.jsx("span",{children:"クエスト進行と実績を保存"})]})]})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur border border-white/80 rounded-3xl p-8 shadow-2xl space-y-6",children:[e.jsxs("div",{className:"flex gap-2 text-sm",children:[e.jsx("button",{onClick:()=>a("login"),className:`flex-1 py-2 rounded-full border font-bold ${t==="login"?"bg-brand-dark text-white border-brand-dark":"bg-brand-base text-brand-dark border-stone-200"}`,children:"ログイン"}),e.jsx("button",{onClick:()=>a("signup"),className:`flex-1 py-2 rounded-full border font-bold ${t==="signup"?"bg-brand-dark text-white border-brand-dark":"bg-brand-base text-brand-dark border-stone-200"}`,children:"新規登録"}),e.jsx("button",{onClick:()=>a("forgot"),className:`flex-1 py-2 rounded-full border font-bold ${t==="forgot"?"bg-brand-dark text-white border-brand-dark":"bg-brand-base text-brand-dark border-stone-200"}`,children:"パスワード再設定"})]}),n==="success"?e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-xl flex items-center gap-2",children:[e.jsx(ot,{size:18}),e.jsx("span",{children:t==="forgot"?"再設定リンクをメールで送信しました。ご確認ください。":"認証が成功しました。ダッシュボードへリダイレクトします。"})]}):e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[g&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:g}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"メールアドレス"}),e.jsx("input",{type:"email",required:!0,value:d,onChange:w=>u(w.target.value),className:"w-full px-4 py-3 rounded-xl border border-stone-200 bg-stone-50 focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),t!=="forgot"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"パスワード"}),e.jsx("input",{type:"password",required:!0,value:x,onChange:w=>b(w.target.value),className:"w-full px-4 py-3 rounded-xl border border-stone-200 bg-stone-50 focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),t==="signup"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold text-brand-dark",children:"パスワード確認"}),e.jsx("input",{type:"password",required:!0,value:f,onChange:w=>v(w.target.value),className:"w-full px-4 py-3 rounded-xl border border-stone-200 bg-stone-50 focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsx("button",{type:"submit",disabled:n==="submitting",className:"w-full bg-brand-dark text-white py-3 rounded-full font-bold hover:bg-brand-gold transition-colors flex items-center justify-center gap-2 disabled:opacity-70",children:n==="submitting"?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):p[t]})]}),t!=="login"&&e.jsx("button",{onClick:()=>a("login"),className:"text-sm text-brand-gold font-bold underline",children:"ログインに戻る"}),t==="login"&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-stone-600",children:[e.jsx("button",{onClick:()=>a("forgot"),className:"underline hover:text-brand-dark",children:"パスワードをお忘れですか？"}),e.jsx("button",{onClick:()=>a("signup"),className:"underline hover:text-brand-dark",children:"新規登録する"})]})]})]})]})]})},Qo=({onBackHome:t,onGoAuth:a,onOpenOnboarding:n,t:r})=>e.jsxs("section",{className:"min-h-screen relative overflow-hidden font-sans text-brand-dark",style:{backgroundColor:"#f7f0e5"},children:[e.jsx("div",{className:"fixed inset-0 pointer-events-none opacity-[0.03] bg-[url('https://grainy-gradients.vercel.app/noise.svg')] mix-blend-overlay"}),e.jsx("div",{className:"relative pt-48 pb-20 px-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 lg:gap-20 items-center",children:[e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-left",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-brand-gold/10 text-brand-gold border border-brand-gold/20 text-xs font-bold tracking-widest uppercase mb-6",children:[e.jsx(Be,{size:12}),r.hero.badge]}),e.jsxs("h1",{className:"text-5xl lg:text-7xl font-bold font-serif leading-[1.1] mb-6 tracking-tight whitespace-pre-line",children:[r.hero.title.split(`
`)[0]," ",e.jsx("br",{}),e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-brand-gold to-amber-600",children:r.hero.title.split(`
`)[1]})]}),e.jsx("p",{className:"text-xl text-stone-500 leading-relaxed mb-8 max-w-lg",children:r.hero.subtitle}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("button",{onClick:n,className:"group relative px-8 py-4 rounded-full bg-brand-dark text-white font-bold text-lg overflow-hidden shadow-xl shadow-brand-dark/25 hover:shadow-2xl hover:shadow-brand-dark/30 transition-all duration-300",children:[e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[r.hero.btnCreate,e.jsx(xt,{size:18,className:"group-hover:translate-x-1 transition-transform"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-stone-800 to-stone-900 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("button",{onClick:()=>{var m;return(m=document.getElementById("features"))==null?void 0:m.scrollIntoView({behavior:"smooth"})},className:"px-8 py-4 rounded-full border border-stone-200 bg-white text-stone-600 font-bold text-lg hover:bg-stone-50 transition-colors",children:r.hero.btnLearnMore})]})]}),e.jsx(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.1},className:"relative h-[500px] hidden lg:block",children:e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-50 to-stone-100 rounded-[2.5rem] overflow-hidden border border-white shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?auto=format&fit=crop&w=1200&q=80')] bg-cover bg-center opacity-30 mix-blend-multiply grayscale"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-stone-50 via-transparent to-transparent"}),e.jsxs(N.div,{animate:{y:[0,-10,0]},transition:{duration:6,repeat:1/0,ease:"easeInOut"},className:"absolute top-12 right-12 bg-white/90 backdrop-blur p-4 rounded-xl shadow-lg border border-white/50 w-64",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-base flex items-center justify-center text-brand-gold",children:e.jsx(Fe,{size:16})}),e.jsxs("div",{children:[e.jsx("div",{className:"h-2 w-24 bg-stone-200 rounded-full mb-1.5"}),e.jsx("div",{className:"h-1.5 w-16 bg-stone-100 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-12 w-full bg-stone-50 rounded-lg border border-stone-100"}),e.jsx("div",{className:"h-12 w-full bg-stone-50 rounded-lg border border-stone-100"})]})]}),e.jsxs(N.div,{animate:{y:[0,15,0]},transition:{duration:7,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute bottom-16 left-12 bg-white/90 backdrop-blur p-5 rounded-xl shadow-lg border border-white/50 w-72",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-xs font-bold text-stone-400 uppercase tracking-wider",children:"Revenue Share"}),e.jsx("span",{className:"text-emerald-500 text-xs font-bold",children:"+12%"})]}),e.jsxs("div",{className:"flex items-baseline gap-1 mb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-brand-dark",children:"¥24,800"}),e.jsx("span",{className:"text-sm text-stone-500",children:"/ mo"})]}),e.jsx("div",{className:"h-1.5 w-full bg-stone-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full w-[70%] bg-brand-gold rounded-full"})})]})]})})]})})}),e.jsx("div",{id:"features",className:"py-24 px-4 bg-white relative",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold font-serif mb-4",children:r.whyCreate.title}),e.jsx("p",{className:"text-stone-500 text-lg max-w-2xl mx-auto",children:r.whyCreate.subtitle})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 auto-rows-[minmax(280px,auto)]",children:[e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"md:col-span-2 bg-stone-50 rounded-3xl p-8 md:p-10 border border-stone-100 relative overflow-hidden group",children:[e.jsxs("div",{className:"relative z-10 h-full flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-sm mb-6 text-brand-gold border border-stone-100",children:e.jsx(Ka,{size:24})}),e.jsx("h3",{className:"text-2xl font-bold mb-3",children:r.whyCreate.revenueTitle}),e.jsx("p",{className:"text-stone-500 leading-relaxed max-w-md",children:r.whyCreate.revenueDesc})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:n,className:"text-sm font-bold underline underline-offset-4 decoration-stone-300 hover:decoration-brand-gold transition-colors",children:r.whyCreate.revenueLink})})]}),e.jsx("div",{className:"absolute right-0 bottom-0 w-1/2 h-full bg-gradient-to-l from-white/50 to-transparent pointer-events-none md:block hidden",children:e.jsxs("div",{className:"absolute bottom-8 right-8 bg-white p-4 rounded-xl shadow-lg border border-stone-100 rotate-[-6deg] group-hover:rotate-0 transition-transform duration-500",children:[e.jsx("div",{className:"text-xs text-stone-400 uppercase tracking-wider mb-1",children:r.whyCreate.revenueEarnings}),e.jsx("div",{className:"text-2xl font-bold text-brand-dark",children:"¥50,000+"})]})})]}),e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:.1},className:"md:row-span-2 bg-brand-dark text-white rounded-3xl p-8 md:p-10 relative overflow-hidden flex flex-col justify-between",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center backdrop-blur-sm mb-6 text-brand-gold border border-white/10",children:e.jsx(Be,{size:24})}),e.jsx("h3",{className:"text-2xl font-bold mb-3",children:r.whyCreate.aiTitle}),e.jsx("p",{className:"text-white/60 leading-relaxed",children:r.whyCreate.aiDesc})]}),e.jsxs("div",{className:"relative h-48 mt-8 rounded-xl bg-white/5 border border-white/10 p-4 font-mono text-xs text-brand-gold/80 overflow-hidden",children:[e.jsxs("div",{className:"opacity-50",children:["> Generating clue...",e.jsx("br",{}),'> "Look for the stone lion..."',e.jsx("br",{}),"> Analysis: 95% fun rating"]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-brand-dark via-transparent to-transparent"})]})]}),e.jsx(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:.2},className:"bg-white rounded-3xl p-8 border border-stone-200 shadow-sm flex flex-col justify-between group hover:border-brand-gold/50 transition-colors",children:e.jsxs("div",{children:[e.jsx("div",{className:"w-12 h-12 bg-stone-50 rounded-2xl flex items-center justify-center mb-6 text-stone-400 group-hover:text-brand-gold transition-colors",children:e.jsx(Dt,{size:24})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:r.whyCreate.globalTitle}),e.jsx("p",{className:"text-stone-500 text-sm",children:r.whyCreate.globalDesc})]})}),e.jsx(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:.3},className:"bg-gradient-to-br from-amber-50 to-white rounded-3xl p-8 border border-stone-200 shadow-sm flex flex-col justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-2xl flex items-center justify-center mb-6 text-amber-500 shadow-sm",children:e.jsx(Ot,{size:24})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:r.whyCreate.portfolioTitle}),e.jsx("p",{className:"text-stone-500 text-sm",children:r.whyCreate.portfolioDesc})]})})]})]})}),e.jsx("div",{className:"py-24 px-4 bg-stone-50",children:e.jsx(Eo,{t:r.features})}),e.jsx(Ao,{t:r.revenueSimulator}),e.jsx("div",{className:"py-24 px-4 bg-white",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(Yt,{subtitle:r.howItWorks.subtitle,children:r.howItWorks.title}),e.jsxs("div",{className:"relative mt-16",children:[e.jsx("div",{className:"absolute top-0 bottom-0 left-[27px] md:left-1/2 w-0.5 bg-stone-200 -z-10"}),r.howItWorks.steps.map((m,g)=>e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:g*.2},className:`flex flex-col md:flex-row gap-8 md:gap-0 items-start md:items-center mb-16 last:mb-0 ${g%2===0?"md:flex-row-reverse":""}`,children:[e.jsx("div",{className:"flex-1 md:w-1/2"}),e.jsx("div",{className:"w-14 h-14 rounded-full bg-brand-dark text-white border-4 border-white shadow-xl flex items-center justify-center shrink-0 z-10 relative",children:e.jsx("span",{className:"font-bold font-serif text-lg",children:g+1})}),e.jsxs("div",{className:`flex-1 md:w-1/2 ${g%2===0?"md:pr-12 md:text-right":"md:pl-12"}`,children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:m.title}),e.jsx("p",{className:"text-stone-500 leading-relaxed",children:m.description})]})]},m.title))]})]})}),e.jsx("div",{className:"py-32 px-4 text-center relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10 max-w-3xl mx-auto",children:[e.jsx("h2",{className:"text-4xl md:text-6xl font-serif font-bold mb-6 text-brand-dark",children:r.cta.title}),e.jsx("p",{className:"text-xl text-stone-600 mb-10",children:r.cta.subtitle}),e.jsx("button",{onClick:n,className:"group px-10 py-5 bg-brand-dark text-white rounded-full font-bold text-lg hover:bg-brand-gold hover:text-brand-dark transition-colors shadow-2xl hover:shadow-brand-gold/20",children:r.cta.button})]})})]});function Vo({onLogoHome:t,onBack:a,onComplete:n,questTitle:r,questDescription:m,questLocation:g,questLatLng:d,routeSpots:u,storySettings:x,questId:b,userId:f,userEmail:v,questCategoryTags:p,setQuestCategoryTags:i,questHashtags:_,setQuestHashtags:w}){const[B,L]=o.useState({core:!1,route:!1,story:!1}),[O,R]=o.useState(""),[be,Y]=o.useState(!1),ee=Object.values(B).every(Boolean)&&be,[P,he]=o.useState("idle"),re=[{value:"デートに最適",desc:"2人でわいわい"},{value:"家族で",desc:"お子様もOK"},{value:"ナイトクエスト",desc:"夜景と謎解き"},{value:"歴史ロマン",desc:"街の物語"},{value:"はじめて",desc:"難易度ひかえめ"}],[xe,te]=o.useState(""),[A,Z]=o.useState("idle"),[me,E]=o.useState(null),V=async()=>{if(!(!O.trim()||P==="sending")){he("sending");try{const{data:C,error:ve}=await D.from("profiles").select("id").eq("role","admin");if(ve)throw ve;const de=(C||[]).map(k=>k.id).filter(Boolean);if(de.length===0)throw new Error("管理者が見つかりませんでした");const I=`クリエイター問い合わせ: ${r||"無題クエスト"}`,c=`${O.trim()}

from: ${v||f||"不明ユーザー"}
quest: ${r||"不明"}${b?` (${b})`:""}`,h=de.map(k=>({user_id:k,title:I,message:c,type:"creator_question"}));await D.from("notifications").insert(h),he("success"),Y(!0)}catch{he("error")}}},oe=C=>{i(ve=>ve.includes(C)?ve.filter(de=>de!==C):[...ve,C])},ke=()=>{const C=xe.trim();if(!C)return;const ve=C.startsWith("#")?C:`#${C}`;if(_.includes(ve)){te("");return}w([..._,ve]),te("")},je=C=>{w(_.filter(ve=>ve!==C))},ie=async()=>{if(!b)return E("クエストIDがありません。Step1を保存してください。"),!1;Z("saving"),E(null);const C=[...p,..._];try{return await D.from("quests").update({tags:C,category_tags:p,hashtag_tags:_}).eq("id",b),Z("idle"),!0}catch(ve){return Z("error"),E((ve==null?void 0:ve.message)||"タグの保存に失敗しました"),!1}},Se=async()=>{await ie()&&n()},fe=u.map((C,ve)=>{var k,z,K,y,M;const de=(((k=C.details)==null?void 0:k.storyText)||"").trim().length>0,I=(((z=C.details)==null?void 0:z.challengeText)||"").trim().length>0,c=((K=C.details)==null?void 0:K.answerType)==="choice"?(((y=C.details)==null?void 0:y.choiceOptions)||[]).length>0:(((M=C.details)==null?void 0:M.answerText)||"").trim().length>0;return{idx:ve,spot:C,isComplete:de&&I&&c,missing:[de?null:"ストーリー",I?null:"問題文",c?null:"回答設定"].filter(Boolean)}}),Me=x.scenario.length;return e.jsxs("section",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-stone-200 bg-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 py-4 flex items-center justify-between gap-6",children:e.jsx("button",{onClick:t,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-8 w-auto"})})})}),e.jsxs("div",{className:"container mx-auto px-4 md:px-10 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:a,className:"text-sm text-brand-dark font-bold hover:underline flex items-center gap-2",children:"< Workspace"}),e.jsx("div",{className:"text-xs text-stone-500 font-bold",children:"Step 4 / 5"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-6 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Final Review"}),e.jsx("h1",{className:"text-3xl font-serif font-bold text-brand-dark mt-2",children:"最終確認"}),e.jsx("p",{className:"text-sm text-stone-700 mt-3 leading-relaxed",children:"ここでは現地に行かずに、Step1〜3で作成した内容をまとめて確認できます。公開カード用のカテゴリ/ハッシュタグ設定と、運営への問い合わせを済ませた上で「確認済み」にチェックし、ステップを完了してください。"})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-6 shadow-sm space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-brand-dark flex items-center gap-2",children:[e.jsx(er,{size:18,className:"text-brand-gold"}),"制作内容サマリー"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-2xl border border-stone-200 p-4 bg-brand-base/60",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs text-stone-500 font-bold",children:"Step1"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-stone-600",children:[e.jsx("input",{type:"checkbox",checked:B.core,onChange:()=>L(C=>({...C,core:!C.core})),className:"rounded border-stone-300 text-brand-dark"}),"確認済み"]})]}),e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:r||"タイトル未設定"}),e.jsx("p",{className:"text-xs text-stone-600 line-clamp-2 mt-1",children:m||"説明未入力"}),e.jsxs("div",{className:"text-xs text-stone-600 mt-2",children:[e.jsxs("div",{children:["エリア: ",g||"未設定"]}),d&&e.jsxs("div",{children:["座標: ",d.lat.toFixed(4),", ",d.lng.toFixed(4)]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-stone-200 p-4 bg-brand-base/60",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs text-stone-500 font-bold",children:"Step2"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-stone-600",children:[e.jsx("input",{type:"checkbox",checked:B.route,onChange:()=>L(C=>({...C,route:!C.route})),className:"rounded border-stone-300 text-brand-dark"}),"確認済み"]})]}),u.length===0?e.jsx("p",{className:"text-sm text-stone-500",children:"スポット未登録（Step2で追加してください）"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-1",children:fe.map(({spot:C,idx:ve,isComplete:de,missing:I})=>e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-dark text-white flex items-center justify-center text-xs font-bold",children:ve+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-bold text-brand-dark",children:C.name||`Spot ${ve+1}`}),e.jsx("span",{className:`text-[11px] px-2 py-1 rounded-full border ${de?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-amber-50 text-amber-700 border-amber-200"}`,children:de?"OK":`未完: ${I.join("・")}`})]}),e.jsx("p",{className:"text-xs text-stone-500",children:C.address||"住所未設定"})]})]},C.id))})]}),e.jsxs("div",{className:"rounded-2xl border border-stone-200 p-4 bg-brand-base/60 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs text-stone-500 font-bold",children:"Step3"}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-stone-600",children:[e.jsx("input",{type:"checkbox",checked:B.story,onChange:()=>L(C=>({...C,story:!C.story})),className:"rounded border-stone-300 text-brand-dark"}),"確認済み"]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3 text-sm text-stone-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500",children:"案内人"}),e.jsx("p",{className:"font-bold text-brand-dark",children:x.castName||"未設定"}),e.jsx("p",{className:"text-xs text-stone-500",children:x.castTone||"トーン未設定"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500",children:"登場人物"}),e.jsxs("p",{className:"font-bold text-brand-dark",children:[x.characters.length," 名"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-stone-500",children:"シナリオフロー"}),e.jsxs("p",{className:"font-bold text-brand-dark",children:[Me," ブロック"]})]})]}),e.jsxs("div",{className:"mt-3 grid md:grid-cols-2 gap-3 text-sm text-stone-700",children:[e.jsxs("div",{className:"rounded-xl border border-stone-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"プロローグ"}),e.jsx("p",{className:"font-bold text-brand-dark",children:x.prologueTitle||"タイトル未設定"}),e.jsx("p",{className:"text-xs text-stone-600 line-clamp-2",children:(x.prologueBody||"本文未入力").replace(/\s+/g," ").trim()})]}),e.jsxs("div",{className:"rounded-xl border border-stone-200 bg-white p-3",children:[e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"エピローグ"}),e.jsx("p",{className:"text-xs text-stone-600 line-clamp-3",children:(x.epilogueBody||"未入力").replace(/\s+/g," ").trim()}),x.socialMessage&&e.jsxs("p",{className:"text-[11px] text-emerald-700 bg-emerald-50 border border-emerald-100 rounded-lg px-2 py-1 mt-2",children:["ソーシャル: ",x.socialMessage]})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-6 shadow-sm space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-brand-dark flex items-center gap-2",children:[e.jsx(tl,{size:18,className:"text-brand-gold"}),"カード用カテゴリ & ハッシュタグ"]}),e.jsx("p",{className:"text-sm text-stone-600",children:"公開カードに表示するカテゴリをクリックで選択し、自由入力の #タグ も追加できます。"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-3",children:re.map(C=>{const ve=p.includes(C.value);return e.jsxs("button",{onClick:()=>oe(C.value),className:`w-full text-left rounded-2xl border px-4 py-3 transition-all ${ve?"border-brand-dark bg-brand-dark text-white":"border-stone-200 bg-brand-base hover:border-brand-gold"}`,children:[e.jsx("p",{className:"text-sm font-bold",children:C.value}),e.jsx("p",{className:`text-xs ${ve?"text-white/80":"text-stone-500"}`,children:C.desc})]},C.value)})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{value:xe,onChange:C=>te(C.target.value),placeholder:"#デートプラン など",className:"flex-1 rounded-2xl border border-stone-200 bg-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40"}),e.jsx("button",{onClick:ke,className:"px-4 py-3 rounded-full bg-brand-dark text-white text-sm font-bold hover:bg-brand-gold transition-colors shadow",children:"#を追加"}),e.jsx("button",{onClick:ie,disabled:A==="saving",className:"px-4 py-3 rounded-full border border-stone-300 text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold transition-colors shadow-sm",children:A==="saving"?"保存中...":"タグを保存"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[[...p,..._].length===0&&e.jsx("span",{className:"text-xs text-stone-500",children:"まだタグがありません"}),p.map(C=>e.jsxs("span",{className:"text-xs bg-brand-dark text-white px-3 py-1 rounded-full border border-brand-dark",children:["#",C]},C)),_.map(C=>e.jsxs("button",{onClick:()=>je(C),className:"text-xs bg-amber-50 text-amber-800 px-3 py-1 rounded-full border border-amber-200 hover:border-amber-400 transition-colors",children:[C," ×"]},C))]}),me&&e.jsx("p",{className:"text-xs text-rose-600",children:me})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-6 shadow-sm space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-brand-dark flex items-center gap-2",children:[e.jsx(Ms,{size:18,className:"text-brand-gold"}),"チェックリスト"]}),e.jsxs("ul",{className:"space-y-3 text-sm text-stone-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ks,{size:16,className:"text-emerald-600 mt-0.5"})," 移動ルートに迷わないか？"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ks,{size:16,className:"text-emerald-600 mt-0.5"})," 各スポット間は500m以内か？"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ks,{size:16,className:"text-emerald-600 mt-0.5"})," 物語のトーンが一貫しているか？"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ks,{size:16,className:"text-emerald-600 mt-0.5"})," 正解入力やヒントの導線は分かりやすいか？"]})]})]}),e.jsxs("div",{className:"bg-brand-base rounded-3xl border border-dashed border-stone-300 p-6 shadow-inner",children:[e.jsx("p",{className:"text-sm text-stone-700 mb-3",children:"運営への確認・質問（任意）"}),e.jsx("textarea",{value:O,onChange:C=>R(C.target.value),placeholder:"気づいたことや質問をメモしてください。送信すると管理者に通知されます。",className:"w-full h-28 rounded-2xl border border-stone-200 bg-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-3 items-center",children:[e.jsxs("button",{onClick:V,disabled:!O.trim()||P==="sending",className:`px-4 py-2 rounded-full text-sm font-bold border shadow-sm flex items-center gap-2 ${O.trim()&&P!=="sending"?"bg-brand-dark text-white border-brand-dark hover:bg-brand-gold":"bg-stone-100 text-stone-400 border-stone-200 cursor-not-allowed"}`,children:[e.jsx(As,{size:16}),P==="sending"?"送信中...":"問い合わせを送信"]}),P==="success"&&e.jsx("span",{className:"text-xs text-emerald-700",children:"管理者へ送信しました"}),P==="error"&&e.jsx("span",{className:"text-xs text-rose-600",children:"送信に失敗しました。時間を置いて再試行してください。"})]}),e.jsxs("label",{className:"mt-3 inline-flex items-center gap-2 text-sm text-stone-700",children:[e.jsx("input",{type:"checkbox",checked:be,onChange:()=>Y(C=>!C),className:"rounded border-stone-300 text-brand-dark"}),"質問はありません／問い合わせ済みです（チェック必須）"]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:Se,disabled:!ee,className:`px-5 py-3 rounded-full text-sm font-bold transition-colors shadow-lg ${ee?"bg-brand-dark text-white hover:bg-brand-gold":"bg-stone-200 text-stone-500 cursor-not-allowed"}`,children:"確認済みとしてステップを完了する"}),e.jsx("button",{onClick:a,className:"px-5 py-3 rounded-full border border-stone-300 text-brand-dark text-sm font-bold hover:border-brand-gold hover:text-brand-gold transition-colors shadow-sm",children:"ワークスペースへ戻る"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 p-6 shadow-sm space-y-4 h-fit",children:[e.jsx("h4",{className:"text-sm font-bold text-brand-dark uppercase tracking-widest",children:"Next"}),e.jsx("p",{className:"text-lg font-serif font-bold text-brand-dark",children:"公開 (Step 5)"}),e.jsx("p",{className:"text-sm text-stone-700",children:"テストが完了したら、公開申請へ進めます。提出前に気になる箇所があれば、Step 1〜3に戻って微調整してください。確認チェックがすべて完了すると「ステップを完了」が有効になります。"})]})]})]})]})}function Uo({onLogoHome:t,onBackHome:a}){return e.jsxs("section",{className:"min-h-screen bg-white flex flex-col",children:[e.jsx("div",{className:"border-b border-stone-200 bg-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 py-4 flex items-center justify-between gap-6",children:e.jsx("button",{onClick:t,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-8 w-auto"})})})}),e.jsx("div",{className:"flex-1 container mx-auto px-4 md:px-10 py-12 max-w-3xl",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-stone-200 shadow-sm p-8 space-y-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-brand-gold/10 border border-brand-gold/30 flex items-center justify-center",children:e.jsx(As,{className:"text-brand-gold"})}),e.jsx("h1",{className:"text-2xl font-serif font-bold text-brand-dark",children:"申請を受け付けました"}),e.jsx("p",{className:"text-sm text-stone-700 leading-relaxed",children:"運営チームが審査を行い、承認され次第「公開」されます。結果はダッシュボードに反映されますので、しばらくお待ちください。"}),e.jsx("div",{className:"flex justify-center gap-3 mt-4",children:e.jsx("button",{onClick:a,className:"px-5 py-3 rounded-full bg-brand-dark text-white text-sm font-bold hover:bg-brand-gold transition-colors shadow-lg",children:"ワークスペースへ戻る"})})]})})]})}function Go({pending:t,onReview:a}){return e.jsx("section",{className:"min-h-screen bg-white pt-28 pb-12",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-10",children:[e.jsx("h1",{className:"text-3xl font-serif font-bold text-brand-dark mb-2",children:"審査ダッシュボード"}),e.jsx("p",{className:"text-sm text-stone-600 mb-6",children:"pending_review のクエストを一覧表示します。"}),e.jsxs("div",{className:"bg-white border border-stone-200 rounded-2xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-4 text-xs font-bold text-stone-500 px-4 py-3 bg-brand-base",children:[e.jsx("div",{children:"申請日"}),e.jsx("div",{children:"クエスト名"}),e.jsx("div",{children:"クリエイター"}),e.jsx("div",{className:"text-right",children:"アクション"})]}),t.length===0&&e.jsx("div",{className:"px-4 py-6 text-sm text-stone-500",children:"申請中のクエストはありません。"}),t.map(n=>{var r;return e.jsxs("div",{className:"grid grid-cols-4 items-center px-4 py-3 border-t border-stone-100 text-sm",children:[e.jsx("div",{className:"text-stone-600",children:new Date(n.created_at).toLocaleString()}),e.jsx("div",{className:"font-bold text-brand-dark",children:n.title||"タイトル未設定"}),e.jsx("div",{className:"text-stone-700",children:((r=n.profiles)==null?void 0:r.username)||"クリエイター"}),e.jsx("div",{className:"text-right",children:e.jsx("button",{onClick:()=>a(n.id),className:"px-3 py-2 rounded-full bg-brand-dark text-white text-xs font-bold hover:bg-brand-gold",children:"審査する"})})]},n.id)})]})]})})}function Wo({questBundle:t,onBack:a,onApprove:n,onReject:r,loading:m}){var f,v;const[g,d]=o.useState("");if(!t)return e.jsx("section",{className:"min-h-screen bg-white flex items-center justify-center text-stone-500",children:"読み込み中..."});const{quest:u,spots:x,story:b}=t;return e.jsx("section",{className:"min-h-screen bg-white pt-28 pb-12",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-10 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Review"}),e.jsx("h1",{className:"text-3xl font-serif font-bold text-brand-dark",children:u.title||"タイトル未設定"}),e.jsxs("p",{className:"text-sm text-stone-600",children:["申請者: ",((f=u.profiles)==null?void 0:f.username)||"クリエイター"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:n,disabled:m,className:"px-4 py-2 rounded-full bg-emerald-600 text-white text-sm font-bold hover:bg-emerald-700 disabled:opacity-60",children:"承認する"}),e.jsx("button",{onClick:()=>r(g),disabled:m,className:"px-4 py-2 rounded-full bg-rose-500 text-white text-sm font-bold hover:bg-rose-600 disabled:opacity-60",children:"差し戻し"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"bg-white border border-stone-200 rounded-2xl p-5 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-brand-dark mb-2",children:"基本情報"}),e.jsxs("p",{className:"text-sm text-stone-700",children:["エリア: ",u.area_name||"未設定"]}),e.jsx("p",{className:"text-sm text-stone-700 whitespace-pre-line mt-2",children:u.description||"---"})]}),e.jsxs("div",{className:"bg-white border border-stone-200 rounded-2xl p-5 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-brand-dark mb-2",children:"ルート/スポット"}),e.jsx("div",{className:"space-y-3",children:x&&x.length>0?x.map((p,i)=>e.jsxs("div",{className:"flex items-start gap-3 border border-stone-200 rounded-xl p-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-dark text-white flex items-center justify-center text-sm font-bold",children:i+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-brand-dark",children:p.name}),e.jsx("p",{className:"text-xs text-stone-600",children:p.address})]})]},p.id)):e.jsx("p",{className:"text-sm text-stone-600",children:"スポットなし"})})]}),e.jsxs("div",{className:"bg-white border border-stone-200 rounded-2xl p-5 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-brand-dark mb-2",children:"ストーリー"}),e.jsx("p",{className:"text-sm text-stone-700 whitespace-pre-line",children:(b==null?void 0:b.prologue)||"プロローグ未設定"}),e.jsx("div",{className:"mt-3 space-y-2 text-sm text-stone-700",children:((v=b==null?void 0:b.timeline_data)==null?void 0:v.map((p,i)=>e.jsxs("div",{className:"border border-stone-200 rounded-lg px-3 py-2",children:[e.jsx("span",{className:"text-xs text-stone-500",children:p.type}),e.jsx("div",{className:"text-brand-dark",children:p.content||p.text||p.name||""})]},i)))||null}),e.jsx("p",{className:"text-sm text-stone-700 mt-3 whitespace-pre-line",children:(b==null?void 0:b.epilogue)||""})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white border border-stone-200 rounded-2xl p-5 shadow-sm",children:[e.jsx("h4",{className:"text-sm font-bold text-brand-dark mb-2",children:"差し戻し理由（任意）"}),e.jsx("textarea",{value:g,onChange:p=>d(p.target.value),rows:6,className:"w-full rounded-xl border border-stone-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-gold/40",placeholder:"修正依頼があれば記載してください"})]})})]})]})})}function pi(){const t=typeof window<"u"?window.location.pathname:"/";console.log("[DEBUG] LandingPage initialPath:",t);const a=t==="/play"?"player":t==="/about"?"about":t==="/business"?"business":t==="/creator"||t==="/creator/workspace"?"creator-workspace":t==="/creator/analytics"||t.startsWith("/creator/analytics/")?"creator-analytics":t.startsWith("/creator/route-spots/")?"creator-spot-detail":t==="/creator/storytelling"?"creator-storytelling":t==="/creator/test-run"?"creator-test-run":t==="/creator/submitted"?"creator-submitted":t==="/admin"||t==="/admin/dashboard"?"admin-dashboard":t.startsWith("/admin/review/")?"admin-review":"home",n=es(),r=Fr(),[m,g]=o.useState(!1),[d,u]=o.useState(!1),[x,b]=o.useState(null),[f,v]=o.useState("ja"),p=il[f],[i,_]=o.useState(a);o.useEffect(()=>{const s=r.pathname;let l=null;s==="/about"?l="about":s==="/business"?l="business":s.startsWith("/quest/")&&s!=="/quests"?l="quest-detail":s==="/quests"||s==="/quests/"?l="quests":s==="/creators"||s==="/creators/"?l="creators":s==="/auth/login"||s==="/auth/signup"||s==="/auth/forgot"||s==="/auth"?l="auth":s==="/profile"?l="profile":s==="/play"||s==="/player"?l="player":s==="/creator/start"?l="creator-start":s.startsWith("/creator/canvas")?l="creator-canvas":s==="/creator/mystery-setup"?l="creator-mystery-setup":s.startsWith("/creator/route-spots/")?l="creator-spot-detail":s==="/creator/route-spots"?l="creator-route-spots":s.startsWith("/creator/workspace/languages")?l="creator-workspace-languages":s.startsWith("/creator/workspace")?l="creator-workspace":s==="/creator/storytelling"?l="creator-storytelling":s==="/creator/test-run"?l="creator-test-run":s==="/creator/submitted"?l="creator-submitted":s.startsWith("/creator/analytics")?l="creator-analytics":s==="/admin/dashboard"?l="admin-dashboard":s.startsWith("/admin/review/")?l="admin-review":s==="/"&&(l="home"),l!==null&&_(l)},[r.pathname]);const[w,B]=o.useState(null),[L,O]=o.useState("all"),[R,be]=o.useState("popular"),[Y,ee]=o.useState(null),[P,he]=o.useState(null),[re,xe]=o.useState([]),[te,A]=o.useState([]),[Z,me]=o.useState(!1),[E,V]=o.useState(null),[oe,ke]=o.useState(null),[je,ie]=o.useState(!1),[Se,fe]=o.useState("login"),[Me,C]=o.useState("idle"),[ve,de]=o.useState(null),{user:I,profile:c,loading:h,signIn:k,signUp:z,resetPassword:K,signOut:y}=ca(),[M,$]=o.useState(!1),[q,U]=o.useState(!1),[Ce,ze]=o.useState(0),[Ye,Es]=o.useState("mystery"),[et,tt]=o.useState(""),[ms,Xe]=o.useState(""),[_t,it]=o.useState(""),Ge=["デートに最適","家族で","ナイトクエスト","歴史ロマン","はじめて"],[mt,$t]=o.useState([]),[ts,Mt]=o.useState([]),[ht,We]=o.useState(1),[st,dt]=o.useState([]),[hs,Pt]=o.useState(null),[St,pt]=o.useState(null),[ye,at]=o.useState(null),[ps,Rt]=o.useState("PRIVATE"),[ut,Bt]=o.useState({}),[Ls,ss]=o.useState(null),[Ds,qt]=o.useState(!1),[us,Os]=o.useState("SHARE"),[Rs,bt]=o.useState([]),[ct,Ft]=o.useState([]),[as,j]=o.useState([]),[S,Ne]=o.useState([]),[ne,He]=o.useState("all"),[Ie,H]=o.useState(null),[qe,we]=o.useState(null),[Ze,Ct]=o.useState(!1),rs=o.useCallback(async s=>{const l=s||(I==null?void 0:I.id);if(!l){j([]);return}try{const{data:T,error:G}=await D.from("quests").select("id,title").eq("creator_id",l);if(G||!(T!=null&&T.length)){j([]),Ne([]);return}const pe=T.map(ce=>ce.id),{data:ge,error:X}=await D.from("play_sessions").select("quest_id,user_id,ended_at,started_at,duration_sec,hints_used,wrong_answers,solved_spots").in("quest_id",pe),{data:Re,error:F}=await D.from("quest_reviews").select("quest_id,rating,created_at");if(X){j([]),Ne([]);return}F&&console.warn("reviews fetch failed (quest_reviews 無い可能性)",F),Ne(ge||[]);const W=ce=>{const Ve=Date.now(),De=ce*24*60*60*1e3;return(ge||[]).filter(_e=>{const se=_e.ended_at?Date.parse(_e.ended_at):_e.started_at?Date.parse(_e.started_at):null;return se?Ve-se<=De:!0})},Ee=ne==="all"?ge||[]:W(ne==="30d"?30:7),Te=(Re||[]).filter(ce=>pe.includes(ce.quest_id)),Le=ne==="all"?Te:Te.filter(ce=>{const Ve=ce.created_at?Date.parse(ce.created_at):null;if(!Ve)return!1;const De=Date.now(),_e=ne==="30d"?720*60*60*1e3:10080*60*1e3;return De-Ve<=_e}),J=pe.map(ce=>{var Lt;const Ve=((Lt=T.find(Q=>Q.id===ce))==null?void 0:Lt.title)||"タイトル未設定",De=(Ee||[]).filter(Q=>Q.quest_id===ce),_e=Le.filter(Q=>Q.quest_id===ce&&Q.rating!=null),se=De.length,$e=new Set(De.map(Q=>Q.user_id)).size,It=De.filter(Q=>Q.ended_at!=null).length,jt=De.filter(Q=>Q.duration_sec!=null&&Q.ended_at!=null).map(Q=>Q.duration_sec),ae=De.filter(Q=>Q.hints_used!=null).map(Q=>Q.hints_used),Pe=De.filter(Q=>Q.wrong_answers!=null).map(Q=>Q.wrong_answers),Ke=jt.length>0?Math.round(jt.reduce((Q,ue)=>Q+ue,0)/jt.length/60):null,Oe=ae.length>0?parseFloat((ae.reduce((Q,ue)=>Q+ue,0)/ae.length).toFixed(1)):null,Je=Pe.length>0?parseFloat((Pe.reduce((Q,ue)=>Q+ue,0)/Pe.length).toFixed(1)):null,Et=_e.length>0?parseFloat((_e.reduce((Q,ue)=>Q+(ue.rating||0),0)/_e.length).toFixed(2)):null;return{questId:ce,title:Ve,playCount:se,uniquePlayers:$e,clearCount:It,clearRate:se>0?Math.round(It/se*100):0,avgDurationMin:Ke,avgHints:Oe,avgWrongs:Je,avgRating:Et,reviewCount:_e.length}});j(J)}catch(T){console.warn("creator analytics fetch failed",T),j([]),Ne([])}},[I==null?void 0:I.id,ne]),Tt=o.useCallback(async(s,l)=>{if(!Ze){if(!s){H(null),we(null);return}H(s),Ct(!0),we(null);try{const{data:T,error:G}=await D.from("spots").select("id,name,order_index").eq("quest_id",s).order("order_index",{ascending:!0});if(G){we(null);return}const{data:pe,error:ge}=await D.from("quest_reviews").select("rating,comment,created_at").eq("quest_id",s).order("created_at",{ascending:!1});ge&&console.warn("detail reviews fetch failed",ge);const X=S.filter(ae=>ae.quest_id===s),Re=ae=>{const Pe=Date.now(),Ke=ae*24*60*60*1e3;return X.filter(Oe=>{const Je=Oe.ended_at?Date.parse(Oe.ended_at):Oe.started_at?Date.parse(Oe.started_at):null;return Je?Pe-Je<=Ke:!0})},F=ne==="all"?X:Re(ne==="30d"?30:7),W=F.length,Ee=F.filter(ae=>ae.ended_at!=null).length,Te=F.filter(ae=>ae.duration_sec!=null&&ae.ended_at!=null).map(ae=>ae.duration_sec),Le=F.filter(ae=>ae.hints_used!=null).map(ae=>ae.hints_used),J=F.filter(ae=>ae.wrong_answers!=null).map(ae=>ae.wrong_answers),ce=Te.length>0?Math.round(Te.reduce((ae,Pe)=>ae+Pe,0)/Te.length/60):null,Ve=Le.length>0?parseFloat((Le.reduce((ae,Pe)=>ae+Pe,0)/Le.length).toFixed(1)):null,De=J.length>0?parseFloat((J.reduce((ae,Pe)=>ae+Pe,0)/J.length).toFixed(1)):null,_e=(T==null?void 0:T.length)||0,se=(T||[]).map((ae,Pe)=>{const Ke=Pe+1,Oe=F.filter(ue=>(ue.solved_spots??0)>=Ke-1).length,Je=F.filter(ue=>(ue.solved_spots??0)>=Ke).length,Et=Oe>0?Math.max(0,Math.min(1,(Oe-Je)/Oe)):0,Lt=Oe>0&&_e>0&&Le.length>0?parseFloat((F.filter(ue=>(ue.solved_spots??0)>=Ke-1).reduce((ue,vt)=>ue+(vt.hints_used||0)/_e,0)/Oe).toFixed(2)):null,Q=Oe>0&&_e>0&&J.length>0?parseFloat((F.filter(ue=>(ue.solved_spots??0)>=Ke-1).reduce((ue,vt)=>ue+(vt.wrong_answers||0)/_e,0)/Oe).toFixed(2)):null;return{step:Ke,name:ae.name||`スポット ${Ke}`,reached:Oe,completed:Je,dropRate:Et,avgHints:Lt,avgWrongs:Q}}),$e=ne==="all"?pe||[]:(pe||[]).filter(ae=>{const Pe=ae.created_at?Date.parse(ae.created_at):null;if(!Pe)return!1;const Ke=Date.now(),Oe=ne==="30d"?720*60*60*1e3:10080*60*1e3;return Ke-Pe<=Oe});let It=null,jt=null;try{const{data:ae}=await D.from("gameplay_events").select("event_data").eq("quest_id",s).eq("event_type","session_abandon"),Pe={};(ae||[]).forEach(Q=>{var vt;const ue=((vt=Q.event_data)==null?void 0:vt.last_mode)||"unknown";Pe[ue]=(Pe[ue]||0)+1});const{data:Ke}=await D.from("gameplay_events").select("spot_id, event_data").eq("quest_id",s).eq("event_type","puzzle_submit"),Oe={};(Ke||[]).forEach(Q=>{var vt;const ue=Q.spot_id||"unknown";if(!Oe[ue]){const Ys=T==null?void 0:T.find(Rr=>Rr.id===ue);Oe[ue]={total:0,wrong:0,name:(Ys==null?void 0:Ys.name)||"Unknown"}}Oe[ue].total++,((vt=Q.event_data)==null?void 0:vt.correct)===!1&&Oe[ue].wrong++}),It={dropOffByMode:Object.entries(Pe).map(([Q,ue])=>({mode:Q,count:ue})),puzzleErrorRate:Object.entries(Oe).map(([Q,ue])=>({spotName:ue.name,totalSubmits:ue.total,wrongSubmits:ue.wrong,rate:ue.total>0?ue.wrong/ue.total:0})).sort((Q,ue)=>ue.rate-Q.rate),arrivalFailRate:0,hintUsageRate:Le.length>0&&W>0?Le.filter(Q=>Q>0).length/W:0};const{data:Je}=await D.from("user_feedback").select("category, message, created_at").eq("quest_id",s).order("created_at",{ascending:!1}),Et={},Lt={lost:"迷子",gps_error:"GPS問題",puzzle_hard:"謎が難しい",answer_rejected:"答えが通らない",ui_confusing:"UI分からない",other:"その他"};(Je||[]).forEach(Q=>{Et[Q.category]=(Et[Q.category]||0)+1}),jt={total:(Je==null?void 0:Je.length)||0,byCategory:Object.entries(Et).map(([Q,ue])=>({category:Q,count:ue,label:Lt[Q]||Q})),recent:(Je||[]).slice(0,5).map(Q=>({category:Lt[Q.category]||Q.category,message:Q.message,created_at:Q.created_at}))}}catch(ae){console.warn("gameplay/feedback fetch failed",ae)}we({questId:s,title:l||"クエスト詳細",summary:{playCount:W,clearRate:W>0?Math.round(Ee/W*100):0,avgDurationMin:ce,avgHints:Ve,avgWrongs:De},steps:se,reviews:{avgRating:$e&&$e.length>0?parseFloat(($e.reduce((ae,Pe)=>ae+(Pe.rating||0),0)/$e.length).toFixed(2)):null,count:($e==null?void 0:$e.length)||0,distribution:[1,2,3,4,5].map(ae=>({score:ae,count:($e==null?void 0:$e.filter(Pe=>Pe.rating===ae).length)||0})),latest:($e==null?void 0:$e.slice(0,10).map(ae=>({rating:ae.rating,comment:ae.comment,created_at:ae.created_at})))||[]},gameplayEvents:It,feedbackStats:jt})}catch(T){console.warn("detail analytics fetch failed",T),we(null)}finally{Ct(!1)}}},[ne,S]),[bs,ns]=o.useState(!1),[ir,Bs]=o.useState(!1),[ga,dr]=o.useState(!1),cr=async()=>{if(!(I!=null&&I.id))return;const{data:s,error:l}=await D.from("quests").select("*").eq("creator_id",I.id).order("updated_at",{ascending:!1});!l&&s&&bt(s)},qs=o.useCallback(async()=>{if(!(I!=null&&I.id)){Ft([]);return}const{data:s,error:l}=await D.from("purchases").select("quest_id").eq("user_id",I.id);if(!l&&s){const T=Array.from(new Set((s||[]).map(G=>G.quest_id).filter(Boolean)));Ft(T)}else Ft([])},[I==null?void 0:I.id]),[gt,Ht]=o.useState({castName:"",castTone:"",castIcon:"",prologueTitle:"",prologueBody:"",prologueImage:"",epilogueBody:"",socialMessage:"",epilogueImage:"",characters:[],scenario:[]}),[xr,fa]=o.useState(!1),[mr,ja]=o.useState(null),[hr,Fs]=o.useState(!1),va=o.useCallback(async s=>{if(!s)return;const{data:l,error:T}=await D.from("spots").select("*, spot_details (*)").eq("quest_id",s).order("order_index",{ascending:!0});if(!T&&l){const G=l.map((pe,ge)=>{var Ee;const X=((Ee=pe.spot_details)==null?void 0:Ee[0])||pe.spot_details||null,Re=X!=null&&X.hint_text?String(X.hint_text).split(/\n+/).map(Te=>Te.trim()).filter(Te=>Te.length>0):[],F=X?{directions:X.nav_text||"",directionsImage:"",storyImage:"",storyText:X.story_text||"",challengeText:X.question_text||"",challengeImage:"",hints:Re.length>0?Re.map((Te,Le)=>({id:`hint-${Le+1}`,label:`ヒント${Le+1}`,text:Te})):[],answerText:X.answer_text||"",answerType:X.answer_type||"text",choiceOptions:Array.isArray(X.choice_options)?X.choice_options:[],acceptableAnswers:Array.isArray(X.acceptable_answers)?X.acceptable_answers:[],successMessage:X.explanation_text||X.completion_message||""}:void 0,W=((F==null?void 0:F.challengeText)||"").trim().length>0&&(((F==null?void 0:F.answerType)==="choice"?(F.choiceOptions||[]).length>0:((F==null?void 0:F.answerText)||"").trim().length>0)||!1);return{id:pe.id,name:pe.name,address:pe.address||"",lat:pe.lat,lng:pe.lng,orderIndex:pe.order_index||ge+1,status:W?"complete":pe.status||"draft",details:F}});dt(G)}},[dt]),Qt=(I==null?void 0:I.email)||null,[ya,Na]=o.useState(""),[gs,wa]=o.useState("idle"),pr=(s,l,T)=>{switch(s){case"home":return"/";case"player":return"/play";case"quests":return"/quests";case"quest-detail":return l?`/quest/${l}`:"/quests";case"creators":return"/creators";case"auth":return T==="signup"?"/auth/signup":T==="forgot"?"/auth/forgot":"/auth/login";case"profile":return"/profile";case"creator-start":return"/creator/start";case"creator-canvas":return l?`/creator/canvas/${l}`:"/creator/canvas";case"creator-mystery-setup":return"/creator/mystery-setup";case"creator-route-spots":return"/creator/route-spots";case"creator-workspace":return l?`/creator/workspace/${l}`:"/creator/workspace";case"creator-storytelling":return"/creator/storytelling";case"creator-test-run":return"/creator/test-run";case"creator-submitted":return"/creator/submitted";case"creator-analytics":return l?`/creator/analytics/${l}`:"/creator/analytics";case"admin-dashboard":return"/admin/dashboard";case"admin-review":return l?`/admin/review/${l}`:"/admin/dashboard";case"creator-spot-detail":return hs?`/creator/route-spots/${hs}`:"/creator/route-spots";case"creator-workspace-languages":return"/creator/workspace/languages";case"about":return"/about";case"business":return"/business";default:return"/"}},Ae=(s,l)=>{const T=(l==null?void 0:l.quest)??null,G=(l==null?void 0:l.authModeOverride)??Se;l!=null&&l.questId&&(at(l.questId),localStorage.setItem("quest-id",l.questId),vs(l.questId)),s==="quest-detail"?(B(T),ee((l==null?void 0:l.questId)||(T==null?void 0:T.id)||null)):s!=="quest-detail"&&(B(null),ee(null)),s==="admin-review"?ke((l==null?void 0:l.questId)||null):s!=="admin-review"&&(ke(null),V(null)),s==="auth"&&(l!=null&&l.authModeOverride)&&fe(l.authModeOverride),s==="creator-spot-detail"?Pt((l==null?void 0:l.spotId)??null):s!=="creator-spot-detail"&&Pt(null),s!=="creator-analytics"&&(H(null),we(null)),_(s);const pe=s==="creator-spot-detail"&&(l!=null&&l.spotId)?`/creator/route-spots/${l.spotId}`:pr(s,(l==null?void 0:l.questId)||(T==null?void 0:T.id),s==="auth"?G:void 0);n(pe,{replace:l==null?void 0:l.replace})},Hs=s=>s==="/quests"?{page:"quests"}:s.startsWith("/quest/")?{page:"quest-detail",questId:s.split("/")[2]}:s==="/creators"?{page:"creators"}:s==="/auth/login"?{page:"auth",authMode:"login"}:s==="/auth/signup"?{page:"auth",authMode:"signup"}:s==="/auth/forgot"?{page:"auth",authMode:"forgot"}:s==="/profile"?{page:"profile"}:s==="/creator/start"?{page:"creator-start"}:s==="/creator/canvas"||s.startsWith("/creator/canvas/")?{page:"creator-canvas",questId:s.split("/")[3]||null}:s==="/creator/mystery-setup"?{page:"creator-mystery-setup"}:s==="/creator/route-spots"?{page:"creator-route-spots"}:s.startsWith("/creator/route-spots/")?{page:"creator-spot-detail",spotId:s.split("/")[3]}:s==="/creator/storytelling"?{page:"creator-storytelling"}:s==="/creator/test-run"?{page:"creator-test-run"}:s==="/creator/submitted"?{page:"creator-submitted"}:s==="/creator/analytics"?{page:"creator-analytics"}:s.startsWith("/creator/analytics/")?{page:"creator-analytics",questId:s.split("/")[3]}:s==="/admin"||s==="/admin/dashboard"?{page:"admin-dashboard"}:s.startsWith("/admin/review/")?{page:"admin-review",questId:s.split("/")[3]}:s==="/play"?{page:"player"}:s==="/creator"?{page:"creator-workspace"}:s==="/creator/workspace/languages"?{page:"creator-workspace-languages"}:s.startsWith("/creator/workspace/")?{page:"creator-workspace",questId:s.split("/")[3]}:s==="/creator/workspace"||s==="/workspace"?{page:"creator-workspace"}:s.startsWith("/creator/analytics/")?{page:"creator-analytics",questId:s.split("/")[3]}:s==="/creator/analytics"?{page:"creator-analytics"}:{page:"home"};o.useEffect(()=>{const s=()=>{g(window.scrollY>50)};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[]),o.useEffect(()=>{if(typeof window>"u")return;const s=Hs(window.location.pathname);Ae(s.page,{quest:s.quest||null,questId:s.questId||null,authModeOverride:s.authMode,replace:!0,spotId:s.spotId})},[]),o.useEffect(()=>{if(typeof window>"u")return;const s=()=>{const l=Hs(window.location.pathname);Ae(l.page,{quest:l.quest||null,questId:l.questId||null,authModeOverride:l.authMode,replace:!0,spotId:l.spotId})};return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),o.useEffect(()=>{if(Hs(window.location.pathname).questId)return;const T=localStorage.getItem("quest-id");T&&at(T)},[]),o.useEffect(()=>{if(!(I!=null&&I.id)){A([]);return}D.from("notifications").select("*").eq("user_id",I.id).order("created_at",{ascending:!1}).then(({data:s})=>{s&&A(s)}).catch(()=>{})},[I==null?void 0:I.id]),o.useEffect(()=>{qs()},[qs]),o.useEffect(()=>{i.startsWith("creator")&&rs()},[i,rs]),o.useEffect(()=>{Ie&&Tt(Ie,qe==null?void 0:qe.title)},[ne,S,Ie,Tt]),o.useEffect(()=>{if(!w)return;const s=ct.includes(w.id);w.owned!==s&&B({...w,owned:s})},[ct,w]),o.useEffect(()=>{(async()=>{var Re;if(i!=="quest-detail"||!Y||(w==null?void 0:w.id)===Y)return;const[{data:l,error:T},{data:G},{data:pe},{data:ge},{data:X}]=await Promise.all([D.from("quests").select("*, profiles!quests_creator_id_fkey(username)").eq("id",Y).limit(1).single(),D.from("spots").select("*").eq("quest_id",Y).order("order_index",{ascending:!0}),D.from("story_timelines").select("*").eq("quest_id",Y).single(),D.from("quest_reviews").select("id, rating, comment, created_at, profiles!quest_reviews_user_id_fkey(username)").eq("quest_id",Y).order("created_at",{ascending:!1}).limit(10),D.from("play_sessions").select("ended_at,duration_sec").eq("quest_id",Y)]);if(!T&&l){const F=(G==null?void 0:G.map(se=>({name:se.name,clue:se.address||"",action:""})))||[],W=(ge||[]).filter(se=>se.rating!=null),Ee=W.length>0?parseFloat((W.reduce((se,$e)=>se+($e.rating||0),0)/W.length).toFixed(1)):0,Te=(X==null?void 0:X.length)||0,Le=(X||[]).filter(se=>se.ended_at!=null).length,J=Te>0?Math.round(Le/Te*100):null,ce=(X||[]).filter(se=>se.duration_sec!=null).map(se=>se.duration_sec),Ve=ce.length>0?Math.round(ce.reduce((se,$e)=>se+$e,0)/ce.length/60):null,De=W.map(se=>{var $e;return{id:se.id,rating:se.rating,name:(($e=se.profiles)==null?void 0:$e.username)||"ユーザー",date:se.created_at?new Date(se.created_at).toLocaleDateString("ja-JP",{year:"numeric",month:"long"}):"",comment:se.comment||""}}),_e={id:l.id,title:l.title||"タイトル未設定",area:l.area_name||"エリア未設定",distanceKm:l.distance_km||2,durationMin:l.duration_min||60,difficulty:"初級",tags:l.tags||["街歩き"],rating:Ee,reviews:W.length,cover:l.cover_image_url||"https://images.unsplash.com/photo-1505761671935-60b3a7427bad?auto=format&fit=crop&w=1200&q=80",description:l.description||"",teaser:l.area_name||"",startingPoint:"",reward:"",timeWindow:"いつでも",mood:"街を探検",stops:F,creatorName:((Re=l.profiles)==null?void 0:Re.username)||"TOMOSHIBI Creator",creatorId:l.creator_id,storyPrologue:(pe==null?void 0:pe.prologue)||"",storyEpilogue:(pe==null?void 0:pe.epilogue)||"",owned:ct.includes(l.id),playCount:Te,clearRate:J,avgDurationMin:Ve,reviewList:De};B(_e)}})()},[i,Y,w,ct]),o.useEffect(()=>{(async()=>{if(i!=="admin-review"||!oe)return;const{data:l}=await D.from("quests").select("*, profiles!quests_creator_id_fkey(username)").eq("id",oe).single(),{data:T}=await D.from("spots").select("*").eq("quest_id",oe).order("order_index",{ascending:!0}),{data:G}=await D.from("story_timelines").select("*").eq("quest_id",oe).single();l&&V({quest:l,spots:T||[],story:G||null})})()},[i,oe]),o.useEffect(()=>{i==="profile"&&(I!=null&&I.id)&&cr()},[i,I==null?void 0:I.id]),o.useEffect(()=>{i==="admin-dashboard"&&fs()},[i]),o.useEffect(()=>{i==="creator-test-run"&&We(4)},[i]);const fs=async()=>{const{data:s,error:l}=await D.from("quests").select("id, title, area_name, created_at, creator_id, profiles!quests_creator_id_fkey(username)").eq("status","pending_review").order("created_at",{ascending:!1});!l&&s&&xe(s)};o.useEffect(()=>{i==="admin-dashboard"&&fs()},[i]),o.useEffect(()=>{ye&&(vs(ye),Xe(""),it(""),tt(""),pt(null),dt([]),Ht({castName:"",castTone:"",castIcon:"",prologueTitle:"",prologueBody:"",prologueImage:"",epilogueBody:"",socialMessage:"",epilogueImage:"",characters:[],scenario:[]}),$t([]),Mt([]),D.from("quests").select("*").eq("id",ye).maybeSingle().then(({data:s,error:l})=>{if(l){console.warn("Quest fetch error:",l);return}s&&(Xe(s.title||""),it(s.description||""),tt(s.area_name||""),s.location_lat&&s.location_lng&&pt({lat:s.location_lat,lng:s.location_lng}))}).catch(()=>{}))},[ye]),o.useEffect(()=>{(async()=>{if(!(I!=null&&I.id)||i!=="profile"){bt([]);return}const{data:l,error:T}=await D.from("quests").select("id, title, description, area_name, location_lat, location_lng, cover_image_url, status, created_at, updated_at").eq("creator_id",I.id).order("updated_at",{ascending:!1});bt(!T&&l?l:[])})()},[I==null?void 0:I.id,i]);const Qs=()=>{C("idle"),de(null)},ka=s=>{fe(s),C("idle"),de(null)},_a=s=>{const l=document.querySelector(s);l&&l.scrollIntoView({behavior:"smooth",block:"start"})},Qe=s=>{console.log("[DEBUG] goHome called, stack:",new Error().stack),Ae("home"),u(!1),Qs(),U(!1),s?requestAnimationFrame(()=>_a(s)):window.scrollTo({top:0,behavior:"smooth"})},At=s=>{Ae("quests"),u(!1),Qs(),U(!1),he(s||null),window.scrollTo({top:0,behavior:"smooth"})},js=()=>{Ae("creators"),u(!1),Qs(),U(!1),window.scrollTo({top:0,behavior:"smooth"})},Vs=async()=>{try{await y()}catch{}finally{$(!1),U(!1),Qe()}},Us=async()=>{if(!I){Vt("login");return}const s=await Gs();s&&(Ae("creator-canvas",{questId:s}),window.scrollTo({top:0,behavior:"smooth"}))},Sa=()=>{U(!1),ze(0)},ur=()=>{if(Ce>=na.length-1){Sa(),Ca();return}ze(s=>Math.min(s+1,na.length-1))},br=()=>{Ae("quests"),window.scrollTo({top:0,behavior:"smooth"})},gr=s=>{B(s),ee(s.id),Ae("quest-detail",{quest:s}),window.scrollTo({top:0,behavior:"smooth"})},fr=async s=>{if(!(I!=null&&I.id)){Vt("login");return}if(ct.includes(s)){alert("すでに購入済みです。/mobile からプレイできます。");return}ns(!0);try{const{data:l}=await D.from("events").select("id").eq("quest_id",s).maybeSingle(),T={user_id:I.id,quest_id:s,status:"test",price:0,currency:"JPY"};l!=null&&l.id&&(T.event_id=l.id),await D.from("purchases").insert(T),await qs(),B(G=>G&&G.id===s?{...G,owned:!0}:G),alert("購入完了。このアカウントで /mobile からプレイできます。")}catch(l){console.error(l),alert("購入に失敗しました。時間をおいて再試行してください。")}finally{ns(!1)}},Vt=(s="login")=>{ka(s),Ae("auth",{authModeOverride:s}),u(!1),B(null),U(!1),window.scrollTo({top:0,behavior:"smooth"})},ft=()=>{Ae("profile"),u(!1),$(!1),U(!1),window.scrollTo({top:0,behavior:"smooth"}),I!=null&&I.id&&D.from("quests").select("*").eq("creator_id",I.id).order("created_at",{ascending:!1}).then(({data:s})=>{s&&bt(s)})},Ca=()=>{Ae("creator-start"),U(!1),u(!1),$(!1),window.scrollTo({top:0,behavior:"smooth"})},Gs=async()=>{if(!(I!=null&&I.id))return Ae("auth",{authModeOverride:"login"}),null;try{const{data:s,error:l}=await D.from("quests").insert({creator_id:I.id,title:"",area_name:"",description:"",tags:[],category_tags:[],hashtag_tags:[],status:"draft",mode:"PRIVATE",quality_checklist:{}}).select("id, title, area_name, description, mode, quality_checklist, share_token").maybeSingle();if(l)throw l;if(s!=null&&s.id)return at(s.id),localStorage.setItem("quest-id",s.id),Xe(s.title||""),it(s.description||""),tt(s.area_name||""),Rt(s.mode||"PRIVATE"),Bt(s.quality_checklist||{}),ss(s.share_token||null),s.id}catch(s){console.warn("draft quest create failed",s),alert("クエストの作成に失敗しました。通信状況をご確認ください。")}return null},jr=()=>{Ae("creator-mystery-setup"),window.scrollTo({top:0,behavior:"smooth"})},ls=()=>{We(2),Ae("creator-route-spots"),window.scrollTo({top:0,behavior:"smooth"})},vr=(s,l)=>{Ae("creator-analytics",{questId:s}),U(!1),u(!1),$(!1),s?Tt(s,l):we(null),window.scrollTo({top:0,behavior:"smooth"})},yr=()=>{We(3),Ae("creator-storytelling",{questId:ye}),U(!1),u(!1),$(!1),window.scrollTo({top:0,behavior:"smooth"})},Ws=()=>{We(4),Ae("creator-test-run",{questId:ye}),U(!1),u(!1),$(!1),window.scrollTo({top:0,behavior:"smooth"})},Nr=()=>{Ae("creator-submitted"),U(!1),u(!1),$(!1),window.scrollTo({top:0,behavior:"smooth"})},rt=s=>{const l=s||ye;l&&vs(l),Ae("creator-workspace",{questId:l}),U(!1),u(!1),$(!1),window.scrollTo({top:0,behavior:"smooth"})},vs=s=>{if(!s){We(1);return}const l=localStorage.getItem(`workspace-step:${s}`),T=l?parseInt(l,10):1;We(Number.isFinite(T)&&T>0?T:1)},ys=async s=>{if(!ye)return;const l=Math.max(s,ht||1);We(l),localStorage.setItem(`workspace-step:${ye}`,String(l)),await D.from("quests").update({updated_at:new Date().toISOString(),status:"draft"}).eq("id",ye)},Ks=async()=>{if(!ye){alert("クエストが見つかりません。Step1を保存してください。");return}if(!(I!=null&&I.id)){alert("ログインしてください。"),Vt("login");return}const{data:s}=await D.from("profiles").select("role").eq("id",I.id).single(),T=((s==null?void 0:s.role)||(c==null?void 0:c.role)||"player")==="admin"?"published":"pending_review",{error:G}=await D.from("quests").update({status:T}).eq("id",ye);if(G){alert("公開処理に失敗しました。時間をおいて再試行してください。");return}We(5),T==="published"?(alert("公開しました"),At()):(alert("申請を受け付けました。審査完了をお待ちください。"),Nr())},Ta=s=>{Os(s),qt(!0)},wr=async s=>{Bt(s),ye&&await D.from("quests").update({quality_checklist:s}).eq("id",ye)},Ia=async()=>{if(!ye)return;const s=crypto.randomUUID(),{error:l}=await D.from("quests").update({share_token:s,mode:"SHARE",status:"ready_for_share"}).eq("id",ye);l||(ss(s),Rt("SHARE"))},kr=async()=>{ye&&(us==="SHARE"?(Ls||await Ia(),qt(!1),alert("共有リンクが有効になりました！")):(await Ks(),qt(!1)))},_r=s=>{var pe,ge,X,Re;let l;if(s.title&&Xe(s.title),s.description&&it(s.description),s.area&&tt(s.area),(ge=(pe=s.routeSpots)==null?void 0:pe[0])!=null&&ge.lat&&((Re=(X=s.routeSpots)==null?void 0:X[0])!=null&&Re.lng)&&pt({lat:s.routeSpots[0].lat,lng:s.routeSpots[0].lng}),Array.isArray(s.tags)){const F=s.tags.filter(Boolean);$t(F.filter(W=>Ge.includes(W))),Mt(F.filter(W=>!Ge.includes(W)))}const G=(()=>{var F;return(F=s.routeSpots)!=null&&F.length?s.routeSpots:[]})();if(G.length){const F=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,W=>{const Ee=Math.random()*16|0;return(W==="x"?Ee:Ee&3|8).toString(16)});l=G.map((W,Ee)=>{const Te=F(),Le=Array.isArray(W.hints)?W.hints.map((J,ce)=>({id:`${Te}-hint-${ce+1}`,label:`ヒント${ce+1}`,text:typeof J=="string"?J:(J==null?void 0:J.text)||""})):[];return{id:Te,name:W.name||`スポット${Ee+1}`,address:W.address||s.area||et||"",lat:typeof W.lat=="number"?W.lat:0,lng:typeof W.lng=="number"?W.lng:0,orderIndex:Ee+1,status:"draft",details:{directions:W.directions||"",storyText:W.storyText||"",challengeText:W.challengeText||"",hints:Le,answerText:W.answer||"",answerType:"text",acceptableAnswers:W.acceptableAnswers||(W.answer?[W.answer]:[]),successMessage:W.successMessage||"ナイス！次のスポットへ進みましょう。"}}}),dt(l)}return s.story&&Ht(F=>{var W,Ee,Te,Le,J,ce,Ve,De,_e;return{castName:((W=s.story)==null?void 0:W.castName)||F.castName,castTone:((Ee=s.story)==null?void 0:Ee.castTone)||F.castTone,castIcon:F.castIcon,prologueTitle:((Te=s.story)==null?void 0:Te.prologueTitle)||F.prologueTitle,prologueBody:((Le=s.story)==null?void 0:Le.prologueBody)||F.prologueBody,prologueImage:F.prologueImage,epilogueBody:((J=s.story)==null?void 0:J.epilogueBody)||F.epilogueBody,socialMessage:F.socialMessage,epilogueImage:F.epilogueImage,characters:((Ve=(ce=s.story)==null?void 0:ce.characters)==null?void 0:Ve.map((se,$e)=>({id:se.id||`c${$e+1}`,name:se.name||"",role:se.role||"",color:se.color||"bg-brand-gold",tone:se.tone||""})))||F.characters,scenario:((_e=(De=s.story)==null?void 0:De.scenario)==null?void 0:_e.map((se,$e)=>({id:se.id||`scene-${$e+1}`,type:se.type||"scene",name:se.name||"",content:se.content||"",speaker:se.speaker||""})))||F.scenario}}),{spots:l}},Sr=()=>{Ht({castName:"",castTone:"",castIcon:"",prologueTitle:"",prologueBody:"",prologueImage:"",epilogueBody:"",socialMessage:"",epilogueImage:"",characters:[],scenario:[]})},Cr=async s=>{var l,T,G,pe,ge;ja(null),fa(!0);try{const X=ye||await Gs();if(!X)throw new Error("クエストの作成に失敗しました。ログイン状態を確認してください。");at(X),at(X),localStorage.setItem("quest-id",X);const Re="AIzaSyD0wPNjJUvnhDTguxYLwl9NE_kFvEZZs1I",F=`
あなたは位置連動ミステリークエストの設計者です。以下の入力をもとに、JSONだけを返してください。

【重要: スポット選定の処理手順】
1. まず指定エリアの中心座標を特定してください（エリア名から正確な緯度経度を割り出す）
2. その中心から半径2km以内で、テーマに関連する実在の観光地・ランドマークを10件選定してください
3. 選定した各スポット間の距離を計算し、隣接スポット間が500m以内になるようルートを最適化してください
4. 各スポットのlat/lngは具体的な数値（小数点以下5桁）で指定してください

- 出力フォーマット:
{
  "title": "短く魅力的なタイトル",
  "description": "100-200文字の概要。導入と体験価値を明確に",
  "area": "主なエリア名",
  "difficulty": "初級|中級|上級",
  "target": "想定ターゲットを短く",
  "tags": ["デートに最適", "歴史ロマン" など任意],
  "routeSpots": [
    {
      "name": "スポット名（実在する場所）",
      "address": "正確な住所やランドマーク",
      "lat": 35.XXXXX（実際の緯度）,
      "lng": 139.XXXXX（実際の経度）,
      "directions": "到達ヒント（現地への道案内や目印）",
      "storyText": "現地での物語/ナレーション（その場所の背景やストーリー）",
      "challengeText": "謎の本文（プレイヤーに解いてもらう問題）",
      "hints": ["ヒント1（段階的に難易度を下げる）","ヒント2（さらに具体的な手がかり）"],
      "answer": "正解例（正確な答え）",
      "acceptableAnswers": ["許容回答1（表記揺れ対応）","許容回答2（別名対応）"],
      "successMessage": "クリア時メッセージ（達成感を高める演出）",
      "preDialogue": [
        { "speakerType": "character", "speakerName": "登場人物名", "text": "到着時の会話（謎解き開始前）" },
        { "speakerType": "narrator", "speakerName": "ナレーション", "text": "場面説明" }
      ],
      "postDialogue": [
        { "speakerType": "character", "speakerName": "登場人物名", "text": "正解後の会話（次のスポットへの導入）" }
      ]
    }
  ],
  "story": {
    "castName": "案内役やナレーター名",
    "castTone": "口調の指示（例: 丁寧語、関西弁、ミステリアスなど）",
    "prologueTitle": "プロローグ見出し",
    "prologueBody": "導入文（200-400文字程度の物語の始まり）",
    "epilogueBody": "エンディング（200-400文字程度のクリア後メッセージ）",
    "characters": [
      { "id": "narrator", "name": "案内人名", "role": "ナレーター/案内人", "color": "bg-brand-gold", "tone": "丁寧でミステリアス" },
      { "id": "c1", "name": "登場人物1", "role": "役割（例: 謎の老人, 歴史研究家）", "color": "bg-indigo-500", "tone": "話し方の特徴" },
      { "id": "c2", "name": "登場人物2", "role": "役割", "color": "bg-emerald-500", "tone": "話し方の特徴" },
      { "id": "c3", "name": "登場人物3", "role": "役割", "color": "bg-rose-500", "tone": "話し方の特徴" }
    ],
    "scenario": [
      { "id": "scene-1", "type": "scene", "name": "場面名", "content": "セリフや描写", "speaker": "話し手" }
    ]
  }
}

【絶対必須条件】
1. スポット間距離の制約（最重要）:
   - 入力されたエリア名から実在する地域を特定し、その地域内でスポットを選定すること
   - 隣接するスポット間の直線距離は必ず500メートル以内にすること
   - これを守れない場合は、スポット数を減らしてでも制約を優先すること
   - 全スポットが徒歩で無理なく回れる範囲内であること
   - 各スポットには正確な緯度経度（lat, lng）を必ず設定すること

2. preDialogue と postDialogue の生成（必須）:
   - 各スポットには必ず preDialogue（謎解き前の会話、2-4行）と postDialogue（正解後の会話、1-2行）を含めること
   - speakerType は 'character' または 'narrator' を使用
   - 登場人物は story.characters で定義したキャラクターから選択すること

3. スポットとテーマの関連性:
   - 各スポットはクエストのテーマ・モチーフに密接に関連する場所であること
   - そのエリアに実在する場所・ランドマークを選ぶこと
   - 謎や物語がその場所の特徴を活かした内容であること

4. routeSpots は必ず10件を生成してください（全て詳細情報を含めること）

5. 登場人物（characters）の生成:
   - 案内人/ナレーター以外に、物語に登場するキャラクターを3〜5名生成すること
   - 各キャラクターには独自の役割、話し方、性格を設定すること
   - キャラクターはクエストの謎や物語に関わる人物であること

6. 各スポットの directions, storyText, challengeText, hints, answer, acceptableAnswers, successMessage は必ず記入してください

7. 謎は難易度に応じて適切な難しさにしてください（初級: 簡単な観察や計算、中級: 推理や知識、上級: 複合的な思考）

8. 対応言語に応じたコンテンツ生成:
   - 指定された各言語でコンテンツを生成すること
   - 日本語は必須、追加で選択された言語（英語、韓国語）も生成すること
   - 各言語版は全て同じJSON構造で、テキスト内容のみ言語に応じて変換すること

入力:
- エリア: ${s.area||"未指定"}
- テーマ: ${s.theme||"未指定"}
- 難易度: ${s.difficulty||"中級"}
- ターゲット: ${s.target||"未指定"}
- 対応言語: ${s.targetLanguages.join(", ")}
- 追加要望: ${s.notes||"特になし"}
${s.spotCount?`- スポット数: ${s.spotCount}スポット`:"- スポット数: 7スポット（デフォルト）"}
${s.estimatedPlayTime?`- 想定プレイ時間: ${s.estimatedPlayTime}`:""}
${s.artStyle?`- アートスタイル・世界観: ${s.artStyle}`:""}
${s.storyTone?`- 物語のトーン: ${s.storyTone}`:""}
${s.characterCount?`- 登場人物の人数: ${s.characterCount}人`:""}
${s.specialRequirements?`- 特別な指定・要件: ${s.specialRequirements}`:""}
${s.includeSpots?`- 必ず含めるスポット: ${s.includeSpots}`:""}
${(s.challengeTypes||[]).length>0?`- チャレンジタイプ: ${(s.challengeTypes||[]).join("、")}（これらのタイプからバランスよく出題）`:""}
`.trim(),W=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${Re}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:F}]}]})});if(!W.ok){const _e=await W.text();throw new Error(`Gemini API error: ${_e}`)}const Ee=await W.json(),Te=((ge=(pe=(G=(T=(l=Ee==null?void 0:Ee.candidates)==null?void 0:l[0])==null?void 0:T.content)==null?void 0:G.parts)==null?void 0:pe[0])==null?void 0:ge.text)||"",Le=Te.match(/```json([\s\S]*?)```/),J=Le?Le[1]:Te,ce=JSON.parse(J.trim()),Ve=_r(ce),De=await Tr(X,ce,Ve.spots);We(2),localStorage.setItem(`workspace-step:${X}`,"2"),localStorage.setItem(`quest-languages:${X}`,JSON.stringify(s.targetLanguages)),De&&await va(X)}catch(X){throw console.error(X),ja((X==null?void 0:X.message)||"AI生成に失敗しました。時間をおいて再試行してください。"),X}finally{fa(!1)}},Tr=async(s,l,T)=>{var G,pe;try{const ge=T==null?void 0:T[0],X=(ge==null?void 0:ge.lat)||null,Re=(ge==null?void 0:ge.lng)||null,{error:F}=await D.from("quests").upsert({id:s,creator_id:(I==null?void 0:I.id)||null,title:l.title||ms||"",description:l.description||_t||"",area_name:l.area||et||"",tags:l.tags||[],location_lat:X,location_lng:Re,updated_at:new Date().toISOString(),status:"draft"});if(F)throw F;if(T!=null&&T.length){const{data:W}=await D.from("spots").select("id").eq("quest_id",s);if(W&&W.length>0){const J=W.map(ce=>ce.id);await D.from("spot_story_messages").delete().in("spot_id",J),await D.from("spot_details").delete().in("spot_id",J),await D.from("spots").delete().eq("quest_id",s)}const Ee=T.map((J,ce)=>({id:J.id,quest_id:s,name:J.name,address:J.address||"",lat:J.lat,lng:J.lng,order_index:J.orderIndex||ce+1})),{error:Te}=await D.from("spots").insert(Ee);if(Te)throw Te;const Le=T.filter(J=>J.details).map(J=>{var De,_e,se,$e,It,jt,ae,Pe,Ke,Oe;const ce=((De=J.details)==null?void 0:De.choiceOptions)||[],Ve=((_e=J.details)==null?void 0:_e.acceptableAnswers)||[];return{id:J.id,spot_id:J.id,nav_text:((se=J.details)==null?void 0:se.directions)||"",story_text:(($e=J.details)==null?void 0:$e.storyText)||"",question_text:((It=J.details)==null?void 0:It.challengeText)||"",answer_text:((jt=J.details)==null?void 0:jt.answerText)||"",hint_text:(((ae=J.details)==null?void 0:ae.hints)||[]).map(Je=>Je.text).filter(Boolean).join(`
`),explanation_text:((Pe=J.details)==null?void 0:Pe.successMessage)||"",completion_message:((Ke=J.details)==null?void 0:Ke.successMessage)||"",answer_type:((Oe=J.details)==null?void 0:Oe.answerType)||"text",choice_options:ce.length?ce:null,acceptable_answers:Ve.length?Ve:null}});if(Le.length>0){const{error:J}=await D.from("spot_details").upsert(Le,{onConflict:"spot_id"});if(J)throw console.error("spot_details upsert failed:",J),J}if((G=l.routeSpots)!=null&&G.length){const J=[];for(let ce=0;ce<T.length;ce++){const Ve=T[ce],De=l.routeSpots[ce];De&&((De.preDialogue||[]).forEach((_e,se)=>{J.push({spot_id:Ve.id,message_type:"pre_puzzle",sequence:se+1,speaker_type:_e.speakerType||"character",speaker_name:_e.speakerName||"",message_text:_e.text||""})}),(De.postDialogue||[]).forEach((_e,se)=>{J.push({spot_id:Ve.id,message_type:"post_puzzle",sequence:se+1,speaker_type:_e.speakerType||"character",speaker_name:_e.speakerName||"",message_text:_e.text||""})}))}if(J.length>0){const{error:ce}=await D.from("spot_story_messages").insert(J);ce&&console.error("spot_story_messages insert failed:",ce)}}}if(l.story){const W=((pe=l.story.scenario)==null?void 0:pe.map((Te,Le)=>({...Te,id:Te.id||`scene-${Le+1}`})))||[],{error:Ee}=await D.from("story_timelines").upsert({quest_id:s,cast_name:l.story.castName||gt.castName||"",cast_tone:l.story.castTone||gt.castTone||"",cast_icon:gt.castIcon||"",prologue_title:l.story.prologueTitle||gt.prologueTitle||"",prologue:l.story.prologueBody||gt.prologueBody||"",epilogue:l.story.epilogueBody||gt.epilogueBody||"",characters:l.story.characters||gt.characters||[],timeline_data:W,timeline_json:W},{onConflict:"quest_id"});if(Ee)throw Ee}return!0}catch(ge){return console.error("AI draft persist failed",ge),!1}},Ir=async()=>{if(!ye){alert("削除対象のクエストがありません。");return}if(window.confirm(`このクエストを消去しますか？
関連するスポットやストーリーも削除されます。`)){Fs(!0);try{console.log("[DELETE] Starting deletion for quest:",ye);const{data:l,error:T}=await D.from("spots").select("id").eq("quest_id",ye);T&&console.error("[DELETE] Error fetching spots:",T);const G=(l||[]).map(F=>F.id).filter(Boolean);if(console.log("[DELETE] Found spots:",G),G.length){const{error:F}=await D.from("spot_details").delete().in("spot_id",G);F?console.error("[DELETE] Error deleting spot_details:",F):console.log("[DELETE] Deleted spot_details")}if(G.length){const{error:F}=await D.from("spot_story_messages").delete().in("spot_id",G);F?console.error("[DELETE] Error deleting spot_story_messages:",F):console.log("[DELETE] Deleted spot_story_messages")}const{error:pe}=await D.from("spots").delete().eq("quest_id",ye);pe?console.error("[DELETE] Error deleting spots:",pe):console.log("[DELETE] Deleted spots");const{error:ge}=await D.from("story_timelines").delete().eq("quest_id",ye);ge?console.error("[DELETE] Error deleting story_timelines:",ge):console.log("[DELETE] Deleted story_timelines");const{error:X}=await D.from("play_sessions").delete().eq("quest_id",ye);X?console.error("[DELETE] Error deleting play_sessions:",X):console.log("[DELETE] Deleted play_sessions");const{error:Re}=await D.from("quests").delete().eq("id",ye);if(Re){console.error("[DELETE] Error deleting quest:",Re),alert(`クエスト削除エラー: ${Re.message}
Code: ${Re.code}
Details: ${Re.details||"N/A"}`),Fs(!1);return}console.log("[DELETE] Deleted quest successfully"),bt(F=>F.filter(W=>W.id!==ye)),localStorage.removeItem("quest-id"),localStorage.removeItem(`workspace-step:${ye}`),at(null),Xe(""),it(""),tt(""),dt([]),We(1),Sr(),ft(),alert("クエストを消去しました。")}catch(l){console.error("delete quest failed",l),alert(`クエストの消去に失敗しました: ${(l==null?void 0:l.message)||l}`)}finally{Fs(!1)}}},za=async({userId:s,title:l,message:T})=>{s&&await D.from("notifications").insert({user_id:s,title:l,message:T,type:"review_result"})},zr=async()=>{if(!oe)return;ie(!0);const{data:s,error:l}=await D.from("quests").update({status:"published"}).eq("id",oe).select("creator_id, title").single();if(l){alert("承認に失敗しました。権限/RLS設定を確認してください。"),ie(!1);return}s&&(await za({userId:s.creator_id,title:"クエストが公開されました！",message:`おめでとうございます。あなたのクエスト「${s.title}」が審査を通過し、公開されました。`}),alert("承認しました"),fs(),Js()),ie(!1)},$r=async s=>{if(!oe||!(E!=null&&E.quest))return;ie(!0);const{error:l}=await D.from("quests").update({status:"draft"}).eq("id",oe);if(l){alert("差し戻しに失敗しました。権限/RLS設定を確認してください。"),ie(!1);return}await za({userId:E.quest.creator_id,title:"クエストの審査結果について",message:`申請いただいたクエストは差し戻されました。内容を修正して再度申請してください。
理由: ${s||"記載なし"}`}),alert("差し戻しました"),fs(),Js(),ie(!1)},$a=s=>{dt(l=>l.map(T=>T.id===s.id?s:T))},Mr=async({email:s,password:l,confirmPassword:T})=>{de(null),C("submitting");try{if(Se==="signup"&&l!==T)throw new Error("パスワードが一致しません。");if(Se!=="forgot"&&(!l||l.length<6))throw new Error("パスワードは6文字以上で入力してください。");if(Se==="forgot"){await K(s),C("success");return}if(Se==="login")await k(s,l||""),C("success"),setTimeout(()=>ft(),200);else{const G=await z(s,l||"");if(!(G!=null&&G.session)){C("idle"),de("確認メールを送信しました。メール確認後にログインしてください。"),fe("login");return}C("success"),setTimeout(()=>ft(),200)}}catch(G){C("idle"),de((G==null?void 0:G.message)||"認証に失敗しました。再度お試しください。"),console.error(G)}},Ns=s=>{if(s==="#creators"){js();return}i!=="home"?Qe(s):(_a(s),u(!1))},Pr=s=>{b(x===s?null:s)},Ar=s=>{s.preventDefault(),ya&&(wa("submitting"),setTimeout(()=>{wa("success"),Na("")},1200))},Er=i==="home",ws=!!Va,Lr=()=>{typeof window>"u"||window.location.assign(zo)},Dr=ga&&ir&&["home","quests","quest-detail","creators","auth","profile"].includes(i);o.useEffect(()=>{if(typeof window>"u")return;const s=()=>{const l=/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent||"")||window.matchMedia("(max-width: 640px)").matches;dr(l);const T=sessionStorage.getItem("tmoshibi_install_bar_dismissed")==="1";l&&!T&&Bs(!0),l||Bs(!1)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const Or=()=>{Bs(!1),typeof window<"u"&&sessionStorage.setItem("tmoshibi_install_bar_dismissed","1")},Ma=()=>{if(typeof window<"u"){window.location.href="/mobile";return}ws&&ga||Ae("player")},Js=()=>{(c==null?void 0:c.role)==="admin"?(Ae("admin-dashboard"),u(!1),$(!1)):(alert("管理者のみアクセスできます"),Qe())};return e.jsxs("div",{className:"min-h-screen bg-brand-base font-sans text-brand-dark selection:bg-brand-gold/30 selection:text-brand-dark",children:[i!=="creator-mystery-setup"&&i!=="creator-workspace"&&i!=="creator-route-spots"&&i!=="creator-spot-detail"&&i!=="creator-storytelling"&&i!=="creator-test-run"&&i!=="creator-submitted"&&i!=="creator-analytics"&&i!=="player"&&e.jsxs("nav",{className:`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${i==="creator-canvas"?"bg-white py-4 shadow-sm border-b border-stone-200":m?"bg-white/80 backdrop-blur-md py-4 shadow-lg border-b border-stone-200/50":"bg-transparent py-6"}`,children:[e.jsxs("div",{className:"container mx-auto px-4 md:px-8 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>Qe(),className:"flex items-center gap-2 group hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-8 md:h-10 w-auto"})}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 lg:gap-6",children:[e.jsxs("button",{onClick:()=>n("/about"),className:"text-xs lg:text-sm font-medium text-stone-600 hover:text-brand-gold transition-colors relative group whitespace-nowrap",children:["About",e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-gold transition-all group-hover:w-full"})]}),e.jsxs("button",{onClick:()=>Ns("#features"),className:"text-xs lg:text-sm font-medium text-stone-600 hover:text-brand-gold transition-colors relative group whitespace-nowrap",children:[p.nav.features,e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-gold transition-all group-hover:w-full"})]}),e.jsxs("button",{onClick:()=>Ns("#how-it-works"),className:"text-xs lg:text-sm font-medium text-stone-600 hover:text-brand-gold transition-colors relative group whitespace-nowrap",children:[p.nav.howItWorks,e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-gold transition-all group-hover:w-full"})]}),e.jsxs("button",{onClick:()=>Ns("#creators"),className:"text-xs lg:text-sm font-medium text-stone-600 hover:text-brand-gold transition-colors relative group whitespace-nowrap",children:[p.nav.creators,e.jsx("span",{className:"absolute -bottom-1 left-0 w-0 h-0.5 bg-brand-gold transition-all group-hover:w-full"})]}),e.jsx("div",{className:"w-px h-5 bg-stone-300"}),e.jsx("button",{onClick:()=>n("/business"),className:"text-xs lg:text-sm font-medium text-stone-500 hover:text-brand-gold transition-colors whitespace-nowrap",children:p.nav.business}),e.jsx("button",{onClick:At,className:"bg-brand-gold text-white px-6 py-2.5 rounded-full text-sm font-bold hover:bg-amber-600 transition-all shadow-md hover:shadow-lg",children:p.nav.findQuest}),!h&&Qt?e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{me(s=>!s),te.some(s=>!s.is_read)&&(D.from("notifications").update({is_read:!0}).eq("user_id",(I==null?void 0:I.id)||""),A(s=>s.map(l=>({...l,is_read:!0}))))},className:"relative p-2 rounded-full border border-stone-200 bg-white/90 hover:border-brand-gold",children:[e.jsx(Ya,{size:18,className:"text-brand-dark"}),te.some(s=>!s.is_read)&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full bg-rose-500"})]}),Z&&e.jsxs("div",{className:"absolute right-14 top-12 w-72 bg-white border border-stone-200 rounded-xl shadow-lg z-50",children:[e.jsx("div",{className:"p-3 border-b border-stone-100 text-sm font-bold text-brand-dark",children:p.common.notifications}),e.jsxs("div",{className:"max-h-64 overflow-y-auto",children:[te.length===0&&e.jsx("div",{className:"px-4 py-3 text-xs text-stone-500",children:p.common.noNotifications}),te.map(s=>e.jsxs("div",{className:`px-4 py-3 border-b border-stone-100 ${s.is_read?"bg-white":"bg-brand-base"}`,children:[e.jsx("p",{className:"text-xs text-stone-500",children:new Date(s.created_at).toLocaleString()}),e.jsx("p",{className:"text-sm font-bold text-brand-dark",children:s.title}),e.jsx("p",{className:"text-xs text-stone-600 whitespace-pre-line",children:s.message})]},s.id))]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-white/50 backdrop-blur-sm rounded-full p-1 border border-stone-200",children:[e.jsx("button",{onClick:()=>v("ja"),className:`px-2 h-7 flex items-center justify-center rounded-full text-xs font-bold transition-all ${f==="ja"?"bg-brand-dark text-white shadow-sm":"text-stone-400 hover:text-stone-600"}`,title:"日本語",children:"JA"}),e.jsx("button",{onClick:()=>v("en"),className:`px-2 h-7 flex items-center justify-center rounded-full text-xs font-bold transition-all ${f==="en"?"bg-brand-dark text-white shadow-sm":"text-stone-400 hover:text-stone-600"}`,title:"English",children:"EN"}),e.jsx("button",{onClick:()=>v("ko"),className:`px-2 h-7 flex items-center justify-center rounded-full text-xs font-bold transition-all ${f==="ko"?"bg-brand-dark text-white shadow-sm":"text-stone-400 hover:text-stone-600"}`,title:"한국어",children:"KO"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>$(!M),className:"flex items-center gap-3 pl-3 pr-4 py-2 rounded-full border border-stone-300 bg-white/90 backdrop-blur text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold transition-all shadow-sm",children:e.jsx("span",{className:"w-8 h-8 rounded-full bg-brand-dark text-white flex items-center justify-center font-bold overflow-hidden",children:c!=null&&c.avatar_url?e.jsx("img",{src:c.avatar_url,alt:"",className:"w-full h-full object-cover"}):Qt.charAt(0).toUpperCase()})}),M&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white border border-stone-200 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("button",{onClick:ft,className:"w-full text-left px-4 py-3 text-sm text-brand-dark hover:bg-brand-base",children:p.common.profile}),(c==null?void 0:c.role)==="admin"&&e.jsx("button",{onClick:Js,className:"w-full text-left px-4 py-3 text-sm text-brand-dark hover:bg-brand-base",children:p.common.adminDashboard}),e.jsx("button",{onClick:Vs,className:"w-full text-left px-4 py-3 text-sm text-brand-dark hover:bg-brand-base",children:p.common.logout})]})]})]}):h?e.jsx("div",{className:"w-10 h-10 rounded-full bg-stone-200 animate-pulse"}):e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>Vt("login"),className:"ml-2 px-4 py-2 rounded-full border border-stone-300 bg-white/80 backdrop-blur text-sm font-bold text-brand-dark hover:border-brand-gold hover:text-brand-gold transition-all shadow-sm",children:p.common.login}),e.jsxs("div",{className:"flex items-center gap-1 bg-white/50 backdrop-blur-sm rounded-full p-1 border border-stone-200 ml-2",children:[e.jsx("button",{onClick:()=>v("ja"),className:`px-2 h-7 flex items-center justify-center rounded-full text-xs font-bold transition-all ${f==="ja"?"bg-brand-dark text-white shadow-sm":"text-stone-400 hover:text-stone-600"}`,title:"日本語",children:"JA"}),e.jsx("button",{onClick:()=>v("en"),className:`px-2 h-7 flex items-center justify-center rounded-full text-xs font-bold transition-all ${f==="en"?"bg-brand-dark text-white shadow-sm":"text-stone-400 hover:text-stone-600"}`,title:"English",children:"EN"}),e.jsx("button",{onClick:()=>v("ko"),className:`px-2 h-7 flex items-center justify-center rounded-full text-xs font-bold transition-all ${f==="ko"?"bg-brand-dark text-white shadow-sm":"text-stone-400 hover:text-stone-600"}`,title:"한국어",children:"KO"})]})]})]}),e.jsx("button",{className:"md:hidden text-brand-dark",onClick:()=>u(!d),children:d?e.jsx(nt,{}):e.jsx(Wa,{})})]}),e.jsx(Ue,{children:d&&e.jsx(N.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"md:hidden bg-white border-t border-stone-200 overflow-hidden shadow-xl",children:e.jsxs("div",{className:"flex flex-col p-6 gap-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 bg-stone-100 rounded-xl p-2",children:[e.jsx("button",{onClick:()=>v("ja"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${f==="ja"?"bg-brand-dark text-white shadow-sm":"text-stone-500 hover:text-brand-dark"}`,children:"JA"}),e.jsx("button",{onClick:()=>v("en"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${f==="en"?"bg-brand-dark text-white shadow-sm":"text-stone-500 hover:text-brand-dark"}`,children:"EN"}),e.jsx("button",{onClick:()=>v("ko"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${f==="ko"?"bg-brand-dark text-white shadow-sm":"text-stone-500 hover:text-brand-dark"}`,children:"KO"})]}),$o.map(s=>e.jsx("button",{onClick:()=>Ns(s.href),className:"text-lg text-brand-dark font-serif text-left",children:s.label},s.label)),e.jsx("button",{onClick:()=>{u(!1),n("/business")},className:"w-full border-2 border-brand-gold text-brand-dark py-3 rounded-lg font-bold",children:"自治体・企業の方へ"}),e.jsx("button",{onClick:At,className:"w-full bg-brand-gold text-white py-3 rounded-lg font-bold",children:p.nav.findQuest}),!h&&Qt?e.jsxs("div",{className:"flex flex-col gap-2 border border-stone-200 rounded-lg p-3 bg-white",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"w-9 h-9 rounded-full bg-brand-dark text-white flex items-center justify-center font-bold overflow-hidden",children:c!=null&&c.avatar_url?e.jsx("img",{src:c.avatar_url,alt:"",className:"w-full h-full object-cover"}):Qt.charAt(0).toUpperCase()})}),e.jsx("button",{onClick:ft,className:"w-full bg-brand-dark text-white py-2 rounded-lg font-bold text-sm hover:bg-brand-gold transition-colors",children:p.common.profile}),e.jsx("button",{onClick:Vs,className:"w-full border border-stone-300 text-brand-dark py-2 rounded-lg font-bold text-sm hover:border-brand-gold hover:text-brand-gold transition-colors",children:p.common.logout})]}):h?e.jsx("div",{className:"flex items-center justify-center py-4 text-stone-400 text-sm",children:p.common.loading}):e.jsx("button",{onClick:()=>Vt("login"),className:"w-full border border-stone-300 text-brand-dark py-3 rounded-lg font-bold hover:border-brand-gold hover:text-brand-gold transition-colors",children:p.common.login})]})})})]}),i==="quests"&&e.jsx(gl,{onSelectQuest:gr,onBackHome:()=>Qe(),ownedQuestIds:ct,initialBrandFilter:P,t:p.questsPage}),i==="quest-detail"&&w&&e.jsx(yl,{quest:w,onBackToList:br,onBackHome:()=>Qe(),onOpenApp:Ma,purchased:w.owned||ct.includes(w.id),onPurchase:fr,purchasing:bs,t:p.questDetailPage}),i==="quest-detail"&&!w&&e.jsx("div",{className:"py-32 text-center text-stone-500",children:p.questsPage.loadingQuest}),i==="creators"&&e.jsx(Qo,{onBackHome:()=>Qe(),onGoAuth:Vt,onOpenOnboarding:Us,t:p.creatorsPage}),i==="auth"&&e.jsx(Ho,{mode:Se,setMode:ka,status:Me,onSubmit:Mr,error:ve,onBackHome:()=>Qe()}),i==="profile"&&Qt&&e.jsx(Oo,{email:Qt,onLogout:Vs,onBackHome:()=>Qe(),onGoCreators:js,onGoQuests:At,onOpenOnboarding:Us,onGoCreatorStart:Ca,quests:Rs,onOpenWorkspace:async s=>{at(s.id),localStorage.setItem("quest-id",s.id),Xe(s.title||""),it(s.description||""),tt(s.area_name||"");const l=Array.isArray(s.tags)?s.tags:[];$t(l.filter(G=>Ge.includes(G))),Mt(l.filter(G=>!Ge.includes(G))),s.location_lat&&s.location_lng&&pt({lat:s.location_lat,lng:s.location_lng}),await va(s.id);const{data:T}=await D.from("story_timelines").select("*").eq("quest_id",s.id).maybeSingle();T&&Ht(G=>({...G,castName:T.cast_name||"",castTone:T.cast_tone||"",prologueBody:T.prologue||"",epilogueBody:T.epilogue||"",characters:Array.isArray(T.characters)?T.characters:[],scenario:Array.isArray(T.scenario)?T.scenario:[]})),vs(s.id),rt(s.id)},onOpenAnalytics:s=>{vr(s.id,s.title)},onDeleteQuest:async s=>{if(window.confirm(`「${s.title||"このクエスト"}」を削除しますか？
この操作は取り消せません。`))try{const{error:T}=await D.from("quests").delete().eq("id",s.id);if(T)throw T;bt(G=>G.filter(pe=>pe.id!==s.id))}catch(T){console.error("Failed to delete quest:",T),alert("削除に失敗しました")}},t:p.profilePage}),i==="creator-start"&&e.jsx(Ko,{selectedType:Ye,setSelectedType:Es,onBack:()=>ft(),onStart:async()=>{if(Ye==="mystery"){const s=localStorage.getItem("quest-id");s&&localStorage.removeItem(`workspace-step:${s}`),Xe(""),it(""),tt(""),pt(null),dt([]),We(1),Pt(null),$t([]),Mt([]),Ht({castName:"",castTone:"",castIcon:"",prologueTitle:"",prologueBody:"",prologueImage:"",epilogueBody:"",socialMessage:"",epilogueImage:"",characters:[],scenario:[]});const l=await Gs();l&&(localStorage.setItem("quest-id",l),localStorage.setItem(`workspace-step:${l}`,"1"),localStorage.setItem(`quest-init-status:${l}`,"pending")),rt()}else js()},onOpenOnboarding:Us}),i==="creator-canvas"&&e.jsx(uo,{questId:ye,onBack:()=>ft(),onLogoHome:()=>Qe(),onPublish:Ks,onTestRun:()=>Ws()}),i==="creator-mystery-setup"&&e.jsx(Jo,{location:et,setLocation:tt,title:ms,setTitle:Xe,description:_t,setDescription:it,onSaveNext:()=>{We(2),ys(1),rt()},onBack:()=>rt(),onLogoHome:()=>Qe(),onGoWorkspace:()=>rt(),userId:(I==null?void 0:I.id)||null,questId:ye,setQuestId:at,setQuestLatLng:pt,questLatLng:St}),i==="creator-route-spots"&&e.jsx(Fo,{onBack:()=>rt(),onComplete:()=>{We(3),ys(2),rt()},onLogoHome:()=>Qe(),routeSpots:st,setRouteSpots:dt,onOpenSpotDetail:s=>{Pt(s),Ae("creator-spot-detail",{spotId:s})},questId:ye}),i==="creator-storytelling"&&e.jsx(qo,{onLogoHome:()=>Qe(),onBack:()=>rt(),onSaveComplete:s=>{Ht(s),We(4),ys(3),rt()},storySettings:gt,spots:st,isSocialQuest:Ye==="scavenger",questId:ye}),i==="creator-test-run"&&e.jsx(Vo,{onLogoHome:()=>Qe(),onBack:()=>rt(),onComplete:()=>{We(5),ys(4),rt()},questTitle:ms,questDescription:_t,questLocation:et,questLatLng:St,routeSpots:st,storySettings:gt,questId:ye,userId:(I==null?void 0:I.id)||null,userEmail:(I==null?void 0:I.email)||null,questCategoryTags:mt,setQuestCategoryTags:$t,questHashtags:ts,setQuestHashtags:Mt}),i==="creator-submitted"&&e.jsx(Uo,{onLogoHome:()=>Qe(),onBackHome:()=>rt()}),i==="admin-dashboard"&&((c==null?void 0:c.role)==="admin"?e.jsx(Go,{pending:re,onReview:s=>Ae("admin-review",{questId:s}),onBackHome:()=>Qe()}):e.jsx("div",{className:"py-32 text-center text-stone-500",children:"管理者のみアクセス可能です。"})),i==="admin-review"&&((c==null?void 0:c.role)==="admin"?e.jsx(Wo,{questBundle:E,onBack:()=>Ae("admin-dashboard"),onApprove:zr,onReject:$r,loading:je}):e.jsx("div",{className:"py-32 text-center text-stone-500",children:"管理者のみアクセス可能です。"})),i==="creator-spot-detail"&&(()=>{const s=st.find(ge=>ge.id===hs)||st[0]||null,l=s?st.findIndex(ge=>ge.id===s.id):-1,T=l>=0&&l<st.length-1?st[l+1]:null;if(!s)return ls(),null;const G=ge=>{$a(ge),ls()},pe=ge=>{$a(ge),T?(Pt(T.id),Ae("creator-spot-detail",{spotId:T.id}),window.scrollTo({top:0,behavior:"smooth"})):ls()};return e.jsx(Bo,{spot:s,onLogoHome:()=>Qe(),onBackList:()=>ls(),onSaveBack:ge=>G(ge),onSaveNext:ge=>pe(ge),nextSpot:T,questId:ye,setRouteSpots:dt})})(),i==="creator-workspace"&&e.jsx(Ro,{onBack:()=>ft(),onPreview:()=>{},activeStep:ht,setActiveStep:We,onGoStep2:ls,onGoStep3:yr,onGoStep4:Ws,onPublish:Ks,onLogoHome:()=>Qe(),onGoStep1:()=>jr(),showAnalytics:!1,analytics:as,analyticsFilter:ne,onChangeAnalyticsFilter:s=>He(s),onOpenDetail:(s,l)=>Tt(s,l),detailQuestAnalytics:qe,detailLoading:Ze,onAiGenerateDraft:Cr,aiDraftLoading:xr,aiDraftError:mr,onDeleteQuest:Ir,deleteLoading:hr,questId:ye,onGoMultilingual:()=>{We(4),Ae("creator-workspace-languages",{questId:ye}),U(!1),u(!1),$(!1),window.scrollTo({top:0,behavior:"smooth"})},questMode:ps,onPlayNow:()=>Ws(),onOpenShareModal:()=>Ta("SHARE"),onOpenPublishModal:()=>Ta("PUBLISH"),isPaidUser:(c==null?void 0:c.role)==="creator"||(c==null?void 0:c.role)==="admin"}),e.jsx(Co,{isOpen:Ds,onClose:()=>qt(!1),targetMode:us,currentChecklist:ut,onChecklistChange:wr,onConfirm:kr,userId:I==null?void 0:I.id,shareToken:Ls,onGenerateShareToken:Ia}),i==="creator-analytics"&&e.jsx(To,{onBack:()=>ft(),onLogoHome:()=>Qe(),analytics:as,analyticsFilter:ne,onChangeAnalyticsFilter:s=>He(s),onOpenDetail:(s,l)=>Tt(s,l),detailQuestAnalytics:qe,detailLoading:Ze}),i==="player"&&e.jsx(hl,{onBackHome:()=>Qe()}),i==="about"&&e.jsx(jo,{t:{nav:{about:"TOMOSHIBIについて"},aboutPage:{title:"TOMOSHIBIについて",subtitle:"街歩き×謎解きで、日常を冒険に変える",missionTitle:"Mission",missionText:"私たちは、テクノロジーと物語の力で、人々が街を歩き、発見し、つながる新しい体験を創造します。日常の風景に隠された物語を解き明かすことで、街への愛着と人々の絆を深めます。",visionTitle:"Vision",visionText:"世界中の街が、物語で彩られる未来。TOMOSHIBIは、ローカルの魅力を世界に届け、旅行者と地域をつなぐプラットフォームを目指します。",valuesTitle:"私たちの価値観",values:[{title:"冒険心",description:"未知への好奇心を大切にし、新しい発見を楽しむ心を育みます。"},{title:"地域愛",description:"街の歴史や文化を尊重し、地域の魅力を再発見する機会を提供します。"},{title:"つながり",description:"人と人、人と街をつなぎ、共有体験を通じて絆を深めます。"},{title:"創造性",description:"クリエイターの自由な発想を支援し、多様な物語を世界に届けます。"}],teamTitle:"【作成中】運営チーム",teamSubtitle:"TOMOSHIBIを運営するメンバーを紹介します",members:[{name:"メンバー 1",role:"Founder / CEO",bio:"TOMOSHIBIの創業者。街歩きと謎解きを通じて、新しい体験を創造することに情熱を注いでいます。"},{name:"メンバー 2",role:"CTO",bio:"技術面でTOMOSHIBIを支える。ユーザー体験を最高にするための開発をリードしています。"},{name:"メンバー 3",role:"クリエイティブディレクター",bio:"ストーリーテリングとデザインを担当。没入感のある体験を設計しています。"}],backToHome:"ホームに戻る"}},onLogoHome:()=>Qe()}),i==="business"&&e.jsx(So,{}),Er&&e.jsxs(e.Fragment,{children:[e.jsx(go,{onNavigateToQuests:At,translations:{title:p.hero.title,description:p.hero.description}}),e.jsx("section",{className:"py-10 border-y border-stone-200/50 bg-white/40 backdrop-blur-sm",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 text-center divide-y md:divide-y-0 md:divide-x divide-stone-200",children:Mo.map((s,l)=>e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:l*.1},className:"py-4 md:py-0",children:[e.jsx("div",{className:"text-sm text-stone-500 mb-2 font-medium",children:l===0?p.stats.area:l===1?p.stats.quests:p.stats.players}),e.jsx("div",{className:"text-3xl md:text-4xl font-serif font-bold text-brand-dark",children:l===0?p.stats.areaValue:s.value})]},l))}),e.jsx("p",{className:"text-center text-stone-500 mt-10 text-sm md:text-base font-light italic",children:f==="ja"?"「観光、デート、家族のおでかけ、チームビルディングまで。街歩きが“物語体験”に変わる新しい余暇のかたちです。」":f==="en"?'"From sightseeing to dates, family outings, and team building. A new form of leisure turning city walks into story experiences."':`"관광, 데이트, 가족 나들이, 팀 빌딩까지. 거리 산책이 '이야기 체험'으로 바뀌는 새로운 여가 형태입니다."`})]})}),e.jsxs("section",{id:"features",className:"py-32 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-stone-50 via-white to-amber-50/20"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(212,165,116,0.03)_0%,transparent_50%)] pointer-events-none"}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 relative z-10",children:[e.jsx(Yt,{subtitle:p.hero.description,children:p.nav.features}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mt-16",children:p.features.list.map((s,l)=>{const T=Po[l].icon;return e.jsxs(N.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:l*.15,duration:.5},whileHover:{y:-8},className:"group relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-gold/20 to-amber-400/10 rounded-[2rem] blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsxs("div",{className:"relative bg-white/80 backdrop-blur-sm rounded-[2rem] p-8 shadow-sm hover:shadow-2xl transition-all duration-500 border border-stone-100/80 overflow-hidden h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/60 via-transparent to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-stone-100/50 to-transparent rounded-bl-[100px] -mr-8 -mt-8 transition-all duration-500 group-hover:from-brand-gold/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"relative w-14 h-14 mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-gold/10 to-amber-100/50 rounded-2xl transition-all duration-500 group-hover:scale-125 group-hover:opacity-60"}),e.jsx("div",{className:"relative w-full h-full bg-white border border-stone-100 rounded-2xl flex items-center justify-center text-stone-400 group-hover:border-brand-gold/30 group-hover:text-brand-gold group-hover:shadow-lg transition-all duration-300",children:e.jsx(T,{size:26,strokeWidth:1.5})})]}),e.jsx("h3",{className:"text-xl font-bold mb-4 text-brand-dark group-hover:text-brand-gold transition-colors duration-300",children:s.title}),e.jsx("p",{className:"text-stone-500 text-sm leading-relaxed group-hover:text-stone-600 transition-colors",children:s.desc})]})]})]},l)})})]})]}),e.jsxs("section",{id:"spr",className:"py-24 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-stone-900 via-stone-800 to-stone-900"}),e.jsxs("div",{className:"absolute inset-0 opacity-10",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 border border-brand-gold rounded-full"}),e.jsx("div",{className:"absolute bottom-1/3 right-1/3 w-48 h-48 border border-amber-500/50 rounded-full"}),e.jsx("div",{className:"absolute top-1/2 right-1/4 w-32 h-32 border border-brand-gold/30 rounded-full"})]}),e.jsx("div",{className:"container mx-auto px-4 md:px-8 relative z-10",children:e.jsxs(N.div,{className:"max-w-4xl mx-auto text-center",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6},children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 bg-brand-gold/10 backdrop-blur-md rounded-full text-brand-gold text-xs font-bold mb-8 border border-brand-gold/30 shadow-lg",children:[e.jsx("span",{className:"relative w-2 h-2 rounded-full bg-brand-gold",children:e.jsx("span",{className:"absolute inset-0 rounded-full bg-brand-gold animate-ping opacity-75"})}),p.spr.badge]}),e.jsxs("h2",{className:"text-4xl md:text-5xl lg:text-6xl font-serif font-bold text-white mb-6 leading-tight",children:[e.jsx("span",{className:"text-brand-gold",children:p.spr.title}),e.jsx("span",{className:"text-white",children:p.spr.subtitle})]}),e.jsxs("p",{className:"text-sm md:text-base text-stone-400 font-mono tracking-widest mb-8",children:["— ",p.spr.fullName," —"]}),e.jsx("p",{className:"text-stone-300 text-lg md:text-xl leading-relaxed mb-10 max-w-2xl mx-auto",children:p.spr.description}),e.jsx("div",{className:"flex justify-center mb-10",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-brand-gold/50 flex items-center justify-center bg-brand-gold/10 backdrop-blur-sm",children:e.jsx(sr,{size:40,className:"text-brand-gold"})}),e.jsx("div",{className:"absolute -bottom-2 -right-2 w-8 h-16 border-4 border-brand-gold/50 rounded-full transform rotate-45 origin-top"})]})}),e.jsxs(N.button,{onClick:()=>At("spr"),className:"group bg-brand-gold text-brand-dark px-8 py-4 rounded-full font-bold text-lg shadow-xl flex items-center gap-3 mx-auto hover:bg-amber-500 transition-colors",whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},children:[e.jsx(ha,{size:20}),e.jsx("span",{children:p.spr.cta}),e.jsx(xt,{size:18,className:"group-hover:translate-x-1 transition-transform"})]})]})})]}),e.jsxs("section",{id:"how-it-works",className:"py-32 relative overflow-hidden bg-gradient-to-b from-white via-stone-50/50 to-white",children:[e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,rgba(212,165,116,0.05)_1px,transparent_1px),linear-gradient(to_bottom,rgba(212,165,116,0.05)_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_70%_60%_at_50%_50%,#000_60%,transparent_100%)] pointer-events-none"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-brand-gold/5 rounded-full blur-[150px] pointer-events-none"}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 relative z-10",children:[e.jsx(Yt,{subtitle:p.steps.title,children:p.nav.howItWorks}),e.jsx("div",{className:"max-w-5xl mx-auto mt-20",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 md:left-1/2 top-0 bottom-0 w-px md:-translate-x-1/2 overflow-hidden",children:e.jsx(N.div,{className:"w-full h-full bg-gradient-to-b from-brand-gold via-amber-400 to-orange-300",initial:{scaleY:0},whileInView:{scaleY:1},viewport:{once:!0},transition:{duration:1.5,ease:"easeOut"},style:{transformOrigin:"top"}})}),p.steps.list.map((s,l)=>e.jsxs(N.div,{initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{delay:l*.25,duration:.6},className:`relative flex flex-col md:flex-row gap-8 items-start mb-24 last:mb-0 ${l%2===0?"":"md:flex-row-reverse"}`,children:[e.jsx(N.div,{className:"absolute left-6 md:left-1/2 -translate-x-1/2 z-20 mt-6",whileInView:{scale:[0,1.2,1]},viewport:{once:!0},transition:{delay:l*.25+.3,duration:.4},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 w-5 h-5 bg-brand-gold rounded-full blur-md opacity-60"}),e.jsx("div",{className:"relative w-5 h-5 bg-gradient-to-br from-brand-gold to-amber-500 border-4 border-white rounded-full shadow-lg"})]})}),e.jsx("div",{className:`pl-16 md:pl-0 md:w-1/2 ${l%2===0?"md:pr-20 text-left":"md:pl-20 md:text-left"}`,children:e.jsxs(N.div,{className:"group relative bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-stone-100 shadow-sm hover:shadow-xl transition-all duration-500",whileHover:{y:-4},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-gold/10 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsx("div",{className:`absolute top-0 text-[7rem] font-serif font-bold leading-none select-none pointer-events-none ${l%2===0,"-left-4 md:-left-6"}`,children:e.jsxs("span",{className:"text-transparent bg-clip-text bg-gradient-to-br from-stone-100 to-stone-200 group-hover:from-brand-gold/20 group-hover:to-amber-200/30 transition-all duration-500",children:["0",l+1]})}),e.jsxs("div",{className:"relative",children:[e.jsx("h3",{className:"text-2xl font-bold text-brand-dark mb-3 group-hover:text-brand-gold transition-colors duration-300",children:s.title}),e.jsx("p",{className:"text-stone-600 leading-relaxed text-base",children:s.desc})]})]})}),e.jsx("div",{className:"hidden md:block md:w-1/2"})]},l))]})})]})]}),e.jsxs("section",{id:"scenes",className:"py-32 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white via-amber-50/20 to-stone-50"}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 relative z-10",children:[e.jsx(Yt,{subtitle:p.scenes.subtitle,children:p.scenes.title}),e.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:p.scenes.list.map((s,l)=>{const T=ra[l].icon;return e.jsxs(N.div,{initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},transition:{delay:l*.15,duration:.6},whileHover:{y:-12},className:"group relative",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-brand-gold/30 via-amber-400/20 to-orange-400/30 rounded-[2rem] blur-xl opacity-0 group-hover:opacity-70 transition-opacity duration-700"}),e.jsxs("div",{className:"relative h-[420px] rounded-3xl overflow-hidden shadow-xl group-hover:shadow-2xl transition-shadow duration-500",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:ra[l].image,alt:s.title,className:"w-full h-full object-cover transition-transform duration-1000 ease-out group-hover:scale-[1.15]"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-brand-dark via-brand-dark/50 to-transparent opacity-90"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-gold/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"})]}),e.jsxs("div",{className:"absolute inset-0 p-8 flex flex-col justify-end",children:[e.jsx(N.div,{className:"w-14 h-14 bg-white/10 backdrop-blur-md rounded-2xl flex items-center justify-center text-white mb-4 border border-white/20 shadow-lg",whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:300},children:e.jsx(T,{size:26})}),e.jsxs("div",{className:"relative inline-block mb-2",children:[e.jsx("span",{className:"text-brand-gold text-xs font-bold tracking-widest uppercase",children:ra[l].target}),e.jsx(N.div,{className:"absolute -bottom-1 left-0 h-px bg-gradient-to-r from-brand-gold to-transparent",initial:{width:0},whileInView:{width:"100%"},viewport:{once:!0},transition:{delay:l*.15+.5,duration:.5}})]}),e.jsx("h3",{className:"text-2xl font-serif font-bold mb-3 text-white group-hover:text-brand-gold/90 transition-colors duration-300",children:s.title}),e.jsx(N.p,{className:"text-stone-200/90 text-sm leading-relaxed",initial:{opacity:0,y:10},whileInView:{opacity:0},animate:{opacity:0},whileHover:{opacity:1,y:0},transition:{duration:.3},children:s.desc}),e.jsx("p",{className:"text-stone-200/90 text-sm leading-relaxed opacity-0 group-hover:opacity-100 transform translate-y-4 group-hover:translate-y-0 transition-all duration-400",children:s.desc})]})]})]},l)})})]})]}),e.jsxs("section",{id:"creators",className:"py-32 my-10 relative overflow-hidden",children:[e.jsx(N.div,{className:"absolute inset-0 bg-gradient-to-br from-brand-dark via-stone-900 to-brand-dark",animate:{background:["linear-gradient(to bottom right, #1c1917, #292524, #1c1917)","linear-gradient(to bottom right, #292524, #1c1917, #292524)","linear-gradient(to bottom right, #1c1917, #292524, #1c1917)"]},transition:{duration:10,repeat:1/0,ease:"linear"}}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-brand-gold/10 rounded-full blur-[150px] pointer-events-none"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-amber-500/10 rounded-full blur-[100px] pointer-events-none"}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 relative z-10",children:[e.jsxs(N.div,{className:"text-center mb-16",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{duration:.6},children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 bg-white/5 backdrop-blur-md rounded-full text-brand-gold text-xs font-bold mb-6 border border-brand-gold/20 shadow-lg",children:[e.jsx("span",{className:"relative w-2 h-2 rounded-full bg-brand-gold",children:e.jsx("span",{className:"absolute inset-0 rounded-full bg-brand-gold animate-ping opacity-75"})}),"FOR CREATORS"]}),e.jsx("h2",{className:"text-4xl md:text-5xl font-serif font-bold text-white mb-6 leading-tight",children:p.creators.title}),e.jsx("p",{className:"text-stone-400 text-lg max-w-2xl mx-auto",children:"プログラミング不要。直感的なUIで誰でもクエストを作成・公開できます。"})]}),e.jsxs(N.div,{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16",initial:"hidden",whileInView:"visible",viewport:{once:!0},variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},children:[e.jsxs(N.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},className:"bg-white/10 backdrop-blur-sm border border-white/10 rounded-2xl p-6 hover:bg-white/15 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-brand-gold to-amber-500 flex items-center justify-center mb-4",children:e.jsx(Be,{size:24,className:"text-brand-dark"})}),e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"AI自動生成"}),e.jsx("p",{className:"text-sm text-stone-400 leading-relaxed",children:"ストーリー・謎・ヒント・キャラクター会話をAIが自動生成。アイデアから完成まで最速で。"})]}),e.jsxs(N.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},className:"bg-white/10 backdrop-blur-sm border border-white/10 rounded-2xl p-6 hover:bg-white/15 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center mb-4",children:e.jsx(Fe,{size:24,className:"text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"スポット設定"}),e.jsx("p",{className:"text-sm text-stone-400 leading-relaxed",children:"地図上で直感的にスポットを配置。道順、ヒント、正解条件を細かく設定できます。"})]}),e.jsxs(N.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},className:"bg-white/10 backdrop-blur-sm border border-white/10 rounded-2xl p-6 hover:bg-white/15 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-400 to-indigo-500 flex items-center justify-center mb-4",children:e.jsx(Dt,{size:24,className:"text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"多言語対応"}),e.jsx("p",{className:"text-sm text-stone-400 leading-relaxed",children:"日本語・英語・韓国語に対応。AIが翻訳をサポートし、インバウンド対応も簡単。"})]}),e.jsxs(N.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},className:"bg-white/10 backdrop-blur-sm border border-white/10 rounded-2xl p-6 hover:bg-white/15 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-rose-400 to-pink-500 flex items-center justify-center mb-4",children:e.jsx(zs,{size:24,className:"text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"プレイ分析"}),e.jsx("p",{className:"text-sm text-stone-400 leading-relaxed",children:"参加数、クリア率、離脱ポイントを可視化。データを元に改善できます。"})]})]}),e.jsxs(N.div,{className:"text-center",initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:.4},children:[e.jsxs(N.button,{onClick:js,className:"relative group bg-white text-brand-dark px-10 py-5 rounded-full font-bold text-lg shadow-xl flex items-center gap-3 mx-auto overflow-hidden",whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},children:[e.jsx(N.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-brand-gold/30 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"}),e.jsx(Be,{size:20,className:"relative z-10 group-hover:text-brand-gold transition-colors"}),e.jsx("span",{className:"relative z-10",children:p.creators.cta}),e.jsx(xt,{size:18,className:"relative z-10 group-hover:translate-x-1 transition-transform"})]}),e.jsx("p",{className:"text-stone-500 text-sm mt-4",children:"無料で始められます"})]})]})]}),e.jsxs("section",{id:"faq",className:"py-32 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-stone-50 via-white to-amber-50/10"}),e.jsxs("div",{className:"container mx-auto px-4 md:px-8 max-w-3xl relative z-10",children:[e.jsx(Yt,{subtitle:p.faq.title,children:"FAQ"}),e.jsx("div",{className:"space-y-4",children:p.faq.list.map((s,l)=>e.jsx(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{delay:l*.1},className:"group",children:e.jsxs("div",{className:`bg-white/80 backdrop-blur-sm rounded-2xl overflow-hidden border transition-all duration-300 ${x===l?"border-brand-gold/30 shadow-lg shadow-brand-gold/5":"border-stone-200 shadow-sm hover:border-brand-gold/20 hover:shadow-md"}`,children:[e.jsxs("button",{onClick:()=>Pr(l),className:"w-full px-6 py-5 text-left flex justify-between items-center gap-4 hover:bg-stone-50/50 transition-colors",children:[e.jsx("span",{className:`font-bold transition-colors duration-300 ${x===l?"text-brand-gold":"text-brand-dark"}`,children:s.q}),e.jsx(N.div,{animate:{rotate:x===l?180:0},transition:{duration:.3,ease:"easeOut"},className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-colors ${x===l?"bg-brand-gold/10 text-brand-gold":"bg-stone-100 text-stone-400"}`,children:e.jsx(Nt,{size:18})})]}),e.jsx(Ue,{children:x===l&&e.jsx(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeOut"},className:"overflow-hidden",children:e.jsx("div",{className:"px-6 pb-5 text-stone-600 text-sm leading-relaxed border-t border-stone-100",children:e.jsx("div",{className:"pt-4",children:s.a})})})})]})},l))})]})]}),e.jsx("section",{className:"py-20 relative overflow-hidden",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 max-w-4xl",children:e.jsxs(N.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0},className:"bg-white border border-stone-200 rounded-3xl p-8 md:p-12 shadow-xl text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-brand-dark via-brand-gold to-brand-dark"}),e.jsx("div",{className:"absolute -left-10 -bottom-10 w-40 h-40 bg-brand-gold/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -right-10 -top-10 w-40 h-40 bg-brand-dark/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-brand-base rounded-full text-brand-gold mb-6",children:e.jsx(ia,{size:24})}),e.jsx("h3",{className:"text-2xl md:text-3xl font-serif font-bold text-brand-dark mb-4",children:p.registration.title}),e.jsx("p",{className:"text-stone-600 mb-8 max-w-xl mx-auto whitespace-pre-line",children:p.registration.description}),gs==="success"?e.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-green-50 border border-green-200 text-green-700 px-6 py-4 rounded-xl inline-flex items-center gap-2",children:[e.jsx(ot,{size:20}),e.jsx("span",{children:p.registration.successMessage})]}):e.jsxs("form",{onSubmit:Ar,className:"flex flex-col sm:flex-row gap-3 max-w-md mx-auto",children:[e.jsx("input",{type:"email",placeholder:p.registration.emailPlaceholder,value:ya,onChange:s=>Na(s.target.value),required:!0,disabled:gs==="submitting",className:"flex-1 px-5 py-3 rounded-full border border-stone-300 bg-stone-50 focus:outline-none focus:ring-2 focus:ring-brand-gold/50 focus:border-brand-gold transition-all disabled:opacity-50"}),e.jsx("button",{type:"submit",disabled:gs==="submitting",className:"bg-brand-dark text-white px-8 py-3 rounded-full font-bold hover:bg-brand-gold transition-colors shadow-md flex items-center justify-center gap-2 disabled:opacity-70",children:gs==="submitting"?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[p.registration.submitButton," ",e.jsx(As,{size:16})]})})]}),e.jsx("p",{className:"text-xs text-stone-400 mt-6",children:p.registration.privacyNote})]})]})})})]}),e.jsx(Ue,{children:q&&e.jsx(Do,{steps:na,activeIndex:Ce,onClose:Sa,onNext:ur})}),e.jsx(Ue,{children:e.jsx(Lo,{visible:Dr,onPrimary:Ma,onDismiss:Or,comingSoon:!ws,onScrollNotify:Lr})}),i!=="creator-canvas"&&i!=="creator-mystery-setup"&&i!=="creator-workspace"&&i!=="creator-route-spots"&&i!=="creator-spot-detail"&&i!=="creator-storytelling"&&e.jsx("footer",{id:"contact",className:"bg-brand-dark pt-20 pb-10 border-t border-brand-dark/50 mt-10",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-5xl font-serif font-bold text-white mb-6 whitespace-pre-line",children:p.footer.cta}),e.jsx("button",{onClick:At,className:"bg-brand-gold text-white px-10 py-4 rounded-full font-bold text-xl hover:bg-white hover:text-brand-dark transition-colors shadow-lg shadow-brand-gold/20",children:p.nav.findQuest}),e.jsx("div",{className:"mt-8 flex justify-center gap-4 opacity-90 hover:opacity-100 transition-all duration-500 flex-wrap",children:ws?e.jsxs(e.Fragment,{children:[Io,Va]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-12 w-36 bg-stone-800/50 rounded-lg flex items-center justify-center border border-stone-600/50 cursor-not-allowed",children:e.jsx("span",{className:"text-xs text-stone-400",children:"App Store"})}),e.jsx("div",{className:"h-12 w-36 bg-stone-800/50 rounded-lg flex items-center justify-center border border-stone-600/50 cursor-not-allowed",children:e.jsx("span",{className:"text-xs text-stone-400",children:"Google Play"})})]})}),e.jsx("p",{className:"text-xs text-stone-500 mt-2",children:ws?p.footer.appAvailable:p.footer.appComingSoon})]}),e.jsxs("div",{className:"border-t border-stone-700/50 pt-10 flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(kt,{className:"h-8 w-auto",color:"#78716c"})}),e.jsxs("div",{className:"flex gap-6 text-sm text-stone-500 flex-wrap justify-center md:justify-start",children:[e.jsx("a",{href:"/about",className:"hover:text-white transition-colors",children:"TOMOSHIBIについて"}),e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:p.footer.company}),e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:p.footer.privacyPolicy}),e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:p.footer.terms}),e.jsxs("a",{href:"mailto:info@tomoshibi.app",className:"hover:text-white transition-colors flex items-center gap-1",children:[e.jsx(ia,{size:14})," ",p.footer.contactFooter]})]}),e.jsxs("div",{className:"text-xs text-stone-600",children:["© ",new Date().getFullYear()," TOMOSHIBI. All rights reserved."]})]})]})})]})}const Ko=({selectedType:t,setSelectedType:a,onBack:n,onStart:r,onOpenOnboarding:m})=>{const g=[{id:"mystery",icon:wt,title:"ウォーキングクエスト",subtitle:"Walking Quest",description:"ストーリーと謎解きに特化したスタンダードなフォーマット。街を歩きながら物語を体験し、各スポットで謎を解き明かしていきます。観光・地域活性化・エンターテイメントに最適。",features:["没入感のあるストーリー展開","各スポットでの謎解きチャレンジ","街の魅力を再発見する体験設計"],badge:"スタンダード",badgeColor:"bg-emerald-100 text-emerald-700 border-emerald-200"},{id:"scavenger",icon:Ot,title:"スカベンジャーハント",subtitle:"Scavenger Hunt",description:"指定されたアイテムや場所を探索・収集するフォーマット。一般的な宝探しゲームとしてはもちろん、ゴミ拾いや施設点検など社会貢献活動のゲーム化にも活用できます。",features:["宝探し・アイテム収集ゲーム","ゴミ拾い・清掃活動のゲーム化","インフラ点検・施設報告ミッション","地域課題解決への参加促進"],badge:"探索型",badgeColor:"bg-blue-100 text-blue-700 border-blue-200"}];return e.jsx("section",{className:"pt-24 pb-14 bg-brand-base min-h-screen",children:e.jsxs("div",{className:"container mx-auto px-4 md:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-stone-600",children:[e.jsx("button",{onClick:n,className:"underline hover:text-brand-dark",children:"戻る"}),e.jsx("span",{className:"text-stone-400",children:"/"}),e.jsx("span",{className:"font-bold text-brand-dark",children:"新規クエスト制作"})]}),e.jsx("div",{className:"flex items-center gap-3 text-sm",children:e.jsx("button",{onClick:m,className:"text-brand-gold font-bold hover:underline",children:"チュートリアルを見る"})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white/90 backdrop-blur border border-white/70 rounded-3xl p-6 md:p-8 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Be,{size:18,className:"text-brand-gold"}),e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Before You Start"})]}),e.jsx("h2",{className:"text-2xl font-serif font-bold text-brand-dark mb-6",children:"制作を始める前に"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-brand-dark mb-2",children:"必要な視点 (Mindset)"}),e.jsxs("ul",{className:"space-y-2 text-sm text-stone-700 list-disc list-inside",children:[e.jsx("li",{children:"街への好奇心を持つ：普段は見過ごしてしまう路地裏や、隠れた歴史に目を向けてみましょう。"}),e.jsx("li",{children:"課題をエンタメに変える発想：地域の困りごとを、プレイヤーが解決したくなる「ミッション」に変換できないか考えてみましょう。"})]})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-stone-200 to-transparent"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-brand-dark mb-2",children:"準備するもの (Preparation)"}),e.jsxs("ul",{className:"space-y-2 text-sm text-stone-700 list-disc list-inside",children:[e.jsx("li",{children:"現地のロケハン：実際に歩いて、安全なルートや魅力的なスポットを確認してください。"}),e.jsx("li",{children:"ストーリーの種：街の雰囲気からインスピレーションを得た、オリジナルの物語の構想。"})]})]})]})]}),e.jsxs("div",{className:"bg-white/95 backdrop-blur border border-white/70 rounded-3xl p-6 md:p-8 shadow-2xl flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-brand-gold font-bold",children:"Quest Type"}),e.jsx("div",{className:"text-xs text-stone-500",children:"クエストの種類を選択してください"})]}),e.jsx("div",{className:"space-y-4",children:g.map(d=>{const u=t===d.id,x=d.icon;return e.jsx("button",{onClick:()=>a(d.id),className:`w-full text-left bg-white border-2 rounded-2xl p-5 transition-all ${u?"border-brand-gold shadow-lg shadow-brand-gold/10 ring-2 ring-brand-gold/20":"border-stone-200 hover:border-stone-300 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shrink-0 ${u?"bg-brand-gold text-white":"bg-stone-100 text-stone-600"}`,children:e.jsx(x,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-brand-dark",children:d.title}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full border ${d.badgeColor}`,children:d.badge})]}),e.jsx("p",{className:"text-xs text-stone-500 mb-2",children:d.subtitle}),e.jsx("p",{className:"text-sm text-stone-700 leading-relaxed mb-3",children:d.description}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.features.map((b,f)=>e.jsx("span",{className:"text-[11px] px-2 py-1 rounded-full bg-stone-100 text-stone-600",children:b},f))})]}),e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center shrink-0 ${u?"border-brand-gold bg-brand-gold":"border-stone-300"}`,children:u&&e.jsx(ot,{size:16,className:"text-white"})})]})},d.id)})}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{onClick:r,className:"px-6 py-3 rounded-full bg-brand-dark text-white font-bold text-sm hover:bg-brand-gold transition-colors shadow-lg flex items-center gap-2",children:[e.jsx(ds,{size:16}),"制作を開始する"]})})]})]})]})})},Jo=({location:t,setLocation:a,title:n,setTitle:r,description:m,setDescription:g,onSaveNext:d,onBack:u,onLogoHome:x,onGoWorkspace:b,userId:f,questId:v,setQuestId:p,setQuestLatLng:i,questLatLng:_})=>{const w=o.useRef(null),B=o.useRef(null),L=o.useRef(null),O=o.useRef(null),[R,be]=o.useState({lat:35.6804,lng:139.769}),[Y,ee]=o.useState([]),[P,he]=o.useState(!1),[re,xe]=o.useState(!1),[te,A]=o.useState(null),Z=E=>{const V=(E==null?void 0:E.place_type)||[];return E!=null&&E.bbox?null:V.includes("country")?6:V.includes("region")?9:V.includes("place")?12:V.includes("locality")?13:V.includes("neighborhood")?14:15};o.useEffect(()=>{or().then(E=>{B.current&&(L.current=new E.Map({container:B.current,style:lr,center:[R.lng,R.lat],zoom:11}),O.current=new E.Marker({color:"#d97706"}).setLngLat([R.lng,R.lat]).addTo(L.current))}).catch(()=>{})},[]),o.useEffect(()=>{!L.current||!O.current||(L.current.setCenter([R.lng,R.lat]),O.current.setLngLat([R.lng,R.lat]))},[R]),o.useEffect(()=>{const E=new AbortController,V=t.trim();if(V.length<2){ee([]);return}return he(!0),fetch(`https://api.maptiler.com/geocoding/${encodeURIComponent(V)}.json?key=${Xt}&language=ja&limit=5`,{signal:E.signal}).then(oe=>oe.json()).then(oe=>ee((oe==null?void 0:oe.features)||[])).catch(()=>ee([])).finally(()=>he(!1)),()=>E.abort()},[t]),o.useEffect(()=>{_&&be(_)},[_]);const me=async()=>{if(!f){A("ログインしてください");return}A(null),xe(!0);try{const{data:E,error:V}=await D.from("quests").upsert({id:v||void 0,creator_id:f,title:n,description:m,area_name:t,location_lat:R.lat,location_lng:R.lng,cover_image_url:""}).select().single();if(V)throw V;E!=null&&E.id&&(p(E.id),i({lat:R.lat,lng:R.lng}),d())}catch(E){A((E==null?void 0:E.message)||"保存に失敗しました")}finally{xe(!1)}};return e.jsxs("section",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-stone-200 bg-white",children:e.jsx("div",{className:"container mx-auto px-4 md:px-8 py-4 flex items-center justify-between gap-6",children:e.jsx("button",{onClick:x,className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:e.jsx(kt,{className:"h-8 w-auto"})})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 min-h-[calc(100vh-64px)]",children:[e.jsxs("div",{className:"px-4 md:px-12 py-12 space-y-8 overflow-y-auto h-[calc(100vh-96px)]",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-4xl font-serif font-bold text-brand-dark mb-1",children:"基本情報を入力しよう"}),e.jsx("p",{className:"text-base font-bold text-stone-700",children:"🎉 クエスト制作を始めましょう！"}),e.jsx("p",{className:"text-sm text-stone-600 max-w-2xl leading-relaxed",children:"あなたの物語の舞台となる場所を決めましょう。実際に現地調査に行ける、あなたにとって馴染み深いエリアを選ぶのが成功の秘訣です。"})]}),e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{className:"space-y-2 relative",children:[e.jsxs("label",{className:"text-sm font-extrabold text-brand-dark flex items-center gap-2",children:["開催エリア (Location) ",e.jsx("span",{children:"📍"})]}),e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"あなたが実際に歩いて調査できる場所を選んでください。"}),e.jsx("input",{type:"text",value:t,onChange:E=>a(E.target.value),placeholder:"都市名や郵便番号で検索（例：大阪府貝塚市）",ref:w,className:"w-full px-4 py-3 rounded-xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"}),Y.length>0&&e.jsxs("div",{className:"mt-2 rounded-2xl border border-stone-200 bg-white shadow-lg max-h-56 overflow-auto z-10",children:[Y.map(E=>e.jsx("button",{onMouseDown:V=>{var ie;V.preventDefault();const[oe,ke]=(E==null?void 0:E.center)||[],je=(E==null?void 0:E.place_name)||"";if(je&&a(je),L.current&&(E!=null&&E.bbox)){const[Se,fe,Me,C]=E.bbox;L.current.fitBounds([[Se,fe],[Me,C]],{padding:80}),be({lat:(fe+C)/2,lng:(Se+Me)/2})}else if(ke&&oe){const Se=Z(E);(ie=L.current)==null||ie.jumpTo({center:[oe,ke],zoom:Se??L.current.getZoom()}),be({lat:ke,lng:oe})}ee([])},className:"w-full text-left px-4 py-2 text-sm text-brand-dark hover:bg-brand-base",children:E==null?void 0:E.place_name},E.id)),P&&e.jsx("div",{className:"px-4 py-2 text-xs text-stone-500",children:"検索中..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-extrabold text-brand-dark flex items-center gap-2",children:["クエストタイトル (Quest Title) ",e.jsx("span",{children:"✏️"})]}),e.jsx("p",{className:"text-xs text-stone-500 mb-1",children:"プレイヤーが思わず参加したくなるような、謎めいたタイトルをつけましょう。"}),e.jsx("input",{type:"text",value:n,onChange:E=>r(E.target.value),placeholder:"魅力的なタイトルを入力（例：二色浜と消えた記憶の灯火）",className:"w-full px-4 py-3 rounded-xl border border-stone-300 bg-white focus:outline-none focus:ring-2 focus:ring-brand-gold/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-extrabold text-brand-dark flex items-center gap-2",children:["概要・ストーリー (Description) ",e.jsx("span",{children:"📝"})]}),e.jsx("p",{className:"text-xs text-stone-500",children:"物語のプロローグ（導入）となる文章です。プレイヤーを世界観に引き込む「依頼文」や「挑戦状」のような書き出しがおすすめです。"}),e.jsxs("div",{className:"rounded-2xl border border-stone-300 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-stone-200 text-xs text-stone-500",children:[e.jsx("button",{className:"px-2.5 py-1.5 rounded-lg border border-stone-200 hover:border-brand-gold hover:text-brand-dark flex items-center gap-1",children:e.jsx(Ur,{size:14})}),e.jsx("button",{className:"px-2.5 py-1.5 rounded-lg border border-stone-200 hover:border-brand-gold hover:text-brand-dark flex items-center gap-1",children:e.jsx(Ja,{size:14})}),e.jsx("button",{className:"px-2.5 py-1.5 rounded-lg border border-stone-200 hover:border-brand-gold hover:text-brand-dark flex items-center gap-1",children:e.jsx(Gr,{size:14})})]}),e.jsx("textarea",{value:m,onChange:E=>g(E.target.value),rows:8,placeholder:"100年前からこの街に伝わる奇妙な噂…。あなたは探偵として、この街に隠された『失われた色』を取り戻す依頼を受けました。",className:"w-full px-4 py-3 rounded-b-2xl bg-white focus:outline-none text-sm text-brand-dark"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between max-w-2xl pt-2",children:[e.jsx("div",{className:"text-xs text-stone-500",children:"Step 1 of 4"}),e.jsx("button",{onClick:me,disabled:re,className:"px-5 py-3 rounded-full bg-brand-dark text-white text-sm font-bold hover:bg-brand-gold transition-colors shadow-lg disabled:opacity-60",children:re?"保存中...":"保存して次へ"})]}),te&&e.jsx("div",{className:"text-sm text-red-600",children:te})]}),e.jsxs("div",{className:"relative bg-white border-l border-stone-200 h-[calc(100vh-64px)]",children:[e.jsx("div",{ref:B,className:"absolute inset-0 w-full h-full"}),!Xt]})]})]})};export{pi as default};
